@model FreedomWeb.ViewModels.Server.CommandListViewModel
@using FreedomUtils.MvcUtils
@{
    ViewBag.Title = "Command list";
}
<div class="panel panel-primary" style="background-color: #1c1e22;">
    <div class="btn btn-block panel-heading" data-toggle="collapse" data-target="#TableCommandListSearchFilterCollapse">
        <i class="glyphicon glyphicon-search"></i>
        Search filters
    </div>
    <div class="panel-collapse collapse" id="TableCommandListSearchFilterCollapse">
        <div class="panel-body" id="TableCommandListSearchFilter">
        </div>
    </div>
</div>
<table class="table table-striped table-bordered" id="TableOnlineList">
    <thead>
        <tr>
            <th>Command</th>
            <th>Syntax</th>
            <th>Description</th>
            <th>Access level</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var command in Model.CommandList)
        {
            <tr>
                <td>
                    <pre style="white-space: pre-wrap; word-break:normal;"><code>@command.Command</code></pre>
                </td>
                <td>
                    <pre style="white-space: pre-wrap; word-break:normal;"><code>@command.Syntax</code></pre>
                </td>
                <td>
                    @if (!string.IsNullOrEmpty(command.Description))
                    {
                        <span style="white-space: pre-wrap; word-break:normal;">@command.Description</span>
                    }
                </td>
                <td>
                    @command.GMLevel.DisplayName()
                </td>
            </tr>
        }
    </tbody>
</table>

@section scripts
{
    <script type="text/javascript">
    $('#TableOnlineList').DataTable({
        "initComplete": function () {
            this.api().columns().every(function () {
                var column = this;
                var header = $(column.header());
                if (header.hasClass('nosearch'))
                    return;

                var input = $('<input/>', {
                    'class': 'form-control',
                    'type': 'search',
                    'placeholder': "Search: " + column.title()
                });
                input.appendTo($('#TableCommandListSearchFilter'));
                input.on('keyup change', function () {
                    var val = $.fn.dataTable.util.escapeRegex(
                        $(this).val()
                    );

                    column
                        .search(val ? '^.*' + val + '.*$' : '', true, false)
                        .draw();
                });
            });
        },
        "order": [[ 1, "asc" ]],
        "dom": '<"top">rt<"row" <"col-md-4"l><"col-md-4"i><"col-md-4"p>><"clear">',
        "columnDefs": [
            {
                "width": "10%",
                "targets": [0,3]
            },
            {
                "width": "50%",
                "targets": 2
            },
            {
                "width": "30%",
                "targets": 1
            },
            {   // index column
                "sortable": false,
                "targets": 'nosort'
            },
            {
                "searchable": false,
                "targets": 'nosearch'
            }
        ],
    });
    </script>
}
