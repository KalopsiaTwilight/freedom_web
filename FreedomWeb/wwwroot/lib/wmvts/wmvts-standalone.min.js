/*! For license information please see wmvts-standalone.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["wmvts-standalone"]=t():e["wmvts-standalone"]=t()}(this,(()=>(()=>{var e={207:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FirstPersonCamera=void 0;const a=r(1278),n=r(9174);var o;!function(e){e[e.None=0]="None",e[e.Positive=1]="Positive",e[e.Negative=-1]="Negative"}(o||(o={}));class i extends n.Camera{constructor(){super(),this.cameraMatrix=a.Float44.identity(),this.position=a.Float3.create(0,0,0),this.pitch=0,this.yaw=Math.PI,this.xMovement=o.None,this.yMovement=o.None,this.zMovement=o.None,this.movementSpeed=50,this.isDraggingMouse=!1}initialize(e){super.initialize(e),e.containerElement&&(this.onMouseDown=this.handleMouseDown.bind(this),this.onTouchStart=this.handleTouchStart.bind(this),this.engine.containerElement.addEventListener("mousedown",this.onMouseDown),this.engine.containerElement.addEventListener("touchstart",this.onTouchStart)),document&&(this.onMouseUp=this.handleDragRelease.bind(this),this.onTouchEnd=this.handleDragRelease.bind(this),this.onMouseMove=this.handleMouseMove.bind(this),this.onTouchMove=this.handleTouchMove.bind(this),this.onKeyUp=this.handleKeyDown.bind(this),this.onKeyDown=this.handleKeyUp.bind(this),document.addEventListener("keydown",this.onKeyUp),document.addEventListener("keyup",this.onKeyDown),document.addEventListener("mouseup",this.onMouseUp),document.addEventListener("touchend",this.onTouchEnd),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("touchmove",this.onTouchMove),document.addEventListener("pointerlockchange",(()=>{})))}update(e){e>100&&(e=100);const t=a.Float4.quatFromEulers(0,this.pitch,this.yaw),r=a.Float44.fromQuat(t),n=a.Float3.create(this.xMovement,this.yMovement,this.zMovement);a.Float3.normalize(n,n);const o=a.Float3.create(this.movementSpeed,this.movementSpeed,this.movementSpeed),i=a.Float3.create(e/1e3,e/1e3,e/1e3);a.Float3.multiply(o,i,o),a.Float3.multiply(o,n,n),a.Float44.transformPoint(n,r,n),a.Float3.add(n,this.position,this.position),a.Float44.identity(this.cameraMatrix),a.Float44.rotateX(this.cameraMatrix,Math.PI/180*90,this.cameraMatrix),a.Float44.translate(this.cameraMatrix,this.position,this.cameraMatrix),a.Float44.multiply(this.cameraMatrix,r,this.cameraMatrix),a.Float44.invert(this.cameraMatrix,this.viewMatrix)}dispose(){this.engine.containerElement&&(this.engine.containerElement.removeEventListener("mousedown",this.onMouseDown),this.engine.containerElement.removeEventListener("touchstart",this.onTouchStart),this.onMouseDown=null,this.onTouchStart=null),document&&(document.removeEventListener("keydown",this.onKeyUp),document.removeEventListener("keyup",this.onKeyDown),document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("touchend",this.onTouchEnd),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("touchmove",this.onTouchMove),this.onMouseUp=null,this.onTouchEnd=null,this.onMouseMove=null,this.onTouchMove=null,this.onKeyUp=null,this.onKeyDown=null),super.dispose()}resizeForBoundingBox(e){if(this.lastBoundingBox=e,e){const{min:t,max:r}=e;a.Float3.copy(r,this.position);const n=a.Float3.negate(this.position),o=Math.sqrt(n[0]*n[0]+n[2]*n[2]);this.pitch=Math.atan2(n[1],o),this.yaw=Math.atan2(n[0],n[2])}}handleKeyDown(e){switch(e.key.toUpperCase()){case"W":return this.zMovement=o.Negative,!1;case"S":return this.zMovement=o.Positive,!1;case"A":return this.xMovement=o.Negative,!1;case"D":return this.xMovement=o.Positive,!1;case"Q":return this.yMovement=o.Positive,!1;case"E":return this.yMovement=o.Negative,!1}return!0}handleKeyUp(e){switch(e.key.toUpperCase()){case"W":case"S":return this.zMovement=o.None,!1;case"A":case"D":return this.xMovement=o.None,!1;case"Q":case"E":return this.yMovement=o.None,!1}return!0}handleMouseDown(e){2!=e.button&&(this.isDraggingMouse=!0,e.preventDefault(),document&&!document.pointerLockElement&&this.engine.containerElement&&this.engine.containerElement.requestPointerLock())}handleTouchStart(e){e.preventDefault(),document&&!document.pointerLockElement&&this.engine.containerElement&&this.engine.containerElement.requestPointerLock()}handleMouseMove(e){this.isDraggingMouse&&this.handleDrag(e.movementX,e.movementY)}handleTouchMove(e){this.handleDrag(e.touches[0].clientX,e.touches[0].clientY)}handleDrag(e,t){const r=Math.PI/180/4,a=e*r,n=t*r;this.pitch+=a,this.yaw+=n}handleDragRelease(){this.isDraggingMouse=!1,document&&document.pointerLockElement&&document.exitPointerLock()}}t.FirstPersonCamera=i},269:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebGlNativeVertexArrayObject=t.WebGLShaderProgram=t.WebGlVertexDataBuffer=t.WebGLVertexIndexBuffer=t.WebGlVertexAttribPointer=t.WebGLTextureAbstraction=t.WebGlGraphics=void 0;const a=r(7983),n=r(2388),o=r(7690),i=r(1278);class s extends o.CachedGraphics{constructor(e){super(),this.gl=e,this.glVaoExt=e.getExtension("OES_vertex_array_object")}startFrame(e,t){super.startFrame(e,t),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.viewport(0,0,e,t),this.gl.depthFunc(this.gl.LEQUAL)}clearFrame(e){this.gl.clearColor(e[0],e[1],e[2],e[3]),this.gl.depthMask(!0),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}activateBlendMode(e){switch(e===n.GxBlend.GxBlend_Opaque?this.gl.disable(this.gl.BLEND):(this.gl.enable(this.gl.BLEND),this.gl.blendEquation(this.gl.FUNC_ADD)),e){case n.GxBlend.GxBlend_Opaque:break;case n.GxBlend.GxBlend_AlphaKey:this.gl.blendFuncSeparate(this.gl.ONE,this.gl.ZERO,this.gl.ONE,this.gl.ONE);break;case n.GxBlend.GxBlend_Alpha:this.gl.blendFuncSeparate(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA);break;case n.GxBlend.GxBlend_Add:this.gl.blendFuncSeparate(this.gl.SRC_ALPHA,this.gl.ONE,this.gl.ZERO,this.gl.ONE);break;case n.GxBlend.GxBlend_Mod:this.gl.blendFuncSeparate(this.gl.DST_COLOR,this.gl.ZERO,this.gl.DST_ALPHA,this.gl.ZERO);break;case n.GxBlend.GxBlend_Mod2x:this.gl.blendFuncSeparate(this.gl.DST_COLOR,this.gl.SRC_COLOR,this.gl.DST_ALPHA,this.gl.SRC_ALPHA);break;case n.GxBlend.GxBlend_ModAdd:this.gl.blendFuncSeparate(this.gl.DST_COLOR,this.gl.ONE,this.gl.DST_ALPHA,this.gl.ONE);break;case n.GxBlend.GxBlend_InvSrcAlphaAdd:this.gl.blendFuncSeparate(this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE);break;case n.GxBlend.GxBlend_InvSrcAlphaOpaque:this.gl.blendFuncSeparate(this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ZERO,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ZERO);break;case n.GxBlend.GxBlend_SrcAlphaOpaque:this.gl.blendFuncSeparate(this.gl.SRC_ALPHA,this.gl.ZERO,this.gl.SRC_ALPHA,this.gl.ZERO);break;case n.GxBlend.GxBlend_NoAlphaAdd:this.gl.blendFuncSeparate(this.gl.ONE,this.gl.ONE,this.gl.ZERO,this.gl.ONE);break;case n.GxBlend.GxBlend_ConstantAlpha:this.gl.blendFuncSeparate(this.gl.CONSTANT_ALPHA,this.gl.ONE_MINUS_CONSTANT_ALPHA,this.gl.CONSTANT_ALPHA,this.gl.ONE_MINUS_CONSTANT_ALPHA);break;case n.GxBlend.GxBlend_Screen:this.gl.blendFuncSeparate(this.gl.ONE_MINUS_DST_COLOR,this.gl.ONE,this.gl.ONE,this.gl.ZERO);break;case n.GxBlend.GxBlend_BlendAdd:this.gl.blendFuncSeparate(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA)}}activateDepthWrite(e){this.gl.depthMask(e)}activateDepthTest(e){this.useGlFeature(this.gl.DEPTH_TEST,e)}activateBackFaceCulling(e){this.useGlFeature(this.gl.CULL_FACE,e)}activateCounterClockWiseFrontFaces(e){e?this.gl.frontFace(this.gl.CCW):this.gl.frontFace(this.gl.CW)}activateColorMask(e){this.gl.colorMask((e&n.ColorMask.Red)>0,(e&n.ColorMask.Green)>0,(e&n.ColorMask.Blue)>0,(e&n.ColorMask.Alpha)>0)}drawTriangles(e,t){this.gl.drawArrays(this.gl.TRIANGLES,e,t)}drawIndexedTriangles(e,t){this.gl.drawElements(this.gl.TRIANGLES,t,this.gl.UNSIGNED_SHORT,e)}drawIndexedTriangleStrip(e,t){this.gl.drawElements(this.gl.TRIANGLE_STRIP,t,this.gl.UNSIGNED_SHORT,e)}useGlFeature(e,t){t?this.gl.enable(e):this.gl.disable(e)}createSolidColorTexture(e){const t=this.gl,r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(i.Float4.scale(e,255))),t.bindTexture(t.TEXTURE_2D,null),new l(this.gl,r)}createTextureFromImg(e,t){return new l(this.gl,(0,a.createTexture)(this.gl,{premultiplyAlpha:0,src:e,auto:!0,wrapS:(null==t?void 0:t.clampS)?this.gl.CLAMP_TO_EDGE:this.gl.REPEAT,wrapT:(null==t?void 0:t.clampT)?this.gl.CLAMP_TO_EDGE:this.gl.REPEAT}))}createVertexIndexBuffer(e){return new d(this.gl,e)}createVertexDataBuffer(e,t){return new c(this.gl,e.map((e=>new u(this.gl,e.index,e.size,e.type?e.type:n.BufferDataType.Float,!!e.normalized,e.stride?e.stride:0,e.offset?e.offset:0))),t)}createShaderProgram(e,t){return new h(this.gl,e,t)}createVertexArrayObject(){return new f(this.gl,this.glVaoExt)}}t.WebGlGraphics=s;class l{constructor(e,t){this.gl=e,this.texture=t}bind(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture)}unbind(){this.gl.bindTexture(this.gl.TEXTURE_2D,null)}}t.WebGLTextureAbstraction=l;class u{constructor(e,t,r,a,o,i,s){switch(this.gl=e,this.index=t,this.size=r,this.normalized=o,this.stride=i,this.offset=s,a){case n.BufferDataType.UInt8:this.type=e.UNSIGNED_BYTE;break;case n.BufferDataType.UInt16:this.type=e.UNSIGNED_SHORT;break;case n.BufferDataType.UInt32:this.type=e.UNSIGNED_INT;break;case n.BufferDataType.Int8:this.type=e.BYTE;break;case n.BufferDataType.Int16:this.type=e.SHORT;break;case n.BufferDataType.Int32:this.type=e.INT;break;case n.BufferDataType.Float:this.type=e.FLOAT}}bind(){this.gl.enableVertexAttribArray(this.index),this.gl.vertexAttribPointer(this.index,this.size,this.type,this.normalized,this.stride,this.offset)}unbind(){}}t.WebGlVertexAttribPointer=u;class d{constructor(e,t){this.gl=e,this.dynamic=t,this.buffer=e.createBuffer(),this.size=0}setData(e){this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.buffer),this.size<e.byteLength?(this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,e,this.dynamic?this.gl.DYNAMIC_DRAW:this.gl.STATIC_DRAW),this.size=e.byteLength):this.gl.bufferSubData(this.gl.ELEMENT_ARRAY_BUFFER,0,e),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null)}bind(){this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.buffer)}unbind(){this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null)}}t.WebGLVertexIndexBuffer=d;class c{constructor(e,t,r){this.gl=e,this.dynamic=r,this.buffer=e.createBuffer(),this.size=0,this.pointers=t}bind(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer);for(const e of this.pointers)e.bind()}unbind(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)}setData(e){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer),this.size<e.byteLength?(this.gl.bufferData(this.gl.ARRAY_BUFFER,e,this.dynamic?this.gl.DYNAMIC_DRAW:this.gl.STATIC_DRAW),this.size=e.byteLength):this.gl.bufferSubData(this.gl.ARRAY_BUFFER,0,e),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)}}t.WebGlVertexDataBuffer=c;class h{constructor(e,t,r){if(this.gl=e,this.programInfo=(0,a.createProgramInfo)(e,[t,r]),!this.programInfo)throw"Failed to create program"}getAttribLocation(e){return this.gl.getAttribLocation(this.programInfo.program,e)}bind(){this.gl.useProgram(this.programInfo.program),this.lastUniforms=null}useUniforms(e){if(e!==this.lastUniforms){this.lastUniforms=e;for(let t in e)e[t]&&e[t].texture&&(e[t]=e[t].texture);(0,a.setUniforms)(this.programInfo,e)}}unbind(){this.gl.useProgram(null)}}t.WebGLShaderProgram=h;class f{constructor(e,t){this.gl=e,this.glVaoExt=t,this.webGlVAO=t.createVertexArrayOES()}setIndexBuffer(e){this.bind(),e.bind(),this.unbind()}addVertexDataBuffer(e){this.bind(),e.bind(),this.unbind()}bind(){this.glVaoExt.bindVertexArrayOES(this.webGlVAO)}unbind(){this.glVaoExt.bindVertexArrayOES(null)}}t.WebGlNativeVertexArrayObject=f},304:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});const a="\r\nprecision mediump float;\r\nprecision mediump int;\r\nuniform sampler2D u_texture;\r\n\r\nvarying vec4 v_color;\r\nvarying vec2 v_texCoord1;\r\n\r\nvoid main() {\r\n    vec4 tex = texture2D(u_texture, v_texCoord1).rgba;\r\n    gl_FragColor = vec4((v_color.rgb*tex.rgb), tex.a * v_color.a);\r\n}"},909:function(e,t,r){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.M2ParticleEmitter=void 0;const n=r(8219),o=a(r(8680)),i=a(r(8997)),s=r(2807),l=r(3104),u=r(7729),d=[0,0,1,2,3,4],c=[0,1,2,10,3,4,5,13],h=new Array(128);for(let e=0;e<128;e++)h[e]=Math.random();class f{}class m{constructor(){this.center=n.Float3.zero(),this.ageValues={scale:n.Float2.zero(),color:n.Float3.zero(),headCell:0,tailCell:0,alpha:1,alphaCutoff:0}}}t.M2ParticleEmitter=class{constructor(e,t,r,a){this.engine=e,this.parent=t,this.m2data=r,this.exp2Data=a,this.rng=e.getRandomNumberGenerator(),this.emitterModelMatrix=n.Float44.identity(),this.previousPosition=n.Float3.zero(),this.zOrder=0,this.inheritedScale=0,this.burstTime=0,this.particles=[],this.burstVec=n.Float3.zero(),this.fullDeltaPosition=n.Float3.zero(),this.stepDeltaPosition=n.Float3.zero(),this.emissionCounter=0,this.vertexData=[],this.particleToView=n.Float44.identity(),this.particlesFixMat=n.Float44.create(0,1,0,0,-1,0,0,0,0,0,1,0,0,0,0,1),this.quadToView=n.Float33.identity(),this.quadToViewZVector=n.Float3.zero(),this.nrQuads=0,(null==a?void 0:a.alphaCutoff)&&(this.alphaCutOffTrack=new u.LocalAnimatedValueNumber(a.alphaCutoff)),this.colorTrack=new u.LocalAnimatedFloat3(this.m2data.colorTrack),this.alphaTrack=new u.LocalAnimatedValueNumber(this.m2data.alphaTrack),this.scaleTrack=new u.LocalAnimatedValueFloat2(this.m2data.scaleTrack),this.headCellTrack=new u.LocalAnimatedValueNumber(this.m2data.headCellTrack),this.tailCellTrack=new u.LocalAnimatedValueNumber(this.m2data.tailCellTrack),this.isDisposing=!1,this.initialize()}dispose(){this.isDisposing=!0,this.parent=null,this.engine=null,this.m2data=null,this.exp2Data=null,this.rng=null,this.particleGenerator=null,this.shaderProgram=null,this.indexBuffer=null,this.vertexBuffer=null,this.vao=null,this.material=null,this.particleColorOverride=null,this.colorTrack=null,this.alphaTrack=null,this.scaleTrack=null,this.headCellTrack=null,this.tailCellTrack=null,this.alphaCutOffTrack=null,this.particles=null,this.emitterModelMatrix=null,this.previousPosition=null,this.burstVec=null,this.fullDeltaPosition=null,this.stepDeltaPosition=null,this.particleToView=null,this.quadToView=null,this.quadToViewZVector=null}initialize(){switch(this.m2data.particleColorIndex>=11&&this.m2data.particleColorIndex,this.m2data.emitterType){case 1:this.particleGenerator=new s.PlaneParticleGenerator(this.rng,this.m2data);break;case 2:this.particleGenerator=new l.SphereParticleGenerator(this.rng,this.m2data,!!(256&this.m2data.flags));break;default:throw"Found unimplemented particle generator "+this.m2data.emitterType}const e=this.m2data.followSpeed2-this.m2data.followSpeed2;0!=e?(this.followMult=(this.m2data.followScale2-this.m2data.followScale1)/e,this.followBase=this.m2data.followScale1-this.m2data.followSpeed1*this.followMult):(this.followMult=0,this.followBase=0);let t=this.m2data.textureDimensionsColumns;t<=0&&(t=1);let r=this.m2data.textureDimensionsRows;r<=0&&(r=1),this.textureIndexMask=t*r-1;let a=t,n=-1;for(;a;)++n,a>>=1;if(this.textureColBits=n,this.textureColMask=t-1,this.randomizedTextureIndexMask=0,(32768&this.m2data.flags)>0){let e=(this.textureIndexMask+1)*this.rng.getInt();this.randomizedTextureIndexMask=e/4294967296|0}this.texScaleX=1/t,this.texScaleY=1/r;let o=!1;(269484032&this.m2data.flags)>0?(o=!!(268435456&this.m2data.flags),this.particleType=o?2:3):this.particleType=0;let i=!1,u=!1;(268435456&this.m2data.flags)>0?u=(1073741824&this.m2data.flags)>0:1048576&this.m2data.flags||(i=!(1&this.m2data.flags)),2===this.particleType||2===this.particleType&&o?this.shaderId=u?3:2:3==this.particleType?this.shaderId=5:this.shaderId=i?1:0,this.setupGraphics()}update(e){if(this.isDisposing)return;if(!this.particleGenerator)return;e*=.001,this.updateAnimatedProps();const t=n.Float44.identity();n.Float44.multiply(t,this.parent.worldModelMatrix,t),n.Float44.multiply(t,this.parent.boneData[this.m2data.bone].positionMatrix,t);const r=n.Float44.identity();n.Float44.createWithTranslation(this.m2data.position,r),n.Float44.multiply(t,r,t),n.Float44.multiply(t,this.particlesFixMat,t),this.updateParticles(e,t)}draw(){if(this.isDisposing)return;if(this.particles.length<=0)return;this.updateVertexBuffer(),this.vertexBuffer.setData(new Float32Array(this.vertexData));const e=new n.RenderingBatchRequest(this.material);e.useVertexArrayObject(this.vao),e.drawIndexedTriangles(0,6*this.nrQuads|0),this.engine.submitBatchRequest(e)}updateParticles(e,t){if(null==this.particleGenerator)return;n.Float44.getTranslation(this.emitterModelMatrix,this.previousPosition);let r=n.Float4.zero();if(n.Float44.getTranslation(t,r),r[3]=1,n.Float44.transformDirection4(r,this.engine.viewMatrix,r),this.zOrder=r[2],n.Float44.copy(t,this.emitterModelMatrix),this.inheritedScale=n.Float3.length(n.Float44.getColumn4(this.emitterModelMatrix,0)),e>0){const t=n.Float44.getTranslation(this.emitterModelMatrix);if(this.fullDeltaPosition=n.Float3.subtract(t,this.previousPosition),16384&this.m2data.flags){let t=this.followMult*(n.Float3.length(this.fullDeltaPosition)/e)+this.followBase;t>=0&&(t=Math.min(t,1)),n.Float3.scale(this.fullDeltaPosition,t,this.stepDeltaPosition)}if(64&this.m2data.flags){this.burstTime+=e;let t=.03;if(this.burstTime>t)if(this.burstTime=0,0==this.particles.length){let e=t/this.burstTime*this.m2data.burstMultiplier;n.Float3.multiply(this.fullDeltaPosition,n.Float3.fromScalar(e),this.burstVec)}else n.Float3.set(this.burstVec,0,0,0)}this.processSteps(e)}}processSteps(e){if((e=Math.max(e,0))<.1)n.Float3.copy(this.fullDeltaPosition,this.stepDeltaPosition);else{let t=Math.floor(e/.1);e=-.1*t+e;let r=Math.min(Math.floor(this.particleGenerator.getAnimatedProps().lifespan/.1),t),a=r+1,o=1;o=a<0?1:a,n.Float3.scale(this.fullDeltaPosition,1/o,this.stepDeltaPosition);for(let e=0;e<r;e++)this.processStep(.1)}this.processStep(e)}processStep(e){let t=new f;if(!(e<0)){this.calcForces(t,e),this.emitNewParticles(e);for(let r=0;r<this.particles.length;r++){let a=this.particles[r];a.age=a.age+e,a.age>Math.max(this.particleGenerator.getLifespan(a.seed),.001)?(this.particles.splice(r,1),r--):this.updateParticle(a,e,t)||(this.particles.splice(r,1),r--)}}}calcForces(e,t){e.windVector=n.Float3.zero(),e.gravity=n.Float3.zero(),e.position=n.Float3.zero(),e.drag=0,n.Float3.multiply(this.m2data.windVector,n.Float3.fromScalar(t),e.windVector);let r=n.Float3.zero();this.particleGenerator.getGravity(r),n.Float3.multiply(r,n.Float3.fromScalar(t),e.gravity),n.Float3.multiply(r,n.Float3.fromScalar(t*t*.5),e.position),e.drag=Math.min(this.m2data.drag*t,1)}emitNewParticles(e){if(!this.activeNow)return;let t=this.particleGenerator.getNextEmissionRate();for(this.emissionCounter=this.emissionCounter+e*t;this.emissionCounter>1;)this.createNewParticle(e),this.emissionCounter-=1}createNewParticle(e){const t=this.particleGenerator.generateParticle(e);if(16&this.m2data.flags||(n.Float44.transformDirection3_1(t.position,this.emitterModelMatrix,t.position),n.Float44.transformDirection3_0(t.velocity,this.emitterModelMatrix,t.velocity),8192&this.m2data.flags&&(t.position[2]=0)),64&this.m2data.flags){const e=1+this.particleGenerator.animatedProps.speedVariation*this.rng.getSignedFloat(),r=n.Float3.zero();n.Float3.scale(this.burstVec,e,r),n.Float3.add(t.velocity,r,t.velocity)}if(this.particleType>=2)for(let e=0;e<2;e++){t.texturePosition[e][0]=this.rng.getFloat(),t.texturePosition[e][1]=this.rng.getFloat();let r=n.Float2.scale(this.m2data.multiTextureParam1[e],this.rng.getSignedFloat()),a=this.m2data.multiTextureParam0[e];t.textureVelocity[e]=n.Float2.add(r,a)}this.particles.push(t)}updateParticle(e,t,r){if(this.particleType>=2)for(let r=0;r<2;r++){let a=e.texturePosition[r][0]+.1*t*e.textureVelocity[r][0];e.texturePosition[r][0]=a-Math.floor(a),a=e.texturePosition[r][1]+.1*t*e.textureVelocity[r][1],e.texturePosition[r][1]=a-Math.floor(a)}n.Float3.add(e.velocity,r.windVector,e.velocity),16384&this.m2data.flags&&2*t<e.age&&n.Float3.add(e.position,this.stepDeltaPosition,e.position);const a=n.Float3.multiply(e.velocity,n.Float3.fromScalar(t));if(n.Float3.add(e.velocity,r.gravity,e.velocity),n.Float3.scale(e.velocity,1-r.drag,e.velocity),n.Float3.add(e.position,a,e.position),n.Float3.add(e.position,r.position,e.position),2===this.m2data.emitterType&&128&this.m2data.flags){const t=n.Float3.copy(e.position);if(16&this.m2data.flags){if(n.Float3.dot(t,a)>0)return!1}else if(n.Float3.subtract(e.position,n.Float44.getTranslation(this.emitterModelMatrix),t),n.Float3.dot(t,a)>0)return!1}return!0}updateVertexBuffer(){if(this.vertexData.length=0,0==this.particles.length&&null!=this.particleGenerator)return;this.calculateQuadToViewEtc();let e=0;for(let t=0;t<this.particles.length;t++){let r=this.particles[t],a=new m;if(this.calculatePreRenderData(r,a)&&(131072&this.m2data.flags&&(this.buildVertex1(r,a),e++),262144&this.m2data.flags&&(this.buildVertex2(r,a),e++)),e>=1e3)break}this.nrQuads=e}calculateQuadToViewEtc(){if(16&this.m2data.flags?n.Float44.multiply(this.engine.viewMatrix,this.emitterModelMatrix,this.particleToView):n.Float44.copy(this.engine.viewMatrix,this.particleToView),4096&this.m2data.flags){if(n.Float33.getRotationMatrix(this.particleToView,this.quadToView),16&this.m2data.flags&&Math.abs(this.inheritedScale)>0){let e=1/this.inheritedScale;n.Float33.scale(this.quadToView,e,this.quadToView)}n.Float3.set(this.quadToViewZVector,this.quadToView[6],this.quadToView[7],this.quadToView[8]),n.Float3.lengthSquared(this.quadToViewZVector)<=2.3841858e-7?n.Float3.set(this.quadToViewZVector,0,0,1):n.Float3.normalize(this.quadToViewZVector,this.quadToViewZVector)}}calculatePreRenderData(e,t){const r=this.m2data.twinklePercent,a=this.m2data.twinkleScale[0],o=this.m2data.twinkleScale[1]-a;let i=0;if((r<1||0!=o)&&(i=127&e.age*this.m2data.twinkleSpeed+e.seed),r<h[i])return 0;this.fillTimedParticleData(e,t);const s=o*h[i]+a;return n.Float2.scale(t.ageValues.scale,s,t.ageValues.scale),32&this.m2data.flags&&n.Float2.scale(t.ageValues.scale,this.inheritedScale,t.ageValues.scale),n.Float44.transformDirection3_1(e.position,this.particleToView,t.center),1}fillTimedParticleData(e,t){const r=this.engine.getRandomNumberGenerator(e.seed);let a=e.age/this.particleGenerator.getMaxLifespan();a=Math.max(0,Math.min(1,a));const o=n.Float3.create(255,255,255),i=n.Float2.create(1,1),s=t.ageValues;if(this.colorTrack.getValueAtTimestamp(32767*a,o,s.color,this.particleColorOverride),this.particleColorOverride||n.Float3.scale(s.color,1/255,s.color),this.scaleTrack.getValueAtTimestamp(32767*a,i,s.scale),s.alpha=this.alphaTrack.getValueAtTimestamp(32767*a,32767)/32767,this.exp2Data?s.alphaCutoff=this.alphaCutOffTrack.getValueAtTimestamp(a,0)/32767:s.alphaCutoff=0,this.headCellTrack.timestamps.length>0)s.headCell=this.headCellTrack.getValueAtTimestamp(32767*a,0),s.headCell=this.textureIndexMask&s.headCell+this.randomizedTextureIndexMask;else if(65536&this.m2data.flags){let e=Math.floor((this.textureIndexMask+1)*r.getFloat());s.headCell=e}else s.headCell=0;if(s.tailCell=this.tailCellTrack.getValueAtTimestamp(32767*a,0),s.tailCell=s.tailCell+this.randomizedTextureIndexMask&this.textureIndexMask,524288&this.m2data.flags)s.scale[0]=Math.max(1+r.getSignedFloat()*this.m2data.scaleVary[0],99999997e-12)*s.scale[0],s.scale[1]=Math.max(1+r.getSignedFloat()*this.m2data.scaleVary[1],99999997e-12)*s.scale[1];else{let e=Math.max(1+r.getSignedFloat()*this.m2data.scaleVary[0],99999997e-12);s.scale[0]=e*s.scale[0],s.scale[1]=e*s.scale[1]}}buildVertex1(e,t){let r=n.Float2.create((t.ageValues.headCell&this.textureColMask)*this.texScaleX,(t.ageValues.headCell>>this.textureColBits)*this.texScaleY),{baseSpin:a,deltaSpin:o}=this.calculateSpin(e),i=0,s=n.Float3.create(0,0,0),l=n.Float3.create(0,0,0),u=!1,d=!!(4096&this.m2data.flags);if(4&this.m2data.flags&&n.Float3.lengthSquared(e.velocity)>2.3841858e-7&&(i=1,!d)){const r=n.Float44.transformDirection3_0(n.Float3.negate(e.velocity),this.particleToView);let a=0,o=n.Float3.lengthSquared(r);a=o<=2.3841858e-7?0:1/Math.sqrt(o);const i=n.Float3.scale(r,a);n.Float3.scale(i,t.ageValues.scale[0],s),n.Float3.set(l,i[1],-i[0],0),n.Float3.scale(l,t.ageValues.scale[1],l),u=!0}if(d&&!u){let r=n.Float33.copy(this.quadToView),d=t.ageValues.scale[0];if(i){let a=0;const o=n.Float3.negate(e.velocity),i=n.Float3.lengthSquared(o);a=i<=2.3841858e-7?0:1/Math.sqrt(i),n.Float33.multiply(this.quadToView,n.Float33.create(o[0]*a,o[1]*a,0,-o[1]*a,o[0]*a,0,0,0,1),r),a>2.3841858e-7&&(d=t.ageValues.scale[0]*(1/Math.sqrt(n.Float3.lengthSquared(e.velocity))/a))}if(n.Float33.getColumn(r,0,s),n.Float3.scale(s,d,s),n.Float33.getColumn(r,1,l),n.Float3.scale(l,t.ageValues.scale[1],l),o=l[0],u=!0,0!=this.m2data.spin||0!=this.m2data.spinVary){let t=a+o*e.age;512&this.m2data.flags&&1&e.seed&&(t=-t);const r=n.Float3.copy(this.quadToViewZVector),i=n.Float33.fromQuat(n.Float4.createQuat(r,t));n.Float33.transformDir(s,i,s),n.Float3.set(l,o,l[1],l[2]),n.Float33.transformDir(l,i,l)}}if(!u)if(0!=this.m2data.spin||0!=this.m2data.spinVary){let r=a+o*e.age;512&this.m2data.flags&&1&e.seed&&(r=-r);let i=Math.cos(r),u=Math.sin(r);n.Float3.set(s,i,u,0),n.Float3.scale(s,t.ageValues.scale[0],s),n.Float3.set(l,-u,i,0),n.Float3.scale(l,t.ageValues.scale[1],l),134217728&this.m2data.flags&&n.Float3.add(t.center,n.Float3.create(l[0],l[1],0),t.center)}else n.Float3.set(s,t.ageValues.scale[0],0,0),n.Float3.set(l,0,t.ageValues.scale[1],0);return this.buildQuad(s,l,t.center,t.ageValues.color,t.ageValues.alpha,t.ageValues.alphaCutoff,r[0],r[1],e.texturePosition),0}buildVertex2(e,t){const r=n.Float2.create((t.ageValues.tailCell&this.textureColMask)*this.texScaleX,(t.ageValues.tailCell>>this.textureColBits)*this.texScaleY),a=n.Float3.create(0,0,0),o=n.Float3.create(0,0,0);let i=this.m2data.tailLength;1024&this.m2data.flags&&(i=Math.min(e.age,i));const s=n.Float3.scale(e.velocity,-1);n.Float44.transformDirection3_0(s,this.particleToView,s),n.Float3.scale(s,i,s);const l=n.Float3.create(s[0],s[1],0);if(n.Float3.dot(l,l)>1e-4){let e=1/n.Float3.length(l);n.Float2.scale(t.ageValues.scale,e,t.ageValues.scale),n.Float2.multiply(l,t.ageValues.scale,l),n.Float3.set(o,-l[1],l[0],0),n.Float3.scale(s,.5,a),n.Float3.add(t.center,a,t.center)}else n.Float3.set(a,.05*t.ageValues.scale[0],0,0),n.Float3.set(o,0,.05*t.ageValues.scale[1],0);return this.buildQuad(a,o,t.center,t.ageValues.color,t.ageValues.alpha,t.ageValues.alphaCutoff,r[0],r[1],e.texturePosition),1}calculateSpin(e){const t=this.engine.getRandomNumberGenerator(e.seed);let r=this.m2data.baseSpin,a=this.m2data.spin,n=this.m2data.spinVary,o=this.m2data.baseSpinVary;return 0==r&&0==n||(0!=o&&(r+=t.getSignedFloat()*o),0!=n&&(a+=t.getSignedFloat()*n)),{deltaSpin:a,baseSpin:r}}buildQuad(e,t,r,a,o,i,s,l,u){const d=[-1,-1,1,1],c=[1,-1,1,-1],h=[0,0,1,1],f=[0,1,0,1];let m=n.Float3.zero(),p=n.Float2.zero(),g=n.Float2.zero(),y=n.Float2.zero();for(let x=0;x<4;x++)n.Float3.scale(e,d[x],m),n.Float3.add(n.Float3.scale(t,c[x]),m,m),n.Float3.add(m,r,m),n.Float44.transformPoint(m,this.engine.invViewMatrix,m),n.Float2.set(p,h[x]*this.texScaleX+s,f[x]*this.texScaleY+l),n.Float2.set(g,h[x]*this.m2data.multiTextureParamX[0]+u[0][0],f[x]*this.m2data.multiTextureParamX[0]+u[0][1]),n.Float2.set(y,h[x]*this.m2data.multiTextureParamX[1]+u[1][0],f[x]*this.m2data.multiTextureParamX[1]+u[1][1]),this.vertexData.push(m[0]),this.vertexData.push(m[1]),this.vertexData.push(m[2]),this.vertexData.push(a[0]),this.vertexData.push(a[1]),this.vertexData.push(a[2]),this.vertexData.push(o),this.vertexData.push(p[0]),this.vertexData.push(p[1]),this.vertexData.push(g[0]),this.vertexData.push(g[1]),this.vertexData.push(y[0]),this.vertexData.push(y[1]),this.vertexData.push(i)}updateAnimatedProps(){const e=this.parent.animationState;let t=this.particleGenerator.getAnimatedProps(),r=!0;e.hasAnimatedValuesForTrack(this.m2data.enabledIn)&&(r=e.getNumberTrackValue(this.m2data.enabledIn)>0),this.activeNow=r;const a=n.Float3.zero();r&&(t.emissionSpeed=e.getNumberTrackValue(this.m2data.emissionSpeed,0),t.speedVariation=e.getNumberTrackValue(this.m2data.speedVariation,0),t.verticalRange=e.getNumberTrackValue(this.m2data.verticalRange,0),t.horizontalRange=e.getNumberTrackValue(this.m2data.horizontalRange,0),e.getFloat3TrackValue(this.m2data.gravity,a,t.gravity),t.lifespan=e.getNumberTrackValue(this.m2data.lifespan,0),t.emissionRate=e.getNumberTrackValue(this.m2data.emissionRate,0),t.emissionAreaY=e.getNumberTrackValue(this.m2data.emissionAreaWidth,0),t.emissionAreaX=e.getNumberTrackValue(this.m2data.emissionAreaLength,0),this.exp2Data?t.zSource=this.exp2Data.zSource:t.zSource=e.getNumberTrackValue(this.m2data.zSource,0))}getPixelShader(){return d[this.shaderId]}setupGraphics(){this.shaderProgram=this.engine.getShaderProgram("M2ParticleEmitter",i.default,o.default),this.vertexBuffer=this.engine.graphics.createVertexDataBuffer([{index:this.shaderProgram.getAttribLocation("a_position"),size:3,type:n.BufferDataType.Float,normalized:!1,stride:56,offset:0},{index:this.shaderProgram.getAttribLocation("a_color"),size:4,type:n.BufferDataType.Float,normalized:!1,stride:56,offset:12},{index:this.shaderProgram.getAttribLocation("a_texCoord1"),size:2,type:n.BufferDataType.Float,normalized:!1,stride:56,offset:28},{index:this.shaderProgram.getAttribLocation("a_texCoord2"),size:2,type:n.BufferDataType.Float,normalized:!1,stride:56,offset:36},{index:this.shaderProgram.getAttribLocation("a_texCoord3"),size:2,type:n.BufferDataType.Float,normalized:!1,stride:56,offset:44},{index:this.shaderProgram.getAttribLocation("a_alphaCutoff"),size:1,type:n.BufferDataType.Float,normalized:!1,stride:56,offset:52}],!0),this.indexBuffer=this.engine.graphics.createVertexIndexBuffer(!0);let e=new Uint16Array(6e3);for(let t=0;t<1e3;t++)e[6*t+0]=4*t+0,e[6*t+1]=4*t+1,e[6*t+2]=4*t+2,e[6*t+3]=4*t+3,e[6*t+4]=4*t+2,e[6*t+5]=4*t+1;this.indexBuffer.setData(e),this.vao=this.engine.graphics.createVertexArrayObject(),this.vao.addVertexDataBuffer(this.vertexBuffer),this.vao.setIndexBuffer(this.indexBuffer);const t=this.m2data.texture,r=[null,null,null];if(268435456&this.m2data.flags){const e=[0,0,0];e[0]=31&t,e[1]=t>>5&31,e[2]=t>>10&31;for(let t=0;t<e.length;t++){const a=e[t],n=this.parent.modelData.textures[a];n.textureId>-1&&(r[t]=this.parent.loadedTextures[n.textureId])}}else if(t>-1){const e=this.parent.modelData.textures[t];e.textureId>-1&&(r[0]=this.parent.loadedTextures[e.textureId])}const a=new n.MaterialKey(this.parent.fileId,n.MaterialType.M2ParticleMaterial,t);this.material=new n.RenderMaterial(a),this.material.useShaderProgram(this.shaderProgram);let s,l=this.m2data.blendingType;s=0===l?-1:1===l?.501960814:.0039215689,this.material.useBackFaceCulling(!1),this.material.useCounterClockWiseFrontFaces(!this.parent.isMirrored),this.material.useBlendMode(l<c.length?c[l]:n.GxBlend.GxBlend_Opaque),this.material.useDepthTest(!0),this.material.useDepthWrite(!1),this.material.useColorMask(n.ColorMask.Alpha|n.ColorMask.Blue|n.ColorMask.Green|n.ColorMask.Red),this.material.useUniforms({u_pixelShader:this.getPixelShader(),u_texture1:r[0],u_texture2:r[1],u_texture3:r[2],u_alphaTreshold:s,u_alphaMult:this.exp2Data?this.exp2Data.alphaMult:1,u_colorMult:this.exp2Data?this.exp2Data.colorMult:1}),this.engine.addEngineMaterialParams(this.material)}}},1017:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(2388),t),n(r(7690),t),n(r(269),t),n(r(5716),t)},1178:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});const a="precision mediump float;\r\nprecision mediump int;\r\n\r\nattribute vec3 a_position;\r\nattribute vec2 a_texCoord;\r\nattribute float a_depth;\r\n\r\nuniform mat4 u_modelMatrix;\r\nuniform mat4 u_viewMatrix;\r\nuniform mat4 u_projectionMatrix;\r\n\r\n//out vec2 vTexCoord;\r\nvarying vec3 v_position;\r\nvarying vec2 v_texCoord;\r\nvarying float v_depth;\r\nvarying vec3 v_normal;\r\n\r\nmat4 invert(mat4 inputMatrix) {\r\n    float\r\n        m00 = inputMatrix[0][0], m01 = inputMatrix[0][1], m02 = inputMatrix[0][2], m03 = inputMatrix[0][3],\r\n        m10 = inputMatrix[1][0], m11 = inputMatrix[1][1], m12 = inputMatrix[1][2], m13 = inputMatrix[1][3],\r\n        m20 = inputMatrix[2][0], m21 = inputMatrix[2][1], m22 = inputMatrix[2][2], m23 = inputMatrix[2][3],\r\n        m30 = inputMatrix[3][0], m31 = inputMatrix[3][1], m32 = inputMatrix[3][2], m33 = inputMatrix[3][3];\r\n\r\n    float \r\n        t0 = m00 * m11 - m01 * m10,\r\n        t1 = m00 * m12 - m02 * m10,\r\n        t2 = m00 * m13 - m03 * m10,\r\n        t3 = m01 * m12 - m02 * m11,\r\n        t4 = m01 * m13 - m03 * m11,\r\n        t5 = m02 * m13 - m03 * m12,\r\n        t6 = m20 * m31 - m21 * m30,\r\n        t7 = m20 * m32 - m22 * m30,\r\n        t8 = m20 * m33 - m23 * m30,\r\n        t9 = m21 * m32 - m22 * m31,\r\n        t10 = m21 * m33 - m23 * m31,\r\n        t11 = m22 * m33 - m23 * m32,\r\n        determinant = t0 * t11 - t1 * t10 + t2 * t9 + t3 * t8 - t4 * t7 + t5 * t6;\r\n\r\n    return mat4(\r\n        m11 * t11 - m12 * t10 + m13 * t9,\r\n        m02 * t10 - m01 * t11 - m03 * t9,\r\n        m31 * t5 - m32 * t4 + m33 * t3,\r\n        m22 * t4 - m21 * t5 - m23 * t3,\r\n        m12 * t8 - m10 * t11 - m13 * t7,\r\n        m00 * t11 - m02 * t8 + m03 * t7,\r\n        m32 * t2 - m30 * t5 - m33 * t1,\r\n        m20 * t5 - m22 * t2 + m23 * t1,\r\n        m10 * t10 - m11 * t8 + m13 * t6,\r\n        m01 * t8 - m00 * t10 - m03 * t6,\r\n        m30 * t4 - m31 * t2 + m33 * t0,\r\n        m21 * t2 - m20 * t4 - m23 * t0,\r\n        m11 * t7 - m10 * t9 - m12 * t6,\r\n        m00 * t9 - m01 * t7 + m02 * t6,\r\n        m31 * t1 - m30 * t3 - m32 * t0,\r\n        m20 * t3 - m21 * t1 + m22 * t0\r\n    ) / determinant;\r\n}\r\n\r\nhighp mat4 transpose(in highp mat4 inputMatrix) {\r\n    return mat4(\r\n        vec4(inputMatrix[0][0], inputMatrix[1][0], inputMatrix[2][0], inputMatrix[3][0]),\r\n        vec4(inputMatrix[0][1], inputMatrix[1][1], inputMatrix[2][1], inputMatrix[3][1]),\r\n        vec4(inputMatrix[0][2], inputMatrix[1][2], inputMatrix[2][2], inputMatrix[3][2]),\r\n        vec4(inputMatrix[0][3], inputMatrix[1][3], inputMatrix[2][3], inputMatrix[3][3])\r\n    );\r\n}\r\n\r\nvoid main() {\r\n    vec4 aPositionVec4 = vec4(a_position.xyz, 1);\r\n    mat4 viewModelMat = u_viewMatrix * u_modelMatrix;\r\n\r\n    vec4 cameraPoint = viewModelMat * aPositionVec4;\r\n\r\n    mat4 viewModelMatForNormal = transpose(invert(viewModelMat));\r\n\r\n    gl_Position = u_projectionMatrix * cameraPoint;\r\n    v_position = cameraPoint.xyz;\r\n    v_normal = normalize(viewModelMatForNormal * vec4(0,0,1.0, 0.0)).xyz;\r\n    v_depth = a_depth;\r\n    v_texCoord = a_texCoord;\r\n}\r\n"},1278:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(8648),t),n(r(6604),t),n(r(7518),t),n(r(2510),t)},1447:(e,t,r)=>{"use strict";const a=r(3269),n=r(4823),o=r(9674),i=r(1998),{Z_FINISH:s,Z_BLOCK:l,Z_TREES:u,Z_OK:d,Z_STREAM_END:c,Z_NEED_DICT:h,Z_STREAM_ERROR:f,Z_DATA_ERROR:m,Z_MEM_ERROR:p,Z_BUF_ERROR:g,Z_DEFLATED:y}=r(9681),x=16180,v=16190,_=16191,b=16192,F=16194,C=16199,w=16200,S=16206,M=16209,A=16210,E=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function D(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const T=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<x||t.mode>16211?1:0},k=e=>{if(T(e))return f;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=x,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,d},B=e=>{if(T(e))return f;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,k(e)},L=(e,t)=>{let r;if(T(e))return f;const a=e.state;return t<0?(r=0,t=-t):(r=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?f:(null!==a.window&&a.wbits!==t&&(a.window=null),a.wrap=r,a.wbits=t,B(e))},P=(e,t)=>{if(!e)return f;const r=new D;e.state=r,r.strm=e,r.window=null,r.mode=x;const a=L(e,t);return a!==d&&(e.state=null),a};let O,I,U=!0;const W=e=>{if(U){O=new Int32Array(512),I=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(i(1,e.lens,0,288,O,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;i(2,e.lens,0,32,I,0,e.work,{bits:5}),U=!1}e.lencode=O,e.lenbits=9,e.distcode=I,e.distbits=5},R=(e,t,r,a)=>{let n;const o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),a>=o.wsize?(o.window.set(t.subarray(r-o.wsize,r),0),o.wnext=0,o.whave=o.wsize):(n=o.wsize-o.wnext,n>a&&(n=a),o.window.set(t.subarray(r-a,r-a+n),o.wnext),(a-=n)?(o.window.set(t.subarray(r-a,r),0),o.wnext=a,o.whave=o.wsize):(o.wnext+=n,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=n))),0};e.exports.inflateReset=B,e.exports.inflateReset2=L,e.exports.inflateResetKeep=k,e.exports.inflateInit=e=>P(e,15),e.exports.inflateInit2=P,e.exports.inflate=(e,t)=>{let r,D,k,B,L,P,O,I,U,z,V,j,G,N,H,q,Z,X,Y,K,J,Q,$=0;const ee=new Uint8Array(4);let te,re;const ae=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(T(e)||!e.output||!e.input&&0!==e.avail_in)return f;r=e.state,r.mode===_&&(r.mode=b),L=e.next_out,k=e.output,O=e.avail_out,B=e.next_in,D=e.input,P=e.avail_in,I=r.hold,U=r.bits,z=P,V=O,Q=d;e:for(;;)switch(r.mode){case x:if(0===r.wrap){r.mode=b;break}for(;U<16;){if(0===P)break e;P--,I+=D[B++]<<U,U+=8}if(2&r.wrap&&35615===I){0===r.wbits&&(r.wbits=15),r.check=0,ee[0]=255&I,ee[1]=I>>>8&255,r.check=n(r.check,ee,2,0),I=0,U=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&I)<<8)+(I>>8))%31){e.msg="incorrect header check",r.mode=M;break}if((15&I)!==y){e.msg="unknown compression method",r.mode=M;break}if(I>>>=4,U-=4,J=8+(15&I),0===r.wbits&&(r.wbits=J),J>15||J>r.wbits){e.msg="invalid window size",r.mode=M;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=512&I?16189:_,I=0,U=0;break;case 16181:for(;U<16;){if(0===P)break e;P--,I+=D[B++]<<U,U+=8}if(r.flags=I,(255&r.flags)!==y){e.msg="unknown compression method",r.mode=M;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=M;break}r.head&&(r.head.text=I>>8&1),512&r.flags&&4&r.wrap&&(ee[0]=255&I,ee[1]=I>>>8&255,r.check=n(r.check,ee,2,0)),I=0,U=0,r.mode=16182;case 16182:for(;U<32;){if(0===P)break e;P--,I+=D[B++]<<U,U+=8}r.head&&(r.head.time=I),512&r.flags&&4&r.wrap&&(ee[0]=255&I,ee[1]=I>>>8&255,ee[2]=I>>>16&255,ee[3]=I>>>24&255,r.check=n(r.check,ee,4,0)),I=0,U=0,r.mode=16183;case 16183:for(;U<16;){if(0===P)break e;P--,I+=D[B++]<<U,U+=8}r.head&&(r.head.xflags=255&I,r.head.os=I>>8),512&r.flags&&4&r.wrap&&(ee[0]=255&I,ee[1]=I>>>8&255,r.check=n(r.check,ee,2,0)),I=0,U=0,r.mode=16184;case 16184:if(1024&r.flags){for(;U<16;){if(0===P)break e;P--,I+=D[B++]<<U,U+=8}r.length=I,r.head&&(r.head.extra_len=I),512&r.flags&&4&r.wrap&&(ee[0]=255&I,ee[1]=I>>>8&255,r.check=n(r.check,ee,2,0)),I=0,U=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&r.flags&&(j=r.length,j>P&&(j=P),j&&(r.head&&(J=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(D.subarray(B,B+j),J)),512&r.flags&&4&r.wrap&&(r.check=n(r.check,D,j,B)),P-=j,B+=j,r.length-=j),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&r.flags){if(0===P)break e;j=0;do{J=D[B+j++],r.head&&J&&r.length<65536&&(r.head.name+=String.fromCharCode(J))}while(J&&j<P);if(512&r.flags&&4&r.wrap&&(r.check=n(r.check,D,j,B)),P-=j,B+=j,J)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&r.flags){if(0===P)break e;j=0;do{J=D[B+j++],r.head&&J&&r.length<65536&&(r.head.comment+=String.fromCharCode(J))}while(J&&j<P);if(512&r.flags&&4&r.wrap&&(r.check=n(r.check,D,j,B)),P-=j,B+=j,J)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&r.flags){for(;U<16;){if(0===P)break e;P--,I+=D[B++]<<U,U+=8}if(4&r.wrap&&I!==(65535&r.check)){e.msg="header crc mismatch",r.mode=M;break}I=0,U=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=_;break;case 16189:for(;U<32;){if(0===P)break e;P--,I+=D[B++]<<U,U+=8}e.adler=r.check=E(I),I=0,U=0,r.mode=v;case v:if(0===r.havedict)return e.next_out=L,e.avail_out=O,e.next_in=B,e.avail_in=P,r.hold=I,r.bits=U,h;e.adler=r.check=1,r.mode=_;case _:if(t===l||t===u)break e;case b:if(r.last){I>>>=7&U,U-=7&U,r.mode=S;break}for(;U<3;){if(0===P)break e;P--,I+=D[B++]<<U,U+=8}switch(r.last=1&I,I>>>=1,U-=1,3&I){case 0:r.mode=16193;break;case 1:if(W(r),r.mode=C,t===u){I>>>=2,U-=2;break e}break;case 2:r.mode=16196;break;case 3:e.msg="invalid block type",r.mode=M}I>>>=2,U-=2;break;case 16193:for(I>>>=7&U,U-=7&U;U<32;){if(0===P)break e;P--,I+=D[B++]<<U,U+=8}if((65535&I)!=(I>>>16^65535)){e.msg="invalid stored block lengths",r.mode=M;break}if(r.length=65535&I,I=0,U=0,r.mode=F,t===u)break e;case F:r.mode=16195;case 16195:if(j=r.length,j){if(j>P&&(j=P),j>O&&(j=O),0===j)break e;k.set(D.subarray(B,B+j),L),P-=j,B+=j,O-=j,L+=j,r.length-=j;break}r.mode=_;break;case 16196:for(;U<14;){if(0===P)break e;P--,I+=D[B++]<<U,U+=8}if(r.nlen=257+(31&I),I>>>=5,U-=5,r.ndist=1+(31&I),I>>>=5,U-=5,r.ncode=4+(15&I),I>>>=4,U-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=M;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;U<3;){if(0===P)break e;P--,I+=D[B++]<<U,U+=8}r.lens[ae[r.have++]]=7&I,I>>>=3,U-=3}for(;r.have<19;)r.lens[ae[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,te={bits:r.lenbits},Q=i(0,r.lens,0,19,r.lencode,0,r.work,te),r.lenbits=te.bits,Q){e.msg="invalid code lengths set",r.mode=M;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;$=r.lencode[I&(1<<r.lenbits)-1],H=$>>>24,q=$>>>16&255,Z=65535&$,!(H<=U);){if(0===P)break e;P--,I+=D[B++]<<U,U+=8}if(Z<16)I>>>=H,U-=H,r.lens[r.have++]=Z;else{if(16===Z){for(re=H+2;U<re;){if(0===P)break e;P--,I+=D[B++]<<U,U+=8}if(I>>>=H,U-=H,0===r.have){e.msg="invalid bit length repeat",r.mode=M;break}J=r.lens[r.have-1],j=3+(3&I),I>>>=2,U-=2}else if(17===Z){for(re=H+3;U<re;){if(0===P)break e;P--,I+=D[B++]<<U,U+=8}I>>>=H,U-=H,J=0,j=3+(7&I),I>>>=3,U-=3}else{for(re=H+7;U<re;){if(0===P)break e;P--,I+=D[B++]<<U,U+=8}I>>>=H,U-=H,J=0,j=11+(127&I),I>>>=7,U-=7}if(r.have+j>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=M;break}for(;j--;)r.lens[r.have++]=J}}if(r.mode===M)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=M;break}if(r.lenbits=9,te={bits:r.lenbits},Q=i(1,r.lens,0,r.nlen,r.lencode,0,r.work,te),r.lenbits=te.bits,Q){e.msg="invalid literal/lengths set",r.mode=M;break}if(r.distbits=6,r.distcode=r.distdyn,te={bits:r.distbits},Q=i(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,te),r.distbits=te.bits,Q){e.msg="invalid distances set",r.mode=M;break}if(r.mode=C,t===u)break e;case C:r.mode=w;case w:if(P>=6&&O>=258){e.next_out=L,e.avail_out=O,e.next_in=B,e.avail_in=P,r.hold=I,r.bits=U,o(e,V),L=e.next_out,k=e.output,O=e.avail_out,B=e.next_in,D=e.input,P=e.avail_in,I=r.hold,U=r.bits,r.mode===_&&(r.back=-1);break}for(r.back=0;$=r.lencode[I&(1<<r.lenbits)-1],H=$>>>24,q=$>>>16&255,Z=65535&$,!(H<=U);){if(0===P)break e;P--,I+=D[B++]<<U,U+=8}if(q&&!(240&q)){for(X=H,Y=q,K=Z;$=r.lencode[K+((I&(1<<X+Y)-1)>>X)],H=$>>>24,q=$>>>16&255,Z=65535&$,!(X+H<=U);){if(0===P)break e;P--,I+=D[B++]<<U,U+=8}I>>>=X,U-=X,r.back+=X}if(I>>>=H,U-=H,r.back+=H,r.length=Z,0===q){r.mode=16205;break}if(32&q){r.back=-1,r.mode=_;break}if(64&q){e.msg="invalid literal/length code",r.mode=M;break}r.extra=15&q,r.mode=16201;case 16201:if(r.extra){for(re=r.extra;U<re;){if(0===P)break e;P--,I+=D[B++]<<U,U+=8}r.length+=I&(1<<r.extra)-1,I>>>=r.extra,U-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;$=r.distcode[I&(1<<r.distbits)-1],H=$>>>24,q=$>>>16&255,Z=65535&$,!(H<=U);){if(0===P)break e;P--,I+=D[B++]<<U,U+=8}if(!(240&q)){for(X=H,Y=q,K=Z;$=r.distcode[K+((I&(1<<X+Y)-1)>>X)],H=$>>>24,q=$>>>16&255,Z=65535&$,!(X+H<=U);){if(0===P)break e;P--,I+=D[B++]<<U,U+=8}I>>>=X,U-=X,r.back+=X}if(I>>>=H,U-=H,r.back+=H,64&q){e.msg="invalid distance code",r.mode=M;break}r.offset=Z,r.extra=15&q,r.mode=16203;case 16203:if(r.extra){for(re=r.extra;U<re;){if(0===P)break e;P--,I+=D[B++]<<U,U+=8}r.offset+=I&(1<<r.extra)-1,I>>>=r.extra,U-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=M;break}r.mode=16204;case 16204:if(0===O)break e;if(j=V-O,r.offset>j){if(j=r.offset-j,j>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=M;break}j>r.wnext?(j-=r.wnext,G=r.wsize-j):G=r.wnext-j,j>r.length&&(j=r.length),N=r.window}else N=k,G=L-r.offset,j=r.length;j>O&&(j=O),O-=j,r.length-=j;do{k[L++]=N[G++]}while(--j);0===r.length&&(r.mode=w);break;case 16205:if(0===O)break e;k[L++]=r.length,O--,r.mode=w;break;case S:if(r.wrap){for(;U<32;){if(0===P)break e;P--,I|=D[B++]<<U,U+=8}if(V-=O,e.total_out+=V,r.total+=V,4&r.wrap&&V&&(e.adler=r.check=r.flags?n(r.check,k,V,L-V):a(r.check,k,V,L-V)),V=O,4&r.wrap&&(r.flags?I:E(I))!==r.check){e.msg="incorrect data check",r.mode=M;break}I=0,U=0}r.mode=16207;case 16207:if(r.wrap&&r.flags){for(;U<32;){if(0===P)break e;P--,I+=D[B++]<<U,U+=8}if(4&r.wrap&&I!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=M;break}I=0,U=0}r.mode=16208;case 16208:Q=c;break e;case M:Q=m;break e;case A:return p;default:return f}return e.next_out=L,e.avail_out=O,e.next_in=B,e.avail_in=P,r.hold=I,r.bits=U,(r.wsize||V!==e.avail_out&&r.mode<M&&(r.mode<S||t!==s))&&R(e,e.output,e.next_out,V-e.avail_out)?(r.mode=A,p):(z-=e.avail_in,V-=e.avail_out,e.total_in+=z,e.total_out+=V,r.total+=V,4&r.wrap&&V&&(e.adler=r.check=r.flags?n(r.check,k,V,e.next_out-V):a(r.check,k,V,e.next_out-V)),e.data_type=r.bits+(r.last?64:0)+(r.mode===_?128:0)+(r.mode===C||r.mode===F?256:0),(0===z&&0===V||t===s)&&Q===d&&(Q=g),Q)},e.exports.inflateEnd=e=>{if(T(e))return f;let t=e.state;return t.window&&(t.window=null),e.state=null,d},e.exports.inflateGetHeader=(e,t)=>{if(T(e))return f;const r=e.state;return 2&r.wrap?(r.head=t,t.done=!1,d):f},e.exports.inflateSetDictionary=(e,t)=>{const r=t.length;let n,o,i;return T(e)?f:(n=e.state,0!==n.wrap&&n.mode!==v?f:n.mode===v&&(o=1,o=a(o,t,r,0),o!==n.check)?m:(i=R(e,t,r,r),i?(n.mode=A,p):(n.havedict=1,d)))},e.exports.inflateInfo="pako inflate (from Nodeca project)"},1479:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});const a="#ifndef MAX_BONES\r\n#define MAX_BONES 256\r\n#endif\r\n\r\nattribute vec3 a_position;\r\nattribute vec3 a_normal;\r\nattribute vec4 a_bones;\r\nattribute vec4 a_boneWeights;\r\nattribute vec2 a_texcoord1;\r\nattribute vec2 a_texcoord2;\r\n\r\nuniform mat4 u_textureTransformMatrix1;\r\nuniform mat4 u_textureTransformMatrix2;\r\nuniform mat4 u_modelMatrix;\r\nuniform mat4 u_viewMatrix;\r\nuniform mat4 u_projectionMatrix;\r\nuniform vec4 u_color;\r\nuniform int u_vertexShader;\r\n\r\nuniform mat4 u_boneMatrices[MAX_BONES];\r\n\r\nvarying vec3 v_normal;\r\nvarying vec4 v_color;\r\nvarying vec2 v_texCoord1;\r\nvarying vec2 v_texCoord2;\r\nvarying vec2 v_texCoord3;\r\n\r\nmat4 invert(mat4 inputMatrix) {\r\n    float\r\n        m00 = inputMatrix[0][0], m01 = inputMatrix[0][1], m02 = inputMatrix[0][2], m03 = inputMatrix[0][3],\r\n        m10 = inputMatrix[1][0], m11 = inputMatrix[1][1], m12 = inputMatrix[1][2], m13 = inputMatrix[1][3],\r\n        m20 = inputMatrix[2][0], m21 = inputMatrix[2][1], m22 = inputMatrix[2][2], m23 = inputMatrix[2][3],\r\n        m30 = inputMatrix[3][0], m31 = inputMatrix[3][1], m32 = inputMatrix[3][2], m33 = inputMatrix[3][3];\r\n\r\n    float \r\n        t0 = m00 * m11 - m01 * m10,\r\n        t1 = m00 * m12 - m02 * m10,\r\n        t2 = m00 * m13 - m03 * m10,\r\n        t3 = m01 * m12 - m02 * m11,\r\n        t4 = m01 * m13 - m03 * m11,\r\n        t5 = m02 * m13 - m03 * m12,\r\n        t6 = m20 * m31 - m21 * m30,\r\n        t7 = m20 * m32 - m22 * m30,\r\n        t8 = m20 * m33 - m23 * m30,\r\n        t9 = m21 * m32 - m22 * m31,\r\n        t10 = m21 * m33 - m23 * m31,\r\n        t11 = m22 * m33 - m23 * m32,\r\n        determinant = t0 * t11 - t1 * t10 + t2 * t9 + t3 * t8 - t4 * t7 + t5 * t6;\r\n\r\n    return mat4(\r\n        m11 * t11 - m12 * t10 + m13 * t9,\r\n        m02 * t10 - m01 * t11 - m03 * t9,\r\n        m31 * t5 - m32 * t4 + m33 * t3,\r\n        m22 * t4 - m21 * t5 - m23 * t3,\r\n        m12 * t8 - m10 * t11 - m13 * t7,\r\n        m00 * t11 - m02 * t8 + m03 * t7,\r\n        m32 * t2 - m30 * t5 - m33 * t1,\r\n        m20 * t5 - m22 * t2 + m23 * t1,\r\n        m10 * t10 - m11 * t8 + m13 * t6,\r\n        m01 * t8 - m00 * t10 - m03 * t6,\r\n        m30 * t4 - m31 * t2 + m33 * t0,\r\n        m21 * t2 - m20 * t4 - m23 * t0,\r\n        m11 * t7 - m10 * t9 - m12 * t6,\r\n        m00 * t9 - m01 * t7 + m02 * t6,\r\n        m31 * t1 - m30 * t3 - m32 * t0,\r\n        m20 * t3 - m21 * t1 + m22 * t0\r\n    ) / determinant;\r\n}\r\n\r\nhighp mat4 transpose(in highp mat4 inputMatrix) {\r\n    return mat4(\r\n        vec4(inputMatrix[0][0], inputMatrix[1][0], inputMatrix[2][0], inputMatrix[3][0]),\r\n        vec4(inputMatrix[0][1], inputMatrix[1][1], inputMatrix[2][1], inputMatrix[3][1]),\r\n        vec4(inputMatrix[0][2], inputMatrix[1][2], inputMatrix[2][2], inputMatrix[3][2]),\r\n        vec4(inputMatrix[0][3], inputMatrix[1][3], inputMatrix[2][3], inputMatrix[3][3])\r\n    );\r\n}\r\n\r\nvec2 posToTexCoord(vec3 pos, vec3 normal) {\r\n    vec3 reflection = reflect(normalize(pos), normal);\r\n    return normalize(reflection).xy * 0.5 + vec2(0.5);\r\n}   \r\n\r\nfloat edgeScan(vec3 position, vec3 normal){\r\n    float dotProductClamped = clamp(dot(-normalize(position),normal), 0., 1.);\r\n    return clamp(2.7 * dotProductClamped * dotProductClamped - 0.4, 0., 1.);\r\n}\r\n\r\nvoid main(void) {\r\n    mat4 boneTransformMatrix =  mat4(1.0);\r\n    if (length(a_boneWeights) > 0.0) {\r\n        boneTransformMatrix =  mat4(0.0);\r\n        for (int i = 0; i < 4; i++) {\r\n            boneTransformMatrix += u_boneMatrices[int(a_bones[i])] * a_boneWeights[i];\r\n        }\r\n    }\r\n\r\n    mat4 posMatrix = u_viewMatrix * u_modelMatrix * boneTransformMatrix;\r\n    vec4 pos = posMatrix * vec4(a_position, 1);\r\n    gl_Position = u_projectionMatrix * pos;\r\n\r\n    mat4 normalMatrix = transpose(invert(posMatrix));\r\n    v_normal = normalize((normalMatrix * vec4(a_normal, 0.0)).xyz);\r\n    \r\n    vec4 clampedColor = clamp(u_color, 0., 1.);\r\n    vec4 halfColor = clampedColor * 0.5;\r\n\r\n    if (u_vertexShader == 0) {\r\n        //Diffuse_T1\r\n        v_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a);\r\n        v_texCoord1 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\r\n    } else if (u_vertexShader == 1) {\r\n        //Diffuse_Env\r\n        v_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a);\r\n        v_texCoord1 = posToTexCoord(pos.xyz,normalize(v_normal.xyz));\r\n    } else if (u_vertexShader == 2) {\r\n        //Diffuse_T1_T2\r\n        v_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a);\r\n        v_texCoord1 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\r\n        v_texCoord2 = (u_textureTransformMatrix2 * vec4(a_texcoord2, 0., 1.)).xy;\r\n    } else if (u_vertexShader == 3) {\r\n        //Diffuse_T1_Env\r\n        v_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a);\r\n        v_texCoord1 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\r\n        v_texCoord2 = posToTexCoord(pos.xyz,normalize(v_normal.xyz));;\r\n    } else if (u_vertexShader == 4) {\r\n        //Diffuse_Env_T1\r\n        v_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a);\r\n        v_texCoord1 = posToTexCoord(pos.xyz,normalize(v_normal.xyz));;\r\n        v_texCoord2 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\r\n    } else if (u_vertexShader == 5 ) {\r\n        //Diffuse_Env_Env\r\n        v_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a);\r\n        v_texCoord1 = posToTexCoord(pos.xyz,normalize(v_normal.xyz));;\r\n        v_texCoord2 = posToTexCoord(pos.xyz,normalize(v_normal.xyz));;\r\n    } else if ( u_vertexShader == 6 ) {\r\n        //Diffuse_T1_Env_T1\r\n        v_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a);\r\n        v_texCoord1 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.) ).xy;\r\n        v_texCoord2 = posToTexCoord(pos.xyz,normalize(v_normal.xyz));;\r\n        v_texCoord3 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\r\n    } else if ( u_vertexShader == 7 ) {\r\n        //Diffuse_T1_T1\r\n        v_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a);\r\n        v_texCoord1 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\r\n        v_texCoord2 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\r\n    } else if ( u_vertexShader == 8 ) {\r\n        //Diffuse_T1_T1_T1\r\n        v_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a);\r\n        v_texCoord1 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\r\n        v_texCoord2 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\r\n        v_texCoord3 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\r\n    } else if ( u_vertexShader == 9 ) {\r\n        //Diffuse_EdgeFade_T1\r\n        v_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a * edgeScan(pos.xyz, v_normal.rgb));\r\n        v_texCoord1 = ((u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy).xy;\r\n    } else if ( u_vertexShader == 10 ) {\r\n        //Diffuse_T2\r\n        v_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a);\r\n        v_texCoord1 = (u_textureTransformMatrix2 * vec4(a_texcoord2, 0., 1.)).xy;\r\n    } else if ( u_vertexShader == 11 ) {\r\n        //Diffuse_T1_Env_T2\r\n        v_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a);\r\n        v_texCoord1 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\r\n        v_texCoord2 = posToTexCoord(pos.xyz,normalize(v_normal.xyz));;\r\n        v_texCoord3 = (u_textureTransformMatrix2 * vec4(a_texcoord2, 0., 1.)).xy;\r\n    } else if ( u_vertexShader == 12 ) {\r\n        //Diffuse_EdgeFade_T1_T2\r\n        v_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a * edgeScan(pos.xyz, v_normal.rgb));\r\n        v_texCoord1 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\r\n        v_texCoord2 = (u_textureTransformMatrix2 * vec4(a_texcoord2, 0., 1.)).xy;\r\n    } else if ( u_vertexShader == 13 ) {\r\n        //Diffuse_EdgeFade_Env\r\n        v_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a * edgeScan(pos.xyz, v_normal.rgb));\r\n        v_texCoord1 = posToTexCoord(pos.xyz,normalize(v_normal.xyz));;\r\n    } else if ( u_vertexShader == 14 ) {\r\n        //Diffuse_T1_T2_T1\r\n        v_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a);\r\n        v_texCoord1 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\r\n        v_texCoord2 = (u_textureTransformMatrix2 * vec4(a_texcoord2, 0., 1.)).xy;\r\n        v_texCoord3 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\r\n    } else if ( u_vertexShader == 15 ) {\r\n        //Diffuse_T1_T2_T3\r\n        v_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a);\r\n        v_texCoord1 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\r\n        v_texCoord2 = (u_textureTransformMatrix2 * vec4(a_texcoord2, 0., 1.)).xy;\r\n        v_texCoord3 = v_texCoord3;\r\n    } else if ( u_vertexShader == 16 ) {\r\n        //Color_T1_T2_T3\r\n        vec4 in_col0 = vec4(1.0, 1.0, 1.0, 1.0);\r\n        v_color = vec4((in_col0.rgb * 0.5).r, (in_col0.rgb * 0.5).g, (in_col0.rgb * 0.5).b, in_col0.a);\r\n        v_texCoord1 = (u_textureTransformMatrix2 * vec4(a_texcoord2, 0., 1.)).xy;\r\n        v_texCoord2 = vec2(0., 0.);\r\n        v_texCoord3 = v_texCoord3;\r\n    } else if ( u_vertexShader == 17 ) {\r\n        //BW_Diffuse_T1\r\n        v_color = vec4(clampedColor.rgb * 0.5, clampedColor.a);\r\n        v_texCoord1 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\r\n    } else if ( u_vertexShader == 18 ) {\r\n        //BW_Diffuse_T1_T2\r\n        v_color = vec4(clampedColor.rgb * 0.5, clampedColor.a);\r\n        v_texCoord1 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\r\n    }\r\n}\r\n"},1668:(e,t,r)=>{"use strict";const{Deflate:a,deflate:n,deflateRaw:o,gzip:i}=r(3303),{Inflate:s,inflate:l,inflateRaw:u,ungzip:d}=r(7083),c=r(9681);e.exports.Deflate=a,e.exports.deflate=n,e.exports.deflateRaw=o,e.exports.gzip=i,e.exports.Inflate=s,e.exports.inflate=l,e.exports.inflateRaw=u,e.exports.ungzip=d,e.exports.constants=c},1722:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleProgressReporter=void 0;const a=r(4849);class n extends a.BaseProgressReporter{constructor(e,t){super(e),this.options=t,this.setupElements()}onUpdateCount(){this.textContainer.textContent=this.currentOperation+` (${this.filesProcessed} / ${this.totalFiles})`}setupElements(){var e;this.container.style.position="relative";const t=document.createElement("style");t.textContent=".simpleProgress {\n  padding: 0 5px 8px 0;\n  background: repeating-linear-gradient(90deg,currentColor 0 8%,#0000 0 10%) 200% 100%/200% 3px no-repeat;\n  animation: l3 2s steps(6) infinite;\n}\n@keyframes l3 {to{background-position: 80% 100%}}",document.head.appendChild(t),this.progressContainer=document.createElement("div"),this.progressContainer.className="simpleProgress",this.progressContainer.style.display="none",this.progressContainer.style.position="absolute",this.progressContainer.style.bottom="1em",this.progressContainer.style.right="0",this.progressContainer.style.left="25%",this.progressContainer.style.width="50%",this.progressContainer.style.zIndex="1",this.progressContainer.style.color="#FFF",this.container.appendChild(this.progressContainer),this.textContainer=document.createElement("p"),this.textContainer.style.position="relative",this.textContainer.style.margin="0",this.textContainer.style.color="white",this.textContainer.style.textAlign="center",this.textContainer.style.marginBottom="1em",this.progressContainer.appendChild(this.textContainer),null===(e=this.options)||void 0===e||e.onSetupElements(this)}showElements(){this.progressContainer.style.display="block",this.onUpdateCount()}hideElements(){this.progressContainer.style.display="none",this.textContainer.textContent=""}}t.SimpleProgressReporter=n},1737:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AleaPrngGenerator=void 0,t.AleaPrngGenerator=class{constructor(e){let t=4022871197;const r=e=>{e=String(e);for(var r=0;r<e.length;r++){t+=e.charCodeAt(r);var a=.02519603282416938*t;t=a>>>0,a-=t,t=(a*=t)>>>0,t+=4294967296*(a-=t)}return 2.3283064365386963e-10*(t>>>0)};this.c=1,this.s0=r(" "),this.s1=r(" "),this.s2=r(" "),this.s0-=r(e),this.s0<0&&(this.s0+=1),this.s1-=r(e),this.s1<0&&(this.s1+=1),this.s2-=r(e),this.s2<0&&(this.s2+=1)}getInt(){return 4294967296*this.next()|0}getFloat(){return this.next()}getSignedFloat(){const e=this.next();return 1&this.c?e:-e}next(){const e=2091639*this.s0+2.3283064365386963e-10*this.c;return this.s0=this.s1,this.s1=this.s2,this.s2=e-(this.c=0|e)}}},1996:e=>{"use strict";let t=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){t=!1}const r=new Uint8Array(256);for(let e=0;e<256;e++)r[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;r[254]=r[254]=1,e.exports.string2buf=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,r,a,n,o,i=e.length,s=0;for(n=0;n<i;n++)r=e.charCodeAt(n),55296==(64512&r)&&n+1<i&&(a=e.charCodeAt(n+1),56320==(64512&a)&&(r=65536+(r-55296<<10)+(a-56320),n++)),s+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(s),o=0,n=0;o<s;n++)r=e.charCodeAt(n),55296==(64512&r)&&n+1<i&&(a=e.charCodeAt(n+1),56320==(64512&a)&&(r=65536+(r-55296<<10)+(a-56320),n++)),r<128?t[o++]=r:r<2048?(t[o++]=192|r>>>6,t[o++]=128|63&r):r<65536?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|63&r):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|63&r);return t},e.exports.buf2string=(e,a)=>{const n=a||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,a));let o,i;const s=new Array(2*n);for(i=0,o=0;o<n;){let t=e[o++];if(t<128){s[i++]=t;continue}let a=r[t];if(a>4)s[i++]=65533,o+=a-1;else{for(t&=2===a?31:3===a?15:7;a>1&&o<n;)t=t<<6|63&e[o++],a--;a>1?s[i++]=65533:t<65536?s[i++]=t:(t-=65536,s[i++]=55296|t>>10&1023,s[i++]=56320|1023&t)}}return((e,r)=>{if(r<65534&&e.subarray&&t)return String.fromCharCode.apply(null,e.length===r?e:e.subarray(0,r));let a="";for(let t=0;t<r;t++)a+=String.fromCharCode(e[t]);return a})(s,i)},e.exports.utf8border=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let a=t-1;for(;a>=0&&128==(192&e[a]);)a--;return a<0||0===a?t:a+r[e[a]]>t?a:t}},1998:e=>{"use strict";const t=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),r=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),a=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),n=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);e.exports=(e,o,i,s,l,u,d,c)=>{const h=c.bits;let f,m,p,g,y,x,v=0,_=0,b=0,F=0,C=0,w=0,S=0,M=0,A=0,E=0,D=null;const T=new Uint16Array(16),k=new Uint16Array(16);let B,L,P,O=null;for(v=0;v<=15;v++)T[v]=0;for(_=0;_<s;_++)T[o[i+_]]++;for(C=h,F=15;F>=1&&0===T[F];F--);if(C>F&&(C=F),0===F)return l[u++]=20971520,l[u++]=20971520,c.bits=1,0;for(b=1;b<F&&0===T[b];b++);for(C<b&&(C=b),M=1,v=1;v<=15;v++)if(M<<=1,M-=T[v],M<0)return-1;if(M>0&&(0===e||1!==F))return-1;for(k[1]=0,v=1;v<15;v++)k[v+1]=k[v]+T[v];for(_=0;_<s;_++)0!==o[i+_]&&(d[k[o[i+_]]++]=_);if(0===e?(D=O=d,x=20):1===e?(D=t,O=r,x=257):(D=a,O=n,x=0),E=0,_=0,v=b,y=u,w=C,S=0,p=-1,A=1<<C,g=A-1,1===e&&A>852||2===e&&A>592)return 1;for(;;){B=v-S,d[_]+1<x?(L=0,P=d[_]):d[_]>=x?(L=O[d[_]-x],P=D[d[_]-x]):(L=96,P=0),f=1<<v-S,m=1<<w,b=m;do{m-=f,l[y+(E>>S)+m]=B<<24|L<<16|P}while(0!==m);for(f=1<<v-1;E&f;)f>>=1;if(0!==f?(E&=f-1,E+=f):E=0,_++,0==--T[v]){if(v===F)break;v=o[i+d[_]]}if(v>C&&(E&g)!==p){for(0===S&&(S=C),y+=b,w=v-S,M=1<<w;w+S<F&&(M-=T[w+S],!(M<=0));)w++,M<<=1;if(A+=1<<w,1===e&&A>852||2===e&&A>592)return 1;p=E&g,l[p]=C<<24|w<<16|y-u}}return 0!==E&&(l[y+E]=v-S<<24|64<<16),c.bits=C,0}},2315:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});const a="precision highp float;\r\nprecision highp int;\r\n\r\nuniform sampler2D u_texture;\r\nuniform ivec2 u_waterParams;\r\n\r\nvarying vec3 v_position;\r\nvarying vec2 v_texCoord;\r\nvarying vec3 v_normal;\r\nvarying float v_depth;\r\n\r\nuniform vec4 u_oceanCloseColor;\r\nuniform vec4 u_oceanFarColor;\r\nuniform vec4 u_riverCloseColor;\r\nuniform vec4 u_riverFarColor;\r\nuniform vec4 u_waterAlphas; // riverShallow, riverDeep, oceanShallow, oceanDeep\r\n\r\n// Simple lighting params, currently unused\r\nuniform bool u_unlit;\r\nuniform vec4 u_ambientColor;\r\nuniform vec4 u_lightColor;\r\nuniform vec3 u_lightDir;\r\n\r\nfloat saturate(float v) { return clamp(v, 0.0, 1.0); }\r\nvec3 saturate(vec3 v) { return clamp(v, vec3(0.0), vec3(1.0)); }\r\n\r\nvoid main() {\r\n    int liquidCategory = int(u_waterParams.x);\r\n    vec4 tex = texture2D(u_texture, v_texCoord);\r\n    vec4 finalColor;\r\n    // Slime or Lava\r\n    if (liquidCategory == 2 || liquidCategory == 3) {\r\n        finalColor = vec4(saturate(tex.xyz), 1.0);\r\n    } else {\r\n        vec4 liquidColor, diffuseColor, specularColor;\r\n        float depth = saturate(v_depth / 50.0);\r\n        // Ocean\r\n        if (liquidCategory == 1) {\r\n            vec4 shallowColor = vec4(u_oceanCloseColor.rgb, u_waterAlphas.b);\r\n            vec4 deepColor = vec4(u_oceanFarColor.rgb, u_waterAlphas.a);\r\n            liquidColor = mix(shallowColor, deepColor, depth);\r\n        } else {\r\n            vec4 shallowColor = vec4(u_riverCloseColor.rgb, u_waterAlphas.r);\r\n            vec4 deepColor = vec4(u_riverFarColor.rgb, u_waterAlphas.g);\r\n            liquidColor = mix(shallowColor, deepColor, depth);\r\n        }\r\n        diffuseColor = vec4(liquidColor.rgb + tex.rgb, liquidColor.a);\r\n        specularColor = vec4(vec3(0.25) * tex.a, 0.0);\r\n        finalColor = diffuseColor + specularColor;\r\n    }\r\n\r\n    gl_FragColor = finalColor;\r\n}"},2388:(e,t)=>{"use strict";var r,a,n;Object.defineProperty(t,"__esModule",{value:!0}),t.M2BlendModeToEGxBlend=t.GxBlend=t.ColorMask=t.BufferDataType=void 0,function(e){e[e.Float=0]="Float",e[e.UInt8=1]="UInt8",e[e.UInt16=2]="UInt16",e[e.UInt32=3]="UInt32",e[e.Int8=4]="Int8",e[e.Int16=5]="Int16",e[e.Int32=6]="Int32"}(r||(t.BufferDataType=r={})),function(e){e[e.None=0]="None",e[e.Red=1]="Red",e[e.Green=2]="Green",e[e.Blue=4]="Blue",e[e.Alpha=8]="Alpha"}(a||(t.ColorMask=a={})),function(e){e[e.GxBlend_Invalid=-1]="GxBlend_Invalid",e[e.GxBlend_Opaque=0]="GxBlend_Opaque",e[e.GxBlend_AlphaKey=1]="GxBlend_AlphaKey",e[e.GxBlend_Alpha=2]="GxBlend_Alpha",e[e.GxBlend_Add=3]="GxBlend_Add",e[e.GxBlend_Mod=4]="GxBlend_Mod",e[e.GxBlend_Mod2x=5]="GxBlend_Mod2x",e[e.GxBlend_ModAdd=6]="GxBlend_ModAdd",e[e.GxBlend_InvSrcAlphaAdd=7]="GxBlend_InvSrcAlphaAdd",e[e.GxBlend_InvSrcAlphaOpaque=8]="GxBlend_InvSrcAlphaOpaque",e[e.GxBlend_SrcAlphaOpaque=9]="GxBlend_SrcAlphaOpaque",e[e.GxBlend_NoAlphaAdd=10]="GxBlend_NoAlphaAdd",e[e.GxBlend_ConstantAlpha=11]="GxBlend_ConstantAlpha",e[e.GxBlend_Screen=12]="GxBlend_Screen",e[e.GxBlend_BlendAdd=13]="GxBlend_BlendAdd"}(n||(t.GxBlend=n={}));const o=[n.GxBlend_Opaque,n.GxBlend_AlphaKey,n.GxBlend_Alpha,n.GxBlend_NoAlphaAdd,n.GxBlend_Add,n.GxBlend_Mod,n.GxBlend_Mod2x,n.GxBlend_BlendAdd];t.M2BlendModeToEGxBlend=e=>o[e]},2462:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(7716),t),n(r(6472),t),n(r(6098),t),n(r(5416),t)},2510:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BspTree=t.AABB=t.Frustrum=t.Plane=t.FrustrumSide=t.PlaneElem=void 0;const a=r(2462),n=r(6604),o=r(7518);var i,s,l,u,d,c;!function(e){e[e.A=0]="A",e[e.B=1]="B",e[e.C=2]="C",e[e.D=3]="D"}(i||(t.PlaneElem=i={})),function(e){e[e.TOP=0]="TOP",e[e.BOTTOM=1]="BOTTOM",e[e.RIGHT=2]="RIGHT",e[e.LEFT=3]="LEFT",e[e.FAR=4]="FAR",e[e.NEAR=5]="NEAR",e[e.MAX=6]="MAX"}(s||(t.FrustrumSide=s={})),function(e){e.zero=function(){return o.Float4.zero()},e.create=function(e,t){return o.Float4.create(e[0],e[1],e[2],t)},e.majorAxis=function(e){let t=Math.abs(e[0]),r=0;for(let a=1;a<3;a++)Math.abs(e[a])>t&&(t=Math.abs(e[a]),r=a);return r},e.normalize=function(e){const t=o.Float3.length(e);for(let r=0;r<4;r++)e[r]/=t;return e},e.fromEyeAndVertices=function(t,r,a){const n=o.Float3.subtract(r,t),i=o.Float3.subtract(a,t),s=o.Float3.normalize(o.Float3.cross(i,n)),l=o.Float3.dot(s,t);return e.create(s,-l)},e.distanceToPoint=function(e,t){return o.Float3.dot(e,t)+e[3]},e.sideFacingPoint=function(t,r){const a=e.distanceToPoint(t,r);return Math.sign(a)}}(l||(t.Plane=l={})),function(e){e.zero=function(){return[]},e.copy=function(t,r){(r=r||e.zero()).length=t.length;for(let e=0;e<t.length;e++)r[e]=o.Float4.copy(t[e]);return r},e.fromViewMatrix=function(e,t){t=t||[];const r=e[0],a=e[4],n=e[8],i=e[12],u=e[1],d=e[5],c=e[9],h=e[13],f=e[2],m=e[6],p=e[10],g=e[14],y=e[3],x=e[7],v=e[11],_=e[15];for(let e=0;e<s.MAX;e++)t[e]||(t[e]=o.Float4.zero());return o.Float4.set(t[s.LEFT],y+r,x+a,v+n,_+i),l.normalize(t[s.LEFT]),o.Float4.set(t[s.RIGHT],y-r,x-a,v-n,_-i),l.normalize(t[s.RIGHT]),o.Float4.set(t[s.BOTTOM],y+u,x+d,v+c,_+h),l.normalize(t[s.BOTTOM]),o.Float4.set(t[s.TOP],y-u,x-d,v-c,_-h),l.normalize(t[s.TOP]),o.Float4.set(t[s.NEAR],y+f,x+m,v+p,_+g),l.normalize(t[s.NEAR]),o.Float4.set(t[s.FAR],y-f,x-m,v-p,_-g),l.normalize(t[s.FAR]),t},e.transform=function(e,t,r){(r=r||r).length=e.length;const a=n.Float44.invert(t);n.Float44.tranpose(a,a);for(let t=0;t<e.length;t++)r[t]=n.Float44.transformDirection4(e[t],a);return r},e.transformSelf=function(e,t){const r=n.Float44.invert(t);n.Float44.tranpose(r,r);for(let t=0;t<e.length;t++)n.Float44.transformDirection4(e[t],r,e[t])}}(u||(t.Frustrum=u={})),function(e){function t(e,t){for(let r=0;r<3;r++)if(e.min[r]>t[r]||e.max[r]<t[r])return!1;return!0}e.create=function(e,t){return{min:e,max:t}},e.fromVertices=function(t,r=.1){let a,n,i,s,l,u;a=n=i=9999,s=l=u=-9999;for(let e=0;e<t.length;e++){const r=t[e];a=Math.min(a,r[0]),s=Math.max(s,r[0]),n=Math.min(n,r[1]),l=Math.max(l,r[1]),i=Math.min(i,r[2]),u=Math.max(u,r[2])}return e.create(o.Float3.create(a-r,n-r,i-r),o.Float3.create(s+r,l+r,u+r))},e.transform=function(e,t){const r=o.Float3.copy(e.min),a=o.Float3.copy(e.max),n=o.Float3.create(t[12],t[13],t[14]),i=o.Float3.create(t[12],t[13],t[14]);for(let e=0;e<3;e++)for(let o=0;o<3;o++){const s=t[4*e+o]*r[o],l=t[4*e+o]*a[o];n[e]+=s<l?s:l,i[e]+=s<l?l:s}return{min:n,max:i}},e.visibleInFrustrum=function(e,t){const r=[o.Float4.create(e.min[0],e.min[1],e.min[2],1),o.Float4.create(e.max[0],e.min[1],e.min[2],1),o.Float4.create(e.min[0],e.max[1],e.min[2],1),o.Float4.create(e.max[0],e.max[1],e.min[2],1),o.Float4.create(e.min[0],e.min[1],e.max[2],1),o.Float4.create(e.max[0],e.min[1],e.max[2],1),o.Float4.create(e.min[0],e.max[1],e.max[2],1),o.Float4.create(e.max[0],e.max[1],e.max[2],1)];for(const e of t){let t=!1;for(const a of r)if(o.Float4.dot(e,a)>0){t=!0;break}if(!t)return!1}return!0},e.containsPoint=t,e.containsPointIgnoreMaxZ=function(e,t){for(let r=0;r<2;r++)if(e.min[r]>t[r]||e.max[r]<t[r])return!1;return!(e.min[2]>t[2])},e.containsBoundingBox=function(e,r){return t(e,r.min)&&t(e,r.max)},e.distanceToPoint=function(e,r){if(t(e,r))return 0;const a=o.Float3.zero();for(let t=0;t<3;t++)r[t]<e.min[t]?a[t]=e.min[t]-r[t]:a[t]=r[t]-e.max[t];return o.Float3.length(a)},e.distanceToPointIgnoreAxis=function(e,r,a){if(t(e,r))return 0;const n=o.Float3.zero();for(let t=0;t<3;t++)t!=a&&(r[t]<e.min[t]?n[t]=e.min[t]-r[t]:n[t]=r[t]-e.max[t]);return o.Float3.length(n)}}(d||(t.AABB=d={})),function(e){function t(e,[t,r,a]){let n=Math.min(t[0],r[0],a[0]),i=Math.max(t[0],r[0],a[0]);if(e[0]<n||e[0]>i)return null;let s=Math.min(t[1],r[1],a[1]),l=Math.max(t[1],r[1],a[1]);if(e[1]<s||e[1]>l)return null;let u=Math.min(t[2],r[2],a[2]);if(e[2]<u)return null;let d=o.Float3.subtract(r,t);const c=o.Float3.subtract(a,t),h=o.Float3.cross(d,c);if(h[2]<1e-4)return null;const f=o.Float3.subtract(e,t),m=o.Float3.dot(f,h)/h[2];if(m<0)return null;const p=-f[1],g=f[0],y=(c[0],+c[1]*g/h[2]);if(y<0||y>1)return null;const x=(d[0]*p+d[1]*g)/-h[2];return x<0||y+x>1?null:{dist:m,bary:o.Float3.create(y,x,1-y-x)}}function r(e,t){const r=e.faceIndices[t],[a,o,i]=n(e,r);return[e.vertices[a],e.vertices[o],e.vertices[i]]}function n(e,t){return[e.vertexIndices[3*t+0],e.vertexIndices[3*t+1],e.vertexIndices[3*t+2]]}e.pickClosestTriangle_NegZ=function(e,a,i){let s=Number.MAX_VALUE,l=-1,u=o.Float3.zero();for(const n of i){const i=n.faceStart,d=i+n.faces;for(let n=i;n<d;n++){const i=t(a,r(e,n));i&&i.dist<s&&(s=i.dist,l=n,o.Float3.copy(i.bary,u))}}return{distance:s,baryocentricCoords:u,vertexIndices:n(e,e.faceIndices[l])}},e.findNodesForPoint=function e(t,r,n,i){if(i<0||t.nodes.length<i)return;const s=t.nodes[i];if(s.flags&a.WowWorldModelBspNodeFlags.Leaf)return void n.push(s);const l=function(e){return e.flags&a.WowWorldModelBspNodeFlags.YAxis?o.Axis.Y:e.flags&a.WowWorldModelBspNodeFlags.ZAxis?o.Axis.Z:o.Axis.X}(s);l===o.Axis.Z?(e(t,r,n,s.negChild),e(t,r,n,s.posChild)):(l===o.Axis.X?r[0]:r[1])<s.planeDistance?e(t,r,n,s.negChild):e(t,r,n,s.posChild)},e.createBoundingBoxForNodes=function(e,t){const a=t.reduce(((t,a)=>{const n=Array.from({length:a.faces},((e,t)=>a.faceStart+t)).reduce(((t,a)=>t.concat(r(e,a))),[]);return t.concat(n)}),[]);return d.fromVertices(a,0)}}(c||(t.BspTree=c={}))},2673:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StaticM2DataBuffers=void 0;const a=r(8219),n=r(9266);t.StaticM2DataBuffers=class{createFromModelData(e,t,r){this.vao=e.createVertexArrayObject(),this.vertexIndexBuffer=e.createVertexIndexBuffer(!0),this.vertexDataBuffer=e.createVertexDataBuffer([{index:t.getAttribLocation("a_position"),size:3,type:a.BufferDataType.Float,normalized:!1,stride:48,offset:0},{index:t.getAttribLocation("a_normal"),size:3,type:a.BufferDataType.Float,normalized:!1,stride:48,offset:12},{index:t.getAttribLocation("a_bones"),size:4,type:a.BufferDataType.UInt8,normalized:!1,stride:48,offset:24},{index:t.getAttribLocation("a_boneWeights"),size:4,type:a.BufferDataType.UInt8,normalized:!1,stride:48,offset:28},{index:t.getAttribLocation("a_texcoord1"),size:2,type:a.BufferDataType.Float,normalized:!1,stride:48,offset:32},{index:t.getAttribLocation("a_texcoord2"),size:2,type:a.BufferDataType.Float,normalized:!1,stride:48,offset:40}],!0),r&&(this.uploadVertexData(r.vertices),this.vertexIndexBuffer.setData(new Uint16Array(r.skinTriangles)),this.vao.setIndexBuffer(this.vertexIndexBuffer),this.vao.addVertexDataBuffer(this.vertexDataBuffer))}uploadVertexData(e){const t=48*e.length,r=new Uint8Array(t),a=new n.BinaryWriter(r.buffer);for(let t=0;t<e.length;++t)a.writeFloatLE(e[t].position[0]),a.writeFloatLE(e[t].position[1]),a.writeFloatLE(e[t].position[2]),a.writeFloatLE(e[t].normal[0]),a.writeFloatLE(e[t].normal[1]),a.writeFloatLE(e[t].normal[2]),a.writeUInt8(e[t].boneIndices[0]),a.writeUInt8(e[t].boneIndices[1]),a.writeUInt8(e[t].boneIndices[2]),a.writeUInt8(e[t].boneIndices[3]),a.writeUInt8(e[t].boneWeights[0]),a.writeUInt8(e[t].boneWeights[1]),a.writeUInt8(e[t].boneWeights[2]),a.writeUInt8(e[t].boneWeights[3]),a.writeFloatLE(e[t].texCoords1[0]),a.writeFloatLE(e[t].texCoords1[1]),a.writeFloatLE(e[t].texCoords2[0]),a.writeFloatLE(e[t].texCoords2[1]);this.vertexDataBuffer.setData(r)}}},2690:(e,t)=>{"use strict";var r,a;Object.defineProperty(t,"__esModule",{value:!0}),t.getWMOPixelShader=t.getWMOVertexShader=void 0,function(e){e[e.Diffuse=0]="Diffuse",e[e.Specular=1]="Specular",e[e.Metal=2]="Metal",e[e.Env=3]="Env",e[e.Opaque=4]="Opaque",e[e.EnvMetal=5]="EnvMetal",e[e.TwoLayerDiffuse=6]="TwoLayerDiffuse",e[e.TwoLayerEnvMetal=7]="TwoLayerEnvMetal",e[e.TwoLayerTerrain=8]="TwoLayerTerrain",e[e.DiffuseEmissive=9]="DiffuseEmissive",e[e.MaskedEnvMetal=10]="MaskedEnvMetal",e[e.EnvMetalEmissive=11]="EnvMetalEmissive",e[e.TwoLayerDiffuseOpaque=12]="TwoLayerDiffuseOpaque",e[e.TwoLayerDiffuseEmissive=13]="TwoLayerDiffuseEmissive",e[e.AdditiveMaskedEnvMetal=14]="AdditiveMaskedEnvMetal",e[e.TwoLayerDiffuseMod2x=15]="TwoLayerDiffuseMod2x",e[e.TwoLayerDiffuseMod2xNA=16]="TwoLayerDiffuseMod2xNA",e[e.TwoLayerDiffuseAlpha=17]="TwoLayerDiffuseAlpha",e[e.Lod=18]="Lod",e[e.Parallax=19]="Parallax",e[e.UnkShader=20]="UnkShader",e[e.None=21]="None"}(r||(r={})),function(e){e[e.DiffuseT1=0]="DiffuseT1",e[e.DiffuseT1Refl=1]="DiffuseT1Refl",e[e.DiffuseT1EnvT2=2]="DiffuseT1EnvT2",e[e.SpecularT1=3]="SpecularT1",e[e.DiffuseComp=4]="DiffuseComp",e[e.DiffuseCompRefl=5]="DiffuseCompRefl",e[e.DiffuseCompTerrain=6]="DiffuseCompTerrain",e[e.DiffuseCompAlpha=7]="DiffuseCompAlpha",e[e.Parallax=8]="Parallax",e[e.None=9]="None"}(a||(a={}));const n=[[a.DiffuseT1,r.Diffuse],[a.SpecularT1,r.Specular],[a.SpecularT1,r.Metal],[a.DiffuseT1Refl,r.Env],[a.DiffuseT1,r.Opaque],[a.DiffuseT1Refl,r.EnvMetal],[a.DiffuseComp,r.TwoLayerDiffuse],[a.DiffuseT1,r.TwoLayerEnvMetal],[a.DiffuseCompTerrain,r.TwoLayerTerrain],[a.DiffuseComp,r.DiffuseEmissive],[a.None,r.None],[a.DiffuseT1EnvT2,r.MaskedEnvMetal],[a.DiffuseT1EnvT2,r.EnvMetalEmissive],[a.DiffuseComp,r.TwoLayerDiffuseOpaque],[a.None,r.None],[a.DiffuseComp,r.TwoLayerDiffuseEmissive],[a.DiffuseT1,r.Diffuse],[a.DiffuseT1EnvT2,r.AdditiveMaskedEnvMetal],[a.DiffuseCompAlpha,r.TwoLayerDiffuseMod2x],[a.DiffuseComp,r.TwoLayerDiffuseMod2xNA],[a.DiffuseCompAlpha,r.TwoLayerDiffuseAlpha],[a.DiffuseT1,r.Lod],[a.Parallax,r.Parallax],[a.DiffuseT1,r.UnkShader]];t.getWMOVertexShader=e=>n[e][0],t.getWMOPixelShader=e=>n[e][1]},2807:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlaneParticleGenerator=void 0;const a=r(1278),n=r(3064);class o extends n.BaseParticleGenerator{generateParticle(e){let t=e*this.rng.getFloat(),r=this.rng.getFloat(),n=r<1?r>-1?Math.trunc(32767*r+.5):-32767:32767,o=this.getLifespan(n);o<.001&&(o=.001);const i=t%o,s=65535&this.rng.getInt(),l=a.Float3.zero();l[0]=this.rng.getSignedFloat()*this.animatedProps.emissionAreaX*.5,l[1]=this.rng.getSignedFloat()*this.animatedProps.emissionAreaY*.5;let u=this.getNextEmissionSpeed();const d=a.Float3.zero();let c=this.animatedProps.zSource;if(c<.001){let e=this.animatedProps.verticalRange*this.rng.getSignedFloat(),t=this.animatedProps.horizontalRange*this.rng.getSignedFloat(),r=Math.sin(e),n=Math.sin(t),o=Math.cos(e),i=Math.cos(t);a.Float3.set(d,i*r*u,n*r*u,o*u)}else{let e=a.Float3.zero();a.Float3.copy(l,e),e[2]=e[2]-c,a.Float3.length(e)>1e-4&&(a.Float3.normalize(e,e),a.Float3.scale(e,u,d))}return{age:i,position:l,seed:s,state:n,texturePosition:[a.Float2.zero(),a.Float2.zero()],textureVelocity:[a.Float2.zero(),a.Float2.zero()],velocity:d}}}t.PlaneParticleGenerator=o},2981:function(e,t,r){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.M2RibbonEmitter=void 0;const n=r(8219),o=a(r(304)),i=a(r(8381));class s{constructor(){this.pos=n.Float3.zero(),this.color=n.Float4.zero(),this.texCoord=n.Float2.zero()}}t.M2RibbonEmitter=class{constructor(e,t){this.isDisposing=!1,this.parent=e,this.m2data=t,this.engine=e.engine,this.initialize()}initialize(){this.texBox={minX:0,minY:0,maxX:1,maxY:1};let e=Math.ceil(this.m2data.edgesPerSecond),t=Math.max(.25,this.m2data.edgeLifetime),r=Math.ceil(t*e),a=Math.max(r+2,0);this.edgeLifetimes=new Array(a),this.vertices=new Array(2*a);for(let e=0;e<this.vertices.length;e++)this.vertices[e]=new s;this.invLifespan=1/t;let o=this.m2data.textureCols;2147483648&o&&(o=(1&o|o>>1)+(1&o|o>>1));let i=this.m2data.textureRows;2147483648&i&&(i=(1&i|i>>1)+(1&i|i>>1)),this.colLength=(this.texBox.maxX-this.texBox.minX)/o,this.rowLength=(this.texBox.maxY-this.texBox.minY)/i,this.rows=i,this.cols=o,this.edgesPerSecond=e,this.edgeLifetime=t,this.color=n.Float4.create(1,1,1,1),this.texSlot=0,this.texSlotBox={minX:this.texBox.minX,minY:this.texBox.minY,maxX:this.texBox.minX+this.colLength,maxY:this.texBox.minY+this.rowLength},this.heightAbove=10,this.heightBelow=10,this.gravity=this.m2data.gravity,this.visible=!0,this.initializedPosition=!1,this.didSingletonUpdate=!1,this.edgeStart=0,this.edgeEnd=0,this.prevPos=n.Float3.zero(),this.prevDir=n.Float3.zero(),this.prevVertical=n.Float3.zero(),this.currPos=n.Float3.zero(),this.currDir=n.Float3.zero(),this.currVertical=n.Float3.zero(),this.startTime=0,this.below0=n.Float3.zero(),this.below1=n.Float3.zero(),this.above0=n.Float3.zero(),this.above1=n.Float3.zero(),this.prevDirScaled=n.Float3.zero(),this.currDirScaled=n.Float3.zero(),this.minWorldBounds=n.Float3.zero(),this.maxWorldBounds=n.Float3.zero(),this.setupGraphics()}dispose(){this.isDisposing=!0,this.materials=null}update(e){for(this.updateAnimatedProps(),this.updatePosition(),e*=.001,this.didSingletonUpdate||this.edgesPerSecond>0&&(e=1/this.edgesPerSecond+99999997e-12),e>=0?this.edgeLifetime<=e&&(e=this.edgeLifetime):e=0;e+this.edgeLifetimes[this.edgeStart]>=this.edgeLifetime&&this.edgeStart!=this.edgeEnd;)this.edgeStart=this.advance(this.edgeStart,1);if(this.visible&&this.initializedPosition){this.updateDeltas();const t=e*this.edgesPerSecond+this.startTime;let r,a,n,o=!1,i=0;if(t<1?o=!0:(a=this.startTime,r=1/(t-a),n=Math.max(Math.floor(t-1),0)),!o&&n>-1)for(i=0;-1!==n;)i+=1,a=this.startTime,this.vertices[2*this.edgeEnd].color=this.color,this.vertices[2*this.edgeEnd+1].color=this.color,this.interpEdge((i-a)*r*-e,(i-a)*r,1),n--;this.startTime=t-Math.floor(t),this.interpEdge(0,1,0);const s=this.vertices[2*this.edgeEnd];s.texCoord[0]=this.texSlotBox.minX,s.texCoord[1]=this.texSlotBox.minY,s.color=this.color;const l=this.vertices[2*this.edgeEnd+1];l.texCoord[0]=this.texSlotBox.maxX,l.texCoord[1]=this.texSlotBox.maxY,l.color=this.color}this.minWorldBounds[2]=34028235e30,this.minWorldBounds[1]=34028235e30,this.minWorldBounds[0]=34028235e30,this.maxWorldBounds[2]=-34028235e30,this.maxWorldBounds[1]=-34028235e30,this.maxWorldBounds[0]=-34028235e30;let t=this.edgeStart;for(;t!=this.edgeEnd;){const r=this.vertices[2*t],a=this.vertices[2*t+1],n=2*this.gravity*this.edgeLifetimes[t]*e+e*this.gravity*e;r.pos[2]=r.pos[2]+n,a.pos[2]=n+a.pos[2],this.minWorldBounds[0]=Math.min(this.minWorldBounds[0],r.pos[0],a.pos[0]),this.minWorldBounds[1]=Math.min(this.minWorldBounds[1],r.pos[1],a.pos[1]),this.minWorldBounds[2]=Math.min(this.minWorldBounds[2],r.pos[2],a.pos[2]),this.maxWorldBounds[0]=Math.max(this.maxWorldBounds[0],r.pos[0],a.pos[0]),this.maxWorldBounds[1]=Math.max(this.maxWorldBounds[1],r.pos[1],a.pos[1]),this.maxWorldBounds[2]=Math.max(this.maxWorldBounds[2],r.pos[2],a.pos[2]),this.edgeLifetimes[t]=e+this.edgeLifetimes[t];const o=this.colLength*this.edgeLifetimes[t]*this.invLifespan+this.texSlotBox.minX;r.texCoord[0]=o,r.texCoord[1]=this.texSlotBox.minY,a.texCoord[0]=o,a.texCoord[1]=this.texSlotBox.maxY;const i=t+1;t=i-this.edgeLifetimes.length,this.edgeLifetimes.length>i&&(t=i)}this.didSingletonUpdate=!0,this.updateBuffers()}draw(){if(!this.isDisposing&&this.edgeStart!=this.edgeEnd)for(const e of this.materials){const t=new n.RenderingBatchRequest(e);t.useVertexArrayObject(this.vao);const r=this.edgeEnd>this.edgeStart?2*(this.edgeEnd-this.edgeStart)+2:2*(this.edgeLifetimes.length+this.edgeEnd-this.edgeStart)+2;t.drawIndexedTriangleStrip(2*this.edgeStart*2,r),this.engine.submitBatchRequest(t)}}updateAnimatedProps(){let e=n.Float3.zero(),t=1;e=this.parent.animationState.getFloat3TrackValue(this.m2data.colorTrack,e),t=this.parent.animationState.getNumberTrackValue(this.m2data.alphaTrack,0),n.Float3.copy(e,this.color),this.color[3]=Math.max(t/32767,0),this.heightAbove=this.parent.animationState.getNumberTrackValue(this.m2data.heightAboveTrack,0),this.heightBelow=this.parent.animationState.getNumberTrackValue(this.m2data.heightBelowTrack,0);const r=this.parent.animationState.getNumberTrackValue(this.m2data.texSlotTrack,0);if(this.texSlot!=r){this.texSlot=r;let e=r%this.cols;2147483648&e&&(e=(1&e|e>>1)+(1&e|e>>1));const t=e*this.colLength+this.texBox.minX;this.texSlotBox.minX=t;let a=r/this.cols;2147483648&a&&(a=1&a|a>>1,a+=a);let n=a*this.rowLength+this.texBox.minY;this.texSlotBox.minY=n,this.texSlotBox.maxX=t+this.colLength,this.texSlotBox.maxY=n+this.rowLength}const a=this.parent.animationState.getNumberTrackValue(this.m2data.visibilityTrack,1)>0;a||(this.initializedPosition=!1),this.visible=a}updatePosition(){if(this.visible){const e=n.Float44.identity();n.Float44.multiply(this.parent.worldModelMatrix,this.parent.boneData[this.m2data.boneIndex].positionMatrix,e),n.Float44.translate(e,this.m2data.position,e);const t=n.Float3.zero();n.Float44.getTranslation(e,t),this.initializedPosition?(n.Float3.copy(this.currPos,this.prevPos),n.Float3.copy(this.currDir,this.prevDir),n.Float3.copy(this.currVertical,this.prevVertical)):(n.Float3.copy(t,this.prevPos),this.prevDir=n.Float44.getColumn3(e,2),this.prevVertical=n.Float44.getColumn3(e,1),this.startTime=0,this.initializedPosition=!0),this.currPos=t,this.currDir=n.Float44.getColumn3(e,2),this.currVertical=n.Float44.getColumn3(e,1)}}advance(e,t){let r=e+t,a=this.edgeLifetimes.length;return r>=a&&(r-=a),r}updateDeltas(){let e=n.Float3.zero();n.Float3.subtract(this.prevPos,this.prevPos,e);let t=n.Float3.length(e);n.Float3.scale(this.prevVertical,this.heightBelow,e),n.Float3.subtract(this.prevPos,e,this.below0),n.Float3.scale(this.currVertical,this.heightBelow,e),n.Float3.subtract(this.currPos,e,this.below1),n.Float3.scale(this.prevVertical,this.heightAbove,e),n.Float3.add(this.prevPos,e,this.above0),n.Float3.scale(this.currVertical,this.heightAbove,e),n.Float3.add(this.currPos,e,this.above1),n.Float3.scale(this.prevDir,t,this.prevDirScaled),n.Float3.scale(this.currDir,t,this.currDirScaled)}interpEdge(e,t,r){const a=this.vertices[2*this.edgeEnd],o=this.vertices[2*this.edgeEnd+1],i=n.Float3.zero();n.Float3.scale(this.currDirScaled,1-t,i),n.Float3.subtract(this.below1,i,i),n.Float3.scale(i,t,a.pos),n.Float3.scale(this.prevDirScaled,t,i),n.Float3.add(this.below0,i,i),n.Float3.scale(i,1-t,i),n.Float3.add(a.pos,i,a.pos),n.Float3.scale(this.currDirScaled,1-t,i),n.Float3.subtract(this.above1,i,i),n.Float3.scale(i,t,o.pos),n.Float3.scale(this.prevDirScaled,t,i),n.Float3.add(this.above0,i,i),n.Float3.scale(i,1-t,i),n.Float3.add(o.pos,i,o.pos),this.edgeLifetimes[this.edgeEnd]=e,this.edgeEnd=this.edgeEnd+r,this.edgeEnd>=this.edgeLifetimes.length&&(this.edgeEnd-=this.edgeLifetimes.length)}updateBuffers(){let e=new Array(this.vertices.length),t=0;for(let r=0;r<this.vertices.length;++r)e[t++]=this.vertices[r].pos[0],e[t++]=this.vertices[r].pos[1],e[t++]=this.vertices[r].pos[2],e[t++]=this.vertices[r].color[0],e[t++]=this.vertices[r].color[1],e[t++]=this.vertices[r].color[2],e[t++]=this.vertices[r].color[3],e[t++]=this.vertices[r].texCoord[0],e[t++]=this.vertices[r].texCoord[1];this.vertexBuffer.setData(new Float32Array(e))}setupGraphics(){this.shaderProgram=this.engine.getShaderProgram("M2RibbonEmitter",i.default,o.default),this.vertexBuffer=this.engine.graphics.createVertexDataBuffer([{index:this.shaderProgram.getAttribLocation("a_position"),size:3,type:n.BufferDataType.Float,normalized:!1,stride:36,offset:0},{index:this.shaderProgram.getAttribLocation("a_color"),size:4,type:n.BufferDataType.Float,normalized:!1,stride:36,offset:12},{index:this.shaderProgram.getAttribLocation("a_texCoord1"),size:2,type:n.BufferDataType.Float,normalized:!1,stride:36,offset:28}],!0),this.indexBuffer=this.engine.graphics.createVertexIndexBuffer(!0);let e=new Uint16Array(4*this.edgeLifetimes.length);for(let t=0;t<e.length;t++)e[t]=t%(2*this.edgeLifetimes.length);this.indexBuffer.setData(e),this.vao=this.engine.graphics.createVertexArrayObject(),this.vao.addVertexDataBuffer(this.vertexBuffer),this.vao.setIndexBuffer(this.indexBuffer),this.materials=[];for(let e=0;e<this.m2data.textureIndices.length;e++){const t=this.m2data.textureIndices[e];if(t<=-1||t>this.parent.modelData.textures.length)continue;const r=this.parent.modelData.textures[t];if(r.textureId<=-1)continue;const a=this.parent.loadedTextures[r.textureId];let o=e;o>=this.m2data.materialIndices.length&&(o=0);const i=this.parent.modelData.materials[this.m2data.materialIndices[o]];let s=(0,n.M2BlendModeToEGxBlend)(i.blendingMode);s===n.GxBlend.GxBlend_Opaque&&(s=n.GxBlend.GxBlend_Alpha);const l=new n.MaterialKey(this.parent.fileId,n.MaterialType.M2RibbonMaterial,o);let u=new n.RenderMaterial(l);u.useShaderProgram(this.shaderProgram),u.useBackFaceCulling(!1),u.useCounterClockWiseFrontFaces(!this.parent.isMirrored),u.useBlendMode(s),u.useDepthTest(!0),u.useDepthWrite(!1),u.useColorMask(n.ColorMask.Alpha|n.ColorMask.Blue|n.ColorMask.Green|n.ColorMask.Red),u.useUniforms({u_texture:a}),this.engine.addEngineMaterialParams(u),this.materials.push(u)}}}},3030:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});const a="precision mediump float;\r\n\r\nvarying vec3 v_normal;\r\nvarying vec4 v_color;\r\nvarying vec2 v_texCoord1;\r\nvarying vec2 v_texCoord2;\r\nvarying vec2 v_texCoord3;\r\n\r\nuniform int u_blendMode;\r\nuniform int u_pixelShader;\r\nuniform bool u_unlit;\r\nuniform vec4 u_ambientColor;\r\nuniform vec4 u_lightColor;\r\nuniform vec3 u_lightDir;\r\nuniform sampler2D u_texture1;\r\nuniform sampler2D u_texture2;\r\nuniform sampler2D u_texture3;\r\nuniform sampler2D u_texture4;\r\nuniform vec4 u_textureWeights;\r\n        \r\nvoid main(void) {\r\n    vec4 outputColor = vec4(1.0);\r\n    vec3 specular = vec3(0.0);\r\n\r\n    vec4 tex1 = texture2D(u_texture1, v_texCoord1.st);\r\n    vec4 tex2 = texture2D(u_texture2, v_texCoord2.st);\r\n    vec4 tex3 = texture2D(u_texture3, v_texCoord3.st);\r\n\r\n    vec3 materialColor;\r\n    float discardAlpha = 1.0;\r\n    if ( u_pixelShader == 0 ) { \r\n        //Combiners_Opaque\r\n        materialColor = v_color.rgb * 2.0 * tex1.rgb;\r\n    } else if ( u_pixelShader == 1 ) { \r\n        //Combiners_Mod\r\n        materialColor = v_color.rgb * 2.0 * tex1.rgb;\r\n        discardAlpha = tex1.a;\r\n    } else if ( u_pixelShader == 2 ) { \r\n        //Combiners_Opaque_Mod\r\n        materialColor = v_color.rgb * 2.0 * tex1.rgb * tex2.rgb;\r\n        discardAlpha = tex2.a;\r\n    } else if ( u_pixelShader == 3 ) { \r\n        //Combiners_Opaque_Mod2x\r\n        materialColor = v_color.rgb * 2.0 * tex1.rgb * tex2.rgb * 2.0;\r\n        discardAlpha = tex2.a * 2.0;\r\n    } else if ( u_pixelShader == 4 ) { \r\n        //Combiners_Opaque_Mod2xNA\r\n        materialColor = v_color.rgb * 2.0 * tex1.rgb * tex2.rgb * 2.0;\r\n    } else if ( u_pixelShader == 5 ) { \r\n        //Combiners_Opaque_Opaque\r\n        materialColor = v_color.rgb * 2.0 * tex1.rgb * tex2.rgb;\r\n    } else if ( u_pixelShader == 6 ) { \r\n        //Combiners_Mod_Mod\r\n        materialColor = v_color.rgb * 2.0 * tex1.rgb * tex2.rgb;\r\n        discardAlpha = tex1.a * tex2.a;\r\n    } else if ( u_pixelShader == 7 ) { \r\n        //Combiners_Mod_Mod2x\r\n        materialColor = v_color.rgb * 2.0 * tex1.rgb * tex2.rgb * 2.0;\r\n        discardAlpha = tex1.a * tex2.a * 2.0;\r\n    } else if ( u_pixelShader == 8 ) { \r\n        //Combiners_Mod_Add\r\n        materialColor = v_color.rgb * 2.0 * tex1.rgb;\r\n        discardAlpha = tex1.a + tex2.a;\r\n        specular = tex2.rgb;\r\n    } else if ( u_pixelShader == 9 ) { \r\n        //Combiners_Mod_Mod2xNA\r\n        materialColor = v_color.rgb * 2.0 * tex1.rgb * tex2.rgb * 2.0;\r\n        discardAlpha = tex1.a;\r\n    } else if ( u_pixelShader == 10 ) { \r\n        //Combiners_Mod_AddNA\r\n        materialColor = v_color.rgb * 2.0 * tex1.rgb;\r\n        discardAlpha = tex1.a;\r\n        specular = tex2.rgb;\r\n    } else if ( u_pixelShader == 11 ) { \r\n        //Combiners_Mod_Opaque\r\n        materialColor = v_color.rgb * 2.0 * tex1.rgb * tex2.rgb;\r\n        discardAlpha = tex1.a;\r\n    } else if ( u_pixelShader == 12 ) { \r\n        //Combiners_Opaque_Mod2xNA_Alpha\r\n        materialColor = v_color.rgb * 2.0 * mix(tex1.rgb * tex2.rgb * 2.0, tex1.rgb, vec3(tex1.a));\r\n    } else if ( u_pixelShader == 13 ) { \r\n        //Combiners_Opaque_AddAlpha\r\n        materialColor = v_color.rgb * 2.0 * tex1.rgb;\r\n        specular = tex2.rgb * tex2.a;\r\n    } else if ( u_pixelShader == 14 ) {\r\n        //Combiners_Opaque_AddAlpha_Alpha\r\n        materialColor = v_color.rgb * 2.0 * tex1.rgb;\r\n        specular = tex2.rgb * tex2.a * (1.0 - tex1.a);\r\n    } else if ( u_pixelShader == 15 ) {\r\n        //Combiners_Opaque_Mod2xNA_Alpha_Add\r\n        materialColor = v_color.rgb * 2.0 * mix(tex1.rgb * tex2.rgb * 2.0, tex1.rgb, vec3(tex1.a));\r\n        specular = tex3.rgb * tex3.a * u_textureWeights.b;\r\n    } else if ( u_pixelShader == 16 ) {\r\n        //Combiners_Mod_AddAlpha\r\n        materialColor = v_color.rgb * 2.0 * tex1.rgb;\r\n        discardAlpha = tex1.a;\r\n        specular = tex2.rgb * tex2.a;\r\n    } else if ( u_pixelShader == 17 ) {\r\n        //Combiners_Mod_AddAlpha_Alpha\r\n        materialColor = v_color.rgb * 2.0 * tex1.rgb;\r\n        discardAlpha = tex1.a + tex2.a * (0.3 * tex2.r + 0.59 * tex2.g + 0.11 * tex2.b);\r\n        specular = tex2.rgb * tex2.a * (1.0 - tex1.a);\r\n    } else if ( u_pixelShader == 18 ) {\r\n        //Combiners_Opaque_Alpha_Alpha\r\n        materialColor = v_color.rgb * 2.0 * mix(mix(tex1.rgb, tex2.rgb, vec3(tex2.a)), tex1.rgb, vec3(tex1.a));\r\n    } else if ( u_pixelShader == 19 ) { \r\n        //Combiners_Opaque_Mod2xNA_Alpha_3s\r\n        materialColor = v_color.rgb * 2.0 * mix(tex1.rgb * tex2.rgb * 2.0, tex3.rgb, vec3(tex3.a));\r\n    } else if ( u_pixelShader == 20 ) { \r\n        //Combiners_Opaque_AddAlpha_Wgt\r\n        materialColor = v_color.rgb * 2.0 * tex1.rgb;\r\n        specular = tex2.rgb * tex2.a * u_textureWeights.g;\r\n    } else if ( u_pixelShader == 21 ) {\r\n        //Combiners_Mod_Add_Alpha\r\n        materialColor = v_color.rgb * 2.0 * tex1.rgb;\r\n        discardAlpha = tex1.a + tex2.a;\r\n        specular = tex2.rgb * (1.0 - tex1.a);\r\n    } else if ( u_pixelShader == 22 ) { \r\n        //Combiners_Opaque_ModNA_Alpha\r\n        materialColor = v_color.rgb * 2.0 * mix(tex1.rgb * tex2.rgb, tex1.rgb, vec3(tex1.a));\r\n    } else if ( u_pixelShader == 23 ) { \r\n        //Combiners_Mod_AddAlpha_Wgt\r\n        materialColor = v_color.rgb * 2.0 * tex1.rgb;\r\n        discardAlpha = tex1.a;\r\n        specular = tex2.rgb * tex2.a * u_textureWeights.g;\r\n    } else if ( u_pixelShader == 24 ) { \r\n        //Combiners_Opaque_Mod_Add_Wgt\r\n        materialColor = v_color.rgb * 2.0 * mix(tex1.rgb, tex2.rgb, vec3(tex2.a));\r\n        specular = tex1.rgb * tex1.a * u_textureWeights.r;\r\n    } else if ( u_pixelShader == 25 ) { \r\n        //Combiners_Opaque_Mod2xNA_Alpha_UnshAlpha\r\n        float glowOpacity = clamp(tex3.a * u_textureWeights.b, 0.0, 1.0);\r\n        materialColor = v_color.rgb * 2.0 * mix(tex1.rgb * tex2.rgb * 2.0, tex1.rgb, vec3(tex1.a)) * (1.0 - glowOpacity);\r\n        specular = tex3.rgb * glowOpacity;\r\n    } else if ( u_pixelShader == 26 ) { \r\n        //Combiners_Mod_Dual_Crossfade\r\n        materialColor = v_color.rgb * 2.0 * mix(mix(tex1, texture2D(u_texture2, v_texCoord1), vec4(clamp(u_textureWeights.g, 0.0, 1.0))), texture2D(u_texture3,v_texCoord1), vec4(clamp(u_textureWeights.b, 0.0, 1.0))).rgb;\r\n        discardAlpha = mix(mix(tex1, texture2D(u_texture2, v_texCoord1), vec4(clamp(u_textureWeights.g, 0.0, 1.0))), texture2D(u_texture3,v_texCoord1), vec4(clamp(u_textureWeights.b, 0.0, 1.0))).a;\r\n    } else if ( u_pixelShader == 27 ) { \r\n        //Combiners_Opaque_Mod2xNA_Alpha_Alpha\r\n        materialColor = v_color.rgb * 2.0 * mix(mix(tex1.rgb * tex2.rgb * 2.0, tex3.rgb, vec3(tex3.a)), tex1.rgb, vec3(tex1.a));\r\n    } else if ( u_pixelShader == 28 ) { \r\n        //Combiners_Mod_Masked_Dual_Crossfade\r\n        materialColor = v_color.rgb * 2.0 * mix(mix(tex1, texture2D(u_texture2, v_texCoord1), vec4(clamp(u_textureWeights.g, 0.0, 1.0))), texture2D(u_texture3, v_texCoord1), vec4(clamp(u_textureWeights.b, 0.0, 1.0))).rgb;\r\n        discardAlpha = mix(mix(tex1, texture2D(u_texture2, v_texCoord1), vec4(clamp(u_textureWeights.g, 0.0, 1.0))), texture2D(u_texture3, v_texCoord1), vec4(clamp(u_textureWeights.b, 0.0, 1.0))).a * texture2D(u_texture4, v_texCoord2).a;\r\n    } else if ( u_pixelShader == 29 ) { \r\n        //Combiners_Opaque_Alpha\r\n        materialColor = v_color.rgb * 2.0 * mix(tex1.rgb, tex2.rgb, vec3(tex2.a));\r\n    } else if ( u_pixelShader == 30 ) {\r\n         //Guild\r\n        materialColor = v_color.rgb * 2.0 * mix(tex1.rgb * mix(vec3(1), tex2.rgb, vec3(tex2.a)), tex3.rgb, vec3(tex3.a));\r\n        discardAlpha = tex1.a;\r\n    } else if ( u_pixelShader == 31 ) { \r\n        //Guild_NoBorder\r\n        materialColor = v_color.rgb * 2.0 * tex1.rgb * mix(vec3(1), tex2.rgb, vec3(tex2.a));\r\n        discardAlpha = tex1.a;\r\n    } else if ( u_pixelShader == 32 ) { \r\n        //Guild_Opaque\r\n        materialColor = v_color.rgb * 2.0 * mix(tex1.rgb * mix(vec3(1), tex2.rgb, vec3(tex2.a)), tex3.rgb, vec3(tex3.a));\r\n    } else if ( u_pixelShader == 33 ) { \r\n        //Combiners_Mod_Depth\r\n        materialColor = v_color.rgb * 2.0 * tex1.rgb;\r\n        discardAlpha = tex1.a;\r\n    } else if ( u_pixelShader == 34 ) { \r\n        //Illum\r\n        discardAlpha = tex1.a;\r\n    } else if ( u_pixelShader == 35 ) { \r\n        //Combiners_Mod_Mod_Mod_Const\r\n        materialColor = v_color.rgb * 2.0 * (tex1 * tex2 * tex3).rgb;\r\n        discardAlpha = (tex1 * tex2 * tex3).a;\r\n    }\r\n\r\n    if (u_blendMode == 13) {\r\n        outputColor.a = discardAlpha * v_color.a;\r\n    } else if (u_blendMode == 1) {\r\n        if (discardAlpha < (128.0 / 255.0))\r\n            discard;\r\n        outputColor.a = v_color.a;\r\n    } else if (u_blendMode == 0) {\r\n        outputColor.a = v_color.a;\r\n    } else {\r\n        outputColor.a = discardAlpha * v_color.a;\r\n    }\r\n\r\n    outputColor.rgb = materialColor;\r\n    if (!u_unlit) {\r\n        // Simple ambient + diffuse lighting\r\n        // color = (ambient + diffuse) * objectColor \r\n        vec4 lightColor = u_ambientColor;\r\n        float diffStrength = max(0.0, dot(v_normal, u_lightDir));\r\n        lightColor += u_lightColor * diffStrength;\r\n        lightColor = clamp(lightColor, vec4(0,0,0,0), vec4(1,1,1,1));\r\n        outputColor.rgb *= lightColor.rgb;\r\n    }\r\n    outputColor += vec4(specular, 0.0);\r\n    \r\n    gl_FragColor = outputColor;\r\n}"},3064:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseParticleGenerator=t.AnimatedParticleGeneratorProps=void 0;const a=r(1278);class n{constructor(){this.emissionSpeed=0,this.speedVariation=0,this.lifespan=0,this.emissionRate=0,this.gravity=a.Float3.zero(),this.zSource=0,this.emissionAreaX=0,this.emissionAreaY=0,this.verticalRange=0,this.horizontalRange=0}}t.AnimatedParticleGeneratorProps=n,t.BaseParticleGenerator=class{constructor(e,t){this.rng=e,this.m2Data=t,this.animatedProps=new n}getNextEmissionRate(){return this.animatedProps.emissionRate+this.rng.getSignedFloat()*this.m2Data.emissionRateVary}getMaxEmissionRate(){return this.animatedProps.emissionRate+this.m2Data.emissionRateVary}getMaxLifespan(){return this.animatedProps.lifespan+this.m2Data.lifespanVary}getLifespan(e){return this.animatedProps.lifespan+1/32767*e*this.m2Data.lifespanVary}getNextEmissionSpeed(){return this.animatedProps.emissionSpeed+this.animatedProps.speedVariation*this.rng.getSignedFloat()}getAnimatedProps(){return this.animatedProps}getGravity(e){a.Float3.copy(this.animatedProps.gravity,e)}}},3104:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SphereParticleGenerator=void 0;const a=r(3064),n=r(1278);class o extends a.BaseParticleGenerator{constructor(e,t,r){super(e,t),this.particlesGoUp=r}generateParticle(e){let t=e*this.rng.getFloat(),r=this.rng.getFloat();const a=r<1?r>-1?Math.trunc(32767*r+.5):-32767:32767;let o=this.getLifespan(a);o<.001&&(o=.001);const i=t%o,s=65535&this.rng.getInt(),l=this.animatedProps.emissionAreaY-this.animatedProps.emissionAreaX;let u=this.animatedProps.emissionAreaX+l*this.rng.getFloat(),d=this.animatedProps.verticalRange*this.rng.getFloat(),c=this.animatedProps.horizontalRange*this.rng.getFloat(),h=Math.cos(d),f=n.Float3.create(h*Math.cos(c),h*Math.sin(c),Math.sin(d));const m=n.Float3.zero();n.Float3.scale(f,u,m);let p=this.animatedProps.zSource,g=n.Float3.create(.5,.5,.5);return 0==p?this.particlesGoUp?n.Float3.set(g,0,0,1):n.Float3.set(g,h*Math.cos(c),h*Math.sin(c),Math.sin(d)):(n.Float3.set(g,0,0,p),n.Float3.subtract(m,g,g),n.Float3.length(g)>1e-4&&n.Float3.normalize(g,g)),{age:i,position:m,seed:s,state:a,velocity:n.Float3.scale(g,this.getNextEmissionSpeed()),texturePosition:[n.Float2.zero(),n.Float2.zero()],textureVelocity:[n.Float2.zero(),n.Float2.zero()]}}}t.SphereParticleGenerator=o},3269:e=>{"use strict";e.exports=(e,t,r,a)=>{let n=65535&e,o=e>>>16&65535,i=0;for(;0!==r;){i=r>2e3?2e3:r,r-=i;do{n=n+t[a++]|0,o=o+n|0}while(--i);n%=65521,o%=65521}return n|o<<16}},3303:(e,t,r)=>{"use strict";const a=r(8411),n=r(9805),o=r(1996),i=r(4674),s=r(4442),l=Object.prototype.toString,{Z_NO_FLUSH:u,Z_SYNC_FLUSH:d,Z_FULL_FLUSH:c,Z_FINISH:h,Z_OK:f,Z_STREAM_END:m,Z_DEFAULT_COMPRESSION:p,Z_DEFAULT_STRATEGY:g,Z_DEFLATED:y}=r(9681);function x(e){this.options=n.assign({level:p,method:y,chunkSize:16384,windowBits:15,memLevel:8,strategy:g},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;let r=a.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==f)throw new Error(i[r]);if(t.header&&a.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?o.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,r=a.deflateSetDictionary(this.strm,e),r!==f)throw new Error(i[r]);this._dict_set=!0}}function v(e,t){const r=new x(t);if(r.push(e,!0),r.err)throw r.msg||i[r.err];return r.result}x.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize;let i,s;if(this.ended)return!1;for(s=t===~~t?t:!0===t?h:u,"string"==typeof e?r.input=o.string2buf(e):"[object ArrayBuffer]"===l.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(s===d||s===c)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(i=a.deflate(r,s),i===m)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),i=a.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===f;if(0!==r.avail_out){if(s>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},x.prototype.onData=function(e){this.chunks.push(e)},x.prototype.onEnd=function(e){e===f&&(this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},e.exports.Deflate=x,e.exports.deflate=v,e.exports.deflateRaw=function(e,t){return(t=t||{}).raw=!0,v(e,t)},e.exports.gzip=function(e,t){return(t=t||{}).gzip=!0,v(e,t)},e.exports.constants=r(9681)},3474:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseCWMOFile=function(e){let t=new n.BinaryReader(e);if(1129794895!=t.readUInt32LE())throw new Error("Encountered wrong magic number. File data is probably not CM2 data?");const r=t.readUInt32LE();if(1e3!=r)throw new Error("Incompatible version encountered in CM2. Supported versions are: 1000. Encountered: "+r);const p=t.readUInt32LE(),g=t.readUInt32LE(),y=t.readUInt32LE(),x=t.readUInt32LE(),v=t.readUInt32LE(),_=t.readUInt32LE(),b=t.readUInt32LE(),F=t.readUInt32LE(),C=t.readUInt32LE(),w=t.readUInt32LE(),S=t.readUInt32LE(),M=t.readUInt32LE(),A=t.readUInt32LE(),E=t.readUInt32LE();let D;const T=t.readRemainingBytes();if(D=(0,a.inflate)(T),D.length<E)throw new Error("Compressed data appears to be smaller than expected? Received: "+D.length+" expected: "+E);t=new n.BinaryReader(D.buffer),t.seek(p);const k=t.readUInt32LE(),B=t.readInt16LE(),L=t.readUInt32LE(),P=t.readUInt32LE(),O=(0,o.readColor)(t),I=(0,o.readAABB)(t);t.seek(g);const U=(0,o.readArray)(t,i);t.seek(y);const W=(0,o.readArray)(t,s);t.seek(x);const R=(0,o.readArray)(t,l);t.seek(v);const z=(0,o.readArray)(t,(e=>e.readUInt32LE()));t.seek(_);const V=(0,o.readArray)(t,u);t.seek(b);const j=(0,o.readArray)(t,d);t.seek(F);const G=(0,o.readArray)(t,c);t.seek(C);const N=(0,o.readArray)(t,h);t.seek(w);const H=(0,o.readArray)(t,f);t.seek(S);const q=(0,o.readArray)(t,f);t.seek(M);const Z=(0,o.readArray)(t,o.readFloat3);t.seek(A);return{flags:B,fileDataID:k,id:L,skyboxFileId:P,ambientColor:O,boundingBox:I,ambientVolumes:q,doodadDefs:R,doodadIds:z,materials:U,fogs:V,portalRefs:G,portals:N,globalAmbientVolumes:H,portalVertices:Z,groups:(0,o.readArray)(t,m),doodadSets:j,groupInfo:W}};const a=r(1668),n=r(9266),o=r(4337);function i(e){return{flags:e.readUInt32LE(),shader:e.readUInt32LE(),blendMode:e.readUInt32LE(),texture1:e.readUInt32LE(),sidnColor:(0,o.readColor)(e),frameSidnColor:(0,o.readColor)(e),texture2:e.readUInt32LE(),diffColor:(0,o.readColor)(e),groundTypeId:e.readUInt32LE(),texture3:e.readUInt32LE(),color2:e.readUInt32LE(),flags2:e.readUInt32LE(),runTimeData:[e.readUInt32LE(),e.readUInt32LE(),e.readUInt32LE(),e.readUInt32LE()]}}function s(e){return{flags:e.readUInt32LE(),boundingBox:(0,o.readAABB)(e)}}function l(e){return{nameOffset:e.readUInt32LE(),flags:e.readUInt32LE(),position:(0,o.readFloat3)(e),rotation:(0,o.readFloat4)(e),scale:e.readFloatLE(),color:(0,o.readColor)(e)}}function u(e){return{flags:e.readUInt32LE(),position:(0,o.readFloat3)(e),smallerRadius:e.readFloatLE(),largerRadius:e.readFloatLE(),fogEnd:e.readFloatLE(),fogStartScalar:e.readFloatLE(),fogColor:(0,o.readColor)(e),uwFogEnd:e.readFloatLE(),uwFogStartScalar:e.readFloatLE(),uwFogColor:(0,o.readColor)(e)}}function d(e){return{startIndex:e.readUInt32LE(),count:e.readUInt32LE()}}function c(e){return{portalIndex:e.readUInt16LE(),groupIndex:e.readUInt16LE(),side:e.readInt16LE()}}function h(e){return{startVertex:e.readUInt16LE(),vertexCount:e.readUInt16LE(),plane:(0,o.readFloat4)(e)}}function f(e){return{position:(0,o.readFloat3)(e),start:e.readFloatLE(),end:e.readFloatLE(),color1:(0,o.readColor)(e),color2:(0,o.readColor)(e),color3:(0,o.readColor)(e),flags:e.readUInt32LE(),doodadSetId:e.readUInt16LE()}}function m(e){return{fileDataID:e.readUInt32LE(),lod:e.readInt32LE(),flags:e.readUInt32LE(),boundingBox:(0,o.readAABB)(e),portalsOffset:e.readUInt16LE(),portalCount:e.readUInt16LE(),transBatchCount:e.readUInt16LE(),intBatchCount:e.readUInt16LE(),extBatchCount:e.readUInt16LE(),unknownBatchCount:e.readUInt16LE(),fogIndices:[e.readUInt8(),e.readUInt8(),e.readUInt8(),e.readUInt8()],groupLiquid:e.readUInt32LE(),groupId:e.readUInt32LE(),flags2:e.readUInt32LE(),splitGroupindex:e.readInt16LE(),nextSplitChildIndex:e.readInt16LE(),headerReplacementColor:(0,o.readColor)(e),indices:(0,o.readArray)(e,(e=>e.readUInt16LE())),liquidData:(0,o.readArray)(e,p),bspIndices:(0,o.readArray)(e,(e=>e.readUInt16LE())),bspNodes:(0,o.readArray)(e,g),vertices:(0,o.readArray)(e,o.readFloat3),normals:(0,o.readArray)(e,o.readFloat3),uvList:(0,o.readArray)(e,o.readFloat2),vertexColors:(0,o.readArray)(e,o.readColor),batches:(0,o.readArray)(e,y),doodadReferences:(0,o.readArray)(e,(e=>e.readUInt16LE()))}}function p(e){return{liquidVertices:(0,o.readInt2)(e),liquidTiles:(0,o.readInt2)(e),position:(0,o.readFloat3)(e),materialId:e.readUInt16LE(),vertices:(0,o.readArray)(e,x),tiles:(0,o.readArray)(e,v)}}function g(e){return{flags:e.readUInt16LE(),negChild:e.readInt16LE(),posChild:e.readInt16LE(),faces:e.readUInt16LE(),faceStart:e.readUInt32LE(),planeDistance:e.readFloatLE()}}function y(e){return{materialId:e.readUInt16LE(),startIndex:e.readUInt32LE(),indexCount:e.readUInt16LE(),firstVertex:e.readUInt16LE(),lastVertex:e.readUInt16LE()}}function x(e){return{data:e.readUInt32LE(),height:e.readFloatLE()}}function v(e){return{legacyLiquidType:e.readUInt8(),fishable:e.readUInt8(),shared:e.readUInt8()}}},3656:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RotatingCamera=void 0;const a=r(1278),n=r(9174);class o extends n.Camera{constructor(){super()}initialize(e){super.initialize(e),this.time=0,this.radius=50,this.rotateSpeed=.05}update(e){this.time=(this.time+e)%(360/this.rotateSpeed);var t=Math.floor(this.time/(1/this.rotateSpeed))*Math.PI/180,r=a.Float44.identity();a.Float44.rotateX(r,90*Math.PI/180,r),a.Float44.rotateY(r,t,r),a.Float44.translate(r,a.Float3.create(0,0,this.radius),r),a.Float44.invert(r,this.viewMatrix)}resizeForBoundingBox(e){if(this.lastBoundingBox=e,!e)return;const{min:t,max:r}=e,n=a.Float3.subtract(r,t),o=a.Float3.length(n);this.radius=o}}t.RotatingCamera=o},3665:e=>{"use strict";function t(e){let t=e.length;for(;--t>=0;)e[t]=0}const r=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),a=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),n=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),o=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),i=new Array(576);t(i);const s=new Array(60);t(s);const l=new Array(512);t(l);const u=new Array(256);t(u);const d=new Array(29);t(d);const c=new Array(30);function h(e,t,r,a,n){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=a,this.max_length=n,this.has_stree=e&&e.length}let f,m,p;function g(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}t(c);const y=e=>e<256?l[e]:l[256+(e>>>7)],x=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},v=(e,t,r)=>{e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,x(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},_=(e,t,r)=>{v(e,r[2*t],r[2*t+1])},b=(e,t)=>{let r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1},F=(e,t,r)=>{const a=new Array(16);let n,o,i=0;for(n=1;n<=15;n++)i=i+r[n-1]<<1,a[n]=i;for(o=0;o<=t;o++){let t=e[2*o+1];0!==t&&(e[2*o]=b(a[t]++,t))}},C=e=>{let t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},w=e=>{e.bi_valid>8?x(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},S=(e,t,r,a)=>{const n=2*t,o=2*r;return e[n]<e[o]||e[n]===e[o]&&a[t]<=a[r]},M=(e,t,r)=>{const a=e.heap[r];let n=r<<1;for(;n<=e.heap_len&&(n<e.heap_len&&S(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!S(t,a,e.heap[n],e.depth));)e.heap[r]=e.heap[n],r=n,n<<=1;e.heap[r]=a},A=(e,t,n)=>{let o,i,s,l,h=0;if(0!==e.sym_next)do{o=255&e.pending_buf[e.sym_buf+h++],o+=(255&e.pending_buf[e.sym_buf+h++])<<8,i=e.pending_buf[e.sym_buf+h++],0===o?_(e,i,t):(s=u[i],_(e,s+256+1,t),l=r[s],0!==l&&(i-=d[s],v(e,i,l)),o--,s=y(o),_(e,s,n),l=a[s],0!==l&&(o-=c[s],v(e,o,l)))}while(h<e.sym_next);_(e,256,t)},E=(e,t)=>{const r=t.dyn_tree,a=t.stat_desc.static_tree,n=t.stat_desc.has_stree,o=t.stat_desc.elems;let i,s,l,u=-1;for(e.heap_len=0,e.heap_max=573,i=0;i<o;i++)0!==r[2*i]?(e.heap[++e.heap_len]=u=i,e.depth[i]=0):r[2*i+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=u<2?++u:0,r[2*l]=1,e.depth[l]=0,e.opt_len--,n&&(e.static_len-=a[2*l+1]);for(t.max_code=u,i=e.heap_len>>1;i>=1;i--)M(e,r,i);l=o;do{i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],M(e,r,1),s=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=s,r[2*l]=r[2*i]+r[2*s],e.depth[l]=(e.depth[i]>=e.depth[s]?e.depth[i]:e.depth[s])+1,r[2*i+1]=r[2*s+1]=l,e.heap[1]=l++,M(e,r,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const r=t.dyn_tree,a=t.max_code,n=t.stat_desc.static_tree,o=t.stat_desc.has_stree,i=t.stat_desc.extra_bits,s=t.stat_desc.extra_base,l=t.stat_desc.max_length;let u,d,c,h,f,m,p=0;for(h=0;h<=15;h++)e.bl_count[h]=0;for(r[2*e.heap[e.heap_max]+1]=0,u=e.heap_max+1;u<573;u++)d=e.heap[u],h=r[2*r[2*d+1]+1]+1,h>l&&(h=l,p++),r[2*d+1]=h,d>a||(e.bl_count[h]++,f=0,d>=s&&(f=i[d-s]),m=r[2*d],e.opt_len+=m*(h+f),o&&(e.static_len+=m*(n[2*d+1]+f)));if(0!==p){do{for(h=l-1;0===e.bl_count[h];)h--;e.bl_count[h]--,e.bl_count[h+1]+=2,e.bl_count[l]--,p-=2}while(p>0);for(h=l;0!==h;h--)for(d=e.bl_count[h];0!==d;)c=e.heap[--u],c>a||(r[2*c+1]!==h&&(e.opt_len+=(h-r[2*c+1])*r[2*c],r[2*c+1]=h),d--)}})(e,t),F(r,u,e.bl_count)},D=(e,t,r)=>{let a,n,o=-1,i=t[1],s=0,l=7,u=4;for(0===i&&(l=138,u=3),t[2*(r+1)+1]=65535,a=0;a<=r;a++)n=i,i=t[2*(a+1)+1],++s<l&&n===i||(s<u?e.bl_tree[2*n]+=s:0!==n?(n!==o&&e.bl_tree[2*n]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,o=n,0===i?(l=138,u=3):n===i?(l=6,u=3):(l=7,u=4))},T=(e,t,r)=>{let a,n,o=-1,i=t[1],s=0,l=7,u=4;for(0===i&&(l=138,u=3),a=0;a<=r;a++)if(n=i,i=t[2*(a+1)+1],!(++s<l&&n===i)){if(s<u)do{_(e,n,e.bl_tree)}while(0!=--s);else 0!==n?(n!==o&&(_(e,n,e.bl_tree),s--),_(e,16,e.bl_tree),v(e,s-3,2)):s<=10?(_(e,17,e.bl_tree),v(e,s-3,3)):(_(e,18,e.bl_tree),v(e,s-11,7));s=0,o=n,0===i?(l=138,u=3):n===i?(l=6,u=3):(l=7,u=4)}};let k=!1;const B=(e,t,r,a)=>{v(e,0+(a?1:0),3),w(e),x(e,r),x(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r};e.exports._tr_init=e=>{k||((()=>{let e,t,o,g,y;const x=new Array(16);for(o=0,g=0;g<28;g++)for(d[g]=o,e=0;e<1<<r[g];e++)u[o++]=g;for(u[o-1]=g,y=0,g=0;g<16;g++)for(c[g]=y,e=0;e<1<<a[g];e++)l[y++]=g;for(y>>=7;g<30;g++)for(c[g]=y<<7,e=0;e<1<<a[g]-7;e++)l[256+y++]=g;for(t=0;t<=15;t++)x[t]=0;for(e=0;e<=143;)i[2*e+1]=8,e++,x[8]++;for(;e<=255;)i[2*e+1]=9,e++,x[9]++;for(;e<=279;)i[2*e+1]=7,e++,x[7]++;for(;e<=287;)i[2*e+1]=8,e++,x[8]++;for(F(i,287,x),e=0;e<30;e++)s[2*e+1]=5,s[2*e]=b(e,5);f=new h(i,r,257,286,15),m=new h(s,a,0,30,15),p=new h(new Array(0),n,0,19,7)})(),k=!0),e.l_desc=new g(e.dyn_ltree,f),e.d_desc=new g(e.dyn_dtree,m),e.bl_desc=new g(e.bl_tree,p),e.bi_buf=0,e.bi_valid=0,C(e)},e.exports._tr_stored_block=B,e.exports._tr_flush_block=(e,t,r,a)=>{let n,l,u=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),E(e,e.l_desc),E(e,e.d_desc),u=(e=>{let t;for(D(e,e.dyn_ltree,e.l_desc.max_code),D(e,e.dyn_dtree,e.d_desc.max_code),E(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*o[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),n=e.opt_len+3+7>>>3,l=e.static_len+3+7>>>3,l<=n&&(n=l)):n=l=r+5,r+4<=n&&-1!==t?B(e,t,r,a):4===e.strategy||l===n?(v(e,2+(a?1:0),3),A(e,i,s)):(v(e,4+(a?1:0),3),((e,t,r,a)=>{let n;for(v(e,t-257,5),v(e,r-1,5),v(e,a-4,4),n=0;n<a;n++)v(e,e.bl_tree[2*o[n]+1],3);T(e,e.dyn_ltree,t-1),T(e,e.dyn_dtree,r-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,u+1),A(e,e.dyn_ltree,e.dyn_dtree)),C(e),a&&w(e)},e.exports._tr_tally=(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(u[r]+256+1)]++,e.dyn_dtree[2*y(t)]++),e.sym_next===e.sym_end),e.exports._tr_align=e=>{v(e,2,3),_(e,256,i),(e=>{16===e.bi_valid?(x(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}},3975:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(6677),t),n(r(6085),t)},4176:(e,t)=>{"use strict";var r,a;Object.defineProperty(t,"__esModule",{value:!0}),t.getM2PixelShaderId=t.getM2VertexShaderId=t.getM2ShaderTableEntry=void 0,function(e){e[e.Combiners_Opaque=0]="Combiners_Opaque",e[e.Combiners_Mod=1]="Combiners_Mod",e[e.Combiners_Opaque_Mod=2]="Combiners_Opaque_Mod",e[e.Combiners_Opaque_Mod2x=3]="Combiners_Opaque_Mod2x",e[e.Combiners_Opaque_Mod2xNA=4]="Combiners_Opaque_Mod2xNA",e[e.Combiners_Opaque_Opaque=5]="Combiners_Opaque_Opaque",e[e.Combiners_Mod_Mod=6]="Combiners_Mod_Mod",e[e.Combiners_Mod_Mod2x=7]="Combiners_Mod_Mod2x",e[e.Combiners_Mod_Add=8]="Combiners_Mod_Add",e[e.Combiners_Mod_Mod2xNA=9]="Combiners_Mod_Mod2xNA",e[e.Combiners_Mod_AddNA=10]="Combiners_Mod_AddNA",e[e.Combiners_Mod_Opaque=11]="Combiners_Mod_Opaque",e[e.Combiners_Opaque_Mod2xNA_Alpha=12]="Combiners_Opaque_Mod2xNA_Alpha",e[e.Combiners_Opaque_AddAlpha=13]="Combiners_Opaque_AddAlpha",e[e.Combiners_Opaque_AddAlpha_Alpha=14]="Combiners_Opaque_AddAlpha_Alpha",e[e.Combiners_Opaque_Mod2xNA_Alpha_Add=15]="Combiners_Opaque_Mod2xNA_Alpha_Add",e[e.Combiners_Mod_AddAlpha=16]="Combiners_Mod_AddAlpha",e[e.Combiners_Mod_AddAlpha_Alpha=17]="Combiners_Mod_AddAlpha_Alpha",e[e.Combiners_Opaque_Alpha_Alpha=18]="Combiners_Opaque_Alpha_Alpha",e[e.Combiners_Opaque_Mod2xNA_Alpha_3s=19]="Combiners_Opaque_Mod2xNA_Alpha_3s",e[e.Combiners_Opaque_AddAlpha_Wgt=20]="Combiners_Opaque_AddAlpha_Wgt",e[e.Combiners_Mod_Add_Alpha=21]="Combiners_Mod_Add_Alpha",e[e.Combiners_Opaque_ModNA_Alpha=22]="Combiners_Opaque_ModNA_Alpha",e[e.Combiners_Mod_AddAlpha_Wgt=23]="Combiners_Mod_AddAlpha_Wgt",e[e.Combiners_Opaque_Mod_Add_Wgt=24]="Combiners_Opaque_Mod_Add_Wgt",e[e.Combiners_Opaque_Mod2xNA_Alpha_UnshAlpha=25]="Combiners_Opaque_Mod2xNA_Alpha_UnshAlpha",e[e.Combiners_Mod_Dual_Crossfade=26]="Combiners_Mod_Dual_Crossfade",e[e.Combiners_Opaque_Mod2xNA_Alpha_Alpha=27]="Combiners_Opaque_Mod2xNA_Alpha_Alpha",e[e.Combiners_Mod_Masked_Dual_Crossfade=28]="Combiners_Mod_Masked_Dual_Crossfade",e[e.Combiners_Opaque_Alpha=29]="Combiners_Opaque_Alpha",e[e.Guild=30]="Guild",e[e.Guild_NoBorder=31]="Guild_NoBorder",e[e.Guild_Opaque=32]="Guild_Opaque",e[e.Combiners_Mod_Depth=33]="Combiners_Mod_Depth",e[e.Illum=34]="Illum",e[e.Combiners_Mod_Mod_Mod_Const=35]="Combiners_Mod_Mod_Mod_Const",e[e.NewUnkCombiner=36]="NewUnkCombiner"}(r||(r={})),function(e){e[e.Diffuse_T1=0]="Diffuse_T1",e[e.Diffuse_Env=1]="Diffuse_Env",e[e.Diffuse_T1_T2=2]="Diffuse_T1_T2",e[e.Diffuse_T1_Env=3]="Diffuse_T1_Env",e[e.Diffuse_Env_T1=4]="Diffuse_Env_T1",e[e.Diffuse_Env_Env=5]="Diffuse_Env_Env",e[e.Diffuse_T1_Env_T1=6]="Diffuse_T1_Env_T1",e[e.Diffuse_T1_T1=7]="Diffuse_T1_T1",e[e.Diffuse_T1_T1_T1=8]="Diffuse_T1_T1_T1",e[e.Diffuse_EdgeFade_T1=9]="Diffuse_EdgeFade_T1",e[e.Diffuse_T2=10]="Diffuse_T2",e[e.Diffuse_T1_Env_T2=11]="Diffuse_T1_Env_T2",e[e.Diffuse_EdgeFade_T1_T2=12]="Diffuse_EdgeFade_T1_T2",e[e.Diffuse_EdgeFade_Env=13]="Diffuse_EdgeFade_Env",e[e.Diffuse_T1_T2_T1=14]="Diffuse_T1_T2_T1",e[e.Diffuse_T1_T2_T3=15]="Diffuse_T1_T2_T3",e[e.Color_T1_T2_T3=16]="Color_T1_T2_T3",e[e.BW_Diffuse_T1=17]="BW_Diffuse_T1",e[e.BW_Diffuse_T1_T2=18]="BW_Diffuse_T1_T2"}(a||(a={}));const n=[[r.Combiners_Opaque_Mod2xNA_Alpha,a.Diffuse_T1_Env],[r.Combiners_Opaque_AddAlpha,a.Diffuse_T1_Env],[r.Combiners_Opaque_AddAlpha_Alpha,a.Diffuse_T1_Env],[r.Combiners_Opaque_Mod2xNA_Alpha_Add,a.Diffuse_T1_Env_T1],[r.Combiners_Mod_AddAlpha,a.Diffuse_T1_Env],[r.Combiners_Opaque_AddAlpha,a.Diffuse_T1_T1],[r.Combiners_Mod_AddAlpha,a.Diffuse_T1_T1],[r.Combiners_Mod_AddAlpha_Alpha,a.Diffuse_T1_Env],[r.Combiners_Opaque_Alpha_Alpha,a.Diffuse_T1_Env],[r.Combiners_Opaque_Mod2xNA_Alpha_3s,a.Diffuse_T1_Env_T1],[r.Combiners_Opaque_AddAlpha_Wgt,a.Diffuse_T1_T1],[r.Combiners_Mod_Add_Alpha,a.Diffuse_T1_Env],[r.Combiners_Opaque_ModNA_Alpha,a.Diffuse_T1_Env],[r.Combiners_Mod_AddAlpha_Wgt,a.Diffuse_T1_Env],[r.Combiners_Mod_AddAlpha_Wgt,a.Diffuse_T1_T1],[r.Combiners_Opaque_AddAlpha_Wgt,a.Diffuse_T1_T2],[r.Combiners_Opaque_Mod_Add_Wgt,a.Diffuse_T1_Env],[r.Combiners_Opaque_Mod2xNA_Alpha_UnshAlpha,a.Diffuse_T1_Env_T1],[r.Combiners_Mod_Dual_Crossfade,a.Diffuse_T1],[r.Combiners_Mod_Depth,a.Diffuse_EdgeFade_T1],[r.Combiners_Opaque_Mod2xNA_Alpha_Alpha,a.Diffuse_T1_Env_T2],[r.Combiners_Mod_Mod,a.Diffuse_EdgeFade_T1_T2],[r.Combiners_Mod_Masked_Dual_Crossfade,a.Diffuse_T1_T2],[r.Combiners_Opaque_Alpha,a.Diffuse_T1_T1],[r.Combiners_Opaque_Mod2xNA_Alpha_UnshAlpha,a.Diffuse_T1_Env_T2],[r.Combiners_Mod_Depth,a.Diffuse_EdgeFade_Env],[r.Guild,a.Diffuse_T1_T2_T1],[r.Guild_NoBorder,a.Diffuse_T1_T2],[r.Guild_Opaque,a.Diffuse_T1_T2_T1],[r.Illum,a.Diffuse_T1_T1],[r.Combiners_Mod_Mod_Mod_Const,a.Diffuse_T1_T2_T3],[r.Combiners_Mod_Mod_Mod_Const,a.Color_T1_T2_T3],[r.Combiners_Opaque,a.Diffuse_T1],[r.Combiners_Mod_Mod2x,a.Diffuse_EdgeFade_T1_T2],[r.Combiners_Mod,a.Diffuse_EdgeFade_T1],[r.NewUnkCombiner,a.Diffuse_EdgeFade_T1_T2]];t.getM2ShaderTableEntry=e=>{const t=32767&e;if(t>=n.length)throw"Wrong shaderId for vertex shader";return n[t]},t.getM2VertexShaderId=(e,r)=>(32768&e&&(0,t.getM2ShaderTableEntry)(e)[1],1==r?128&e?a.Diffuse_Env:16384&e?a.Diffuse_T2:a.Diffuse_T1:128&e?8&e?a.Diffuse_Env_Env:a.Diffuse_Env_T1:8&e?a.Diffuse_T1_Env:16384&e?a.Diffuse_T1_T2:a.Diffuse_T1_T1),t.getM2PixelShaderId=(e,a)=>{if(32768&e)return(0,t.getM2ShaderTableEntry)(e)[0];if(1===a)return 112&e?r.Combiners_Mod:r.Combiners_Opaque;if(112&e)switch(7&e){case 0:return r.Combiners_Mod_Opaque;case 3:return r.Combiners_Mod_Add;case 4:return r.Combiners_Mod_Mod2x;case 6:return r.Combiners_Mod_Mod2xNA;case 7:return r.Combiners_Mod_AddNA;default:return r.Combiners_Mod_Mod}else switch(7&e){case 0:return r.Combiners_Opaque_Opaque;case 3:case 7:return r.Combiners_Opaque_AddAlpha;case 4:return r.Combiners_Opaque_Mod2x;case 6:return r.Combiners_Opaque_Mod2xNA;default:return r.Combiners_Opaque_Mod}}},4337:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readInt2=function(e){return[e.readInt32LE(),e.readInt32LE()]},t.readFloat2=function(e){return a.Float2.create(e.readFloatLE(),e.readFloatLE())},t.readFloat3=n,t.readFloat4=function(e){return a.Float4.create(e.readFloatLE(),e.readFloatLE(),e.readFloatLE(),e.readFloatLE())},t.readQuaternion=function(e){return a.Float4.create(-e.readFloatLE(),-e.readFloatLE(),-e.readFloatLE(),e.readFloatLE())},t.readColor=function(e){return[e.readUInt8(),e.readUInt8(),e.readUInt8(),e.readUInt8()]},t.readFloat44=function(e){return a.Float44.create(e.readFloatLE(),e.readFloatLE(),e.readFloatLE(),e.readFloatLE(),e.readFloatLE(),e.readFloatLE(),e.readFloatLE(),e.readFloatLE(),e.readFloatLE(),e.readFloatLE(),e.readFloatLE(),e.readFloatLE(),e.readFloatLE(),e.readFloatLE(),e.readFloatLE(),e.readFloatLE())},t.readAABB=function(e){return a.AABB.create(n(e),n(e))},t.readArray=function(e,t){const r=e.readInt32LE();if(r>0){const a=new Array(r);for(let n=0;n<r;n++)a[n]=t(e,n);return a}return[]};const a=r(8219);function n(e){return a.Float3.create(e.readFloatLE(),e.readFloatLE(),e.readFloatLE())}},4442:e=>{"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},4510:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},4521:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OrbitalCamera=t.DragOperation=void 0;const a=r(9174),n=r(1278);var o;!function(e){e[e.None=0]="None",e[e.Rotation=1]="Rotation",e[e.Translation=2]="Translation"}(o||(t.DragOperation=o={}));class i extends a.Camera{constructor(){super(),this.cameraMatrix=n.Float44.identity(),this.currentDragOperation=o.None,this.targetLocation=n.Float3.create(0,0,0),this.upDir=n.Float3.create(0,0,1),this.cameraTranslation=n.Float3.zero(),this.theta=Math.PI/2,this.phi=1.5*Math.PI,this.startingRadius=500,this.currentRadius=this.startingRadius,this.minRadius=200,this.maxRadius=1e3,this.zoomFactor=20,this.currentZoom=0,this.zoomDecay=.7,this.position=n.Float3.fromSpherical(this.startingRadius,this.theta,this.phi),n.Float3.add(this.position,this.targetLocation),n.Float44.lookAt(this.position,this.targetLocation,this.upDir,this.cameraMatrix)}initialize(e){if(super.initialize(e),e.containerElement){this.onContextMenu=e=>(e.preventDefault(),!1),this.onMouseDown=this.handleMouseDown.bind(this),this.onTouchStart=this.handleTouchStart.bind(this),this.onWheel=this.handleWheel.bind(this),e.containerElement.addEventListener("contextmenu",this.onContextMenu),e.containerElement.addEventListener("mousedown",this.onMouseDown),e.containerElement.addEventListener("touchstart",this.onTouchStart),e.containerElement.addEventListener("wheel",this.onWheel);const t=e.containerElement.getBoundingClientRect();this.containerWidth=t.width,this.containerHeight=t.height}document&&(this.onMouseUp=this.handleDragRelease.bind(this),this.onTouchEnd=this.handleDragRelease.bind(this),this.onMouseMove=this.handleMouseMove.bind(this),this.onTouchMove=this.handleTouchMove.bind(this),document.addEventListener("mouseup",this.onMouseUp),document.addEventListener("touchend",this.onTouchEnd),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("touchmove",this.onTouchMove))}update(e){0!=this.currentZoom&&(this.currentRadius=this.currentRadius+this.currentZoom*this.zoomFactor,this.currentRadius=Math.min(Math.max(this.minRadius,this.currentRadius),this.maxRadius),this.currentZoom*=this.zoomDecay,this.currentZoom<1e-4&&(this.currentZoom=0),n.Float3.fromSpherical(this.currentRadius,this.theta,this.phi,this.position)),n.Float44.lookAt(this.position,this.targetLocation,this.upDir,this.cameraMatrix),n.Float44.translate(this.cameraMatrix,this.cameraTranslation,this.cameraMatrix),n.Float44.invert(this.cameraMatrix,this.viewMatrix)}dispose(){this.engine.containerElement&&(this.engine.containerElement.removeEventListener("contextmenu",this.onContextMenu),this.engine.containerElement.removeEventListener("mousedown",this.onMouseDown),this.engine.containerElement.removeEventListener("touchstart",this.onTouchStart),this.engine.containerElement.removeEventListener("wheel",this.onWheel),this.onContextMenu=null,this.onMouseDown=null,this.onTouchStart=null,this.onWheel=null),document&&(document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("touchend",this.onTouchEnd),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("touchmove",this.onTouchMove),this.onMouseUp=null,this.onTouchEnd=null,this.onMouseMove=null,this.onTouchMove=null),super.dispose(),this.cameraMatrix=null,this.targetLocation=null,this.upDir=null,this.cameraTranslation=null}handleMouseDown(e){2==e.button||e.ctrlKey?this.currentDragOperation=o.Translation:this.currentDragOperation=o.Rotation,this.lastDragX=e.clientX,this.lastDragY=e.clientY,e.preventDefault()}handleTouchStart(e){this.currentDragOperation=o.Rotation,this.lastDragX=e.touches[0].clientX,this.lastDragY=e.touches[0].clientY,e.preventDefault()}handleMouseMove(e){this.handleDrag(e.x,e.y)}handleTouchMove(e){this.handleDrag(e.touches[0].clientX,e.touches[0].clientY)}handleDrag(e,t){if(this.currentDragOperation===o.None)return;const r=(e-this.lastDragX)/this.containerWidth,a=(t-this.lastDragY)/this.containerHeight;if(this.currentDragOperation===o.Translation){const e=n.Float3.create(-r*this.currentRadius,a*this.currentRadius,0);n.Float3.add(this.cameraTranslation,e,this.cameraTranslation)}else{const e=Math.PI,t=r*e,o=a*e;this.theta=Math.min(Math.max(this.theta-o-o,.01),Math.PI),this.phi-=t,n.Float3.fromSpherical(this.currentRadius,this.theta,this.phi,this.position)}this.lastDragX=e,this.lastDragY=t}handleDragRelease(){this.currentDragOperation=o.None}handleWheel(e){this.currentZoom=e.deltaY<0?-1:1,e.preventDefault()}resizeForBoundingBox(e){if(this.lastBoundingBox=e,!e)return;const{min:t,max:r}=e,a=n.Float3.subtract(r,t),o=n.Float3.length(a);this.startingRadius=o,this.currentRadius=this.startingRadius,this.minRadius=.25*o,this.maxRadius=2*o,this.zoomFactor=this.maxRadius/50,n.Float3.zero(this.cameraTranslation),n.Float3.fromSpherical(this.currentRadius,this.theta,this.phi,this.position)}}t.OrbitalCamera=i},4674:e=>{"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},4741:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnimationState=void 0;const a=r(2462),n=r(8156),o=(e,t,r)=>e+r*(t-e),i=e=>e;t.AnimationState=class{constructor(e){this.animations=e.modelData.animations,this.currentAnimActiveTime=0,this.nextAnimActiveTime=0,this.blendFactor=1,this.globalLoops=e.modelData.globalLoops,this.globalTimers=new Array(this.globalLoops.length);for(let e=0;e<this.globalTimers.length;e++)this.globalTimers[e]=0;this.model=e,this.speed=1}useAnimation(e){this.currentAnimActiveTime=0,this.currentAnimation=this.animations.find((t=>t.id===e&&0===t.variationIndex)),this.currentAnimation||(this.currentAnimation=this.animations.find((e=>0===e.id&&0===e.variationIndex))),this.blendFactor=0,this.getNextVariation()}update(e){this.isPaused||(this.currentAnimActiveTime+=e*this.speed);for(let t=0;t<this.globalTimers.length;t++)this.globalTimers[t]+=e,this.globalLoops[t]>0&&(this.globalTimers[t]%=this.globalLoops[t]);let t=this.currentAnimation.duration-this.currentAnimActiveTime;if(this.nextAnimation){const e=this.nextAnimation.blendTimeIn;e>0&&t<e?(this.nextAnimActiveTime=(e-t)%this.nextAnimation.duration,this.blendFactor=t/e):this.blendFactor=1}t<=0&&(this.nextAnimation?(this.currentAnimation=this.nextAnimation,this.currentAnimActiveTime=this.nextAnimActiveTime,this.getNextVariation()):this.currentAnimActiveTime%=this.currentAnimation.duration)}getNextVariation(){if(this.nextAnimation=this.currentAnimation,this.nextAnimActiveTime=0,this.currentAnimation.variationNext>-1){let e=32767*Math.random(),t=0;for(t+=this.animations[this.currentAnimation.variationNext].frequency;t<e&&this.nextAnimation.variationNext>-1;)this.nextAnimation=this.animations[this.currentAnimation.variationNext],t+=this.nextAnimation.frequency}else{const e=this.animations.find((e=>e.id==this.currentAnimation.id&&0===e.variationIndex));e&&(this.nextAnimation=e)}for(;!(a.WoWAnimationFlags.PrimaryBoneSequence&this.nextAnimation.flags)&&(a.WoWAnimationFlags.IsAlias&this.nextAnimation.flags)>0;)this.nextAnimation=this.animations[this.nextAnimation.aliasNext]}hasAnimatedValuesForTrack(e){if(!e||!e.animations.length)return!1;let t=this.currentAnimation.id;this.currentAnimation.id>e.animations.length&&(t=0);const r=e.animations[t];return r&&r.timeStamps.length>0}getFloat3TrackValue(e,t,r){return this.getTrackValueInt(n.Float3.lerp,n.Float3.copy,e,t,r)}getFloat4TrackValue(e,t,r){return this.getTrackValueInt(n.Float4.lerp,n.Float4.copy,e,t,r)}getNumberTrackValue(e,t){return this.getTrackValueInt(o,i,e,t,0)}getTrackValueInt(e,t,r,a,n){if(!r||0===r.animations.length)return a;let o=this.currentAnimation.aliasNext;o>=r.animations.length&&(o=0);let i=this.calculateAnimatedValue(e,t,r,o,this.currentAnimActiveTime,a,n);if(this.blendFactor<=0||this.blendFactor>=1)return i;let s=this.nextAnimation.aliasNext;return s>=r.animations.length&&(s=0),e(this.calculateAnimatedValue(e,t,r,s,this.nextAnimActiveTime,a,n),i,this.blendFactor,n)}calculateAnimatedValue(e,t,r,a,n,o,i){const s=r.animations[a];if(0===s.values.length)return o;if(1===s.values.length)return t(s.values[0],i);if(s.values.length>1){r.globalSequence>=0&&(n=r.globalSequence<this.globalTimers.length?this.globalTimers[r.globalSequence]:this.globalTimers[0]);const a=s.timeStamps[s.timeStamps.length-1];a>0&&n>=a&&(r.globalSequence<0?n%=a:n=a);let o=s.timeStamps.findIndex((e=>e>n));o<0&&(o=s.timeStamps.length-1);const l=o-1;if(1!==r.interpolationType)return t(s.values[l],i);const u=s.timeStamps[l],d=s.timeStamps[o];let c=0;return u!==d&&(c=(n-u)/(d-u)),e(s.values[l],s.values[o],c,i)}}}},4823:e=>{"use strict";const t=new Uint32Array((()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var a=0;a<8;a++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t})());e.exports=(e,r,a,n)=>{const o=t,i=n+a;e^=-1;for(let t=n;t<i;t++)e=e>>>8^o[255&(e^r[t])];return~e}},4849:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseProgressReporter=void 0,t.BaseProgressReporter=class{constructor(e){this.resetState(),this.isDisposing=!1,this.container=e,this.finishLoadingAfterMs=100}dispose(){this.isDisposing=!0,this.progressPerFile=null}calcTotalProgress(){let e=0;for(const t in this.progressPerFile)e+=this.progressPerFile[t];return e/=this.totalFiles,e}update(e,t){this.progressPerFile[e]=t}onUpdateCount(){}addFileToOperation(e){this.totalFiles++,this.onUpdateCount(),this.progressPerFile[e]=0,this.startDrawing()}removeFileFromOperation(e){void 0!==this.progressPerFile[e]&&(delete this.progressPerFile[e],this.filesProcessed++),this.onUpdateCount(),0===Object.keys(this.progressPerFile).length&&setTimeout(this.checkFinish.bind(this),this.finishLoadingAfterMs)}checkFinish(){0===Object.keys(this.progressPerFile).length&&this.finishOperation()}setOperation(e){""===this.currentOperation&&(this.currentOperation=e)}finishOperation(){this.resetState(),this.hideElements()}startDrawing(){this.show||(this.show=!0,this.showElements())}resetState(){this.show=!1,this.currentOperation="",this.progressPerFile={},this.filesProcessed=0,this.totalFiles=0}}},5053:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleCache=void 0,t.SimpleCache=class{constructor(e=3e5){this.items={},this.maxTtl=e}dispose(){this.isDisposing=!0,this.items=null}update(e){const t=this.getKeys();for(const r of t){const t=this.items[r];-1!=t.ttl&&(t.ttl-=e,t.ttl<0&&delete this.items[r])}}contains(e){return!this.isDisposing&&!!this.items[e]}get(e){if(this.isDisposing)return null;const t=this.items[e];return t?(t.ttl=this.maxTtl,t.value):null}store(e,t,r=this.maxTtl){this.items[e]={ttl:r,value:t}}getKeys(){return this.isDisposing?null:Object.keys(this.items)}getValues(){return this.isDisposing?null:this.getKeys().map((e=>this.items[e].value))}}},5416:(e,t)=>{"use strict";var r,a,n,o,i,s,l;Object.defineProperty(t,"__esModule",{value:!0}),t.WowWorldModelBspNodeFlags=t.WMOShader=t.WoWWorldModelMaterialMaterialFlags=t.WMODoodadFlags=t.WowWorldModelGroupFlags2=t.WowWorldModelGroupFlags=t.WorldModelRootFlags=void 0,function(e){e[e.DoNoAttenuateVerticesBasedOnDistanceToPortal=1]="DoNoAttenuateVerticesBasedOnDistanceToPortal",e[e.UseUnifiedRenderPath=2]="UseUnifiedRenderPath",e[e.UseLiquidTypeDbcId=4]="UseLiquidTypeDbcId",e[e.DoNotFixVertexColorAlpha=8]="DoNotFixVertexColorAlpha",e[e.Lod=16]="Lod",e[e.DefaultMaxLod=32]="DefaultMaxLod",e[e.Unknown_0x40=64]="Unknown_0x40",e[e.Unknown_0x80=128]="Unknown_0x80",e[e.Unknown_0x100=256]="Unknown_0x100",e[e.Unknown_0x200=512]="Unknown_0x200",e[e.Unknown_0x400=1024]="Unknown_0x400",e[e.Unknown_0x800=2048]="Unknown_0x800"}(r||(t.WorldModelRootFlags=r={})),function(e){e[e.BspTree=1]="BspTree",e[e.LightMap=2]="LightMap",e[e.VertexColors=4]="VertexColors",e[e.Exterior=8]="Exterior",e[e.Unknown_0x10=16]="Unknown_0x10",e[e.Unknown_0x20=32]="Unknown_0x20",e[e.ExteriorLit=64]="ExteriorLit",e[e.Unreachable=128]="Unreachable",e[e.ShowExteriorSky=256]="ShowExteriorSky",e[e.HasLights=512]="HasLights",e[e.Lod=1024]="Lod",e[e.HasDoodads=2048]="HasDoodads",e[e.HasWater=4096]="HasWater",e[e.Interior=8192]="Interior",e[e.Unknown_0x4000=16384]="Unknown_0x4000",e[e.Unknown_0x8000=32768]="Unknown_0x8000",e[e.AlwaysDraw=65536]="AlwaysDraw",e[e.Unknown_0x20000=131072]="Unknown_0x20000",e[e.ShowSkybox=262144]="ShowSkybox",e[e.IsOceanWater=524288]="IsOceanWater",e[e.Unknown_0x100000=1048576]="Unknown_0x100000",e[e.IsMountAllowed=2097152]="IsMountAllowed",e[e.Unknown_0x400000=4194304]="Unknown_0x400000",e[e.Unknown_0x800000=8388608]="Unknown_0x800000",e[e.Has2VertexColors=16777216]="Has2VertexColors",e[e.Has2UVs=33554432]="Has2UVs",e[e.AntiPortal=67108864]="AntiPortal",e[e.Unknown_0x8000000=134217728]="Unknown_0x8000000",e[e.Unknown_0x10000000=268435456]="Unknown_0x10000000",e[e.Unknown_0x20000000=536870912]="Unknown_0x20000000",e[e.Has3UVs=1073741824]="Has3UVs",e[e.Unknown_0x80000000=2147483648]="Unknown_0x80000000"}(a||(t.WowWorldModelGroupFlags=a={})),function(e){e[e.CanCutTerrain=1]="CanCutTerrain",e[e.Unknown_0x2=2]="Unknown_0x2",e[e.Unknown_0x4=4]="Unknown_0x4",e[e.Unknown_0x8=8]="Unknown_0x8",e[e.Unknown_0x10=16]="Unknown_0x10",e[e.Unknown_0x20=32]="Unknown_0x20",e[e.IsSplitGroupParent=64]="IsSplitGroupParent",e[e.IsSplitGroupChild=128]="IsSplitGroupChild",e[e.AttachmentMesh=256]="AttachmentMesh"}(n||(t.WowWorldModelGroupFlags2=n={})),function(e){e[e.AcceptProjTexture=1]="AcceptProjTexture",e[e.UseInteriorLighting=2]="UseInteriorLighting",e[e.Unknown_0x4=4]="Unknown_0x4",e[e.Unknown_0x8=8]="Unknown_0x8",e[e.Unknown_0x10=16]="Unknown_0x10",e[e.Unknown_0x20=32]="Unknown_0x20",e[e.Unknown_0x40=64]="Unknown_0x40",e[e.Unknown_0x80=128]="Unknown_0x80"}(o||(t.WMODoodadFlags=o={})),function(e){e[e.Unlit=1]="Unlit",e[e.Unfogged=2]="Unfogged",e[e.Unculled=4]="Unculled",e[e.Extlight=8]="Extlight",e[e.Sidn=16]="Sidn",e[e.Window=32]="Window",e[e.ClampS=64]="ClampS",e[e.ClampT=128]="ClampT",e[e.Unknown_0x100=256]="Unknown_0x100",e[e.Unknown_0x200=512]="Unknown_0x200",e[e.Unknown_0x400=1024]="Unknown_0x400",e[e.Unknown_0x800=2048]="Unknown_0x800",e[e.Unknown_0x1000=4096]="Unknown_0x1000",e[e.Unknown_0x2000=8192]="Unknown_0x2000",e[e.Unknown_0x4000=16384]="Unknown_0x4000",e[e.Unknown_0x8000=32768]="Unknown_0x8000",e[e.Unknown_0x10000=65536]="Unknown_0x10000",e[e.Unknown_0x20000=131072]="Unknown_0x20000",e[e.Unknown_0x40000=262144]="Unknown_0x40000",e[e.Unknown_0x80000=524288]="Unknown_0x80000",e[e.Unknown_0x100000=1048576]="Unknown_0x100000",e[e.Unknown_0x200000=2097152]="Unknown_0x200000",e[e.Unknown_0x400000=4194304]="Unknown_0x400000",e[e.Unknown_0x800000=8388608]="Unknown_0x800000"}(i||(t.WoWWorldModelMaterialMaterialFlags=i={})),function(e){e[e.Diffuse=0]="Diffuse",e[e.Specular=1]="Specular",e[e.Metal=2]="Metal",e[e.Env=3]="Env",e[e.Opaque=4]="Opaque",e[e.EnvMetal=5]="EnvMetal",e[e.TwoLayerDiffuse=6]="TwoLayerDiffuse",e[e.TwoLayerEnvMetal=7]="TwoLayerEnvMetal",e[e.TwoLayerTerrain=8]="TwoLayerTerrain",e[e.DiffuseEmissive=9]="DiffuseEmissive",e[e.WaterWindow=10]="WaterWindow",e[e.MaskedEnvMetal=11]="MaskedEnvMetal",e[e.EnvMetalEmissive=12]="EnvMetalEmissive",e[e.TwoLayerDiffuseOpaque=13]="TwoLayerDiffuseOpaque",e[e.SubmarineWindow=14]="SubmarineWindow",e[e.TwoLayerDiffuseEmissive=15]="TwoLayerDiffuseEmissive",e[e.DiffuseTerrain=16]="DiffuseTerrain",e[e.AdditiveMaskedEnvMetal=17]="AdditiveMaskedEnvMetal",e[e.TwoLayerDiffuseMod2x=18]="TwoLayerDiffuseMod2x",e[e.TwoLayerDiffuseMod2xNA=19]="TwoLayerDiffuseMod2xNA",e[e.TwoLayerDiffuseAlpha=20]="TwoLayerDiffuseAlpha",e[e.Lod=21]="Lod",e[e.Parallax=22]="Parallax",e[e.Unknown_DF_Shader=23]="Unknown_DF_Shader"}(s||(t.WMOShader=s={})),function(e){e[e.XAxis=0]="XAxis",e[e.YAxis=1]="YAxis",e[e.ZAxis=2]="ZAxis",e[e.AxisMask=3]="AxisMask",e[e.Leaf=4]="Leaf",e[e.NoChild=65535]="NoChild"}(l||(t.WowWorldModelBspNodeFlags=l={}))},5510:function(e,t,r){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WMOLiquid=void 0;const n=r(8156),o=r(9266),i=r(8521),s=a(r(2315)),l=a(r(1178)),u=1600/3/16/8;var d,c;!function(e){e[e.None=0]="None",e[e.River=1]="River",e[e.Ocean=2]="Ocean",e[e.Wmo=3]="Wmo"}(d||(d={})),function(e){e[e.Water=0]="Water",e[e.Ocean=1]="Ocean",e[e.Lava=2]="Lava",e[e.Slime=3]="Slime"}(c||(c={}));class h extends i.WorldPositionedObject{constructor(e,t,r){super(),this.vertices=[],this.indices=[],this.fileId=-1,this.data=e,this.groupData=t,this.wmoFlags=r,this.metadataLoaded=!1,this.texturesLoaded=!1}initialize(e){super.initialize(e),this.shaderProgram=e.getShaderProgram("WMOLiquid",l.default,s.default);const t=[],[r,a]=this.data.liquidTiles,i=this.groupData.flags&n.WowWorldModelGroupFlags.Exterior?1e3:0;for(let e=0;e<a+1;e++)for(let a=0;a<r+1;a++){const o=this.data.vertices[e*(r+1)+a],s=this.data.position[0]+u*a,l=this.data.position[1]+u*e,d=o.height;t.push({position:n.Float3.create(s,l,d),x:a,y:e,depth:i})}this.boundingBox=n.AABB.fromVertices(t.map((e=>e.position)));let d=0,c=-1;this.vertices=[],this.indices=[];for(let e=0;e<a;e++)for(let a=0;a<r&&!(d>=65532);a++){const n=e*r+a,o=this.data.tiles[n];if(8&o.legacyLiquidType)continue;const i=e*(r+1)+a,s=[i,i+1,i+r+2,i+r+1];for(const e of s)e>t.length||this.vertices.push(t[e]);this.indices.push(d),this.indices.push(d+1),this.indices.push(d+2),this.indices.push(d+2),this.indices.push(d+3),this.indices.push(d),d+=4,c<0&&(c=o.legacyLiquidType)}const h=this.engine.graphics.createVertexDataBuffer([{index:this.shaderProgram.getAttribLocation("a_position"),size:3,type:n.BufferDataType.Float,normalized:!1,stride:24,offset:0},{index:this.shaderProgram.getAttribLocation("a_texCoord"),size:2,type:n.BufferDataType.Float,normalized:!1,stride:24,offset:12},{index:this.shaderProgram.getAttribLocation("a_depth"),size:1,type:n.BufferDataType.Float,normalized:!1,stride:24,offset:20}],!0),f=new Uint8Array(24*this.vertices.length),m=new o.BinaryWriter(f.buffer);for(let e=0;e<this.vertices.length;e++)m.writeFloatLE(this.vertices[e].position[0]),m.writeFloatLE(this.vertices[e].position[1]),m.writeFloatLE(this.vertices[e].position[2]),m.writeFloatLE(this.vertices[e].x),m.writeFloatLE(this.vertices[e].y),m.writeFloatLE(this.vertices[e].depth);h.setData(f);const p=this.engine.graphics.createVertexIndexBuffer(!0);p.setData(new Uint16Array(this.indices)),this.vao=this.engine.graphics.createVertexArrayObject(),this.vao.addVertexDataBuffer(h),this.vao.setIndexBuffer(p),this.liquidType=this.getLiquidType(c),this.engine.getLiquidTypeMetadata(this.liquidType).then(this.onMetadataLoaded.bind(this))}draw(){if(!this.isLoaded||this.isDisposing)return;const e=Math.floor(this.engine.timeElapsed/100%this.animatingTextureCount),t=this.materials[e],r=new n.RenderingBatchRequest(t);r.useVertexArrayObject(this.vao),r.drawIndexedTriangles(0,this.indices.length),this.engine.submitBatchRequest(r)}dispose(){super.dispose(),this.materials=null}get isLoaded(){return this.metadataLoaded&&this.texturesLoaded}onMetadataLoaded(e){if(null==e)return void this.dispose();this.liquidTypeMetadata=e,this.liquidTypeMetadata.name.includes("Slime")?this.liquidCategory=c.Slime:this.liquidTypeMetadata.name.includes("Magma")||this.liquidTypeMetadata.name.includes("Lava")?this.liquidCategory=c.Lava:this.liquidTypeMetadata.name.includes("Ocean")?this.liquidCategory=c.Ocean:this.liquidCategory=c.Water;const t=[];this.textures=new Array(e.textures.length);for(let r=0;r<this.textures.length;r++){const a=e.textures[r].fileDataId;if(a>0){const e=this.engine.getTexture(a).then((e=>{this.textures[r]=e}));t.push(e)}}this.animatingTextureCount=this.liquidTypeMetadata.namedTextures[0]?e.textures.length:0;const r=this.liquidTypeMetadata.namedTextures[1];r&&r.startsWith("procedural")?(r.includes("River")?this.proceduralTextureType=d.River:r.includes("Ocean")?this.proceduralTextureType=d.Ocean:r.includes("Wmo")&&(this.proceduralTextureType=d.Wmo),this.animatingTextureCount--):(this.proceduralTextureType=d.None,r&&this.animatingTextureCount--);for(let t=2;t<e.namedTextures.length;t++)e.namedTextures[t]&&this.animatingTextureCount--;this.animatingTextureCount=Math.max(0,this.animatingTextureCount),Promise.all(t).then((()=>{this.setupMaterials(),this.texturesLoaded=!0})),this.metadataLoaded=!0}getLiquidType(e){let t;if(this.wmoFlags&n.WorldModelRootFlags.UseLiquidTypeDbcId){if(!(this.groupData.groupLiquid<21))return this.groupData.groupLiquid;t=this.groupData.groupLiquid-1}else if(15===this.groupData.groupLiquid)t=e;else{if(!(this.groupData.groupLiquid<21))return this.groupData.groupLiquid+1;t=this.groupData.groupLiquid}const r=3&t;return 1===r?14:2===r?19:3===r?20:this.groupData.flags&n.WowWorldModelGroupFlags.IsOceanWater?14:13}setupMaterials(){this.materials=new Array(this.textures.length);for(let e=0;e<this.textures.length;e++){const t=this.textures[e],r=new n.RenderMaterial(new n.MaterialKey(this.liquidTypeMetadata.id,n.MaterialType.WMOLiquid));r.useCounterClockWiseFrontFaces(!0),r.useBackFaceCulling(!1),r.useBlendMode(n.GxBlend.GxBlend_Alpha),r.useDepthTest(!0),r.useDepthWrite(!0),r.useColorMask(n.ColorMask.Alpha|n.ColorMask.Red|n.ColorMask.Blue|n.ColorMask.Green),r.useUniforms({u_texture:t,u_modelMatrix:this.worldModelMatrix,u_waterParams:n.Float2.create(this.liquidCategory,0),u_oceanCloseColor:n.Float4.create(17/255,75/255,89/255,1),u_oceanFarColor:n.Float4.create(0,29/255,41/255,1),u_riverCloseColor:n.Float4.create(41/255,76/255,81/255,1),u_riverFarColor:n.Float4.create(26/255,46/255,.2,1),u_waterAlphas:n.Float4.create(.3,.8,.5,1)}),r.useShaderProgram(this.shaderProgram),this.engine.addEngineMaterialParams(r),this.materials[e]=r}}}t.WMOLiquid=h},5716:(e,t)=>{"use strict";var r,a;Object.defineProperty(t,"__esModule",{value:!0}),t.RenderingBatchRequest=t.RenderMaterial=t.MaterialKey=t.MaterialType=t.DrawInstructionType=void 0,function(e){e[e.Triangle=0]="Triangle",e[e.TriangleStrip=1]="TriangleStrip"}(r||(t.DrawInstructionType=r={})),function(e){e[e.Unknown=0]="Unknown",e[e.WMOMaterial=1]="WMOMaterial",e[e.WMOPortal=2]="WMOPortal",e[e.WMOLiquid=3]="WMOLiquid",e[e.M2Material=4]="M2Material",e[e.M2ParticleMaterial=5]="M2ParticleMaterial",e[e.M2RibbonMaterial=6]="M2RibbonMaterial"}(a||(t.MaterialType=a={})),t.MaterialKey=class{constructor(e,t,r=-1){this.ownerId=e,this.type=t,this.materialId=r}compare(e){const t=this.ownerId-e.ownerId;if(0!=t)return t;const r=this.type-e.type;return 0!=r?r:this.materialId-e.materialId}toString(){return this.ownerId+"-"+this.materialId}},t.RenderMaterial=class{constructor(e){this.key=e}useBlendMode(e){this.blendMode=e}useDepthWrite(e){this.depthWrite=e}useDepthTest(e){this.depthTest=e}useBackFaceCulling(e){this.backFaceCulling=e}useCounterClockWiseFrontFaces(e){this.counterClockWiseFrontFaces=e}useColorMask(e){this.colorMask=e}useShaderProgram(e){this.shaderProgram=e}useUniforms(e){this.uniforms=Object.assign(Object.assign({},this.uniforms),e)}bind(e){e.useBackFaceCulling(this.backFaceCulling),e.useBlendMode(this.blendMode),e.useColorMask(this.colorMask),e.useCounterClockWiseFrontFaces(this.counterClockWiseFrontFaces),e.useDepthTest(this.depthTest),e.useDepthWrite(this.depthWrite),this.shaderProgram&&(e.useShaderProgram(this.shaderProgram),this.shaderProgram.useUniforms(this.uniforms))}},t.RenderingBatchRequest=class{constructor(e){this.material=e}useMaterial(e){this.material=e}drawTriangles(e,t){this.drawInstruction={indexed:!1,offset:e,count:t,type:r.Triangle}}drawIndexedTriangles(e,t){this.drawInstruction={indexed:!0,offset:e,count:t,type:r.Triangle}}drawIndexedTriangleStrip(e,t){this.drawInstruction={indexed:!0,offset:e,count:t,type:r.TriangleStrip}}useVertexIndexBuffer(e){this.vertexIndexBuffer=e}useVertexDataBuffer(e){this.vertexDataBuffer=e}useVertexArrayObject(e){this.vao=e}submit(e){this.material.bind(e),this.vertexDataBuffer&&e.useVertexDataBuffer(this.vertexDataBuffer),this.vertexIndexBuffer&&e.useVertexIndexBuffer(this.vertexIndexBuffer),this.vao&&e.useVertexArrayObject(this.vao),this.drawInstruction&&(this.drawInstruction.type===r.Triangle&&(this.drawInstruction.indexed?e.drawIndexedTriangles(this.drawInstruction.offset,this.drawInstruction.count):e.drawTriangles(this.drawInstruction.offset,this.drawInstruction.count)),this.drawInstruction.type===r.TriangleStrip&&e.drawIndexedTriangleStrip(this.drawInstruction.offset,this.drawInstruction.count))}}},5748:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},5996:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});const a="precision mediump float;\r\nuniform mat4 u_modelMatrix;\r\nuniform mat4 u_viewMatrix;\r\nuniform mat4 u_projectionMatrix;\r\n\r\nattribute vec3 a_position;\r\n\r\nvoid main() {\r\n    gl_Position = (u_projectionMatrix * u_viewMatrix * u_modelMatrix * vec4(a_position, 1));\r\n}"},6085:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BinaryWriter=void 0;const a=r(6677);class n extends a.BinaryReader{writeBool(e){this.dataView.setUint8(this.offset,e?1:0),this.offset+=1}writeUInt8(e){this.dataView.setUint8(this.offset,e),this.offset+=1}writeInt8(e){this.dataView.setInt8(this.offset,e),this.offset+=1}writeUInt16BE(e){this.dataView.setUint16(this.offset,e),this.offset+=2}writeUInt16LE(e){this.dataView.setUint16(this.offset,e,!0),this.offset+=2}writeInt16BE(e){this.dataView.setInt16(this.offset,e),this.offset+=2}writeInt16LE(e){this.dataView.setInt16(this.offset,e,!0),this.offset+=2}writeUInt32BE(e){this.dataView.setUint32(this.offset,e),this.offset+=4}writeUInt32LE(e){this.dataView.setUint32(this.offset,e,!0),this.offset+=4}writeInt32BE(e){this.dataView.setInt32(this.offset,e,!0),this.offset+=4}writeInt32LE(e){this.dataView.setInt32(this.offset,e,!0),this.offset+=4}writeFloatBE(e){this.dataView.setFloat32(this.offset,e),this.offset+=4}writeFloatLE(e){this.dataView.setFloat32(this.offset,e,!0),this.offset+=4}}t.BinaryWriter=n},6098:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},6303:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(9174),t),n(r(3656),t),n(r(4521),t),n(r(207),t)},6466:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(6500),t)},6472:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAnimationName=void 0;const r=["Stand","Death","Spell","Stop","Walk","Run","Dead","Rise","StandWound","CombatWound","CombatCritical","ShuffleLeft","ShuffleRight","Walkbackwards","Stun","HandsClosed","AttackUnarmed","Attack1H","Attack2H","Attack2HL","ParryUnarmed","Parry1H","Parry2H","Parry2HL","ShieldBlock","ReadyUnarmed","Ready1H","Ready2H","Ready2HL","ReadyBow","Dodge","SpellPrecast","SpellCast","SpellCastArea","NPCWelcome","NPCGoodbye","Block","JumpStart","Jump","JumpEnd","Fall","SwimIdle","Swim","SwimLeft","SwimRight","SwimBackwards","AttackBow","FireBow","ReadyRifle","AttackRifle","Loot","ReadySpellDirected","ReadySpellOmni","SpellCastDirected","SpellCastOmni","BattleRoar","ReadyAbility","Special1H","Special2H","ShieldBash","EmoteTalk","EmoteEat","EmoteWork","EmoteUseStanding","EmoteTalkExclamation","EmoteTalkQuestion","EmoteBow","EmoteWave","EmoteCheer","EmoteDance","EmoteLaugh","EmoteSleep","EmoteSitGround","EmoteRude","EmoteRoar","EmoteKneel","EmoteKiss","EmoteCry","EmoteChicken","EmoteBeg","EmoteApplaud","EmoteShout","EmoteFlex","EmoteShy","EmotePoint","Attack1HPierce","Attack2HLoosePierce","AttackOff","AttackOffPierce","Sheath","HipSheath","Mount","RunRight","RunLeft","MountSpecial","Kick","SitGroundDown","SitGround","SitGroundUp","SleepDown","Sleep","SleepUp","SitChairLow","SitChairMed","SitChairHigh","LoadBow","LoadRifle","AttackThrown","ReadyThrown","HoldBow","HoldRifle","HoldThrown","LoadThrown","EmoteSalute","KneelStart","KneelLoop","KneelEnd","AttackUnarmedOff","SpecialUnarmed","StealthWalk","StealthStand","Knockdown","EatingLoop","UseStandingLoop","ChannelCastDirected","ChannelCastOmni","Whirlwind","Birth","UseStandingStart","UseStandingEnd","CreatureSpecial","Drown","Drowned","FishingCast","FishingLoop","Fly","EmoteWorkNoSheathe","EmoteStunNoSheathe","EmoteUseStandingNoSheathe","SpellSleepDown","SpellKneelStart","SpellKneelLoop","SpellKneelEnd","Sprint","InFlight","Spawn","Close","Closed","Open","Opened","Destroy","Destroyed","Rebuild","Custom0","Custom1","Custom2","Custom3","Despawn","Hold","Decay","BowPull","BowRelease","ShipStart","ShipMoving","ShipStop","GroupArrow","Arrow","CorpseArrow","GuideArrow","Sway","DruidCatPounce","DruidCatRip","DruidCatRake","DruidCatRavage","DruidCatClaw","DruidCatCower","DruidBearSwipe","DruidBearBite","DruidBearMaul","DruidBearBash","DragonTail","DragonStomp","DragonSpit","DragonSpitHover","DragonSpitFly","EmoteYes","EmoteNo","JumpLandRun","LootHold","LootUp","StandHigh","Impact","LiftOff","Hover","SuccubusEntice","EmoteTrain","EmoteDead","EmoteDanceOnce","Deflect","EmoteEatNoSheathe","Land","Submerge","Submerged","Cannibalize","ArrowBirth","GroupArrowBirth","CorpseArrowBirth","GuideArrowBirth","EmoteTalkNoSheathe","EmotePointNoSheathe","EmoteSaluteNoSheathe","EmoteDanceSpecial","Mutilate","CustomSpell01","CustomSpell02","CustomSpell03","CustomSpell04","CustomSpell05","CustomSpell06","CustomSpell07","CustomSpell08","CustomSpell09","CustomSpell10","StealthRun","Emerge","Cower","Grab","GrabClosed","GrabThrown","FlyStand","FlyDeath","FlySpell","FlyStop","FlyWalk","FlyRun","FlyDead","FlyRise","FlyStandWound","FlyCombatWound","FlyCombatCritical","FlyShuffleLeft","FlyShuffleRight","FlyWalkbackwards","FlyStun","FlyHandsClosed","FlyAttackUnarmed","FlyAttack1H","FlyAttack2H","FlyAttack2HL","FlyParryUnarmed","FlyParry1H","FlyParry2H","FlyParry2HL","FlyShieldBlock","FlyReadyUnarmed","FlyReady1H","FlyReady2H","FlyReady2HL","FlyReadyBow","FlyDodge","FlySpellPrecast","FlySpellCast","FlySpellCastArea","FlyNPCWelcome","FlyNPCGoodbye","FlyBlock","FlyJumpStart","FlyJump","FlyJumpEnd","FlyFall","FlySwimIdle","FlySwim","FlySwimLeft","FlySwimRight","FlySwimBackwards","FlyAttackBow","FlyFireBow","FlyReadyRifle","FlyAttackRifle","FlyLoot","FlyReadySpellDirected","FlyReadySpellOmni","FlySpellCastDirected","FlySpellCastOmni","FlyBattleRoar","FlyReadyAbility","FlySpecial1H","FlySpecial2H","FlyShieldBash","FlyEmoteTalk","FlyEmoteEat","FlyEmoteWork","FlyEmoteUseStanding","FlyEmoteTalkExclamation","FlyEmoteTalkQuestion","FlyEmoteBow","FlyEmoteWave","FlyEmoteCheer","FlyEmoteDance","FlyEmoteLaugh","FlyEmoteSleep","FlyEmoteSitGround","FlyEmoteRude","FlyEmoteRoar","FlyEmoteKneel","FlyEmoteKiss","FlyEmoteCry","FlyEmoteChicken","FlyEmoteBeg","FlyEmoteApplaud","FlyEmoteShout","FlyEmoteFlex","FlyEmoteShy","FlyEmotePoint","FlyAttack1HPierce","FlyAttack2HLoosePierce","FlyAttackOff","FlyAttackOffPierce","FlySheath","FlyHipSheath","FlyMount","FlyRunRight","FlyRunLeft","FlyMountSpecial","FlyKick","FlySitGroundDown","FlySitGround","FlySitGroundUp","FlySleepDown","FlySleep","FlySleepUp","FlySitChairLow","FlySitChairMed","FlySitChairHigh","FlyLoadBow","FlyLoadRifle","FlyAttackThrown","FlyReadyThrown","FlyHoldBow","FlyHoldRifle","FlyHoldThrown","FlyLoadThrown","FlyEmoteSalute","FlyKneelStart","FlyKneelLoop","FlyKneelEnd","FlyAttackUnarmedOff","FlySpecialUnarmed","FlyStealthWalk","FlyStealthStand","FlyKnockdown","FlyEatingLoop","FlyUseStandingLoop","FlyChannelCastDirected","FlyChannelCastOmni","FlyWhirlwind","FlyBirth","FlyUseStandingStart","FlyUseStandingEnd","FlyCreatureSpecial","FlyDrown","FlyDrowned","FlyFishingCast","FlyFishingLoop","FlyFly","FlyEmoteWorkNoSheathe","FlyEmoteStunNoSheathe","FlyEmoteUseStandingNoSheathe","FlySpellSleepDown","FlySpellKneelStart","FlySpellKneelLoop","FlySpellKneelEnd","FlySprint","FlyInFlight","FlySpawn","FlyClose","FlyClosed","FlyOpen","FlyOpened","FlyDestroy","FlyDestroyed","FlyRebuild","FlyCustom0","FlyCustom1","FlyCustom2","FlyCustom3","FlyDespawn","FlyHold","FlyDecay","FlyBowPull","FlyBowRelease","FlyShipStart","FlyShipMoving","FlyShipStop","FlyGroupArrow","FlyArrow","FlyCorpseArrow","FlyGuideArrow","FlySway","FlyDruidCatPounce","FlyDruidCatRip","FlyDruidCatRake","FlyDruidCatRavage","FlyDruidCatClaw","FlyDruidCatCower","FlyDruidBearSwipe","FlyDruidBearBite","FlyDruidBearMaul","FlyDruidBearBash","FlyDragonTail","FlyDragonStomp","FlyDragonSpit","FlyDragonSpitHover","FlyDragonSpitFly","FlyEmoteYes","FlyEmoteNo","FlyJumpLandRun","FlyLootHold","FlyLootUp","FlyStandHigh","FlyImpact","FlyLiftOff","FlyHover","FlySuccubusEntice","FlyEmoteTrain","FlyEmoteDead","FlyEmoteDanceOnce","FlyDeflect","FlyEmoteEatNoSheathe","FlyLand","FlySubmerge","FlySubmerged","FlyCannibalize","FlyArrowBirth","FlyGroupArrowBirth","FlyCorpseArrowBirth","FlyGuideArrowBirth","FlyEmoteTalkNoSheathe","FlyEmotePointNoSheathe","FlyEmoteSaluteNoSheathe","FlyEmoteDanceSpecial","FlyMutilate","FlyCustomSpell01","FlyCustomSpell02","FlyCustomSpell03","FlyCustomSpell04","FlyCustomSpell05","FlyCustomSpell06","FlyCustomSpell07","FlyCustomSpell08","FlyCustomSpell09","FlyCustomSpell10","FlyStealthRun","FlyEmerge","FlyCower","FlyGrab","FlyGrabClosed","FlyGrabThrown","ToFly","ToHover","ToGround","FlyToFly","FlyToHover","FlyToGround","Settle","FlySettle","DeathStart","DeathLoop","DeathEnd","FlyDeathStart","FlyDeathLoop","FlyDeathEnd","DeathEndHold","FlyDeathEndHold","Strangulate","FlyStrangulate","ReadyJoust","LoadJoust","HoldJoust","FlyReadyJoust","FlyLoadJoust","FlyHoldJoust","AttackJoust","FlyAttackJoust","ReclinedMount","FlyReclinedMount","ToAltered","FromAltered","FlyToAltered","FlyFromAltered","InStocks","FlyInStocks","VehicleGrab","VehicleThrow","FlyVehicleGrab","FlyVehicleThrow","ToAlteredPostSwap","FromAlteredPostSwap","FlyToAlteredPostSwap","FlyFromAlteredPostSwap","ReclinedMountPassenger","FlyReclinedMountPassenger","Carry2H","Carried2H","FlyCarry2H","FlyCarried2H","EmoteSniff","EmoteFlySniff","AttackFist1H","FlyAttackFist1H","AttackFist1HOff","FlyAttackFist1HOff","ParryFist1H","FlyParryFist1H","ReadyFist1H","FlyReadyFist1H","SpecialFist1H","FlySpecialFist1H","EmoteReadStart","FlyEmoteReadStart","EmoteReadLoop","FlyEmoteReadLoop","EmoteReadEnd","FlyEmoteReadEnd","SwimRun","FlySwimRun","SwimWalk","FlySwimWalk","SwimWalkBackwards","FlySwimWalkBackwards","SwimSprint","FlySwimSprint","MountSwimIdle","FlyMountSwimIdle","MountSwimBackwards","FlyMountSwimBackwards","MountSwimLeft","FlyMountSwimLeft","MountSwimRight","FlyMountSwimRight","MountSwimRun","FlyMountSwimRun","MountSwimSprint","FlyMountSwimSprint","MountSwimWalk","FlyMountSwimWalk","MountSwimWalkBackwards","FlyMountSwimWalkBackwards","MountFlightIdle","FlyMountFlightIdle","MountFlightBackwards","FlyMountFlightBackwards","MountFlightLeft","FlyMountFlightLeft","MountFlightRight","FlyMountFlightRight","MountFlightRun","FlyMountFlightRun","MountFlightSprint","FlyMountFlightSprint","MountFlightWalk","FlyMountFlightWalk","MountFlightWalkBackwards","FlyMountFlightWalkBackwards","MountFlightStart","FlyMountFlightStart","MountSwimStart","FlyMountSwimStart","MountSwimLand","FlyMountSwimLand","MountSwimLandRun","FlyMountSwimLandRun","MountFlightLand","FlyMountFlightLand","MountFlightLandRun","FlyMountFlightLandRun","ReadyBlowDart","FlyReadyBlowDart","LoadBlowDart","FlyLoadBlowDart","HoldBlowDart","FlyHoldBlowDart","AttackBlowDart","FlyAttackBlowDart","CarriageMount","FlyCarriageMount","CarriagePassengerMount","FlyCarriagePassengerMount","CarriageMountAttack","FlyCarriageMountAttack","BarTendStand","FlyBarTendStand","BarServerWalk","FlyBarServerWalk","BarServerRun","FlyBarServerRun","BarServerShuffleLeft","FlyBarServerShuffleLeft","BarServerShuffleRight","FlyBarServerShuffleRight","BarTendEmoteTalk","FlyBarTendEmoteTalk","BarTendEmotePoint","FlyBarTendEmotePoint","BarServerStand","FlyBarServerStand","BarSweepWalk","FlyBarSweepWalk","BarSweepRun","FlyBarSweepRun","BarSweepShuffleLeft","FlyBarSweepShuffleLeft","BarSweepShuffleRight","FlyBarSweepShuffleRight","BarSweepEmoteTalk","FlyBarSweepEmoteTalk","BarPatronSitEmotePoint","FlyBarPatronSitEmotePoint","MountSelfIdle","FlyMountSelfIdle","MountSelfWalk","FlyMountSelfWalk","MountSelfRun","FlyMountSelfRun","MountSelfSprint","FlyMountSelfSprint","MountSelfRunLeft","FlyMountSelfRunLeft","MountSelfRunRight","FlyMountSelfRunRight","MountSelfShuffleLeft","FlyMountSelfShuffleLeft","MountSelfShuffleRight","FlyMountSelfShuffleRight","MountSelfWalkBackwards","FlyMountSelfWalkBackwards","MountSelfSpecial","FlyMountSelfSpecial","MountSelfJump","FlyMountSelfJump","MountSelfJumpStart","FlyMountSelfJumpStart","MountSelfJumpEnd","FlyMountSelfJumpEnd","MountSelfJumpLandRun","FlyMountSelfJumpLandRun","MountSelfStart","FlyMountSelfStart","MountSelfFall","FlyMountSelfFall","Stormstrike","FlyStormstrike","ReadyJoustNoSheathe","FlyReadyJoustNoSheathe","Slam","FlySlam","DeathStrike","FlyDeathStrike","SwimAttackUnarmed","FlySwimAttackUnarmed","SpinningKick","FlySpinningKick","RoundHouseKick","FlyRoundHouseKick","RollStart","FlyRollStart","Roll","FlyRoll","RollEnd","FlyRollEnd","PalmStrike","FlyPalmStrike","MonkOffenseAttackUnarmed","FlyMonkOffenseAttackUnarmed","MonkOffenseAttackUnarmedOff","FlyMonkOffenseAttackUnarmedOff","MonkOffenseParryUnarmed","FlyMonkOffenseParryUnarmed","MonkOffenseReadyUnarmed","FlyMonkOffenseReadyUnarmed","MonkOffenseSpecialUnarmed","FlyMonkOffenseSpecialUnarmed","MonkDefenseAttackUnarmed","FlyMonkDefenseAttackUnarmed","MonkDefenseAttackUnarmedOff","FlyMonkDefenseAttackUnarmedOff","MonkDefenseParryUnarmed","FlyMonkDefenseParryUnarmed","MonkDefenseReadyUnarmed","FlyMonkDefenseReadyUnarmed","MonkDefenseSpecialUnarmed","FlyMonkDefenseSpecialUnarmed","MonkHealAttackUnarmed","FlyMonkHealAttackUnarmed","MonkHealAttackUnarmedOff","FlyMonkHealAttackUnarmedOff","MonkHealParryUnarmed","FlyMonkHealParryUnarmed","MonkHealReadyUnarmed","FlyMonkHealReadyUnarmed","MonkHealSpecialUnarmed","FlyMonkHealSpecialUnarmed","FlyingKick","FlyFlyingKick","FlyingKickStart","FlyFlyingKickStart","FlyingKickEnd","FlyFlyingKickEnd","CraneStart","FlyCraneStart","CraneLoop","FlyCraneLoop","CraneEnd","FlyCraneEnd","Despawned","FlyDespawned","ThousandFists","FlyThousandFists","MonkHealReadySpellDirected","FlyMonkHealReadySpellDirected","MonkHealReadySpellOmni","FlyMonkHealReadySpellOmni","MonkHealSpellCastDirected","FlyMonkHealSpellCastDirected","MonkHealSpellCastOmni","FlyMonkHealSpellCastOmni","MonkHealChannelCastDirected","FlyMonkHealChannelCastDirected","MonkHealChannelCastOmni","FlyMonkHealChannelCastOmni","Torpedo","FlyTorpedo","Meditate","FlyMeditate","BreathOfFire","FlyBreathOfFire","RisingSunKick","FlyRisingSunKick","GroundKick","FlyGroundKick","KickBack","FlyKickBack","PetBattleStand","FlyPetBattleStand","PetBattleDeath","FlyPetBattleDeath","PetBattleRun","FlyPetBattleRun","PetBattleWound","FlyPetBattleWound","PetBattleAttack","FlyPetBattleAttack","PetBattleReadySpell","FlyPetBattleReadySpell","PetBattleSpellCast","FlyPetBattleSpellCast","PetBattleCustom0","FlyPetBattleCustom0","PetBattleCustom1","FlyPetBattleCustom1","PetBattleCustom2","FlyPetBattleCustom2","PetBattleCustom3","FlyPetBattleCustom3","PetBattleVictory","FlyPetBattleVictory","PetBattleLoss","FlyPetBattleLoss","PetBattleStun","FlyPetBattleStun","PetBattleDead","FlyPetBattleDead","PetBattleFreeze","FlyPetBattleFreeze","MonkOffenseAttackWeapon","FlyMonkOffenseAttackWeapon","BarTendEmoteWave","FlyBarTendEmoteWave","BarServerEmoteTalk","FlyBarServerEmoteTalk","BarServerEmoteWave","FlyBarServerEmoteWave","BarServerPourDrinks","FlyBarServerPourDrinks","BarServerPickup","FlyBarServerPickup","BarServerPutDown","FlyBarServerPutDown","BarSweepStand","FlyBarSweepStand","BarPatronSit","FlyBarPatronSit","BarPatronSitEmoteTalk","FlyBarPatronSitEmoteTalk","BarPatronStand","FlyBarPatronStand","BarPatronStandEmoteTalk","FlyBarPatronStandEmoteTalk","BarPatronStandEmotePoint","FlyBarPatronStandEmotePoint","CarrionSwarm","FlyCarrionSwarm","WheelLoop","FlyWheelLoop","StandCharacterCreate","FlyStandCharacterCreate","MountChopper","FlyMountChopper","FacePose","FlyFacePose","CombatAbility2HBig01","FlyCombatAbility2HBig01","CombatAbility2H01","FlyCombatAbility2H01","CombatWhirlwind","FlyCombatWhirlwind","CombatChargeLoop","FlyCombatChargeLoop","CombatAbility1H01","FlyCombatAbility1H01","CombatChargeEnd","FlyCombatChargeEnd","CombatAbility1H02","FlyCombatAbility1H02","CombatAbility1HBig01","FlyCombatAbility1HBig01","CombatAbility2H02","FlyCombatAbility2H02","ShaSpellPrecastBoth","FlyShaSpellPrecastBoth","ShaSpellCastBothFront","FlyShaSpellCastBothFront","ShaSpellCastLeftFront","FlyShaSpellCastLeftFront","ShaSpellCastRightFront","FlyShaSpellCastRightFront","ReadyCrossbow","FlyReadyCrossbow","LoadCrossbow","FlyLoadCrossbow","AttackCrossbow","FlyAttackCrossbow","HoldCrossbow","FlyHoldCrossbow","CombatAbility2HL01","FlyCombatAbility2HL01","CombatAbility2HL02","FlyCombatAbility2HL02","CombatAbility2HLBig01","FlyCombatAbility2HLBig01","CombatUnarmed01","FlyCombatUnarmed01","CombatStompLeft","FlyCombatStompLeft","CombatStompRight","FlyCombatStompRight","CombatLeapLoop","FlyCombatLeapLoop","CombatLeapEnd","FlyCombatLeapEnd","ShaReadySpellCast","FlyShaReadySpellCast","ShaSpellPrecastBothChannel","FlyShaSpellPrecastBothChannel","ShaSpellCastBothUp","FlyShaSpellCastBothUp","ShaSpellCastBothUpChannel","FlyShaSpellCastBothUpChannel","ShaSpellCastBothFrontChannel","FlyShaSpellCastBothFrontChannel","ShaSpellCastLeftFrontChannel","FlyShaSpellCastLeftFrontChannel","ShaSpellCastRightFrontChannel","FlyShaSpellCastRightFrontChannel","PriReadySpellCast","FlyPriReadySpellCast","PriSpellPrecastBoth","FlyPriSpellPrecastBoth","PriSpellPrecastBothChannel","FlyPriSpellPrecastBothChannel","PriSpellCastBothUp","FlyPriSpellCastBothUp","PriSpellCastBothFront","FlyPriSpellCastBothFront","PriSpellCastLeftFront","FlyPriSpellCastLeftFront","PriSpellCastRightFront","FlyPriSpellCastRightFront","PriSpellCastBothUpChannel","FlyPriSpellCastBothUpChannel","PriSpellCastBothFrontChannel","FlyPriSpellCastBothFrontChannel","PriSpellCastLeftFrontChannel","FlyPriSpellCastLeftFrontChannel","PriSpellCastRightFrontChannel","FlyPriSpellCastRightFrontChannel","MagReadySpellCast","FlyMagReadySpellCast","MagSpellPrecastBoth","FlyMagSpellPrecastBoth","MagSpellPrecastBothChannel","FlyMagSpellPrecastBothChannel","MagSpellCastBothUp","FlyMagSpellCastBothUp","MagSpellCastBothFront","FlyMagSpellCastBothFront","MagSpellCastLeftFront","FlyMagSpellCastLeftFront","MagSpellCastRightFront","FlyMagSpellCastRightFront","MagSpellCastBothUpChannel","FlyMagSpellCastBothUpChannel","MagSpellCastBothFrontChannel","FlyMagSpellCastBothFrontChannel","MagSpellCastLeftFrontChannel","FlyMagSpellCastLeftFrontChannel","MagSpellCastRightFrontChannel","FlyMagSpellCastRightFrontChannel","LocReadySpellCast","FlyLocReadySpellCast","LocSpellPrecastBoth","FlyLocSpellPrecastBoth","LocSpellPrecastBothChannel","FlyLocSpellPrecastBothChannel","LocSpellCastBothUp","FlyLocSpellCastBothUp","LocSpellCastBothFront","FlyLocSpellCastBothFront","LocSpellCastLeftFront","FlyLocSpellCastLeftFront","LocSpellCastRightFront","FlyLocSpellCastRightFront","LocSpellCastBothUpChannel","FlyLocSpellCastBothUpChannel","LocSpellCastBothFrontChannel","FlyLocSpellCastBothFrontChannel","LocSpellCastLeftFrontChannel","FlyLocSpellCastLeftFrontChannel","LocSpellCastRightFrontChannel","FlyLocSpellCastRightFrontChannel","DruReadySpellCast","FlyDruReadySpellCast","DruSpellPrecastBoth","FlyDruSpellPrecastBoth","DruSpellPrecastBothChannel","FlyDruSpellPrecastBothChannel","DruSpellCastBothUp","FlyDruSpellCastBothUp","DruSpellCastBothFront","FlyDruSpellCastBothFront","DruSpellCastLeftFront","FlyDruSpellCastLeftFront","DruSpellCastRightFront","FlyDruSpellCastRightFront","DruSpellCastBothUpChannel","FlyDruSpellCastBothUpChannel","DruSpellCastBothFrontChannel","FlyDruSpellCastBothFrontChannel","DruSpellCastLeftFrontChannel","FlyDruSpellCastLeftFrontChannel","DruSpellCastRightFrontChannel","FlyDruSpellCastRightFrontChannel","ArtMainLoop","FlyArtMainLoop","ArtDualLoop","FlyArtDualLoop","ArtFistsLoop","FlyArtFistsLoop","ArtBowLoop","FlyArtBowLoop","CombatAbility1H01Off","FlyCombatAbility1H01Off","CombatAbility1H02Off","FlyCombatAbility1H02Off","CombatFuriousStrike01","FlyCombatFuriousStrike01","CombatFuriousStrike02","FlyCombatFuriousStrike02","CombatFuriousStrikes","FlyCombatFuriousStrikes","CombatReadySpellCast","FlyCombatReadySpellCast","CombatShieldThrow","FlyCombatShieldThrow","PalSpellCast1HUp","FlyPalSpellCast1HUp","CombatReadyPostSpellCast","FlyCombatReadyPostSpellCast","PriReadyPostSpellCast","FlyPriReadyPostSpellCast","DHCombatRun","FlyDHCombatRun","CombatShieldBash","FlyCombatShieldBash","CombatThrow","FlyCombatThrow","CombatAbility1HPierce","FlyCombatAbility1HPierce","CombatAbility1HOffPierce","FlyCombatAbility1HOffPierce","CombatMutilate","FlyCombatMutilate","CombatBladeStorm","FlyCombatBladeStorm","CombatFinishingMove","FlyCombatFinishingMove","CombatLeapStart","FlyCombatLeapStart","GlvThrowMain","FlyGlvThrowMain","GlvThrownOff","FlyGlvThrownOff","DHCombatSprint","FlyDHCombatSprint","CombatAbilityGlv01","FlyCombatAbilityGlv01","CombatAbilityGlv02","FlyCombatAbilityGlv02","CombatAbilityGlvOff01","FlyCombatAbilityGlvOff01","CombatAbilityGlvOff02","FlyCombatAbilityGlvOff02","CombatAbilityGlvBig01","FlyCombatAbilityGlvBig01","CombatAbilityGlvBig02","FlyCombatAbilityGlvBig02","ReadyGlv","FlyReadyGlv","CombatAbilityGlvBig03","FlyCombatAbilityGlvBig03","DoubleJumpStart","FlyDoubleJumpStart","DoubleJump","FlyDoubleJump","CombatEviscerate","FlyCombatEviscerate","DoubleJumpLandRun","FlyDoubleJumpLandRun","BackFlipStart","FlyBackFlipStart","BackFlipLoop","FlyBackFlipLoop","FelRushLoop","FlyFelRushLoop","FelRushEnd","FlyFelRushEnd","DHToAlteredStart","FlyDHToAlteredStart","DHToAlteredEnd","FlyDHToAlteredEnd","DHGlide","FlyDHGlide","FanOfKnives","FlyFanOfKnives","SingleJumpStart","FlySingleJumpStart","DHBladeDance1","FlyDHBladeDance1","DHBladeDance2","FlyDHBladeDance2","DHBladeDance3","FlyDHBladeDance3","DHMeteorStrike","FlyDHMeteorStrike","CombatExecute","FlyCombatExecute","ArtLoop","FlyArtLoop","ParryGlv","FlyParryGlv","CombatUnarmed02","FlyCombatUnarmed02","CombatPistolShot","FlyCombatPistolShot","CombatPistolShotOff","FlyCombatPistolShotOff","Monk2HLIdle","FlyMonk2HLIdle","ArtShieldLoop","FlyArtShieldLoop","CombatAbility2H03","FlyCombatAbility2H03","CombatStomp","FlyCombatStomp","CombatRoar","FlyCombatRoar","PalReadySpellCast","FlyPalReadySpellCast","PalSpellPrecastRight","FlyPalSpellPrecastRight","PalSpellPrecastRightChannel","FlyPalSpellPrecastRightChannel","PalSpellCastRightFront","FlyPalSpellCastRightFront","ShaSpellCastBothOut","FlyShaSpellCastBothOut","AttackWeapon","FlyAttackWeapon","ReadyWeapon","FlyReadyWeapon","AttackWeaponOff","FlyAttackWeaponOff","SpecialDual","FlySpecialDual","DkCast1HFront","FlyDkCast1HFront","CastStrongRight","FlyCastStrongRight","CastStrongLeft","FlyCastStrongLeft","CastCurseRight","FlyCastCurseRight","CastCurseLeft","FlyCastCurseLeft","CastSweepRight","FlyCastSweepRight","CastSweepLeft","FlyCastSweepLeft","CastStrongUpLeft","FlyCastStrongUpLeft","CastTwistUpBoth","FlyCastTwistUpBoth","CastOutStrong","FlyCastOutStrong","DrumLoop","FlyDrumLoop","ParryWeapon","FlyParryWeapon","ReadyFL","FlyReadyFL","AttackFL","FlyAttackFL","AttackFLOff","FlyAttackFLOff","ParryFL","FlyParryFL","SpecialFL","FlySpecialFL","PriHoverForward","FlyPriHoverForward","PriHoverBackward","FlyPriHoverBackward","PriHoverRight","FlyPriHoverRight","PriHoverLeft","FlyPriHoverLeft","RunBackwards","FlyRunBackwards","CastStrongUpRight","FlyCastStrongUpRight","WAWalk","FlyWAWalk","WARun","FlyWARun","WADrunkStand","FlyWADrunkStand","WADrunkShuffleLeft","FlyWADrunkShuffleLeft","WADrunkShuffleRight","FlyWADrunkShuffleRight","WADrunkWalk","FlyWADrunkWalk","WADrunkWalkBackwards","FlyWADrunkWalkBackwards","WADrunkWound","FlyWADrunkWound","WADrunkTalk","FlyWADrunkTalk","WATrance01","FlyWATrance01","WATrance02","FlyWATrance02","WAChant01","FlyWAChant01","WAChant02","FlyWAChant02","WAChant03","FlyWAChant03","WAHang01","FlyWAHang01","WAHang02","FlyWAHang02","WASummon01","FlyWASummon01","WASummon02","FlyWASummon02","WABeggarTalk","FlyWABeggarTalk","WABeggarStand","FlyWABeggarStand","WABeggarPoint","FlyWABeggarPoint","WABeggarBeg","FlyWABeggarBeg","WASit01","FlyWASit01","WASit02","FlyWASit02","WASit03","FlyWASit03","WACrierStand01","FlyWACrierStand01","WACrierStand02","FlyWACrierStand02","WACrierStand03","FlyWACrierStand03","WACrierTalk","FlyWACrierTalk","WACrateHold","FlyWACrateHold","WABarrelHold","FlyWABarrelHold","WASackHold","FlyWASackHold","WAWheelBarrowStand","FlyWAWheelBarrowStand","WAWheelBarrowWalk","FlyWAWheelBarrowWalk","WAWheelBarrowRun","FlyWAWheelBarrowRun","WAHammerLoop","FlyWAHammerLoop","WACrankLoop","FlyWACrankLoop","WAPourStart","FlyWAPourStart","WAPourLoop","FlyWAPourLoop","WAPourEnd","FlyWAPourEnd","WAEmotePour","FlyWAEmotePour","WARowingStandRight","FlyWARowingStandRight","WARowingStandLeft","FlyWARowingStandLeft","WARowingRight","FlyWARowingRight","WARowingLeft","FlyWARowingLeft","WAGuardStand01","FlyWAGuardStand01","WAGuardStand02","FlyWAGuardStand02","WAGuardStand03","FlyWAGuardStand03","WAGuardStand04","FlyWAGuardStand04","WAFreezing01","FlyWAFreezing01","WAFreezing02","FlyWAFreezing02","WAVendorStand01","FlyWAVendorStand01","WAVendorStand02","FlyWAVendorStand02","WAVendorStand03","FlyWAVendorStand03","WAVendorTalk","FlyWAVendorTalk","WALean01","FlyWALean01","WALean02","FlyWALean02","WALean03","FlyWALean03","WALeanTalk","FlyWALeanTalk","WABoatWheel","FlyWABoatWheel","WASmithLoop","FlyWASmithLoop","WAScrubbing","FlyWAScrubbing","WAWeaponSharpen","FlyWAWeaponSharpen","WAStirring","FlyWAStirring","WAPerch01","FlyWAPerch01","WAPerch02","FlyWAPerch02","HoldWeapon","FlyHoldWeapon","WABarrelWalk","FlyWABarrelWalk","WAPourHold","FlyWAPourHold","CastStrong","FlyCastStrong","CastCurse","FlyCastCurse","CastSweep","FlyCastSweep","CastStrongUp","FlyCastStrongUp","WABoatWheelStand","FlyWABoatWheelStand","WASmithStand","FlyWASmithStand","WACrankStand","FlyWACrankStand","WAPourWalk","FlyWAPourWalk","FalconeerStart","FlyFalconeerStart","FalconeerLoop","FlyFalconeerLoop","FalconeerEnd","FlyFalconeerEnd","WADrunkDrink","FlyWADrunkDrink","WAStandEat","FlyWAStandEat","WAStandDrink","FlyWAStandDrink","WABound01","FlyWABound01","WABound02","FlyWABound02","CombatAbility1H03Off","FlyCombatAbility1H03Off","CombatAbilityDualWield01","FlyCombatAbilityDualWield01","WACradle01","FlyWACradle01","LocSummon","FlyLocSummon","LoadWeapon","FlyLoadWeapon","ArtOffLoop","FlyArtOffLoop","WADead01","FlyWADead01","WADead02","FlyWADead02","WADead03","FlyWADead03","WADead04","FlyWADead04","WADead05","FlyWADead05","WADead06","FlyWADead06","WADead07","FlyWADead07","GiantRun","FlyGiantRun","BarTendEmoteCheer","FlyBarTendEmoteCheer","BarTendEmoteTalkQuestion","FlyBarTendEmoteTalkQuestion","BarTendEmoteTalkExclamation","FlyBarTendEmoteTalkExclamation","BarTendWalk","FlyBarTendWalk","BartendShuffleLeft","FlyBartendShuffleLeft","BarTendShuffleRight","FlyBarTendShuffleRight","BarTendCustomSpell01","FlyBarTendCustomSpell01","BarTendCustomSpell02","FlyBarTendCustomSpell02","BarTendCustomSpell03","FlyBarTendCustomSpell03","BarServerEmoteCheer","FlyBarServerEmoteCheer","BarServerEmoteTalkQuestion","FlyBarServerEmoteTalkQuestion","BarServerEmoteTalkExclamation","FlyBarServerEmoteTalkExclamation","BarServerCustomSpell01","FlyBarServerCustomSpell01","BarServerCustomSpell02","FlyBarServerCustomSpell02","BarServerCustomSpell03","FlyBarServerCustomSpell03","BarPatronEmoteDrink","FlyBarPatronEmoteDrink","BarPatronEmoteCheer","FlyBarPatronEmoteCheer","BarPatronCustomSpell01","FlyBarPatronCustomSpell01","BarPatronCustomSpell02","FlyBarPatronCustomSpell02","BarPatronCustomSpell03","FlyBarPatronCustomSpell03","HoldDart","FlyHoldDart","ReadyDart","FlyReadyDart","AttackDart","FlyAttackDart","LoadDart","FlyLoadDart","WADartTargetStand","FlyWADartTargetStand","WADartTargetEmoteTalk","FlyWADartTargetEmoteTalk","BarPatronSitEmoteCheer","FlyBarPatronSitEmoteCheer","BarPatronSitCustomSpell01","FlyBarPatronSitCustomSpell01","BarPatronSitCustomSpell02","FlyBarPatronSitCustomSpell02","BarPatronSitCustomSpell03","FlyBarPatronSitCustomSpell03","BarPianoStand","FlyBarPianoStand","BarPianoEmoteTalk","FlyBarPianoEmoteTalk","WAHearthSit","FlyWAHearthSit","WAHearthSitEmoteCry","FlyWAHearthSitEmoteCry","WAHearthSitEmoteCheer","FlyWAHearthSitEmoteCheer","WAHearthSitCustomSpell01","FlyWAHearthSitCustomSpell01","WAHearthSitCustomSpell02","FlyWAHearthSitCustomSpell02","WAHearthSitCustomSpell03","FlyWAHearthSitCustomSpell03","WAHearthStand","FlyWAHearthStand","WAHearthStandEmoteCheer","FlyWAHearthStandEmoteCheer","WAHearthStandEmoteTalk","FlyWAHearthStandEmoteTalk","WAHearthStandCustomSpell01","FlyWAHearthStandCustomSpell01","WAHearthStandCustomSpell02","FlyWAHearthStandCustomSpell02","WAHearthStandCustomSpell03","FlyWAHearthStandCustomSpell03","WAScribeStart","FlyWAScribeStart","WAScribeLoop","FlyWAScribeLoop","WAScribeEnd","FlyWAScribeEnd","WAEmoteScribe","FlyWAEmoteScribe","Haymaker","FlyHaymaker","HaymakerPrecast","FlyHaymakerPrecast","ChannelCastOmniUp","FlyChannelCastOmniUp","DHJumpLandRun","FlyDHJumpLandRun","Cinematic01","FlyCinematic01","Cinematic02","FlyCinematic02","Cinematic03","FlyCinematic03","Cinematic04","FlyCinematic04","Cinematic05","FlyCinematic05","Cinematic06","FlyCinematic06","Cinematic07","FlyCinematic07","Cinematic08","FlyCinematic08","Cinematic09","FlyCinematic09","Cinematic10","FlyCinematic10","TakeOffStart","FlyTakeOffStart","TakeOffFinish","FlyTakeOffFinish","LandStart","FlyLandStart","LandFinish","FlyLandFinish","WAWalkTalk","FlyWAWalkTalk","WAPerch03","FlyWAPerch03","CarriageMountMoving","FlyCarriageMountMoving","TakeOffFinishFly","FlyTakeOffFinishFly","CombatAbility2HBig02","FlyCombatAbility2HBig02","MountWide","FlyMountWide","EmoteTalkSubdued","FlyEmoteTalkSubdued","WASit04","FlyWASit04","MountSummon","FlyMountSummon","EmoteSelfie","FlyEmoteSelfie","CustomSpell11","FlyCustomSpell11","CustomSpell12","FlyCustomSpell12","CustomSpell13","FlyCustomSpell13","CustomSpell14","FlyCustomSpell14","CustomSpell15","FlyCustomSpell15","CustomSpell16","FlyCustomSpell16","CustomSpell17","FlyCustomSpell17","CustomSpell18","FlyCustomSpell18","CustomSpell19","FlyCustomSpell19","CustomSpell20","FlyCustomSpell20","AdvFlyLeft","FlyAdvFlyLeft","AdvFlyRight","FlyAdvFlyRight","AdvFlyForward","FlyAdvFlyForward","AdvFlyBackward","FlyAdvFlyBackward","AdvFlyUp","FlyAdvFlyUp","AdvFlyDown","FlyAdvFlyDown","AdvFlyForwardGlide","FlyAdvFlyForwardGlide","AdvFlyRoll","FlyAdvFlyRoll","ProfCookingLoop","FlyProfCookingLoop","ProfCookingStart","FlyProfCookingStart","ProfCookingEnd","FlyProfCookingEnd","WACurious","FlyWACurious","WAAlert","FlyWAAlert","WAInvestigate","FlyWAInvestigate","WAInteraction","FlyWAInteraction","WAThreaten","FlyWAThreaten","WAReact01","FlyWAReact01","WAReact02","FlyWAReact02","AdvFlyRollStart","FlyAdvFlyRollStart","AdvFlyRollEnd","FlyAdvFlyRollEnd","EmpBreathPrecast","FlyEmpBreathPrecast","EmpBreathPrecastChannel","FlyEmpBreathPrecastChannel","EmpBreathSpellCast","FlyEmpBreathSpellCast","EmpBreathSpellCastChannel","FlyEmpBreathSpellCastChannel","DracFlyBreathTakeoffStart","FlyDracFlyBreathTakeoffStart","DracFlyBreathTakeoffFinish","FlyDracFlyBreathTakeoffFinish","DracFlyBreath","FlyDracFlyBreath","DracFlyBreathLandStart","FlyDracFlyBreathLandStart","DracFlyBreathLandFinish","FlyDracFlyBreathLandFinish","DracAirDashLeft","FlyDracAirDashLeft","DracAirDashForward","FlyDracAirDashForward","DracAirDashBackward","FlyDracAirDashBackward","DracAirDashRight","FlyDracAirDashRight","LivingWorldProximityEnter","FlyLivingWorldProximityEnter","AdvFlyDownEnd","FlyAdvFlyDownEnd","LivingWorldProximityLoop","FlyLivingWorldProximityLoop","LivingWorldProximityLeave","FlyLivingWorldProximityLeave","EmpAirBarragePrecast","FlyEmpAirBarragePrecast","EmpAirBarragePrecastChannel","FlyEmpAirBarragePrecastChannel","EmpAirBarrageSpellCast","FlyEmpAirBarrageSpellCast","DracClawSwipeLeft","FlyDracClawSwipeLeft","DracClawSwipeRight","FlyDracClawSwipeRight","DracHoverIdle","FlyDracHoverIdle","DracHoverLeft","FlyDracHoverLeft","DracHoverRight","FlyDracHoverRight","DracHoverBackward","FlyDracHoverBackward","DracHoverForward","FlyDracHoverForward","DracAttackWings","FlyDracAttackWings","DracAttackTail","FlyDracAttackTail","AdvFlyStart","FlyAdvFlyStart","AdvFlyLand","FlyAdvFlyLand","AdvFlyLandRun","FlyAdvFlyLandRun","AdvFlyStrafeLeft","FlyAdvFlyStrafeLeft","AdvFlyStrafeRight","FlyAdvFlyStrafeRight","AdvFlyIdle","FlyAdvFlyIdle","AdvFlyRollRight","FlyAdvFlyRollRight","AdvFlyRollRightEnd","FlyAdvFlyRollRightEnd","AdvFlyRollLeft","FlyAdvFlyRollLeft","AdvFlyRollLeftEnd","FlyAdvFlyRollLeftEnd","AdvFlyFlap","FlyAdvFlyFlap","DracHoverDracClawSwipeLeft","FlyDracHoverDracClawSwipeLeft","DracHoverDracClawSwipeRight","FlyDracHoverDracClawSwipeRight","DracHoverDracAttackWings","FlyDracHoverDracAttackWings","DracHoverReadySpellOmni","FlyDracHoverReadySpellOmni","DracHoverSpellCastOmni","FlyDracHoverSpellCastOmni","DracHoverChannelSpellOmni","FlyDracHoverChannelSpellOmni","DracHoverReadySpellDirected","FlyDracHoverReadySpellDirected","DracHoverChannelSpellDirected","FlyDracHoverChannelSpellDirected","DracHoverSpellCastDirected","FlyDracHoverSpellCastDirected","DracHoverCastOutStrong","FlyDracHoverCastOutStrong","DracHoverBattleRoar","FlyDracHoverBattleRoar","DracHoverEmpBreathSpellCast","FlyDracHoverEmpBreathSpellCast","DracHoverEmpBreathSpellCastChannel","FlyDracHoverEmpBreathSpellCastChannel","LivingWorldTimeOfDayEnter","FlyLivingWorldTimeOfDayEnter","LivingWorldTimeOfDayLoop","FlyLivingWorldTimeOfDayLoop","LivingWorldTimeOfDayLeave","FlyLivingWorldTimeOfDayLeave","LivingWorldWeatherEnter","FlyLivingWorldWeatherEnter","LivingWorldWeatherLoop","FlyLivingWorldWeatherLoop","LivingWorldWeatherLeave","FlyLivingWorldWeatherLeave","AdvFlyDownStart","FlyAdvFlyDownStart","AdvFlyFlapBig","FlyAdvFlyFlapBig","DracHoverReadyUnarmed","FlyDracHoverReadyUnarmed","DracHoverAttackUnarmed","FlyDracHoverAttackUnarmed","DracHoverParryUnarmed","FlyDracHoverParryUnarmed","DracHoverCombatWound","FlyDracHoverCombatWound","DracHoverCombatCritical","FlyDracHoverCombatCritical","DracHoverAttackTail","FlyDracHoverAttackTail","Glide","FlyGlide","GlideEnd","FlyGlideEnd","DracClawSwipe","FlyDracClawSwipe","DracHoverDracClawSwipe","FlyDracHoverDracClawSwipe","AdvFlyFlapUp","FlyAdvFlyFlapUp","AdvFlySlowFall","FlyAdvFlySlowFall","AdvFlyFlapFoward","FlyAdvFlyFlapFoward","DracSpellCastWings","FlyDracSpellCastWings","DracHoverDracSpellCastWings","FlyDracHoverDracSpellCastWings","DracAirDashVertical","FlyDracAirDashVertical","DracAirDashRefresh","FlyDracAirDashRefresh","SkinningLoop","FlySkinningLoop","SkinningStart","FlySkinningStart","SkinningEnd","FlySkinningEnd","AdvFlyForwardGlideSlow","FlyAdvFlyForwardGlideSlow","AdvFlyForwardGlideFast","FlyAdvFlyForwardGlideFast","AdvFlySecondFlapUp","FlyAdvFlySecondFlapUp","FloatIdle","FlyFloatIdle","FloatWalk","FlyFloatWalk","CinematicTalk","FlyCinematicTalk","CinematicWAGuardEmoteSlam01","FlyCinematicWAGuardEmoteSlam01","WABlowHorn","FlyWABlowHorn","MountExtraWide","FlyMountExtraWide","WA2HIdle","FlyWA2HIdle","HerbalismLoop","FlyHerbalismLoop","CookingLoop","FlyCookingLoop","WAWeaponSharpenNoSheathe","FlyWAWeaponSharpenNoSheathe","CinematicDeath","FlyCinematicDeath","CinematicDeathPose","FlyCinematicDeathPose","EmpSlamPrecast","FlyEmpSlamPrecast","EmpSlamPrecastChannel","FlyEmpSlamPrecastChannel","EmpSlamSpellCast","FlyEmpSlamSpellCast","Climb","FlyClimb","ClimbStart","FlyClimbStart","ClimbEnd","FlyClimbEnd","MountLeanLeft","FlyMountLeanLeft","MountLeanRight","FlyMountLeanRight","MountDive","FlyMountDive","MountCrouch","FlyMountCrouch","WAShovelLoop","FlyWAShovelLoop","EmoteTalkFrustrated","FlyEmoteTalkFrustrated"];t.getAnimationName=e=>e in r?r[e]:"UnknownAnim_"+e},6500:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseCM2File=function(e){let t=new n.BinaryReader(e);if(1129132614!=t.readUInt32LE())throw new Error("Encountered wrong magic number. File data is probably not CM2 data?");const r=t.readUInt32LE();if(1e3!=r)throw new Error("Incompatible version encountered in CM2. Supported versions are: 1000. Encountered: "+r);const i=t.readUInt32LE(),s=t.readUInt32LE(),F=t.readUInt32LE(),C=t.readUInt32LE(),w=t.readUInt32LE(),S=t.readUInt32LE(),M=t.readUInt32LE(),A=t.readUInt32LE(),E=t.readUInt32LE(),D=t.readUInt32LE(),T=t.readUInt32LE(),k=t.readUInt32LE(),B=t.readUInt32LE(),L=t.readUInt32LE(),P=t.readUInt32LE(),O=t.readUInt32LE(),I=t.readUInt32LE(),U=t.readUInt32LE(),W=t.readUInt32LE(),R=t.readUInt32LE(),z=t.readUInt32LE(),V=t.readUInt32LE(),j=t.readUInt32LE(),G=t.readUInt32LE(),N=t.readUInt32LE(),H=t.readUInt32LE(),q=t.readUInt32LE();let Z;const X=t.readRemainingBytes();if(Z=(0,a.inflate)(X),Z.length<q)throw new Error("Compressed data appears to be smaller than expected? Received: "+Z.length+" expected: "+q);t=new n.BinaryReader(Z.buffer),t.seek(P);const Y=(0,o.readArray)(t,(e=>e.readUInt16LE()));t.seek(L);const K=(0,o.readArray)(t,u);t.seek(z);const J=(0,o.readArray)(t,(e=>e.readInt16LE()));t.seek(R);const Q=(0,o.readArray)(t,g);t.seek(S);const $=(0,o.readArray)(t,(e=>e.readInt16LE()));t.seek(M);const ee=(0,o.readArray)(t,(e=>e.readInt16LE()));t.seek(w);const te=(0,o.readArray)(t,d);t.seek(V);const re=(0,o.readArray)(t,y);t.seek(B);const ae=(0,o.readArray)(t,(e=>e.readUInt16LE()));t.seek(E);const ne=(0,o.readArray)(t,f);t.seek(G);const oe=(0,o.readArray)(t,(e=>e.readInt16LE()));t.seek(j);const ie=(0,o.readArray)(t,v);t.seek(N);const se=(0,o.readArray)(t,_);t.seek(H);const le=(0,o.readArray)(t,b);t.seek(F);const ue=(0,o.readArray)(t,(e=>e.readUInt16LE()));t.seek(C);const de=(0,o.readArray)(t,c);t.seek(T);const ce=(0,o.readArray)(t,(e=>e.readInt16LE()));t.seek(k);const he=(0,o.readArray)(t,(e=>e.readInt16LE()));t.seek(D);const fe=(0,o.readArray)(t,m);t.seek(W);const me=(0,o.readArray)(t,(e=>e.readInt16LE()));t.seek(U);const pe=(0,o.readArray)(t,p);t.seek(A);const ge=(0,o.readArray)(t,h);t.seek(I);const ye=(0,o.readArray)(t,(e=>e.readInt16LE()));t.seek(O);const xe=(0,o.readArray)(t,x);t.seek(s);return{flags:i,animationLookup:Y,animations:K,attachmentIdLookup:J,attachments:Q,boneCombos:$,boneIdLookup:ee,bones:te,colors:re,globalLoops:ae,materials:ne,particleEmitterGeosets:oe,particleEmitters:ie,particles:se,ribbonEmitters:le,skinTriangles:ue,submeshes:de,textureCombos:ce,textureIdLookup:he,textures:fe,textureTransformCombos:me,textureTransforms:pe,textureUnits:ge,textureWeightCombos:ye,textureWeights:xe,vertices:(0,o.readArray)(t,l)}},t.parseCM2BoneFile=function(e){let t;t=(0,a.inflate)(e);var r=new n.BinaryReader(t);return{boneIds:(0,o.readArray)(r,(e=>e.readUInt16LE())),boneOffsetMatrices:(0,o.readArray)(r,o.readFloat44)}};const a=r(1668),n=r(9266),o=r(4337);function i(e,t){return{keys:(0,o.readArray)(e,(e=>e.readInt16LE())),values:(0,o.readArray)(e,t)}}function s(e,t){const r={interpolationType:e.readInt16LE(),globalSequence:e.readInt16LE(),animations:(0,o.readArray)(e,(e=>function(e,t){const r={timeStamps:(0,o.readArray)(e,(e=>e.readInt32LE())),values:(0,o.readArray)(e,t)};return r}(e,t)))};return r}function l(e){return{position:(0,o.readFloat3)(e),normal:(0,o.readFloat3)(e),texCoords1:(0,o.readFloat2)(e),texCoords2:(0,o.readFloat2)(e),boneWeights:[e.readUInt8(),e.readUInt8(),e.readUInt8(),e.readUInt8()],boneIndices:[e.readUInt8(),e.readUInt8(),e.readUInt8(),e.readUInt8()]}}function u(e){return{id:e.readUInt16LE(),variationIndex:e.readUInt16LE(),duration:e.readUInt32LE(),flags:e.readUInt32LE(),frequency:e.readUInt16LE(),blendTimeIn:e.readUInt16LE(),blendTimeOut:e.readUInt16LE(),extentBox:(0,o.readAABB)(e),variationNext:e.readInt16LE(),aliasNext:e.readUInt16LE()}}function d(e){return{keyBoneId:e.readInt32LE(),flags:e.readUInt32LE(),parentBoneId:e.readInt16LE(),subMeshId:e.readInt16LE(),boneNameCRC:e.readUInt32LE(),pivot:(0,o.readFloat3)(e),translation:s(e,o.readFloat3),rotation:s(e,o.readQuaternion),scale:s(e,o.readFloat3)}}function c(e){return{submeshId:e.readUInt16LE(),level:e.readUInt16LE(),vertexStart:e.readUInt16LE(),vertexCount:e.readUInt16LE(),triangleStart:e.readUInt16LE(),triangleCount:e.readUInt16LE(),centerBoneIndex:e.readUInt16LE(),centerPosition:(0,o.readFloat3)(e),sortCenterPosition:(0,o.readFloat3)(e),sortRadius:e.readFloatLE()}}function h(e){return{flags:e.readUInt8(),priority:e.readUInt8(),shaderId:e.readUInt16LE(),skinSectionIndex:e.readUInt16LE(),flags2:e.readUInt16LE(),colorIndex:e.readInt16LE(),materialIndex:e.readUInt16LE(),materialLayer:e.readUInt16LE(),textureCount:e.readUInt16LE(),textureComboIndex:e.readUInt16LE(),textureCoordComboIndex:e.readUInt16LE(),textureWeightComboIndex:e.readUInt16LE(),textureTransformComboIndex:e.readUInt16LE()}}function f(e){return{flags:e.readUInt16LE(),blendingMode:e.readUInt16LE()}}function m(e){return{type:e.readInt32LE(),flags:e.readUInt32LE(),textureId:e.readUInt32LE()}}function p(e){return{translation:s(e,o.readFloat3),rotation:s(e,o.readFloat4),scaling:s(e,o.readFloat3)}}function g(e){return{id:e.readInt32LE(),bone:e.readInt32LE(),position:(0,o.readFloat3)(e)}}function y(e){return{color:s(e,o.readFloat3),alpha:s(e,(e=>e.readUInt16LE()))}}function x(e){return{weights:s(e,(e=>e.readUInt16LE()))}}function v(e){return{particleId:e.readInt32LE(),flags:e.readUInt32LE(),position:(0,o.readFloat3)(e),bone:e.readInt16LE(),texture:e.readInt16LE(),blendingType:e.readUInt8(),emitterType:e.readUInt8(),particleColorIndex:e.readUInt16LE(),textureTileRotation:e.readUInt16LE(),textureDimensionsRows:e.readUInt16LE(),textureDimensionsColumns:e.readUInt16LE(),lifespanVary:e.readFloatLE(),emissionRateVary:e.readFloatLE(),colorTrack:i(e,o.readFloat3),alphaTrack:i(e,(e=>e.readUInt16LE())),scaleTrack:i(e,o.readFloat2),scaleVary:(0,o.readFloat2)(e),headCellTrack:i(e,(e=>e.readUInt16LE())),tailCellTrack:i(e,(e=>e.readUInt16LE())),tailLength:e.readFloatLE(),twinkleSpeed:e.readFloatLE(),twinklePercent:e.readFloatLE(),twinkleScale:(0,o.readFloat2)(e),burstMultiplier:e.readFloatLE(),drag:e.readFloatLE(),baseSpin:e.readFloatLE(),baseSpinVary:e.readFloatLE(),spin:e.readFloatLE(),spinVary:e.readFloatLE(),tumbleModelRotationSpeedMin:(0,o.readFloat3)(e),tumbleModelRotationSpeedMax:(0,o.readFloat3)(e),windVector:(0,o.readFloat3)(e),windTime:e.readFloatLE(),followSpeed1:e.readFloatLE(),followScale1:e.readFloatLE(),followSpeed2:e.readFloatLE(),followScale2:e.readFloatLE(),multiTextureParamX:(0,o.readFloat2)(e),multiTextureParam0:[(0,o.readFloat2)(e),(0,o.readFloat2)(e)],multiTextureParam1:[(0,o.readFloat2)(e),(0,o.readFloat2)(e)],emissionSpeed:s(e,(e=>e.readFloatLE())),speedVariation:s(e,(e=>e.readFloatLE())),verticalRange:s(e,(e=>e.readFloatLE())),horizontalRange:s(e,(e=>e.readFloatLE())),gravity:s(e,o.readFloat3),lifespan:s(e,(e=>e.readFloatLE())),emissionAreaLength:s(e,(e=>e.readFloatLE())),emissionAreaWidth:s(e,(e=>e.readFloatLE())),zSource:s(e,(e=>e.readFloatLE())),emissionRate:s(e,(e=>e.readFloatLE())),splinePoints:(0,o.readArray)(e,o.readFloat3),enabledIn:s(e,(e=>e.readUInt8()))}}function _(e){return{zSource:e.readFloatLE(),colorMult:e.readFloatLE(),alphaMult:e.readFloatLE(),alphaCutoff:i(e,(e=>e.readUInt16LE()))}}function b(e){return{ribbonId:e.readInt32LE(),boneIndex:e.readInt32LE(),position:(0,o.readFloat3)(e),edgesPerSecond:e.readFloatLE(),edgeLifetime:e.readFloatLE(),gravity:e.readFloatLE(),textureRows:e.readInt16LE(),textureCols:e.readInt16LE(),priorityPlane:e.readInt16LE(),texSlotTrack:s(e,(e=>e.readUInt16LE())),visibilityTrack:s(e,(e=>e.readUInt8())),textureIndices:(0,o.readArray)(e,(e=>e.readInt16LE())),materialIndices:(0,o.readArray)(e,(e=>e.readInt16LE())),colorTrack:s(e,o.readFloat3),alphaTrack:s(e,(e=>e.readUInt16LE())),heightAboveTrack:s(e,(e=>e.readFloatLE())),heightBelowTrack:s(e,(e=>e.readFloatLE()))}}},6604:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Float44=t.Float33=void 0;const a=r(7518),n="undefined"!=typeof Float32Array?Float32Array:Array;var o,i;!function(e){function t(e){if(e)return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e;const t=new n(9);return n!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}e.create=function(...e){const t=new n(9);for(let r=0;r<e.length&&r<9;r++)t[r]=e[r];return t},e.identity=t,e.getRotationMatrix=function(e,r){return(r=r||t())[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r},e.getColumn=function(e,t,r){return(r=r||a.Float3.zero())[0]=e[3*t],r[1]=e[3*t+1],r[2]=e[3*t+2],r},e.fromQuat=function(e,r){return(r=r||t())[0]=1-2*(e[1]*e[1]-e[2]*e[2]),r[1]=2*(e[1]*e[0]+e[3]*e[2]),r[2]=2*(e[2]*e[0]-e[3]*e[1]),r[3]=2*(e[1]*e[0]-e[3]*e[2]),r[4]=1-2*(e[0]*e[0]-e[2]*e[2]),r[5]=2*(e[2]*e[1]+e[3]*e[0]),r[6]=2*(e[2]*e[0]+e[3]*e[1]),r[7]=2*(e[2]*e[1]-e[3]*e[0]),r[8]=1-2*(e[0]*e[0]-e[1]*e[1]),r},e.copy=function(e,r){return(r=r||t())[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r},e.multiply=function(e,r,a){a=a||t();const n=e[0],o=e[1],i=e[2],s=e[3],l=e[4],u=e[5],d=e[6],c=e[7],h=e[8],f=r[0],m=r[1],p=r[2],g=r[3],y=r[4],x=r[5],v=r[6],_=r[7],b=r[8];return a[0]=f*n+m*s+p*d,a[1]=f*o+m*l+p*c,a[2]=f*i+m*u+p*h,a[3]=g*n+y*s+x*d,a[4]=g*o+y*l+x*c,a[5]=g*i+y*u+x*h,a[6]=v*n+_*s+b*d,a[7]=v*o+_*l+b*c,a[8]=v*i+_*u+b*h,a},e.scale=function(e,r,a){return(a=a||t())[0]=e[0]*r,a[1]=e[1]*r,a[2]=e[2]*r,a[3]=e[3]*r,a[4]=e[4]*r,a[5]=e[5]*r,a[6]=e[6]*r,a[7]=e[7]*r,a[8]=e[8]*r,a},e.transformDir=function(e,t,r){let a=e[0],n=e[1],o=e[2];return r[0]=a*t[0]+n*t[3]+o*t[6],r[1]=a*t[1]+n*t[4]+o*t[7],r[2]=a*t[2]+n*t[5]+o*t[8],r}}(o||(t.Float33=o={})),function(e){function t(e){if(e)return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e;const t=new n(16);return n!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}e.identity=t,e.create=function(...e){const t=new n(16);for(let r=0;r<e.length&&r<16;r++)t[r]=e[r];return t},e.copy=function(e,r){return(r=r||t())[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},e.tranpose=function(e,r){if(e===(r=r||t())){let t=r[1];return e[1]=r[4],e[4]=t,t=r[2],e[2]=r[8],e[8]=t,t=e[3],e[3]=r[12],e[12]=t,t=e[6],e[6]=r[9],e[9]=t,t=e[7],e[7]=r[13],e[13]=t,t=e[11],e[11]=r[14],e[14]=t,r}return e[0]=r[0],e[1]=r[4],e[2]=r[8],e[3]=r[12],e[4]=r[1],e[5]=r[5],e[6]=r[9],e[7]=r[13],e[8]=r[2],e[9]=r[6],e[10]=r[10],e[11]=r[14],e[12]=r[3],e[13]=r[7],e[14]=r[11],e[15]=r[15],e},e.invert=function(e,r){r=r||t();const a=e[0],n=e[1],o=e[2],i=e[3],s=e[4],l=e[5],u=e[6],d=e[7],c=e[8],h=e[9],f=e[10],m=e[11],p=e[12],g=e[13],y=e[14],x=e[15];var v=a*l-n*s,_=a*u-o*s,b=a*d-i*s,F=n*u-o*l,C=n*d-i*l,w=o*d-i*u,S=c*g-h*p,M=c*y-f*p,A=c*x-m*p,E=h*y-f*g,D=h*x-m*g,T=f*x-m*y,k=v*T-_*D+b*E+F*A-C*M+w*S;return k?(k=1/k,r[0]=(l*T-u*D+d*E)*k,r[1]=(o*D-n*T-i*E)*k,r[2]=(g*w-y*C+x*F)*k,r[3]=(f*C-h*w-m*F)*k,r[4]=(u*A-s*T-d*M)*k,r[5]=(a*T-o*A+i*M)*k,r[6]=(y*b-p*w-x*_)*k,r[7]=(c*w-f*b+m*_)*k,r[8]=(s*D-l*A+d*S)*k,r[9]=(n*A-a*D-i*S)*k,r[10]=(p*C-g*b+x*v)*k,r[11]=(h*b-c*C-m*v)*k,r[12]=(l*M-s*E-u*S)*k,r[13]=(a*E-n*M+o*S)*k,r[14]=(g*_-p*F-y*v)*k,r[15]=(c*F-h*_+f*v)*k,r):(t(r),r)},e.multiply=function(e,r,a){a=a||t();const n=e[0],o=e[1],i=e[2],s=e[3],l=e[4],u=e[5],d=e[6],c=e[7],h=e[8],f=e[9],m=e[10],p=e[11],g=e[12],y=e[13],x=e[14],v=e[15],_=r[0],b=r[1],F=r[2],C=r[3],w=r[4],S=r[5],M=r[6],A=r[7],E=r[8],D=r[9],T=r[10],k=r[11],B=r[12],L=r[13],P=r[14],O=r[15];return a[0]=_*n+b*l+F*h+C*g,a[1]=_*o+b*u+F*f+C*y,a[2]=_*i+b*d+F*m+C*x,a[3]=_*s+b*c+F*p+C*v,a[4]=w*n+S*l+M*h+A*g,a[5]=w*o+S*u+M*f+A*y,a[6]=w*i+S*d+M*m+A*x,a[7]=w*s+S*c+M*p+A*v,a[8]=E*n+D*l+T*h+k*g,a[9]=E*o+D*u+T*f+k*y,a[10]=E*i+D*d+T*m+k*x,a[11]=E*s+D*c+T*p+k*v,a[12]=B*n+L*l+P*h+O*g,a[13]=B*o+L*u+P*f+O*y,a[14]=B*i+L*d+P*m+O*x,a[15]=B*s+L*c+P*p+O*v,a},e.translate=function(e,r,a){return e===(a=a||t())?(a[12]=e[0]*r[0]+e[4]*r[1]+e[8]*r[2]+e[12],a[13]=e[1]*r[0]+e[5]*r[1]+e[9]*r[2]+e[13],a[14]=e[2]*r[0]+e[6]*r[1]+e[10]*r[2]+e[14],a[15]=e[3]*r[0]+e[7]*r[1]+e[11]*r[2]+e[15]):(a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a[4]=e[4],a[5]=e[5],a[6]=e[6],a[7]=e[7],a[8]=e[8],a[9]=e[9],a[10]=e[10],a[11]=e[11],a[12]=e[0]*r[0]+e[4]*r[1]+e[8]*r[2]+e[12],a[13]=e[1]*r[0]+e[5]*r[1]+e[9]*r[2]+e[13],a[14]=e[2]*r[0]+e[6]*r[1]+e[10]*r[2]+e[14],a[15]=e[3]*r[0]+e[7]*r[1]+e[11]*r[2]+e[15]),a},e.scale=function(e,r,a){(a=a||t())[0]=e[0]*r[0],a[1]=e[1]*r[0],a[2]=e[2]*r[0],a[3]=e[3]*r[0],a[4]=e[4]*r[1],a[5]=e[5]*r[1],a[6]=e[6]*r[1],a[7]=e[7]*r[1],a[8]=e[8]*r[2],a[9]=e[9]*r[2],a[10]=e[10]*r[2],a[11]=e[11]*r[2],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]},e.rotateX=function(e,r,a){e!==(a=a||t())&&(a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]);const n=Math.sin(r),o=Math.cos(r),i=e[4],s=e[5],l=e[6],u=e[7],d=e[8],c=e[9],h=e[10],f=e[11];return a[4]=i*o+d*n,a[5]=s*o+c*n,a[6]=l*o+h*n,a[7]=u*o+f*n,a[8]=d*o-i*n,a[9]=c*o-s*n,a[10]=h*o-l*n,a[11]=f*o-u*n,a},e.rotateY=function(e,r,a){e!==(a=a||t())&&(a[4]=e[4],a[5]=e[5],a[6]=e[6],a[7]=e[7],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]);const n=Math.sin(r),o=Math.cos(r),i=e[0],s=e[1],l=e[2],u=e[3],d=e[8],c=e[9],h=e[10],f=e[11];return a[0]=i*o-d*n,a[1]=s*o-c*n,a[2]=l*o-h*n,a[3]=u*o-f*n,a[8]=i*n+d*o,a[9]=s*n+c*o,a[10]=l*n+h*o,a[11]=u*n+f*o,a},e.rotateZ=function(e,r,a){e!==(a=a||t())&&(a[8]=e[8],a[9]=e[9],a[10]=e[10],a[11]=e[11],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]);const n=Math.sin(r),o=Math.cos(r),i=e[0],s=e[1],l=e[2],u=e[3],d=e[4],c=e[5],h=e[6],f=e[7];return a[0]=i*o+d*n,a[1]=s*o+c*n,a[2]=l*o+h*n,a[3]=u*o+f*n,a[4]=d*o-i*n,a[5]=c*o-s*n,a[6]=h*o-l*n,a[7]=f*o-u*n,a},e.createWithTranslation=function(e,r){return(r=r||t())[12]=e[0],r[13]=e[1],r[14]=e[2],r},e.fromQuat=function(e,r){r=r||t();const a=e[0],n=e[1],o=e[2],i=e[3],s=a+a,l=n+n,u=o+o,d=a*s,c=a*l,h=a*u,f=n*l,m=n*u,p=o*u,g=i*s,y=i*l,x=i*u;return r[0]=1-(f+p),r[1]=c+x,r[2]=h-y,r[3]=0,r[4]=c-x,r[5]=1-(d+p),r[6]=m+g,r[7]=0,r[8]=h+y,r[9]=m-g,r[10]=1-(d+f),r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},e.getTranslation=function(e,t){return(t=t||a.Float3.zero())[0]=e[12],t[1]=e[13],t[2]=e[14],t},e.transformPoint=function(e,t,r){r=r||a.Float3.zero();let n=e[0],o=e[1],i=e[2],s=t[3]*n+t[7]*o+t[11]*i+t[15];return s=s||1,r[0]=(t[0]*n+t[4]*o+t[8]*i+t[12])/s,r[1]=(t[1]*n+t[5]*o+t[9]*i+t[13])/s,r[2]=(t[2]*n+t[6]*o+t[10]*i+t[14])/s,r},e.transformDirection4=function(e,t,r){r=r||a.Float4.zero();const n=e[0],o=e[1],i=e[2],s=e[3];return r[0]=t[0]*n+t[4]*o+t[8]*i+t[12]*s,r[1]=t[1]*n+t[5]*o+t[9]*i+t[13]*s,r[2]=t[2]*n+t[6]*o+t[10]*i+t[14]*s,r[3]=t[3]*n+t[7]*o+t[11]*i+t[15]*s,r},e.transformDirection3=function(e,t,r){let a=e[0],n=e[1],o=e[2],i=t[3]*a+t[7]*n+t[11]*o+t[15];return i=i||1,r[0]=(t[0]*a+t[4]*n+t[8]*o+t[12])/i,r[1]=(t[1]*a+t[5]*n+t[9]*o+t[13])/i,r[2]=(t[2]*a+t[6]*n+t[10]*o+t[14])/i,r},e.transformDirection3_1=function(e,t,r){r=r||a.Float3.zero();const n=e[0],o=e[1],i=e[2];return r[0]=t[0]*n+t[4]*o+t[8]*i+t[12],r[1]=t[1]*n+t[5]*o+t[9]*i+t[13],r[2]=t[2]*n+t[6]*o+t[10]*i+t[14],r},e.transformDirection3_0=function(e,t,r){r=r||a.Float3.zero();const n=e[0],o=e[1],i=e[2];return r[0]=t[0]*n+t[4]*o+t[8]*i,r[1]=t[1]*n+t[5]*o+t[9]*i,r[2]=t[2]*n+t[6]*o+t[10]*i,r},e.perspective=function(t,r,a,n,o){o=o||e.identity();const i=1/Math.tan(t/2);if(o[0]=i/r,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=i,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,null!==n&&n!==1/0){const e=1/(a-n);o[10]=(n+a)*e,o[14]=2*n*a*e}else o[10]=-1,o[14]=-2*a;return o},e.getColumn4=function(e,t){return a.Float4.create(e[4*t+0],e[4*t+1],e[4*t+2],0)},e.getColumn3=function(e,t){return a.Float3.create(e[4*t+0],e[4*t+1],e[4*t+2])},e.setColumn=function(e,t,r){for(let a=0;a<4;a++)e[4*t+a]=r[a]},e.lookAt=function(e,t,r,n){const o=a.Float3.normalize(a.Float3.subtract(e,t)),i=a.Float3.normalize(a.Float3.cross(r,o)),s=a.Float3.normalize(a.Float3.cross(o,i));return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=0,n[4]=s[0],n[5]=s[1],n[6]=s[2],n[7]=0,n[8]=o[0],n[9]=o[1],n[10]=o[2],n[11]=0,n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n}}(i||(t.Float44=i={}))},6677:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BinaryReader=void 0,t.BinaryReader=class{constructor(e){this.dataView=new DataView(e),this.offset=0}readBool(){const e=0!=this.dataView.getUint8(this.offset);return this.offset+=1,e}readUInt8(){const e=this.dataView.getUint8(this.offset);return this.offset+=1,e}readInt8(){const e=this.dataView.getInt8(this.offset);return this.offset+=1,e}readUInt16BE(){const e=this.dataView.getUint16(this.offset);return this.offset+=2,e}readUInt16LE(){const e=this.dataView.getUint16(this.offset,!0);return this.offset+=2,e}readInt16BE(){const e=this.dataView.getInt16(this.offset);return this.offset+=2,e}readInt16LE(){const e=this.dataView.getInt16(this.offset,!0);return this.offset+=2,e}readUInt32BE(){const e=this.dataView.getUint32(this.offset);return this.offset+=4,e}readUInt32LE(){const e=this.dataView.getUint32(this.offset,!0);return this.offset+=4,e}readInt32BE(){const e=this.dataView.getInt32(this.offset,!0);return this.offset+=4,e}readInt32LE(){const e=this.dataView.getInt32(this.offset,!0);return this.offset+=4,e}readFloatBE(){const e=this.dataView.getFloat32(this.offset);return this.offset+=4,e}readFloatLE(){const e=this.dataView.getFloat32(this.offset,!0);return this.offset+=4,e}readRemainingBytes(){return new Uint8Array(this.dataView.buffer,this.offset)}seek(e){this.offset=e}}},6919:function(e,t,r){"use strict";var a=this&&this.__awaiter||function(e,t,r,a){return new(r||(r=Promise))((function(n,o){function i(e){try{l(a.next(e))}catch(e){o(e)}}function s(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,s)}l((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.WoWModelServerDataProvider=void 0;const n=r(6466),o=r(3474);t.WoWModelServerDataProvider=class{constructor(e,t){this.rootPath=e,this.progress=t}loadBoneFile(e){return a(this,void 0,void 0,(function*(){const t=`${this.rootPath}/modelviewer/bone/${e}.cbone`;try{const e=yield fetch(t);if(!e.ok)return null;const r=yield e.arrayBuffer();return(0,n.parseCM2BoneFile)(r)}catch(e){return null}}))}loadModelFile(e){return a(this,void 0,void 0,(function*(){const t=`${this.rootPath}/modelviewer/models/${e}.cm2`;try{const e=yield fetch(t);if(!e.ok)return null;const r=yield e.arrayBuffer();return(0,n.parseCM2File)(r)}catch(e){return null}}))}loadWorldModelFile(e){return a(this,void 0,void 0,(function*(){const t=`${this.rootPath}/modelviewer/models/${e}.cwmo`;try{const e=yield fetch(t);if(!e.ok)return null;const r=yield e.arrayBuffer();return(0,o.parseCWMOFile)(r)}catch(e){return null}}))}loadCharacterCustomizationMetadata(e){return a(this,void 0,void 0,(function*(){const t=`${this.rootPath}/modelviewer/metadata/charactercustomization/${e}.json`;try{const e=yield fetch(t);return e.ok?yield e.json():null}catch(e){return null}}))}loadCharacterMetadata(e){return a(this,void 0,void 0,(function*(){const t=`${this.rootPath}/modelviewer/metadata/character/${e}.json`;try{const e=yield fetch(t);return e.ok?yield e.json():null}catch(e){return null}}))}loadItemMetadata(e){return a(this,void 0,void 0,(function*(){const t=`${this.rootPath}/modelviewer/metadata/item/${e}.json`;try{const e=yield fetch(t);return e.ok?yield e.json():null}catch(e){return null}}))}loadLiquidTypeMetadata(e){return a(this,void 0,void 0,(function*(){const t=`${this.rootPath}/modelviewer/metadata/liquidtype/${e}.json`;try{const e=yield fetch(t);return e.ok?yield e.json():null}catch(e){return null}}))}loadTexture(e){return new Promise(((t,r)=>{const a=`${this.rootPath}/modelviewer/textures/${e}.webp`,n=new XMLHttpRequest;n.open("GET",a,!0),n.responseType="arraybuffer",n.onload=()=>{const e=new Blob([n.response]);t(window.URL.createObjectURL(e))},n.onprogress=t=>{this.progress&&this.progress.update(e,Math.floor(t.loaded/t.total*100))},n.onloadstart=()=>{this.progress&&this.progress.update(e,0)},n.onerror=e=>{t(null)},n.send()}))}loadItemvisualMetadata(e){return a(this,void 0,void 0,(function*(){const t=`${this.rootPath}/modelviewer/metadata/itemvisual/${e}.json`;try{const e=yield fetch(t);return e.ok?yield e.json():null}catch(e){return null}}))}loadTextureVariationsMetadata(e){return a(this,void 0,void 0,(function*(){const t=`${this.rootPath}/modelviewer/metadata/texturevariations/${e}.json`;try{const e=yield fetch(t);return e.ok?yield e.json():null}catch(e){return null}}))}useProgressReporter(e){this.progress=e}}},6940:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(4510),t),n(r(9551),t),n(r(8803),t),n(r(8521),t)},7083:(e,t,r)=>{"use strict";const a=r(1447),n=r(9805),o=r(1996),i=r(4674),s=r(4442),l=r(7414),u=Object.prototype.toString,{Z_NO_FLUSH:d,Z_FINISH:c,Z_OK:h,Z_STREAM_END:f,Z_NEED_DICT:m,Z_STREAM_ERROR:p,Z_DATA_ERROR:g,Z_MEM_ERROR:y}=r(9681);function x(e){this.options=n.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;let r=a.inflateInit2(this.strm,t.windowBits);if(r!==h)throw new Error(i[r]);if(this.header=new l,a.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=o.string2buf(t.dictionary):"[object ArrayBuffer]"===u.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=a.inflateSetDictionary(this.strm,t.dictionary),r!==h)))throw new Error(i[r])}function v(e,t){const r=new x(t);if(r.push(e),r.err)throw r.msg||i[r.err];return r.result}x.prototype.push=function(e,t){const r=this.strm,n=this.options.chunkSize,i=this.options.dictionary;let s,l,x;if(this.ended)return!1;for(l=t===~~t?t:!0===t?c:d,"[object ArrayBuffer]"===u.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(0===r.avail_out&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),s=a.inflate(r,l),s===m&&i&&(s=a.inflateSetDictionary(r,i),s===h?s=a.inflate(r,l):s===g&&(s=m));r.avail_in>0&&s===f&&r.state.wrap>0&&0!==e[r.next_in];)a.inflateReset(r),s=a.inflate(r,l);switch(s){case p:case g:case m:case y:return this.onEnd(s),this.ended=!0,!1}if(x=r.avail_out,r.next_out&&(0===r.avail_out||s===f))if("string"===this.options.to){let e=o.utf8border(r.output,r.next_out),t=r.next_out-e,a=o.buf2string(r.output,e);r.next_out=t,r.avail_out=n-t,t&&r.output.set(r.output.subarray(e,e+t),0),this.onData(a)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(s!==h||0!==x){if(s===f)return s=a.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(0===r.avail_in)break}}return!0},x.prototype.onData=function(e){this.chunks.push(e)},x.prototype.onEnd=function(e){e===h&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},e.exports.Inflate=x,e.exports.inflate=v,e.exports.inflateRaw=function(e,t){return(t=t||{}).raw=!0,v(e,t)},e.exports.ungzip=v,e.exports.constants=r(9681)},7229:function(e,t,r){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WMOModel=void 0;const n=r(8219),o=r(9266),i=r(2462),s=r(8521),l=r(2690),u=a(r(8344)),d=a(r(8389)),c=a(r(8049)),h=a(r(5996)),f=r(5510);class m extends s.WorldPositionedObject{constructor(e){super(),this.isModelDataLoaded=!1,this.isTexturesLoaded=!1,this.fileId=e,this.doodadSetId=0,this.lodGroupMap=[],this.loadedTextures={},this.groupDoodads={},this.portalsByGroup={},this.groupLiquids={},this.groupMaterials={},this.activeGroups=[],this.activeDoodads=[],this.transposeInvModelMatrix=n.Float44.identity(),this.localCamera=n.Float3.zero(),this.localCameraFrustrum=n.Frustrum.zero()}initialize(e){super.initialize(e),this.shaderProgram=this.engine.getShaderProgram("WMO",d.default,u.default),this.portalShader=this.engine.getShaderProgram("WMOPortal",h.default,c.default),this.engine.getWMOModelFile(this.fileId).then(this.onModelLoaded.bind(this))}update(e){if(super.update(e),this.isLoaded&&!this.isDisposing){n.Float44.transformDirection3(this.engine.cameraPosition,this.invWorldModelMatrix,this.localCamera),n.Frustrum.copy(this.engine.cameraFrustrum,this.localCameraFrustrum),n.Frustrum.transformSelf(this.localCameraFrustrum,this.invWorldModelMatrix),this.findVisibleGroupsAndDoodads(),this.setLODGroupsForVisibleGroups();for(let t=0;t<this.activeDoodads.length;t++)this.activeDoodads[t].update(e);for(const t of this.activeGroups)for(const r of this.groupLiquids[t])r.update(e)}}draw(){if(this.isLoaded&&!this.isDisposing){for(let e=0;e<this.activeGroups.length;e++){const t=this.activeGroups[e];this.drawGroup(t);for(const e of this.groupLiquids[t])e.draw()}for(let e=0;e<this.activeDoodads.length;e++)this.activeDoodads[e].draw();this.engine.debugPortals&&this.drawPortals()}}dispose(){super.dispose();for(const e in this.groupDoodads)for(const t of this.groupDoodads[e])t.dispose();if(this.groupDoodads=null,this.modelData=null,this.groupVaos)for(let e=0;e<this.groupVaos.length;e++)this.groupVaos[e]=null;this.groupVaos=null,this.shaderProgram=null,this.groupDoodads=null,this.portalsByGroup=null,this.activeGroups=null,this.activeDoodads=null,this.transposeInvModelMatrix=null,this.localCamera=null,this.localCameraFrustrum=null}get isLoaded(){return this.isModelDataLoaded&&this.isTexturesLoaded&&this.children.every((e=>e.isLoaded))}onModelLoaded(e){this.modelData=e,null!=this.modelData?this.isDisposing||(this.parent||this.resizeForBounds(),this.setupPortals(),this.makeLodMap(),this.loadTextures(),this.loadDoodads(),this.loadLiquids(),this.setupGraphics(),this.setupPortalGraphics(),this.isModelDataLoaded=!0):this.dispose()}uploadVertexDataForGroup(e){const t=this.modelData.groups[e],r=56,a=this.engine.graphics.createVertexDataBuffer([{index:this.shaderProgram.getAttribLocation("a_position"),size:3,type:n.BufferDataType.Float,normalized:!1,stride:r,offset:0},{index:this.shaderProgram.getAttribLocation("a_normal"),size:3,type:n.BufferDataType.Float,normalized:!1,stride:r,offset:12},{index:this.shaderProgram.getAttribLocation("a_color1"),size:4,type:n.BufferDataType.UInt8,normalized:!1,stride:r,offset:24},{index:this.shaderProgram.getAttribLocation("a_color2"),size:4,type:n.BufferDataType.UInt8,normalized:!1,stride:r,offset:28},{index:this.shaderProgram.getAttribLocation("a_texCoord1"),size:2,type:n.BufferDataType.Float,normalized:!1,stride:r,offset:32},{index:this.shaderProgram.getAttribLocation("a_texCoord2"),size:2,type:n.BufferDataType.Float,normalized:!1,stride:r,offset:40},{index:this.shaderProgram.getAttribLocation("a_texCoord3"),size:2,type:n.BufferDataType.Float,normalized:!1,stride:r,offset:48}],!0),i=t.vertices.length,s=new Uint8Array(r*i),l=new o.BinaryWriter(s.buffer),u=t.vertexColors.length/t.vertices.length;if(u!=Math.floor(u))throw new Error("Unexpected situation. Number of Vertex Colors is not cleanly divisible by number of vertices.");const d=t.uvList.length/t.vertices.length;if(d!=Math.floor(d))throw new Error("Unexpected situation. Number of UV coordinates is not cleanly divisible by number of vertices.");for(let e=0;e<t.vertices.length;e++)l.writeFloatLE(t.vertices[e][0]),l.writeFloatLE(t.vertices[e][1]),l.writeFloatLE(t.vertices[e][2]),l.writeFloatLE(t.normals[e][0]),l.writeFloatLE(t.normals[e][1]),l.writeFloatLE(t.normals[e][2]),l.writeUInt8(u>0?t.vertexColors[e][0]:0),l.writeUInt8(u>0?t.vertexColors[e][1]:0),l.writeUInt8(u>0?t.vertexColors[e][2]:0),l.writeUInt8(u>0?t.vertexColors[e][3]:255),l.writeUInt8(u>1?t.vertexColors[e+t.vertices.length][0]:0),l.writeUInt8(u>1?t.vertexColors[e+t.vertices.length][1]:0),l.writeUInt8(u>1?t.vertexColors[e+t.vertices.length][2]:0),l.writeUInt8(u>1?t.vertexColors[e+t.vertices.length][3]:255),l.writeFloatLE(d>0?t.uvList[e][0]:0),l.writeFloatLE(d>0?t.uvList[e][1]:0),l.writeFloatLE(d>1?t.uvList[e+t.vertices.length][0]:0),l.writeFloatLE(d>1?t.uvList[e+t.vertices.length][1]:0),l.writeFloatLE(d>2?t.uvList[e+2*t.vertices.length][0]:0),l.writeFloatLE(d>2?t.uvList[e+2*t.vertices.length][1]:0);return a.setData(s),a}resizeForBounds(){this.engine.sceneCamera.resizeForBoundingBox(this.modelData.boundingBox)}loadDoodads(){const e=this.getDoodadSetRefs();for(let t=0;t<this.modelData.groups.length;t++){const r=this.modelData.groups[t];this.groupDoodads[t]=[];const a=r.doodadReferences;for(let r of a)if(-1!==e.indexOf(r)){const e=this.modelData.doodadDefs[r],a=this.modelData.doodadIds[e.nameOffset];if(0===a)continue;const o=new n.M2Model(a);o.parent=this;const i=n.Float3.create(e.scale,e.scale,e.scale);o.setModelMatrix(e.position,e.rotation,i),o.initialize(this.engine),this.groupDoodads[t].push(o),this.children.push(o)}}}loadTextures(){const e=[];this.loadedTextures[0]=this.engine.getUnknownTexture();for(let t=0;t<this.modelData.groups.length;t++){const r=this.modelData.groups[t];for(let t=0;t<r.batches.length;t++){const a=r.batches[t],n=this.modelData.materials[a.materialId];for(const t of[n.texture1,n.texture2,n.texture3])if(0!==t){const r=(n.flags&i.WoWWorldModelMaterialMaterialFlags.ClampS)>0,a=(n.flags&i.WoWWorldModelMaterialMaterialFlags.ClampT)>0,o=this.engine.getTexture(t,{clampS:r,clampT:a}).then((e=>{this.isDisposing||(this.loadedTextures[t]=e)}));e.push(o)}}}Promise.all(e).then((()=>{this.setupMaterials(),this.isTexturesLoaded=!0}))}loadLiquids(){for(let e=0;e<this.modelData.groups.length;e++){this.groupLiquids[e]=[];const t=this.modelData.groups[e];for(const r of t.liquidData){const a=new f.WMOLiquid(r,t,this.modelData.flags);a.parent=this,a.updateModelMatrixFromParent(),a.initialize(this.engine),this.children.push(a),this.groupLiquids[e].push(a)}}}getDoodadSetRefs(){let e=this.modelData.doodadSets[0];this.doodadSetId>this.modelData.doodadSets.length&&(this.doodadSetId=0);let t=Array.from({length:e.count},((t,r)=>r+e.startIndex));if(0!=this.doodadSetId){const e=this.modelData.doodadSets[this.doodadSetId];t.concat(Array.from({length:e.count},((t,r)=>r+e.startIndex)))}return t}makeLodMap(){this.activeGroups=Array(this.modelData.groupInfo.length),this.lodGroupMap=Array(3*this.modelData.groupInfo.length);const e=this.modelData.groupInfo.length,t=[];for(let r=0;r<this.lodGroupMap.length;r++){if(r<e){this.modelData.groupInfo[r%e].flags&i.WowWorldModelGroupFlags.Lod||(t.push(r+e),t.push(r+e+e)),this.lodGroupMap[r]=r%e;continue}if(t.indexOf(r)>-1){this.lodGroupMap[r]=r%e;continue}const a=t.filter((e=>e<r)).length;this.lodGroupMap[r]=r-a}}setupPortals(){for(let e=0;e<this.modelData.groupInfo.length;e++)this.portalsByGroup[e]=[];this.portalData=Array(this.modelData.portals.length);for(let e=0;e<this.modelData.portals.length;e++){const t=this.modelData.portals[e];let r=this.modelData.portalVertices.slice(t.startVertex,t.startVertex+t.vertexCount);const a=n.Plane.majorAxis(t.plane),o=n.Float3.zero();for(let e=0;e<r.length;e++)n.Float3.add(r[e],o,o);n.Float3.scale(o,1/r.length,o);const i=n.Float3.projectToVec2(o,a);r=r.sort(((e,t)=>{const r=n.Float2.subtract(i,n.Float3.projectToVec2(e,a)),o=n.Float2.subtract(i,n.Float3.projectToVec2(t,a));return Math.atan2(r[1],r[0])-Math.atan2(o[1],o[0])}));const s=n.AABB.fromVertices(r,0);this.portalData[e]={index:e,negGroup:e,posGroup:e,boundingBox:s,plane:t.plane,vertices:r}}for(const e of this.modelData.portalRefs)e.side>0?this.portalData[e.portalIndex].posGroup=e.groupIndex:this.portalData[e.portalIndex].negGroup=e.groupIndex;for(let e=0;e<this.modelData.groups.length;e++){const t=this.modelData.groups[e],r=t.portalsOffset,a=t.portalCount;this.portalsByGroup[e]=[];for(let t=r;t<r+a;t++)this.portalsByGroup[e].push(this.modelData.portalRefs[t])}}findVisibleGroupsAndDoodads(){this.activeGroups=[],this.activeDoodads=[],this.groupViews={};const e=this.findGroupIndexForPoint(this.localCamera),t=[];for(let e=0;e<this.modelData.groupInfo.length;e++){const r=this.modelData.groupInfo[e];r.flags&i.WowWorldModelGroupFlags.AlwaysDraw?this.activeGroups.push(e):r.flags&i.WowWorldModelGroupFlags.Exterior&&n.AABB.visibleInFrustrum(r.boundingBox,this.localCameraFrustrum)&&t.push(e)}let r=[],a=!1;e<0?r=t:(a=(this.modelData.groupInfo[e].flags&i.WowWorldModelGroupFlags.Interior)>0,r=[e],a||(r=r.concat(t)));const o=new Set,s=new Set;let l=[];for(const e of r)this.traversePortals(e,this.localCameraFrustrum,o,s,l,0);if(a&&l.length>0)for(const e of t)-1===this.activeGroups.indexOf(e)&&this.activeGroups.push(e),this.groupViews[e]=l;this.activeGroups=this.activeGroups.concat([...o]);for(const e of this.activeGroups){const t=this.modelData.groupInfo[e];for(const r of this.groupDoodads[e])if(!(n.AABB.distanceToPointIgnoreAxis(r.worldBoundingBox,this.localCamera,n.Axis.Z)>this.engine.doodadRenderDistance))if(t.flags&i.WowWorldModelGroupFlags.AlwaysDraw)this.activeDoodads.push(r);else for(const t of this.groupViews[e])if(n.AABB.visibleInFrustrum(r.worldBoundingBox,t)){this.activeDoodads.push(r);break}}}setLODGroupsForVisibleGroups(){for(let e=0;e<this.activeGroups.length;e++){const t=this.activeGroups[e],r=this.modelData.groupInfo[t];if(!(r.flags&i.WowWorldModelGroupFlags.Lod)){this.activeGroups[e]=t;continue}const a=n.AABB.distanceToPoint(r.boundingBox,this.localCamera);let o=0;a>800?o=2:a>500&&(o=1),this.activeGroups[e]=this.lodGroupMap[o*this.modelData.groupInfo.length+t]}}findGroupIndexForPoint(e){let t=-1,r=null,a=Number.MAX_VALUE;for(let o=0;o<this.modelData.groupInfo.length;o++){const s=this.modelData.groupInfo[o];if(s.flags&i.WowWorldModelGroupFlags.Unreachable||s.flags&i.WowWorldModelGroupFlags.AntiPortal||s.flags&i.WowWorldModelGroupFlags.Unknown_0x400000)continue;if(s.flags&i.WowWorldModelGroupFlags.Exterior){if(!n.AABB.containsPointIgnoreMaxZ(s.boundingBox,e))continue}else if(!n.AABB.containsPoint(s.boundingBox,e))continue;(-1===t||a===Number.MAX_VALUE&&n.AABB.containsBoundingBox(r,s.boundingBox))&&(t=o,r=s.boundingBox);const l=this.modelData.groups[o],u=[],d={faceIndices:l.bspIndices,nodes:l.bspNodes,vertexIndices:l.indices,vertices:l.vertices};n.BspTree.findNodesForPoint(d,e,u,0);const c=n.BspTree.pickClosestTriangle_NegZ(d,e,u);c&&c.distance<a&&(a=c.distance,t=o)}return t}traversePortals(e,t,r,a,o,s){if(s>8)return;if(a.has(e))return;this.groupViews[e]=this.groupViews[e]?this.groupViews[e]:[],this.groupViews[e].push(t),r.add(e),a.add(e);const l=this.portalsByGroup[e];for(const a of l){const l=this.portalData[a.portalIndex];let u=n.AABB.containsPoint(l.boundingBox,this.localCamera);if(n.Plane.sideFacingPoint(l.plane,this.localCamera)!==a.side&&!u)continue;if(!n.AABB.visibleInFrustrum(l.boundingBox,t)&&!u)continue;const d=n.Frustrum.copy(t);for(let e=0;e<l.vertices.length;e++){const t=l.vertices[e],r=l.vertices[(e+1)%l.vertices.length],a=l.vertices[(e-1+l.vertices.length)%l.vertices.length],o=n.Plane.fromEyeAndVertices(this.localCamera,t,r);n.Plane.distanceToPoint(o,a)<0&&n.Float4.scale(o,-1,o),d.push(o)}const c=this.modelData.groupInfo[e],h=this.modelData.groupInfo[a.groupIndex];c.flags&i.WowWorldModelGroupFlags.Interior&&h.flags&i.WowWorldModelGroupFlags.Exterior&&o.push(d),this.traversePortals(a.groupIndex,d,r,new Set,o,s+1)}}drawGroup(e){const t=this.modelData.groups[e];for(let r=0;r<t.batches.length;r++){const a=t.batches[r],o=new n.RenderingBatchRequest(this.groupMaterials[a.materialId]);o.useVertexArrayObject(this.groupVaos[e]),o.drawIndexedTriangles(2*a.startIndex,a.indexCount),this.engine.submitBatchRequest(o)}}drawPortals(){for(let e=0;e<this.modelData.portals.length;e++){const t=this.modelData.portals[e];if(!n.AABB.visibleInFrustrum(this.portalData[e].boundingBox,this.engine.cameraFrustrum))continue;const r=new n.RenderingBatchRequest(this.groupMaterials[-1]);r.useVertexArrayObject(this.portalVao),r.drawIndexedTriangles(1.5*t.startVertex*2,1.5*t.vertexCount),this.engine.submitBatchRequest(r)}}setupGraphics(){this.groupVaos=new Array(this.modelData.groups.length);for(let e=0;e<this.modelData.groups.length;e++){const t=this.engine.graphics.createVertexArrayObject(),r=this.uploadVertexDataForGroup(e),a=this.engine.graphics.createVertexIndexBuffer(!0);a.setData(new Uint16Array(this.modelData.groups[e].indices)),t.setIndexBuffer(a),t.addVertexDataBuffer(r),this.groupVaos[e]=t}}setupPortalGraphics(){const e=this.engine.graphics.createVertexDataBuffer([{index:this.portalShader.getAttribLocation("a_position"),size:3,type:n.BufferDataType.Float,normalized:!1,stride:12,offset:0}],!0),t=new Uint8Array(12*this.modelData.portalVertices.length),r=new o.BinaryWriter(t.buffer);for(let e=0;e<this.modelData.portalVertices.length;e++)r.writeFloatLE(this.modelData.portalVertices[e][0]),r.writeFloatLE(this.modelData.portalVertices[e][1]),r.writeFloatLE(this.modelData.portalVertices[e][2]);e.setData(t);const a=this.engine.graphics.createVertexIndexBuffer(!0),i=[];for(let e=0;e<this.modelData.portals.length;e++){const t=this.modelData.portals[e];if(!(t.vertexCount-2<=0))for(let e=0;e<t.vertexCount-2;e++)i.push(t.startVertex+0),i.push(t.startVertex+e+1),i.push(t.startVertex+e+2)}a.setData(new Uint16Array(i)),this.portalVao=this.engine.graphics.createVertexArrayObject(),this.portalVao.addVertexDataBuffer(e),this.portalVao.setIndexBuffer(a)}setupMaterials(){if(this.isDisposing)return;for(let e=0;e<this.modelData.materials.length;e++){const t=this.modelData.materials[e],r=(0,n.M2BlendModeToEGxBlend)(t.blendMode),a=(0,l.getWMOVertexShader)(t.shader),o=(0,l.getWMOPixelShader)(t.shader),s=!!(t.flags&i.WoWWorldModelMaterialMaterialFlags.Unlit),u=!!(t.flags&i.WoWWorldModelMaterialMaterialFlags.Unculled),d=new n.MaterialKey(this.fileId,n.MaterialType.WMOMaterial,e),c=new n.RenderMaterial(d);c.useCounterClockWiseFrontFaces(!0),c.useBackFaceCulling(!u),c.useBlendMode(r),c.useDepthTest(!0),c.useDepthWrite(!0),c.useColorMask(n.ColorMask.Alpha|n.ColorMask.Red|n.ColorMask.Blue|n.ColorMask.Green),c.useShaderProgram(this.shaderProgram),c.useUniforms({u_modelMatrix:this.worldModelMatrix,u_cameraPos:this.engine.cameraPosition,u_pixelShader:o,u_vertexShader:a,u_blendMode:t.blendMode,u_unlit:s,u_texture1:this.loadedTextures[t.texture1],u_texture2:this.loadedTextures[t.texture2],u_texture3:this.loadedTextures[t.texture3]}),this.engine.addEngineMaterialParams(c),this.groupMaterials[e]=c}const e=new n.MaterialKey(this.fileId,n.MaterialType.WMOPortal),t=new n.RenderMaterial(e);t.useCounterClockWiseFrontFaces(!1),t.useBackFaceCulling(!1),t.useBlendMode(n.GxBlend.GxBlend_Alpha),t.useDepthTest(!1),t.useDepthWrite(!1),t.useColorMask(n.ColorMask.Alpha|n.ColorMask.Red|n.ColorMask.Blue|n.ColorMask.Green),t.useShaderProgram(this.portalShader),t.useUniforms({u_modelMatrix:this.worldModelMatrix,u_color:n.Float4.create(.8,.1,.1,.25)}),this.engine.addEngineMaterialParams(t),this.groupMaterials[-1]=t}setModelMatrix(e,t,r){super.setModelMatrix(e,t,r),n.Float44.tranpose(this.invWorldModelMatrix,this.transposeInvModelMatrix)}}t.WMOModel=m},7243:function(e,t,r){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.M2Model=void 0;const n=r(2462),o=r(8219),i=r(9266),s=a(r(3030)),l=a(r(1479)),u=r(4176),d=r(8521),c=r(909),h=r(2981),f=r(4741);var m;!function(e){e[e.Unknown=0]="Unknown",e[e.ReplaceTexture=1]="ReplaceTexture"}(m||(m={}));class p extends d.WorldPositionedObject{constructor(e){super(),this.fileId=e,this.isModelDataLoaded=!1,this.isTexturesLoaded=!1,this.isDisposing=!1,this.isMirrored=!1,this.modelViewMatrix=o.Float44.identity(),this.invModelViewMatrix=o.Float44.identity(),this.bonePositionBuffer=new Float32Array(4096),this.onModelLoadedQueue=[],this.dataLoadedCallbacks=[],this.textureVariationsLoadedCallbacks=[],this.children=[]}get isLoaded(){return this.isModelDataLoaded&&this.isTexturesLoaded}initialize(e){super.initialize(e),this.shaderProgram=this.engine.getShaderProgram("M2",l.default,s.default),this.engine.getM2ModelFile(this.fileId).then(this.onModelLoaded.bind(this))}update(e){if(super.update(e),this.isLoaded&&!this.isDisposing){this.animationState.update(e),o.Float44.multiply(this.worldModelMatrix,this.engine.viewMatrix,this.modelViewMatrix),o.Float44.invert(this.modelViewMatrix,this.invModelViewMatrix);for(const e of this.boneData)e.hasUpdatedThisTick=!1;for(let e=0;e<this.modelData.bones.length;e++)this.updateBone(this.modelData.bones[e],e);for(let e=0;e<this.drawOrderTexUnits.length;e++)this.updateTextureUnit(this.modelData.textureUnits[e],e);for(let t=0;t<this.modelData.particleEmitters.length;t++)this.particleEmitters[t].update(e);for(let t=0;t<this.modelData.ribbonEmitters.length;t++)this.ribbonEmitters[t].update(e)}}draw(){if(!this.isLoaded||this.isDisposing)return;const e=Math.min(256,this.modelData.bones.length);for(let t=0;t<e;t++)this.bonePositionBuffer.set(this.boneData[t].positionMatrix,16*t);for(let e=0;e<this.drawOrderTexUnits.length;e++)this.drawTextureUnit(this.modelData.textureUnits[e],e);for(let e=0;e<this.modelData.particleEmitters.length;e++)this.particleEmitters[e].draw();for(let e=0;e<this.modelData.ribbonEmitters.length;e++)this.ribbonEmitters[e].draw()}setTexture(e,t){this.isModelDataLoaded?(this.modelData.textures[e].textureId=t,this.loadTextures()):this.onModelLoadedQueue.push({type:m.ReplaceTexture,params:[e,t]})}useTextureVariation(e){const t=this.textureVariations.textureVariations[e];if(t){for(let e=0;e<t.textureIds.length&&!(e>=this.modelData.textureCombos.length);e++){const r=this.modelData.textureCombos[e];this.modelData.textures[r].textureId=t.textureIds[e]}this.loadTextures()}}on(e,t){"textureVariationsLoaded"===e&&(this.textureVariationsLoadedCallbacks.push(t),null!=this.textureVariations&&t(this.textureVariations)),"modelDataLoaded"===e&&(this.dataLoadedCallbacks.push(t),null!=this.modelData&&t(this.modelData))}getAnimations(){return(0,i.distinct)(this.modelData.animations.map((e=>e.id))).sort(((e,t)=>e-t))}useAnimation(e){this.animationState.useAnimation(e)}pauseAnimation(){this.animationState.isPaused=!0}resumeAnimation(){this.animationState.isPaused=!1}setAnimationSpeed(e){this.animationState.speed=e}updateBone(e,t){const r=this.boneData[t];if(r.hasUpdatedThisTick)return;if(o.Float44.identity(r.positionMatrix),o.Float44.multiply(r.positionMatrix,this.modelViewMatrix,r.positionMatrix),e.parentBoneId>-1){this.updateBone(this.modelData.bones[e.parentBoneId],e.parentBoneId);let t=o.Float44.copy(this.boneData[e.parentBoneId].positionMatrix),a=o.Float44.copy(t);if(7&e.flags){if(o.Float44.multiply(this.modelViewMatrix,t,t),6&~e.flags)if(4&e.flags)for(let e=0;e<3;e++){const r=o.Float44.getColumn4(this.modelViewMatrix,e),a=o.Float4.length(r),n=o.Float44.getColumn4(t,e),i=o.Float4.length(n);o.Float4.scale(r,i/a,r),o.Float44.setColumn(t,e,r)}else for(let e=0;e<3;e++){const r=o.Float44.getColumn4(this.modelViewMatrix,e),a=o.Float4.length(r),n=o.Float44.getColumn4(t,e),i=o.Float4.length(n);o.Float4.scale(n,1/i*a,r),o.Float44.setColumn(t,e,r)}else for(let e=0;e<3;e++)o.Float44.setColumn(t,e,o.Float44.getColumn4(this.modelViewMatrix,e));let r;if(1&e.flags)r=o.Float44.getColumn4(this.modelViewMatrix,3),o.Float44.setColumn(t,3,r);else{const r=o.Float4.create(e.pivot[0],e.pivot[1],e.pivot[2],1),n=o.Float4.create(e.pivot[0],e.pivot[1],e.pivot[2],0),i=o.Float4.identity();o.Float4.subtract(o.Float44.transformDirection4(r,a),o.Float44.transformDirection4(n,t),i),i[3]=1,o.Float44.setColumn(t,3,i)}o.Float44.multiply(this.invWorldModelMatrix,t,t)}o.Float44.multiply(r.positionMatrix,t,r.positionMatrix)}let a=o.Float44.identity(),i=!1;if(640&e.flags){if(o.Float44.translate(a,e.pivot,a),this.animationState.hasAnimatedValuesForTrack(e.translation)){const t=this.animationState.getFloat3TrackValue(e.translation,o.Float3.zero());o.Float44.translate(a,t,a),i=!0}if(this.animationState.hasAnimatedValuesForTrack(e.rotation)){const t=this.animationState.getFloat4TrackValue(e.rotation,o.Float4.identity());t[0]=-t[0],t[1]=-t[1],t[2]=-t[2],o.Float44.multiply(a,o.Float44.fromQuat(t),a),i=!0}if(this.animationState.hasAnimatedValuesForTrack(e.scale)){const t=this.animationState.getFloat3TrackValue(e.scale,o.Float3.one());o.Float44.scale(a,t,a),i=!0}o.Float44.translate(a,o.Float3.negate(e.pivot),a)}null!=r.boneOffsetMatrix&&(o.Float44.translate(a,e.pivot,a),o.Float44.multiply(a,r.boneOffsetMatrix,a),o.Float44.translate(a,o.Float3.negate(e.pivot),a)),o.Float44.multiply(r.positionMatrix,a,r.positionMatrix);const s=120&e.flags;if(s){const t=r.positionMatrix,l=o.Float44.copy(r.positionMatrix),u=o.Float3.create(o.Float4.length(o.Float44.getColumn4(r.positionMatrix,0)),o.Float4.length(o.Float44.getColumn4(r.positionMatrix,1)),o.Float4.length(o.Float44.getColumn4(r.positionMatrix,2)));switch(s){case n.WoWBoneFlags.SphericalBillboard:if(i){const e=o.Float44.getColumn4(a,0);o.Float44.setColumn(t,0,o.Float4.normalize(o.Float4.create(e[1],e[2],-e[0],0)));const r=o.Float44.getColumn4(a,1);o.Float44.setColumn(t,1,o.Float4.normalize(this.isMirrored?o.Float4.create(-r[1],-r[2],r[0],0):o.Float4.create(r[1],r[2],-r[0],0)));const n=o.Float44.getColumn4(a,2);o.Float44.setColumn(t,2,o.Float4.normalize(o.Float4.create(n[1],n[2],-n[0],0)))}else o.Float44.setColumn(t,0,o.Float4.create(0,0,-1,0)),o.Float44.setColumn(t,1,this.isMirrored?o.Float4.create(-1,0,0,0):o.Float4.create(1,0,0,0)),o.Float44.setColumn(t,2,o.Float4.create(0,1,0,0));case n.WoWBoneFlags.CylindricalBillboardLockX:{const e=o.Float4.normalize(o.Float44.getColumn4(t,0));o.Float44.setColumn(t,0,e);const r=o.Float4.normalize(o.Float4.create(t[4],-t[0],0,0));o.Float44.setColumn(t,1,r);const a=o.Float4.cross(r,e);a[3]=0,o.Float44.setColumn(t,2,a)}case n.WoWBoneFlags.CylindricalBillboardLockY:{const e=o.Float4.normalize(o.Float44.getColumn4(t,1));o.Float44.setColumn(t,1,e);const r=o.Float4.normalize(o.Float4.create(-t[5],t[1],0,0));o.Float44.setColumn(t,0,r);const a=o.Float4.cross(e,r);a[3]=0,o.Float44.setColumn(t,2,a)}case n.WoWBoneFlags.CylindricalBillboardLockZ:{const e=o.Float4.normalize(o.Float44.getColumn4(t,2));o.Float44.setColumn(t,2,e);const r=o.Float4.normalize(o.Float4.create(t[9],t[8],0,0));o.Float44.setColumn(t,1,r);const a=o.Float4.cross(e,r);a[3]=0,o.Float44.setColumn(t,0,a)}}const d=o.Float4.create(e.pivot[0],e.pivot[1],e.pivot[2],1),c=o.Float4.create(e.pivot[0],e.pivot[1],e.pivot[2],0);o.Float44.setColumn(t,0,o.Float4.scale(o.Float44.getColumn4(t,0),u[0])),o.Float44.setColumn(t,1,o.Float4.scale(o.Float44.getColumn4(t,1),u[1])),o.Float44.setColumn(t,2,o.Float4.scale(o.Float44.getColumn4(t,2),u[2]));const h=o.Float4.identity();o.Float4.subtract(o.Float44.transformDirection4(d,l),o.Float44.transformDirection4(c,t),h),h[3]=1,o.Float44.setColumn(t,3,h)}o.Float44.multiply(this.invModelViewMatrix,r.positionMatrix,r.positionMatrix),r.hasUpdatedThisTick=!0}updateTextureUnit(e,t){const r=this.textureUnitData[t];o.Float4.set(r.color,1,1,1,1);const a=this.modelData.colors[e.colorIndex];if(a){let e=o.Float3.one(),t=1;this.animationState.hasAnimatedValuesForTrack(a.color)&&this.animationState.getFloat3TrackValue(a.color,o.Float3.one(),e),this.animationState.hasAnimatedValuesForTrack(a.alpha)&&(t=this.animationState.getNumberTrackValue(a.alpha)/32767),r.color[0]=e[0],r.color[1]=e[1],r.color[2]=e[2],r.color[3]=t}for(let t=0;t<e.textureCount;t++)r.textureWeights[t]=1;if(e.textureWeightComboIndex>-1&&e.textureWeightComboIndex<this.modelData.textureWeightCombos.length)for(let t=0;t<e.textureCount;t++){const a=this.modelData.textureWeightCombos[e.textureWeightComboIndex+t];if(a>-1&&a<this.modelData.textureWeights.length){const e=this.modelData.textureWeights[a];if(this.animationState.hasAnimatedValuesForTrack(e.weights)){const a=this.animationState.getNumberTrackValue(e.weights,32767)/32767;r.textureWeights[t]=a}}}if(r.color[3]*=r.textureWeights[0],e.textureTransformComboIndex>-1&&e.textureTransformComboIndex<this.modelData.textureTransformCombos.length)for(let t=0;t<e.textureCount;t++){const a=r.textureMatrices[t];o.Float44.identity(a);let n=this.modelData.textureTransformCombos[e.textureTransformComboIndex+t];if(n>-1&&n<this.modelData.textureTransforms.length){const e=this.modelData.textureTransforms[n];if(o.Float44.translate(a,o.Float3.create(.5,.5,0),a),this.animationState.hasAnimatedValuesForTrack(e.scaling)){const t=this.animationState.getFloat3TrackValue(e.scaling);o.Float44.scale(a,t,a)}if(this.animationState.hasAnimatedValuesForTrack(e.rotation)){const t=this.animationState.getFloat4TrackValue(e.rotation);o.Float44.multiply(a,o.Float44.fromQuat(t),a)}if(this.animationState.hasAnimatedValuesForTrack(e.translation)){const t=this.animationState.getFloat3TrackValue(e.translation);o.Float44.translate(a,t,a)}o.Float44.translate(a,o.Float3.create(-.5,-.5,0),a)}}}drawTextureUnit(e,t){const r=this.textureUnitData[t],a=new o.RenderingBatchRequest(r.material),n=this.modelData.submeshes[e.skinSectionIndex];a.useVertexArrayObject(this.dataBuffers.vao),a.drawIndexedTriangles(2*(n.triangleStart+65536*n.level),n.triangleCount),this.engine.submitBatchRequest(a)}resizeForBounds(){this.engine.sceneCamera.resizeForBoundingBox(this.worldBoundingBox)}dispose(){if(super.dispose(),this.particleEmitters){for(const e of this.particleEmitters)e.dispose();this.particleEmitters=null}if(this.ribbonEmitters){for(const e of this.ribbonEmitters)e.dispose();this.ribbonEmitters=null}this.modelData=null,this.shaderProgram=null,this.dataBuffers=null,this.bonePositionBuffer=null,this.animationState=null,this.loadedTextures=null,this.textureUnitData=null,this.boneData=null,this.worldModelMatrix=null,this.modelViewMatrix=null,this.invWorldModelMatrix=null,this.invModelViewMatrix=null,this.drawOrderTexUnits=null,this.textureVariations=null,this.onModelLoadedQueue=null,this.dataLoadedCallbacks=null,this.textureVariationsLoadedCallbacks=null}onModelLoaded(e){if(null!==e){if(!this.isDisposing){this.modelData=e;for(const e of this.onModelLoadedQueue)this.applyAsyncAction(e);this.localBoundingBox=o.AABB.fromVertices(this.modelData.vertices.map((e=>e.position)),0),this.worldBoundingBox=o.AABB.transform(this.localBoundingBox,this.worldModelMatrix),this.animationState=new f.AnimationState(this),this.animationState.useAnimation(0),this.parent||this.resizeForBounds(),this.loadTextures(),this.engine.getTextureVariationsMetadata(this.fileId).then(this.onTextureVariationsLoaded.bind(this)),this.dataBuffers=this.engine.getM2DataBuffers(this.fileId,this.shaderProgram,this.modelData),this.boneData=new Array(this.modelData.bones.length);for(let e=0;e<this.modelData.bones.length;e++)this.boneData[e]={boneOffsetMatrix:null,hasUpdatedThisTick:!1,positionMatrix:o.Float44.identity()};this.drawOrderTexUnits=this.modelData.textureUnits.sort(((e,t)=>e.priority!=t.priority?e.priority-t.priority:this.modelData.submeshes[e.skinSectionIndex].submeshId-this.modelData.submeshes[t.skinSectionIndex].submeshId)),this.isModelDataLoaded=!0;for(const e of this.dataLoadedCallbacks)e(this.modelData)}}else this.dispose()}onTextureVariationsLoaded(e){if(e&&!this.isDisposing){this.textureVariations=e;for(const e of this.modelData.textures)e.type!==n.WoWTextureType.None&&0===e.textureId&&this.useTextureVariation(0);for(const e of this.textureVariationsLoadedCallbacks)e(this.textureVariations)}}loadTextures(){this.isTexturesLoaded=!1,this.loadedTextures={};const e=[];for(let t=0;t<this.modelData.textures.length;t++){const r=this.modelData.textures[t].textureId;if(r>0){const t=this.engine.getTexture(r).then((e=>{this.isDisposing||(this.loadedTextures[r]=e)}));e.push(t)}else this.loadedTextures[t]=this.engine.getUnknownTexture()}Promise.all(e).then((()=>{this.isTexturesLoaded=!0,this.onTexturesLoaded()}))}onTexturesLoaded(){if(!this.isDisposing){this.particleEmitters=new Array(this.modelData.particleEmitters.length),this.ribbonEmitters=new Array(this.modelData.ribbonEmitters.length);for(let e=0;e<this.modelData.particleEmitters.length;e++){const t=this.modelData.particles[e],r=this.modelData.particleEmitters[e],a=new c.M2ParticleEmitter(this.engine,this,r,t);this.particleEmitters[e]=a}for(let e=0;e<this.modelData.ribbonEmitters.length;e++){const t=this.modelData.ribbonEmitters[e],r=new h.M2RibbonEmitter(this,t);this.ribbonEmitters[e]=r}this.textureUnitData=new Array(this.modelData.textureUnits.length);for(let e=0;e<this.modelData.textureUnits.length;e++){const t=this.modelData.textureUnits[e],r=new o.MaterialKey(this.fileId,o.MaterialType.M2Material,e);let a=new o.RenderMaterial(r);const i=this.engine.getUnknownTexture(),s={color:o.Float4.one(),textureMatrices:[o.Float44.identity(),o.Float44.identity()],textureWeights:o.Float4.one(),textures:[i,i,i,i],material:a};if(!(t.textureComboIndex<0||t.textureComboIndex>this.modelData.textureCombos.length))for(let e=0;e<t.textureCount;e++){const r=this.modelData.textureCombos[t.textureComboIndex+e];if(r>-1&&r<this.modelData.textures.length){const t=this.modelData.textures[r];this.loadedTextures[t.textureId]&&(s.textures[e]=this.loadedTextures[t.textureId])}}const l=this.modelData.materials[t.materialIndex],d=(0,o.M2BlendModeToEGxBlend)(l.blendingMode);a.useShaderProgram(this.shaderProgram),a.useBackFaceCulling(!(4&l.flags)),a.useCounterClockWiseFrontFaces(!this.isMirrored),a.useBlendMode(d),a.useDepthTest(!(n.WoWMaterialFlags.DepthTest&l.flags)),a.useDepthWrite(!(n.WoWMaterialFlags.DepthWrite&l.flags)),a.useColorMask(o.ColorMask.Alpha|o.ColorMask.Blue|o.ColorMask.Green|o.ColorMask.Red),a.useUniforms({u_boneMatrices:this.bonePositionBuffer,u_modelMatrix:this.worldModelMatrix,u_textureTransformMatrix1:s.textureMatrices[0],u_textureTransformMatrix2:s.textureMatrices[1],u_color:s.color,u_vertexShader:(0,u.getM2VertexShaderId)(t.shaderId,t.textureCount),u_blendMode:d,u_pixelShader:(0,u.getM2PixelShaderId)(t.shaderId,t.textureCount),u_unlit:!!(n.WoWMaterialFlags.Unlit&l.flags),u_texture1:s.textures[0],u_texture2:s.textures[1],u_texture3:s.textures[2],u_texture4:s.textures[3],u_textureWeights:s.textureWeights}),this.engine.addEngineMaterialParams(a),this.textureUnitData[e]=s}}}applyAsyncAction(e){e.type==m.ReplaceTexture&&(this.modelData.textures[e.params[0]].textureId=e.params[1])}}t.M2Model=p},7293:function(e,t,r){"use strict";var a=this&&this.__awaiter||function(e,t,r,a){return new(r||(r=Promise))((function(n,o){function i(e){try{l(a.next(e))}catch(e){o(e)}}function s(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,s)}l((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.RenderingEngine=void 0;const n=r(1278),o=r(6940),i=r(1017),s=r(5053),l=-123,u="dataFetching",d="Loading model data...";t.RenderingEngine=class{constructor(e,t,r,a){this.graphics=e,this.dataLoader=t,this.requestFrame=r,this.progress=a.progress,this.dataLoader.useProgressReporter(a.progress),this.errorHandler=a.errorHandler,this.containerElement=a.container,this.sceneObjects=[],this.viewMatrix=n.Float44.identity(),this.invViewMatrix=n.Float44.identity(),this.projectionMatrix=n.Float44.identity(),this.projViewMatrix=n.Float44.identity(),this.cameraFrustrum=n.Frustrum.zero(),this.cameraPosition=n.Float3.zero();const o=a.cacheTtl?a.cacheTtl:9e5;this.textureCache=new s.SimpleCache(o),this.shaderCache=new s.SimpleCache(o),this.wmoCache=new s.SimpleCache(o),this.m2Cache=new s.SimpleCache(o),this.liquidCache=new s.SimpleCache(o),this.m2DataBufferCache=new s.SimpleCache(o),this.materialCache=new s.SimpleCache(o),this.textureVariationsCache=new s.SimpleCache(o),this.runningRequests={},this.batchRequests=[],this.clearColor=a.clearColor?a.clearColor:n.Float4.create(.1,.1,.1,1),this.fov=a.cameraFov?a.cameraFov:60,this.ambientColor=a.ambientColor?a.ambientColor:n.Float4.create(1/3,1/3,1/3,1),this.lightColor=a.lightColor?a.lightColor:n.Float4.one(),this.lightDir=n.Float3.normalize(a.lightDirection?a.lightDirection:[0,0,1]),this.framesDrawn=0,this.timeElapsed=0,this.maxFpsCounterSize=100,this.fpsCounter=[],this.debugPortals=!1,this.doodadRenderDistance=300}dispose(){this.viewMatrix=null,this.invViewMatrix=null,this.sceneCamera.dispose();for(const e of this.sceneObjects)e.dispose()}now(){return window.performance&&window.performance.now?window.performance.now():Date.now()}draw(e){var t;try{const t=e-this.lastTime;this.lastTime=e;for(const e of this.sceneObjects)if(!e.isLoaded)return;this.graphics.startFrame(this.width,this.height),this.graphics.clearFrame(this.clearColor),this.sceneCamera.update(t),n.Float44.copy(this.sceneCamera.getViewMatrix(),this.viewMatrix),n.Float44.invert(this.viewMatrix,this.invViewMatrix),n.Float44.multiply(this.projectionMatrix,this.viewMatrix,this.projViewMatrix),n.Frustrum.fromViewMatrix(this.projViewMatrix,this.cameraFrustrum),n.Float44.getTranslation(this.invViewMatrix,this.cameraPosition),this.textureCache.update(t),this.wmoCache.update(t),this.m2Cache.update(t),this.liquidCache.update(t);for(const e of this.sceneObjects)e.update(t);for(const e of this.sceneObjects)e.draw();const r=this.batchRequests.sort(((e,t)=>{const r=(e.material.blendMode>i.GxBlend.GxBlend_Opaque?e.material.blendMode==i.GxBlend.GxBlend_AlphaKey?1:2:0)-(t.material.blendMode>i.GxBlend.GxBlend_Opaque?t.material.blendMode==i.GxBlend.GxBlend_AlphaKey?1:2:0);return 0!=r?r:e.material.key.compare(t.material.key)}));for(const e of r)e.submit(this.graphics);if(this.graphics.useVertexArrayObject(void 0),this.fpsElement){this.fpsCounter.push(1/(t/1e3)),this.fpsCounter.length>this.maxFpsCounterSize&&this.fpsCounter.splice(0,1);const e=this.fpsCounter.reduce(((e,t)=>e+t),0)/this.fpsCounter.length;this.fpsElement.textContent="FPS: "+Math.floor(e)}this.batchesElement&&(this.batchesElement.textContent="Batches: "+r.length),this.batchRequests=[],r.length>0&&this.framesDrawn++,this.timeElapsed+=t}catch(e){null===(t=this.errorHandler)||void 0===t||t.call(this,"rendering",e.toString())}}start(){this.lastTime=this.now(),this.sceneCamera.initialize(this),n.Float44.copy(this.sceneCamera.getViewMatrix(),this.viewMatrix),n.Float44.invert(this.viewMatrix,this.invViewMatrix);var e=this.width/this.height;n.Float44.perspective(Math.PI/180*this.fov,e,.1,2e3,this.projectionMatrix);const t=this,r=()=>{if(t.isDisposing)return;const e=t.now();t.draw(e),this.requestFrame(r)};r()}enableDebug(){this.setupDebugElements()}enableDebugPortals(){this.debugPortals=!0}disableDebug(){this.destroyDebugElements()}disableDebugPortals(){this.debugPortals=!1}resize(e,t){this.height=t,this.width=e;var r=this.width/this.height;n.Float44.perspective(Math.PI/180*this.fov,r,.1,2e3,this.projectionMatrix)}switchCamera(e){e.initialize(this),e.resizeForBoundingBox(this.sceneCamera.getBoundingBox()),this.sceneCamera.dispose(),this.sceneCamera=e}addSceneObject(e,t){e.initialize(this),this.sceneObjects.push(e)}removeSceneObject(e){this.sceneObjects=this.sceneObjects.filter((t=>t!=e)),e.dispose()}processTexture(e,t,r){return a(this,void 0,void 0,(function*(){return new Promise(((a,n)=>{var o,i;null===t&&(null===(o=this.errorHandler)||void 0===o||o.call(this,u,"Unable to retrieve image data for file: "+e),null===(i=this.progress)||void 0===i||i.removeFileFromOperation(e),delete this.runningRequests[e],a(this.getUnknownTexture()));const s=new Image;s.onload=()=>{var t;const n=this.graphics.createTextureFromImg(s,r);this.textureCache.store(e,n),null===(t=this.progress)||void 0===t||t.removeFileFromOperation(e),delete this.runningRequests[e],a(n)},s.onerror=t=>{var r,n;null===(r=this.errorHandler)||void 0===r||r.call(this,"dataProcessing","Unable to process image data for file: "+e),null===(n=this.progress)||void 0===n||n.removeFileFromOperation(e),delete this.runningRequests[e],a(this.getUnknownTexture())},s.src=t}))}))}getTexture(e,t){return a(this,void 0,void 0,(function*(){var r,a;if(this.runningRequests[e])return yield this.runningRequests[e];if(this.textureCache.contains(e))return this.textureCache.get(e);null===(r=this.progress)||void 0===r||r.setOperation(d),null===(a=this.progress)||void 0===a||a.addFileToOperation(e);const n=this.dataLoader.loadTexture(e).then((r=>this.processTexture(e,r,t)));return this.runningRequests[e]=n,yield n}))}getUnknownTexture(){if(this.textureCache.contains(l))return this.textureCache.get(l);const e=this.graphics.createSolidColorTexture(n.Float4.create(0,1,0,1));return this.textureCache.store(l,e,-1),e}submitBatchRequest(e){this.batchRequests.push(e)}getShaderProgram(e,t,r){if(this.shaderCache.contains(e))return this.shaderCache.get(e);const a=this.graphics.createShaderProgram(t,r);return this.shaderCache.store(e,a,-1),a}getM2ModelFile(e){return a(this,void 0,void 0,(function*(){var t,r,a,n;if(this.runningRequests[e])return yield this.runningRequests[e];if(this.m2Cache.contains(e))return this.m2Cache.get(e);null===(t=this.progress)||void 0===t||t.setOperation(d),null===(r=this.progress)||void 0===r||r.addFileToOperation(e);const o=this.dataLoader.loadModelFile(e);this.runningRequests[e]=o;const i=yield o;return null===i&&(null===(a=this.errorHandler)||void 0===a||a.call(this,u,"Unable to retrieve M2 data for file: "+e)),delete this.runningRequests[e],this.m2Cache.store(e,i),null===(n=this.progress)||void 0===n||n.removeFileFromOperation(e),i}))}getWMOModelFile(e){return a(this,void 0,void 0,(function*(){var t,r,a,n;if(this.runningRequests[e])return yield this.runningRequests[e];if(this.wmoCache.contains(e))return this.wmoCache.get(e);null===(t=this.progress)||void 0===t||t.setOperation(d),null===(r=this.progress)||void 0===r||r.addFileToOperation(e);const o=this.dataLoader.loadWorldModelFile(e);this.runningRequests[e]=o;const i=yield o;return null===i&&(null===(a=this.errorHandler)||void 0===a||a.call(this,u,"Unable to retrieve WMO data for file: "+e)),this.wmoCache.store(e,i),delete this.runningRequests[e],null===(n=this.progress)||void 0===n||n.removeFileFromOperation(e),i}))}getLiquidTypeMetadata(e){return a(this,void 0,void 0,(function*(){var t,r,a,n;const o=e;if(this.runningRequests[o])return yield this.runningRequests[o];if(this.liquidCache.contains(e))return this.liquidCache.get(e);null===(t=this.progress)||void 0===t||t.setOperation(d),null===(r=this.progress)||void 0===r||r.addFileToOperation(o);const i=this.dataLoader.loadLiquidTypeMetadata(e);this.runningRequests[o]=i;const s=yield i;return null===s&&(null===(a=this.errorHandler)||void 0===a||a.call(this,u,"Unable to retrieve Liquid data for liquid: "+e)),this.liquidCache.store(e,s),delete this.runningRequests[o],null===(n=this.progress)||void 0===n||n.removeFileFromOperation(o),s}))}getTextureVariationsMetadata(e){return a(this,void 0,void 0,(function*(){var t,r,a;const n="TextureVariations-"+e;if(this.runningRequests[n])return yield this.runningRequests[n];if(this.textureVariationsCache.contains(n))return this.textureVariationsCache.get(n);null===(t=this.progress)||void 0===t||t.setOperation(d),null===(r=this.progress)||void 0===r||r.addFileToOperation(n);const o=this.dataLoader.loadTextureVariationsMetadata(e);this.runningRequests[n]=o;const i=yield o;return this.textureVariationsCache.store(n,i),delete this.runningRequests[n],null===(a=this.progress)||void 0===a||a.removeFileFromOperation(n),i}))}getM2DataBuffers(e,t,r){if(this.m2DataBufferCache.contains(e))return this.m2DataBufferCache.get(e);var a=new o.StaticM2DataBuffers;return a.createFromModelData(this.graphics,t,r),this.m2DataBufferCache.store(e,a),a}addEngineMaterialParams(e){e.useUniforms({u_ambientColor:this.ambientColor,u_lightColor:this.lightColor,u_lightDir:this.lightDir,u_viewMatrix:this.viewMatrix,u_projectionMatrix:this.projectionMatrix})}getRandomNumberGenerator(e){return new n.AleaPrngGenerator(e||184594917)}setupDebugElements(){document&&this.containerElement&&(this.debugContainer=document.createElement("div"),this.debugContainer.style.position="absolute",this.debugContainer.style.left="0",this.debugContainer.style.top="0",this.debugContainer.style.padding="1em",this.fpsElement=document.createElement("p"),this.fpsElement.style.color="white",this.fpsElement.style.margin="0",this.debugContainer.append(this.fpsElement),this.batchesElement=document.createElement("p"),this.batchesElement.style.color="white",this.batchesElement.style.margin="0",this.batchesElement.style.marginTop="1.2em",this.debugContainer.append(this.batchesElement),this.containerElement.append(this.debugContainer))}destroyDebugElements(){this.fpsElement&&(this.fpsElement.remove(),this.fpsElement=null),this.batchesElement&&(this.batchesElement.remove(),this.batchesElement=null),this.debugContainer&&(this.debugContainer.remove(),this.debugContainer=null)}}},7414:e=>{"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},7518:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Float2=t.Float3=t.Float4=t.Axis=void 0;const r="undefined"!=typeof Float32Array?Float32Array:Array;var a,n,o,i;!function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z",e[e.W=3]="W"}(a||(t.Axis=a={})),function(e){function t(e){return e?(e[0]=0,e[1]=0,e[2]=0,e[3]=0,e):n(0,0,0,0)}function a(e){if(e)return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e;const t=new r(4);return r!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=1),t}function n(e,t,a,n){const o=new r(4);return o[0]=e,o[1]=t,o[2]=a,o[3]=n,o}function o(e,t,r){return(r=r||a())[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r}function i(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}e.zero=t,e.one=function(e){return e?(e[0]=1,e[1]=1,e[2]=1,e[3]=1,e):n(1,1,1,1)},e.identity=a,e.create=n,e.fromVec3=function(e){return n(e[0],e[1],e[2],1)},e.copy=function(e,t){return(t=t||a())[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},e.set=function(e,t,r,a,n){return e[0]=t,e[1]=r,e[2]=a,e[3]=n,e},e.add=function(e,t,r){return(r=r||a())[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r},e.subtract=function(e,t,r){return(r=r||a())[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r[3]=e[3]-t[3],r},e.scale=o,e.length=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},e.normalize=function(e,t){t=t||a();let r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3];return r>0&&(r=1/Math.sqrt(r)),o(e,r,t)},e.dot=i,e.lerp=function(e,t,r,n){n=n||a();let o,s,l=e[0],u=e[1],d=e[2],c=e[3],h=t[0],f=t[1],m=t[2],p=t[3],g=i(e,t);if(g<0&&(g=-g,h=-h,f=-f,m=-m,p=-p),1-g>1e-6){const e=Math.acos(g),t=Math.sin(e);o=Math.sin((1-r)*e)/t,s=Math.sin(r*e)/t}else o=1-r,s=r;return n[0]=o*l+s*h,n[1]=o*u+s*f,n[2]=o*d+s*m,n[3]=o*c+s*p,n},e.cross=function(e,r,a){a=a||t();let n=e[0],o=e[1],i=e[2],s=r[0],l=r[1],u=r[2];return a[0]=o*u-i*l,a[1]=i*s-n*u,a[2]=n*l-o*s,a[3]=0,a},e.createQuat=function(e,t,r){r=r||a(),t*=.5;let n=Math.sin(t);return r[0]=n*e[0],r[1]=n*e[1],r[2]=n*e[2],r[3]=Math.cos(t),r},e.quatFromEulers=function(e,t,r,n){n=n||a();const o=Math.cos(e/2),i=Math.sin(e/2),s=Math.cos(t/2),l=Math.sin(t/2),u=Math.cos(r/2),d=Math.sin(r/2);return n[0]=o*s*u+i*l*d,n[1]=i*s*u-o*l*d,n[2]=o*l*u+i*s*d,n[3]=o*s*d-i*l*u,n},e.quatMultiply=function(e,t,r){r=r||a();const n=e[0],o=e[1],i=e[2],s=e[3],l=t[0],u=t[1],d=t[2],c=t[3];return r[0]=n*l-o*u-i*d-s*c,r[1]=n*u+o*l-i*c+s*d,r[2]=n*d+o*c+i*l-s*u,r[3]=n*c-o*d+i*u+s*l,r},e.quatInvert=function(e,t){return(t=t||a())[0]=e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}}(n||(t.Float4=n={})),function(e){function t(e){return e?(e[0]=0,e[1]=0,e[2]=0,e):n(0,0,0)}function n(e,t,a){const n=new r(3);return n[0]=e,n[1]=t,n[2]=a,n}function o(e,r,a){return(a=a||t())[0]=e[0]*r,a[1]=e[1]*r,a[2]=e[2]*r,a}e.zero=t,e.one=function(e){return e?(e[0]=1,e[1]=1,e[2]=1,e):n(1,1,1)},e.create=n,e.fromScalar=function(e){return n(e,e,e)},e.copy=function(e,r){return(r=r||t())[0]=e[0],r[1]=e[1],r[2]=e[2],r},e.set=function(e,t,r,a){return e[0]=t,e[1]=r,e[2]=a,e},e.add=function(e,r,a){return(a=a||t())[0]=e[0]+r[0],a[1]=e[1]+r[1],a[2]=e[2]+r[2],a},e.subtract=function(e,r,a){return(a=a||t())[0]=e[0]-r[0],a[1]=e[1]-r[1],a[2]=e[2]-r[2],a},e.scale=o,e.length=function(e){return Math.hypot(e[0],e[1],e[2])},e.lengthSquared=function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},e.normalize=function(e,r){r=r||t();let a=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];return a>0&&(a=1/Math.sqrt(a)),o(e,a,r)},e.multiply=function(e,r,a){return(a=a||t())[0]=e[0]*r[0],a[1]=e[1]*r[1],a[2]=e[2]*r[2],a},e.negate=function(e,r){return(r=r||t())[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r},e.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},e.cross=function(e,r,a){a=a||t();let n=e[0],o=e[1],i=e[2],s=r[0],l=r[1],u=r[2];return a[0]=o*u-i*l,a[1]=i*s-n*u,a[2]=n*l-o*s,a},e.lerp=function(e,r,a,n){return(n=n||t())[0]=e[0]+a*(r[0]-e[0]),n[1]=e[1]+a*(r[1]-e[1]),n[2]=e[2]+a*(r[2]-e[2]),n},e.fromSpherical=function(e,r,a,n){return(n=n||t())[0]=e*Math.sin(r)*Math.cos(a),n[1]=e*Math.sin(r)*Math.sin(a),n[2]=e*Math.cos(r),n},e.projectToVec2=function(e,t){switch(t){case a.X:return i.create(e[1],e[2]);case a.Y:return i.create(e[2],e[0]);case a.Z:return i.create(e[0],e[1])}}}(o||(t.Float3=o={})),function(e){function t(e){if(e)return e[0]=0,e[1]=0,e;const t=new r(2);return r!=Float32Array&&(t[0]=0,t[1]=0),t}e.zero=t,e.create=function(e,t){const a=new r(2);return a[0]=e,a[1]=t,a},e.copy=function(e,r){return(r=r||t())[0]=e[0],r[1]=e[1],r},e.set=function(e,t,r){return e[0]=t,e[1]=r,e},e.add=function(e,r,a){return(a=a||t())[0]=e[0]+r[0],a[1]=e[1]+r[1],a},e.subtract=function(e,r,a){return(a=a||t())[0]=e[0]-r[0],a[1]=e[1]-r[1],a},e.scale=function(e,r,a){return(a=a||t())[0]=e[0]*r,a[1]=e[1]*r,a},e.multiply=function(e,r,a){return(a=a||t())[0]=e[0]*r[0],a[1]=e[1]*r[1],a},e.negate=function(e,r){return(r=r||t())[0]=-e[0],r[1]=-e[1],r},e.lerp=function(e,r,a,n){return(n=n||t())[0]=e[0]+a*(r[0]-e[0]),n[1]=e[0]+a*(r[1]-e[1]),n}}(i||(t.Float2=i={}))},7604:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WoWModelViewer=void 0;const a=r(8219),n=r(6303);t.WoWModelViewer=class{constructor(e){var t,r,a;if(!(null==e?void 0:e.dataLoader))throw"dataLoader is a required argument for WoWModelViewer";if(!document&&!(null===(t=null==e?void 0:e.canvas)||void 0===t?void 0:t.createCanvas))throw"canvas.createCanvas is a required argument for WoWModelViewer when running outside of a browser context";if(!(null===(r=null==e?void 0:e.canvas)||void 0===r?void 0:r.container)&&!(null===(a=null==e?void 0:e.canvas)||void 0===a?void 0:a.createCanvas))throw"canvas.container is a required argument for WoWModelViewer when not providing a canvas via canvas.createCanvas";this.options=e,this.initialize()}addM2Model(e){const t=new a.M2Model(e);return this.addSceneObject(t),t}addWMOModel(e){const t=new a.WMOModel(e);return this.addSceneObject(t),t}addSceneObject(e){this.renderEngine.addSceneObject(e,0)}removeModelByFileId(e){const t=this.renderEngine.sceneObjects.find((t=>t.fileId===e));t&&this.removeSceneObject(t)}removeSceneObject(e){this.renderEngine.removeSceneObject(e)}useCamera(e){this.renderEngine.switchCamera(e)}useCameraFov(e){this.renderEngine.fov=e,this.renderEngine.resize(this.width,this.height)}useLightDirection(e){a.Float3.copy(a.Float3.normalize(e),this.renderEngine.lightDir)}useLightColor(e){a.Float4.copy(e,this.renderEngine.lightColor)}useAmbientColor(e){a.Float4.copy(e,this.renderEngine.ambientColor)}useClearColor(e){a.Float4.copy(e,this.renderEngine.clearColor)}showDebug(){this.renderEngine.enableDebug()}hideDebug(){this.renderEngine.disableDebug()}enableDebugPortals(){this.renderEngine.enableDebugPortals()}disableDebugPortals(){this.renderEngine.disableDebugPortals()}setDoodadRenderDistance(e){this.renderEngine.doodadRenderDistance=e}initialize(){var e,t,r,o,i,s,l,u;if(this.options.canvas.createCanvas?this.canvas=this.options.canvas.createCanvas():this.canvas=document.createElement("canvas"),document){const e=this.options.canvas.container?this.options.canvas.container:this.canvas.parentElement;e&&(this.width=e.getBoundingClientRect().width,this.height=e.getBoundingClientRect().height,this.viewerContainer=document.createElement("div"),this.viewerContainer.className="wmvts-container",this.viewerContainer.style.lineHeight="0",this.viewerContainer.style.position="relative",e.append(this.viewerContainer),this.viewerContainer.append(this.canvas),this.options.canvas.resizeToContainer)&&new ResizeObserver((()=>{this.width=this.viewerContainer.getBoundingClientRect().width,this.height=this.viewerContainer.getBoundingClientRect().height,this.resize(this.width,this.height)})).observe(this.viewerContainer)}this.options.canvas.width&&(this.width=this.options.canvas.width),this.options.canvas.height&&(this.height=this.options.canvas.height);const d=this.options.canvas.requestFrame?this.options.canvas.requestFrame:window.requestAnimationFrame.bind(window);let c=this.canvas.getContext("webgl",{alpha:!0,premultipliedAlpha:!1});const h=new a.WebGlGraphics(c);if(this.renderEngine=new a.RenderingEngine(h,this.options.dataLoader,d,{progress:this.options.progressReporter,container:this.viewerContainer,errorHandler:this.options.onError,ambientColor:null===(e=this.options.scene)||void 0===e?void 0:e.ambientColor,cacheTtl:null===(t=this.options.misc)||void 0===t?void 0:t.cacheTtl,cameraFov:null===(r=this.options.scene)||void 0===r?void 0:r.cameraFov,clearColor:null===(o=this.options.canvas)||void 0===o?void 0:o.clearColor,lightColor:null===(i=this.options.scene)||void 0===i?void 0:i.lightColor,lightDirection:null===(s=this.options.scene)||void 0===s?void 0:s.lightDirection}),this.resize(this.width,this.height),this.renderEngine.sceneCamera=null!==(u=null===(l=this.options.scene)||void 0===l?void 0:l.camera)&&void 0!==u?u:new n.Camera,this.options.scene&&this.options.scene.objects)for(const e of this.options.scene.objects)this.renderEngine.addSceneObject(e,0);this.renderEngine.start()}resize(e,t){this.renderEngine&&this.renderEngine.width===e&&this.renderEngine.height===t||(this.canvas.width=e,this.canvas.height=t,this.renderEngine.resize(e,t))}}},7690:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CachedGraphics=void 0,t.CachedGraphics=class{constructor(){}startFrame(e,t){this.lastUsedShaderProgram=void 0,this.lastUsedVertexDataBuffer=void 0,this.lastUsedVertexIndexBuffer=void 0,this.lastUsedVertexArrayObject=void 0,this.lastUsedBlendMode=void 0,this.lastUsedDepthWrite=void 0,this.lastUsedDepthTest=void 0,this.lastUsedColorMask=void 0,this.lastUsedBackFaceCulling=void 0,this.lastUsedCounterClockWiseFrontFaces=void 0}useBlendMode(e){this.lastUsedBlendMode!=e&&(this.activateBlendMode(e),this.lastUsedBlendMode=e)}useDepthWrite(e){this.lastUsedDepthWrite!=e&&(this.activateDepthWrite(e),this.lastUsedDepthWrite=e)}useDepthTest(e){this.lastUsedDepthTest!=e&&(this.activateDepthTest(e),this.lastUsedDepthWrite=e)}useBackFaceCulling(e){this.lastUsedBackFaceCulling!=e&&(this.activateBackFaceCulling(e),this.lastUsedBackFaceCulling=e)}useCounterClockWiseFrontFaces(e){this.lastUsedCounterClockWiseFrontFaces!=e&&(this.activateCounterClockWiseFrontFaces(e),this.lastUsedCounterClockWiseFrontFaces=e)}useColorMask(e){this.lastUsedColorMask!=e&&(this.activateColorMask(e),this.lastUsedColorMask=e)}useVertexIndexBuffer(e){e!=this.lastUsedVertexIndexBuffer&&(e?e.bind():this.lastUsedVertexIndexBuffer.unbind(),this.lastUsedVertexIndexBuffer=e)}useVertexDataBuffer(e){e!=this.lastUsedVertexDataBuffer&&(e?e.bind():this.lastUsedVertexDataBuffer.unbind(),this.lastUsedVertexDataBuffer=e)}useShaderProgram(e){e!=this.lastUsedShaderProgram&&(e?e.bind():this.lastUsedShaderProgram.unbind(),this.lastUsedShaderProgram=e)}useVertexArrayObject(e){e!=this.lastUsedVertexArrayObject&&(e?e.bind():this.lastUsedVertexArrayObject.unbind(),this.lastUsedVertexArrayObject=e)}}},7716:(e,t)=>{"use strict";var r,a,n,o,i,s;Object.defineProperty(t,"__esModule",{value:!0}),t.WoWParticleFlags=t.WoWTextureFlags=t.WoWTextureType=t.WoWMaterialFlags=t.WoWBoneFlags=t.WoWAnimationFlags=void 0,function(e){e[e.Init=1]="Init",e[e.Unk_0x2=2]="Unk_0x2",e[e.Unk_0x4=4]="Unk_0x4",e[e.Unk_0x8=8]="Unk_0x8",e[e.LowPrioritySequence=16]="LowPrioritySequence",e[e.PrimaryBoneSequence=32]="PrimaryBoneSequence",e[e.IsAlias=64]="IsAlias",e[e.BlendedAnimation=128]="BlendedAnimation",e[e.SequenceInModel=256]="SequenceInModel",e[e.BlendTimeInAndOut=512]="BlendTimeInAndOut",e[e.Unk_0x400=1024]="Unk_0x400",e[e.Unk_0x800=2048]="Unk_0x800",e[e.Unk_0x1000=4096]="Unk_0x1000",e[e.Unk_0x2000=8192]="Unk_0x2000"}(r||(t.WoWAnimationFlags=r={})),function(e){e[e.IgnoreParentTranslate=1]="IgnoreParentTranslate",e[e.IgnoreParentScale=2]="IgnoreParentScale",e[e.IgnoreParentRotation=4]="IgnoreParentRotation",e[e.SphericalBillboard=8]="SphericalBillboard",e[e.CylindricalBillboardLockX=16]="CylindricalBillboardLockX",e[e.CylindricalBillboardLockY=32]="CylindricalBillboardLockY",e[e.CylindricalBillboardLockZ=64]="CylindricalBillboardLockZ",e[e.Unk_0x80=128]="Unk_0x80",e[e.UNK_0x100=256]="UNK_0x100",e[e.Transformed=512]="Transformed",e[e.KinematicBone=1024]="KinematicBone",e[e.HelmetAnimScaled=4096]="HelmetAnimScaled",e[e.SomethingSequenceId=8192]="SomethingSequenceId"}(a||(t.WoWBoneFlags=a={})),function(e){e[e.None=0]="None",e[e.Unlit=1]="Unlit",e[e.Unfogged=2]="Unfogged",e[e.TwoSided=4]="TwoSided",e[e.DepthTest=8]="DepthTest",e[e.DepthWrite=16]="DepthWrite",e[e.Unknown_0x40=64]="Unknown_0x40",e[e.Unknown_0x80=128]="Unknown_0x80",e[e.Unknown_0x100=256]="Unknown_0x100",e[e.Unknown_0x200=512]="Unknown_0x200",e[e.Unknown_0x400=1024]="Unknown_0x400",e[e.PreventAlphaForCustomElements=2048]="PreventAlphaForCustomElements"}(n||(t.WoWMaterialFlags=n={})),function(e){e[e.None=0]="None",e[e.Skin=1]="Skin",e[e.ObjectSkin=2]="ObjectSkin",e[e.WeaponBlade=3]="WeaponBlade",e[e.WeaponHandle=4]="WeaponHandle",e[e.Environment=5]="Environment",e[e.CharHair=6]="CharHair",e[e.CharFacialHair=7]="CharFacialHair",e[e.SkinExtra=8]="SkinExtra",e[e.UISkin=9]="UISkin",e[e.TaurenMane=10]="TaurenMane",e[e.Monster1=11]="Monster1",e[e.Monster2=12]="Monster2",e[e.Monster3=13]="Monster3",e[e.ItemIcon=14]="ItemIcon",e[e.GuildBackgroundColor=15]="GuildBackgroundColor",e[e.GuildEmblemColor=16]="GuildEmblemColor",e[e.GuildBorderColor=17]="GuildBorderColor",e[e.GuildEmblem=18]="GuildEmblem",e[e.CharEyes=19]="CharEyes",e[e.CharJewelry=20]="CharJewelry",e[e.CharSecondarySkin=21]="CharSecondarySkin",e[e.CharSecondaryHair=22]="CharSecondaryHair",e[e.CharSecondaryArmor=23]="CharSecondaryArmor",e[e.Unknown24=24]="Unknown24",e[e.Unknown25=25]="Unknown25",e[e.Unknown26=26]="Unknown26"}(o||(t.WoWTextureType=o={})),function(e){e[e.None=0]="None",e[e.TextureWrapX=1]="TextureWrapX",e[e.TextureWrapY=2]="TextureWrapY"}(i||(t.WoWTextureFlags=i={})),function(e){e[e.AffectedByLighting=1]="AffectedByLighting",e[e.Unknown_0x02=2]="Unknown_0x02",e[e.OrientationIsAffectedByPlayerOrientation=4]="OrientationIsAffectedByPlayerOrientation",e[e.TravelUpInWorldspace=8]="TravelUpInWorldspace",e[e.DoNotTrail=16]="DoNotTrail",e[e.Unlightning=32]="Unlightning",e[e.UseBurstMulitpler=64]="UseBurstMulitpler",e[e.ParticlesInModelSpace=128]="ParticlesInModelSpace",e[e.Unknown_0x100=256]="Unknown_0x100",e[e.Unknown_0x200=512]="Unknown_0x200",e[e.PinnedParticles=1024]="PinnedParticles",e[e.Unknown_0x800=2048]="Unknown_0x800",e[e.XYQuadParticles=4096]="XYQuadParticles",e[e.ClampToGround=8192]="ClampToGround",e[e.Unknown_0x4000=16384]="Unknown_0x4000",e[e.Unknown_0x8000=32768]="Unknown_0x8000",e[e.ChooseRandomTexture=65536]="ChooseRandomTexture",e[e.OutwardParticles=131072]="OutwardParticles",e[e.Unknown_0x40000=262144]="Unknown_0x40000",e[e.ScaleVaryAffectsXAndYIndependently=524288]="ScaleVaryAffectsXAndYIndependently",e[e.Unknown_0x100000=1048576]="Unknown_0x100000",e[e.RandomFlipBookStart=2097152]="RandomFlipBookStart",e[e.IgnoreDistance=4194304]="IgnoreDistance",e[e.GravityValuesAreCompressedVectors=8388608]="GravityValuesAreCompressedVectors",e[e.BoneGeneratorIsBoneAndNotJoint=16777216]="BoneGeneratorIsBoneAndNotJoint",e[e.Unknown_0x2000000=33554432]="Unknown_0x2000000",e[e.DoNotThrottleEmissionRateBasedOnDistance=67108864]="DoNotThrottleEmissionRateBasedOnDistance",e[e.Unknown_0x8000000=134217728]="Unknown_0x8000000",e[e.UsesMultiTexturing=268435456]="UsesMultiTexturing"}(s||(t.WoWParticleFlags=s={}))},7729:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalAnimatedValueNumber=t.LocalAnimatedValueFloat2=t.LocalAnimatedFloat3=t.LocalAnimatedFloat4=t.LocalAnimatedValue=void 0;const a=r(8219);class n{constructor(e){this.timestamps=e.keys,this.values=e.values}dispose(){for(let e=0;e<this.values.length;e++)this.values[e]=null;return this.timestamps=null,this.values=null,null}getValueAtTimestamp(e,t,r,a){r||(r=this.getDefaultT());let n=a||this.values;if(this.values.length>1&&this.timestamps.length>1){var o=this.timestamps[this.timestamps.length-1];o>0&&e>o&&(e%=o);var i=0;for(let t=0;t<this.timestamps.length-1;++t)if(e>this.timestamps[t]&&e<=this.timestamps[t+1]){i=t;break}var s=this.timestamps[i],l=this.timestamps[i+1],u=0;return s!=l&&(u=(e-s)/(l-s)),this.lerpT(n[i],n[i+1],u,r)}return n.length>0?r=this.copyT(n[0],r):t}}t.LocalAnimatedValue=n,t.LocalAnimatedFloat4=class extends n{getDefaultT(){return a.Float4.zero()}copyT(e,t){return a.Float4.copy(e,t)}lerpT(e,t,r,n){return a.Float4.lerp(e,t,r,n)}},t.LocalAnimatedFloat3=class extends n{getDefaultT(){return a.Float3.zero()}copyT(e,t){return a.Float3.copy(e,t)}lerpT(e,t,r,n){return a.Float3.lerp(e,t,r,n)}},t.LocalAnimatedValueFloat2=class extends n{getDefaultT(){return a.Float2.zero()}copyT(e,t){return a.Float2.copy(e,t)}lerpT(e,t,r,n){return a.Float2.lerp(e,t,r,n)}},t.LocalAnimatedValueNumber=class extends n{getDefaultT(){return 0}copyT(e,t){return t}lerpT(e,t,r,a){return e+r*(t-e)}}},7983:function(e){var t;"undefined"!=typeof self&&self,t=()=>(()=>{"use strict";var e={"./src/attributes.js":(e,t,r)=>{function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}t.__esModule=!0,t.createAttribsFromArrays=B,t.createBufferFromArray=P,t.createBufferFromTypedArray=b,t.createBufferInfoFromArrays=function(e,t,r){var a=B(e,t),o=Object.assign({},r||{});o.attribs=Object.assign({},r?r.attribs:{},a);var i=t.indices;if(i){var s=A(i,"indices");o.indices=b(e,s,d),o.numElements=s.length,o.elementType=n.getGLTypeForTypedArray(s)}else o.numElements||(o.numElements=function(e,t){var r,a;for(a=0;a<L.length&&!((r=L[a])in t)&&!((r=v.attribPrefix+r)in t);++a);a===L.length&&(r=Object.keys(t)[0]);var n=t[r];if(!n.buffer)return 1;e.bindBuffer(u,n.buffer);var o=e.getBufferParameter(u,c);e.bindBuffer(u,null);var i,s=o/((i=n.type)===h||i===f?1:i===m||i===p?2:i===g||i===y||i===x?4:0),l=n.numComponents||n.size,d=s/l;if(d%1!=0)throw new Error("numComponents ".concat(l," not correct for length ").concat(length));return d}(e,o.attribs));return o},t.createBuffersFromArrays=function(e,t){var r={};return Object.keys(t).forEach((function(a){r[a]=P(e,t[a],a)})),t.indices?(r.numElements=t.indices.length,r.elementType=n.getGLTypeForTypedArray(A(t.indices),"indices")):r.numElements=function(e){var t,r;for(r=0;r<L.length&&!((t=L[r])in e);++r);r===L.length&&(t=Object.keys(e)[0]);var a=e[t],n=C(a).length;if(void 0===n)return 1;var o=M(a,t),i=n/o;if(n%o>0)throw new Error("numComponents ".concat(o," not correct for length ").concat(n));return i}(t),r},t.getArray_=C,t.getNumComponents_=M,t.setAttribInfoBufferFromArray=function(e,t,r,a){r=A(r),void 0!==a?(e.bindBuffer(u,t.buffer),e.bufferSubData(u,a,r)):_(e,u,t.buffer,r,t.drawType)},t.setAttributeDefaults_=function(e){o.copyExistingProperties(e,v)},t.setAttributePrefix=function(e){v.attribPrefix=e};var n=s(r("./src/typedarrays.js")),o=s(r("./src/helper.js"));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}function s(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var l=o?Object.getOwnPropertyDescriptor(e,s):null;l&&(l.get||l.set)?Object.defineProperty(n,s,l):n[s]=e[s]}return n.default=e,r&&r.set(e,n),n}var l=35044,u=34962,d=34963,c=34660,h=5120,f=5121,m=5122,p=5123,g=5124,y=5125,x=5126,v={attribPrefix:""};function _(e,t,r,a,n){e.bindBuffer(t,r),e.bufferData(t,a,n||l)}function b(e,t,r,a){if(o.isBuffer(e,t))return t;r=r||u;var n=e.createBuffer();return _(e,r,n,t,a),n}function F(e){return"indices"===e}function C(e){return e.length?e:e.data}var w=/coord|texture/i,S=/color|colour/i;function M(e,t,r){return e.numComponents||e.size||function(e,t){var r;if(t%(r=w.test(e)?2:S.test(e)?4:3)>0)throw new Error("Can not guess numComponents for attribute '".concat(e,"'. Tried ").concat(r," but ").concat(t," values is not evenly divisible by ").concat(r,". You should specify it."));return r}(t,r||C(e).length)}function A(e,t){if(n.isArrayBuffer(e))return e;if(n.isArrayBuffer(e.data))return e.data;Array.isArray(e)&&(e={data:e});var r=e.type?E(e.type):void 0;return r||(r=F(t)?Uint16Array:Float32Array),new r(e.data)}function E(e){return"number"==typeof e?n.getTypedArrayTypeForGLType(e):e||Float32Array}function D(e,t){return{buffer:t.buffer,numValues:24,type:(r=t.type,"number"==typeof r?r:r?n.getGLTypeForTypedArrayType(r):x),arrayType:E(t.type)};var r}function T(e,t){var r=t.data||t,a=E(t.type),o=r*a.BYTES_PER_ELEMENT,i=e.createBuffer();return e.bindBuffer(u,i),e.bufferData(u,o,t.drawType||l),{buffer:i,numValues:r,type:n.getGLTypeForTypedArrayType(a),arrayType:a}}function k(e,t,r){var a=A(t,r);return{arrayType:a.constructor,buffer:b(e,a,void 0,t.drawType),type:n.getGLTypeForTypedArray(a),numValues:0}}function B(e,t){var r={};return Object.keys(t).forEach((function(a){if(!F(a)){var o=t[a],i=o.attrib||o.name||o.attribName||v.attribPrefix+a;if(o.value){if(!Array.isArray(o.value)&&!n.isArrayBuffer(o.value))throw new Error("array.value is not array or typedarray");r[i]={value:o.value}}else{var s=(o.buffer&&o.buffer instanceof WebGLBuffer?D:"number"==typeof o||"number"==typeof o.data?T:k)(e,o,a),l=s.buffer,u=s.type,d=s.numValues,c=s.arrayType,h=void 0!==o.normalize?o.normalize:(m=c)===Int8Array||m===Uint8Array,f=M(o,a,d);r[i]={buffer:l,numComponents:f,type:u,normalize:h,stride:o.stride||0,offset:o.offset||0,divisor:void 0===o.divisor?void 0:o.divisor,drawType:o.drawType}}}var m})),e.bindBuffer(u,null),r}var L=["position","positions","a_position"];function P(e,t,r){var a="indices"===r?d:u;return b(e,A(t,r),a)}},"./src/draw.js":(e,t,r)=>{function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}t.__esModule=!0,t.drawBufferInfo=l,t.drawObjectList=function(e,t){var r=null,a=null;t.forEach((function(t){if(!1!==t.active){var o=t.programInfo,s=t.vertexArrayInfo||t.bufferInfo,u=!1,d=void 0===t.type?i:t.type;o!==r&&(r=o,e.useProgram(o.program),u=!0),(u||s!==a)&&(a&&a.vertexArrayObject&&!s.vertexArrayObject&&e.bindVertexArray(null),a=s,n.setBuffersAndAttributes(e,o,s)),n.setUniforms(o,t.uniforms),l(e,s,d,t.count,t.offset,t.instanceCount)}})),a&&a.vertexArrayObject&&e.bindVertexArray(null)};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var l=i?Object.getOwnPropertyDescriptor(e,s):null;l&&(l.get||l.set)?Object.defineProperty(n,s,l):n[s]=e[s]}return n.default=e,r&&r.set(e,n),n}(r("./src/programs.js"));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}var i=4,s=5123;function l(e,t,r,a,n,o){r=void 0===r?i:r;var l=t.indices,u=t.elementType,d=void 0===a?t.numElements:a;n=void 0===n?0:n,u||l?void 0!==o?e.drawElementsInstanced(r,d,void 0===u?s:t.elementType,n,o):e.drawElements(r,d,void 0===u?s:t.elementType,n):void 0!==o?e.drawArraysInstanced(r,n,d,o):e.drawArrays(r,n,d)}},"./src/framebuffers.js":(e,t,r)=>{function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}t.__esModule=!0,t.bindFramebufferInfo=function(e,t,r){r=r||l,t?(e.bindFramebuffer(r,t.framebuffer),e.viewport(0,0,t.width,t.height)):(e.bindFramebuffer(r,null),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight))},t.createFramebufferInfo=function(e,t,r,a){var i=l,s=e.createFramebuffer();e.bindFramebuffer(i,s),r=r||e.drawingBufferWidth,a=a||e.drawingBufferHeight;var h=[],f={framebuffer:s,attachments:[],width:r,height:a};return(t=t||g).forEach((function(t,s){var l=t.attachment,g=t.samples,_=t.format,b=t.attachmentPoint||function(e,t){return y[e]||y[t]}(_,t.internalFormat);if(b||(b=c+s),function(e){return e>=c&&e<c+v}(b)&&h.push(b),!l)if(void 0!==g||function(e){return x[e]}(_))l=e.createRenderbuffer(),e.bindRenderbuffer(u,l),g>1?e.renderbufferStorageMultisample(u,g,_,r,a):e.renderbufferStorage(u,_,r,a);else{var F=Object.assign({},t);F.width=r,F.height=a,void 0===F.auto&&(F.auto=!1,F.min=F.min||F.minMag||p,F.mag=F.mag||F.minMag||p,F.wrapS=F.wrapS||F.wrap||m,F.wrapT=F.wrapT||F.wrap||m),l=n.createTexture(e,F)}if(o.isRenderbuffer(e,l))e.framebufferRenderbuffer(i,b,u,l);else{if(!o.isTexture(e,l))throw new Error("unknown attachment type");void 0!==t.layer?e.framebufferTextureLayer(i,b,l,t.level||0,t.layer):e.framebufferTexture2D(i,b,t.target||d,l,t.level||0)}f.attachments.push(l)})),e.drawBuffers&&e.drawBuffers(h),f},t.resizeFramebufferInfo=function(e,t,r,a,i){a=a||e.drawingBufferWidth,i=i||e.drawingBufferHeight,t.width=a,t.height=i,(r=r||g).forEach((function(r,s){var l=t.attachments[s],d=r.format,c=r.samples;if(void 0!==c||o.isRenderbuffer(e,l))e.bindRenderbuffer(u,l),c>1?e.renderbufferStorageMultisample(u,c,d,a,i):e.renderbufferStorage(u,d,a,i);else{if(!o.isTexture(e,l))throw new Error("unknown attachment type");n.resizeTexture(e,l,r,a,i)}}))};var n=s(r("./src/textures.js")),o=s(r("./src/helper.js"));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}function s(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var l=o?Object.getOwnPropertyDescriptor(e,s):null;l&&(l.get||l.set)?Object.defineProperty(n,s,l):n[s]=e[s]}return n.default=e,r&&r.set(e,n),n}var l=36160,u=36161,d=3553,c=36064,h=36096,f=33306,m=33071,p=9729,g=[{format:6408,type:5121,min:p,wrap:m},{format:34041}],y={};y[34041]=f,y[6401]=36128,y[36168]=36128,y[6402]=h,y[33189]=h,y[33190]=h,y[36012]=h,y[35056]=f,y[36013]=f;var x={32854:!0,32855:!0,36194:!0,34041:!0,33189:!0,6401:!0,36168:!0},v=32},"./src/helper.js":(e,t)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}t.__esModule=!0,t.copyExistingProperties=function(e,t){Object.keys(t).forEach((function(r){t.hasOwnProperty(r)&&e.hasOwnProperty(r)&&(t[r]=e[r])}))},t.copyNamedProperties=function(e,t,r){e.forEach((function(e){var a=t[e];void 0!==a&&(r[e]=a)}))},t.error=function(){var e;(e=console).error.apply(e,arguments)},t.isBuffer=function(e,t){return"undefined"!=typeof WebGLBuffer&&n(t,"WebGLBuffer")},t.isRenderbuffer=function(e,t){return"undefined"!=typeof WebGLRenderbuffer&&n(t,"WebGLRenderbuffer")},t.isSampler=function(e,t){return"undefined"!=typeof WebGLSampler&&n(t,"WebGLSampler")},t.isShader=function(e,t){return"undefined"!=typeof WebGLShader&&n(t,"WebGLShader")},t.isTexture=function(e,t){return"undefined"!=typeof WebGLTexture&&n(t,"WebGLTexture")},t.warn=function(){var e;(e=console).warn.apply(e,arguments)};var a=new Map;function n(e,t){if(!e||"object"!==r(e))return!1;var n=a.get(t);n||(n=new WeakMap,a.set(t,n));var o=n.get(e);if(void 0===o){var i=Object.prototype.toString.call(e);o=i.substring(8,i.length-1)===t,n.set(e,o)}return o}},"./src/m4.js":(e,t,r)=>{function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}t.__esModule=!0,t.axisRotate=function(e,t,r,a){a=a||new u(16);var n=t[0],o=t[1],i=t[2],s=Math.sqrt(n*n+o*o+i*i),l=(n/=s)*n,d=(o/=s)*o,c=(i/=s)*i,h=Math.cos(r),f=Math.sin(r),m=1-h,p=l+(1-l)*h,g=n*o*m+i*f,y=n*i*m-o*f,x=n*o*m-i*f,v=d+(1-d)*h,_=o*i*m+n*f,b=n*i*m+o*f,F=o*i*m-n*f,C=c+(1-c)*h,w=e[0],S=e[1],M=e[2],A=e[3],E=e[4],D=e[5],T=e[6],k=e[7],B=e[8],L=e[9],P=e[10],O=e[11];return a[0]=p*w+g*E+y*B,a[1]=p*S+g*D+y*L,a[2]=p*M+g*T+y*P,a[3]=p*A+g*k+y*O,a[4]=x*w+v*E+_*B,a[5]=x*S+v*D+_*L,a[6]=x*M+v*T+_*P,a[7]=x*A+v*k+_*O,a[8]=b*w+F*E+C*B,a[9]=b*S+F*D+C*L,a[10]=b*M+F*T+C*P,a[11]=b*A+F*k+C*O,e!==a&&(a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a},t.axisRotation=function(e,t,r){r=r||new u(16);var a=e[0],n=e[1],o=e[2],i=Math.sqrt(a*a+n*n+o*o),s=(a/=i)*a,l=(n/=i)*n,d=(o/=i)*o,c=Math.cos(t),h=Math.sin(t),f=1-c;return r[0]=s+(1-s)*c,r[1]=a*n*f+o*h,r[2]=a*o*f-n*h,r[3]=0,r[4]=a*n*f-o*h,r[5]=l+(1-l)*c,r[6]=n*o*f+a*h,r[7]=0,r[8]=a*o*f+n*h,r[9]=n*o*f-a*h,r[10]=d+(1-d)*c,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},t.copy=d,t.create=function(){return new u(16).fill(0)},t.frustum=function(e,t,r,a,n,o,i){var s=t-e,l=a-r,d=n-o;return(i=i||new u(16))[0]=2*n/s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*n/l,i[6]=0,i[7]=0,i[8]=(e+t)/s,i[9]=(a+r)/l,i[10]=o/d,i[11]=-1,i[12]=0,i[13]=0,i[14]=n*o/d,i[15]=0,i},t.getAxis=function(e,t,r){var a=4*t;return(r=r||n.create())[0]=e[a+0],r[1]=e[a+1],r[2]=e[a+2],r},t.getTranslation=function(e,t){return(t=t||n.create())[0]=e[12],t[1]=e[13],t[2]=e[14],t},t.identity=c,t.inverse=h,t.lookAt=function(e,t,r,a){return a=a||new u(16),i=i||n.create(),s=s||n.create(),l=l||n.create(),n.normalize(n.subtract(e,t,l),l),n.normalize(n.cross(r,l,i),i),n.normalize(n.cross(l,i,s),s),a[0]=i[0],a[1]=i[1],a[2]=i[2],a[3]=0,a[4]=s[0],a[5]=s[1],a[6]=s[2],a[7]=0,a[8]=l[0],a[9]=l[1],a[10]=l[2],a[11]=0,a[12]=e[0],a[13]=e[1],a[14]=e[2],a[15]=1,a},t.multiply=function(e,t,r){r=r||new u(16);var a=e[0],n=e[1],o=e[2],i=e[3],s=e[4],l=e[5],d=e[6],c=e[7],h=e[8],f=e[9],m=e[10],p=e[11],g=e[12],y=e[13],x=e[14],v=e[15],_=t[0],b=t[1],F=t[2],C=t[3],w=t[4],S=t[5],M=t[6],A=t[7],E=t[8],D=t[9],T=t[10],k=t[11],B=t[12],L=t[13],P=t[14],O=t[15];return r[0]=a*_+s*b+h*F+g*C,r[1]=n*_+l*b+f*F+y*C,r[2]=o*_+d*b+m*F+x*C,r[3]=i*_+c*b+p*F+v*C,r[4]=a*w+s*S+h*M+g*A,r[5]=n*w+l*S+f*M+y*A,r[6]=o*w+d*S+m*M+x*A,r[7]=i*w+c*S+p*M+v*A,r[8]=a*E+s*D+h*T+g*k,r[9]=n*E+l*D+f*T+y*k,r[10]=o*E+d*D+m*T+x*k,r[11]=i*E+c*D+p*T+v*k,r[12]=a*B+s*L+h*P+g*O,r[13]=n*B+l*L+f*P+y*O,r[14]=o*B+d*L+m*P+x*O,r[15]=i*B+c*L+p*P+v*O,r},t.negate=function(e,t){return(t=t||new u(16))[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t[9]=-e[9],t[10]=-e[10],t[11]=-e[11],t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=-e[15],t},t.ortho=function(e,t,r,a,n,o,i){return(i=i||new u(16))[0]=2/(t-e),i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2/(a-r),i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2/(n-o),i[11]=0,i[12]=(t+e)/(e-t),i[13]=(a+r)/(r-a),i[14]=(o+n)/(n-o),i[15]=1,i},t.perspective=function(e,t,r,a,n){n=n||new u(16);var o=Math.tan(.5*Math.PI-.5*e),i=1/(r-a);return n[0]=o/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=o,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=(r+a)*i,n[11]=-1,n[12]=0,n[13]=0,n[14]=r*a*i*2,n[15]=0,n},t.rotateX=function(e,t,r){r=r||new u(16);var a=e[4],n=e[5],o=e[6],i=e[7],s=e[8],l=e[9],d=e[10],c=e[11],h=Math.cos(t),f=Math.sin(t);return r[4]=h*a+f*s,r[5]=h*n+f*l,r[6]=h*o+f*d,r[7]=h*i+f*c,r[8]=h*s-f*a,r[9]=h*l-f*n,r[10]=h*d-f*o,r[11]=h*c-f*i,e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r},t.rotateY=function(e,t,r){r=r||new u(16);var a=e[0],n=e[1],o=e[2],i=e[3],s=e[8],l=e[9],d=e[10],c=e[11],h=Math.cos(t),f=Math.sin(t);return r[0]=h*a-f*s,r[1]=h*n-f*l,r[2]=h*o-f*d,r[3]=h*i-f*c,r[8]=h*s+f*a,r[9]=h*l+f*n,r[10]=h*d+f*o,r[11]=h*c+f*i,e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r},t.rotateZ=function(e,t,r){r=r||new u(16);var a=e[0],n=e[1],o=e[2],i=e[3],s=e[4],l=e[5],d=e[6],c=e[7],h=Math.cos(t),f=Math.sin(t);return r[0]=h*a+f*s,r[1]=h*n+f*l,r[2]=h*o+f*d,r[3]=h*i+f*c,r[4]=h*s-f*a,r[5]=h*l-f*n,r[6]=h*d-f*o,r[7]=h*c-f*i,e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r},t.rotationX=function(e,t){t=t||new u(16);var r=Math.cos(e),a=Math.sin(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=a,t[7]=0,t[8]=0,t[9]=-a,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.rotationY=function(e,t){t=t||new u(16);var r=Math.cos(e),a=Math.sin(e);return t[0]=r,t[1]=0,t[2]=-a,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=a,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.rotationZ=function(e,t){t=t||new u(16);var r=Math.cos(e),a=Math.sin(e);return t[0]=r,t[1]=a,t[2]=0,t[3]=0,t[4]=-a,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.scale=function(e,t,r){r=r||new u(16);var a=t[0],n=t[1],o=t[2];return r[0]=a*e[0],r[1]=a*e[1],r[2]=a*e[2],r[3]=a*e[3],r[4]=n*e[4],r[5]=n*e[5],r[6]=n*e[6],r[7]=n*e[7],r[8]=o*e[8],r[9]=o*e[9],r[10]=o*e[10],r[11]=o*e[11],e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r},t.scaling=function(e,t){return(t=t||new u(16))[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.setAxis=function(e,t,r,a){a!==e&&(a=d(e,a));var n=4*r;return a[n+0]=t[0],a[n+1]=t[1],a[n+2]=t[2],a},t.setDefaultType=function(e){var t=u;return u=e,t},t.setTranslation=function(e,t,r){return e!==(r=r||c())&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11]),r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r},t.transformDirection=function(e,t,r){r=r||n.create();var a=t[0],o=t[1],i=t[2];return r[0]=a*e[0]+o*e[4]+i*e[8],r[1]=a*e[1]+o*e[5]+i*e[9],r[2]=a*e[2]+o*e[6]+i*e[10],r},t.transformNormal=function(e,t,r){r=r||n.create();var a=h(e),o=t[0],i=t[1],s=t[2];return r[0]=o*a[0]+i*a[1]+s*a[2],r[1]=o*a[4]+i*a[5]+s*a[6],r[2]=o*a[8]+i*a[9]+s*a[10],r},t.transformPoint=function(e,t,r){r=r||n.create();var a=t[0],o=t[1],i=t[2],s=a*e[3]+o*e[7]+i*e[11]+e[15];return r[0]=(a*e[0]+o*e[4]+i*e[8]+e[12])/s,r[1]=(a*e[1]+o*e[5]+i*e[9]+e[13])/s,r[2]=(a*e[2]+o*e[6]+i*e[10]+e[14])/s,r},t.translate=function(e,t,r){r=r||new u(16);var a=t[0],n=t[1],o=t[2],i=e[0],s=e[1],l=e[2],d=e[3],c=e[4],h=e[5],f=e[6],m=e[7],p=e[8],g=e[9],y=e[10],x=e[11],v=e[12],_=e[13],b=e[14],F=e[15];return e!==r&&(r[0]=i,r[1]=s,r[2]=l,r[3]=d,r[4]=c,r[5]=h,r[6]=f,r[7]=m,r[8]=p,r[9]=g,r[10]=y,r[11]=x),r[12]=i*a+c*n+p*o+v,r[13]=s*a+h*n+g*o+_,r[14]=l*a+f*n+y*o+b,r[15]=d*a+m*n+x*o+F,r},t.translation=function(e,t){return(t=t||new u(16))[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},t.transpose=function(e,t){var r;if((t=t||new u(16))===e)return r=e[1],e[1]=e[4],e[4]=r,r=e[2],e[2]=e[8],e[8]=r,r=e[3],e[3]=e[12],e[12]=r,r=e[6],e[6]=e[9],e[9]=r,r=e[7],e[7]=e[13],e[13]=r,r=e[11],e[11]=e[14],e[14]=r,t;var a=e[0],n=e[1],o=e[2],i=e[3],s=e[4],l=e[5],d=e[6],c=e[7],h=e[8],f=e[9],m=e[10],p=e[11],g=e[12],y=e[13],x=e[14],v=e[15];return t[0]=a,t[1]=s,t[2]=h,t[3]=g,t[4]=n,t[5]=l,t[6]=f,t[7]=y,t[8]=o,t[9]=d,t[10]=m,t[11]=x,t[12]=i,t[13]=c,t[14]=p,t[15]=v,t};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var l=i?Object.getOwnPropertyDescriptor(e,s):null;l&&(l.get||l.set)?Object.defineProperty(n,s,l):n[s]=e[s]}return n.default=e,r&&r.set(e,n),n}(r("./src/v3.js"));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}var i,s,l,u=Float32Array;function d(e,t){return(t=t||new u(16))[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function c(e){return(e=e||new u(16))[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function h(e,t){t=t||new u(16);var r=e[0],a=e[1],n=e[2],o=e[3],i=e[4],s=e[5],l=e[6],d=e[7],c=e[8],h=e[9],f=e[10],m=e[11],p=e[12],g=e[13],y=e[14],x=e[15],v=f*x,_=y*m,b=l*x,F=y*d,C=l*m,w=f*d,S=n*x,M=y*o,A=n*m,E=f*o,D=n*d,T=l*o,k=c*g,B=p*h,L=i*g,P=p*s,O=i*h,I=c*s,U=r*g,W=p*a,R=r*h,z=c*a,V=r*s,j=i*a,G=v*s+F*h+C*g-(_*s+b*h+w*g),N=_*a+S*h+E*g-(v*a+M*h+A*g),H=b*a+M*s+D*g-(F*a+S*s+T*g),q=w*a+A*s+T*h-(C*a+E*s+D*h),Z=1/(r*G+i*N+c*H+p*q);return t[0]=Z*G,t[1]=Z*N,t[2]=Z*H,t[3]=Z*q,t[4]=Z*(_*i+b*c+w*p-(v*i+F*c+C*p)),t[5]=Z*(v*r+M*c+A*p-(_*r+S*c+E*p)),t[6]=Z*(F*r+S*i+T*p-(b*r+M*i+D*p)),t[7]=Z*(C*r+E*i+D*c-(w*r+A*i+T*c)),t[8]=Z*(k*d+P*m+O*x-(B*d+L*m+I*x)),t[9]=Z*(B*o+U*m+z*x-(k*o+W*m+R*x)),t[10]=Z*(L*o+W*d+V*x-(P*o+U*d+j*x)),t[11]=Z*(I*o+R*d+j*m-(O*o+z*d+V*m)),t[12]=Z*(L*f+I*y+B*l-(O*y+k*l+P*f)),t[13]=Z*(R*y+k*n+W*f-(U*f+z*y+B*n)),t[14]=Z*(U*l+j*y+P*n-(V*y+L*n+W*l)),t[15]=Z*(V*f+O*n+z*l-(R*l+j*f+I*n)),t}},"./src/primitives.js":(e,t,r)=>{function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}t.__esModule=!0,t.concatVertices=function(e){for(var t,r={},a=function(){var a=e[n];Object.keys(a).forEach((function(e){r[e]||(r[e]=[]),t||"indices"===e||(t=e);var n=a[e],o=h(n,e),i=c(n).length/o;r[e].push(i)}))},n=0;n<e.length;++n)a();var o=r[t],i={};return Object.keys(r).forEach((function(t){var r=function(t){for(var r,a=0,n=0;n<e.length;++n){var o=e[n][t];a+=c(o).length,r&&!o.data||(r=o)}return{length:a,spec:r}}(t),a=W(r.spec,r.length);!function(t,r,a){for(var n=0,o=0,i=0;i<e.length;++i){var s=e[i][t],l=c(s);"indices"===t?(U(l,a,o,n),n+=r[i]):U(l,a,o),o+=l.length}}(t,o,c(a)),i[t]=a})),i},t.create3DFBuffers=t.create3DFBufferInfo=void 0,t.create3DFVertices=D,t.createAugmentedTypedArray=m,t.createCrescentBuffers=t.createCrescentBufferInfo=void 0,t.createCrescentVertices=T,t.createCubeBuffers=t.createCubeBufferInfo=t.createCresentVertices=t.createCresentBuffers=t.createCresentBufferInfo=void 0,t.createCubeVertices=M,t.createCylinderBuffers=t.createCylinderBufferInfo=void 0,t.createCylinderVertices=k,t.createDiscBuffers=t.createDiscBufferInfo=void 0,t.createDiscVertices=L,t.createPlaneBuffers=t.createPlaneBufferInfo=void 0,t.createPlaneVertices=C,t.createSphereBuffers=t.createSphereBufferInfo=void 0,t.createSphereVertices=w,t.createTorusBuffers=t.createTorusBufferInfo=void 0,t.createTorusVertices=B,t.createTruncatedConeBuffers=t.createTruncatedConeBufferInfo=void 0,t.createTruncatedConeVertices=A,t.createXYQuadBuffers=t.createXYQuadBufferInfo=void 0,t.createXYQuadVertices=F,t.deindexVertices=function(e){var t=e.indices,r={},a=t.length;return Object.keys(e).filter(p).forEach((function(n){for(var o=e[n],i=o.numComponents,s=m(i,a,o.constructor),l=0;l<a;++l)for(var u=t[l]*i,d=0;d<i;++d)s.push(o[u+d]);r[n]=s})),r},t.duplicateVertices=function(e){var t={};return Object.keys(e).forEach((function(r){var a=e[r],n=c(a),o=W(a,n.length);U(n,c(o),0),t[r]=o})),t},t.flattenNormals=function(e){if(e.indices)throw new Error("can not flatten normals of indexed vertices. deindex them first");for(var t=e.normal,r=t.length,a=0;a<r;a+=9){var n=t[a+0],o=t[a+1],i=t[a+2],s=t[a+3],l=t[a+4],u=t[a+5],d=n+s+t[a+6],c=o+l+t[a+7],h=i+u+t[a+8],f=Math.sqrt(d*d+c*c+h*h);d/=f,c/=f,h/=f,t[a+0]=d,t[a+1]=c,t[a+2]=h,t[a+3]=d,t[a+4]=c,t[a+5]=h,t[a+6]=d,t[a+7]=c,t[a+8]=h}return e},t.makeRandomVertexColors=function(e,t){t=t||{};var r=e.position.numElements,a=m(4,r,Uint8Array),n=t.rand||function(e,t){return t<3?256*Math.random()|0:255};if(e.color=a,e.indices)for(var o=0;o<r;++o)a.push(n(o,0),n(o,1),n(o,2),n(o,3));else for(var i=t.vertsPerColor||3,s=r/i,l=0;l<s;++l)for(var u=[n(l,0),n(l,1),n(l,2),n(l,3)],d=0;d<i;++d)a.push(u);return e},t.reorientDirections=x,t.reorientNormals=v,t.reorientPositions=_,t.reorientVertices=b;var n=d(r("./src/attributes.js")),o=d(r("./src/helper.js")),i=d(r("./src/typedarrays.js")),s=d(r("./src/m4.js")),l=d(r("./src/v3.js"));function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}function d(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var r=u(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}var c=n.getArray_,h=n.getNumComponents_;function f(e,t){var r=0;return e.push=function(){for(var t=0;t<arguments.length;++t){var a=arguments[t];if(a instanceof Array||i.isArrayBuffer(a))for(var n=0;n<a.length;++n)e[r++]=a[n];else e[r++]=a}},e.reset=function(e){r=e||0},e.numComponents=t,Object.defineProperty(e,"numElements",{get:function(){return this.length/this.numComponents|0}}),e}function m(e,t,r){return f(new(r||Float32Array)(e*t),e)}function p(e){return"indices"!==e}function g(e,t,r){for(var a=e.length,n=new Float32Array(3),o=0;o<a;o+=3)r(t,[e[o],e[o+1],e[o+2]],n),e[o]=n[0],e[o+1]=n[1],e[o+2]=n[2]}function y(e,t,r){r=r||l.create();var a=t[0],n=t[1],o=t[2];return r[0]=a*e[0]+n*e[1]+o*e[2],r[1]=a*e[4]+n*e[5]+o*e[6],r[2]=a*e[8]+n*e[9]+o*e[10],r}function x(e,t){return g(e,t,s.transformDirection),e}function v(e,t){return g(e,s.inverse(t),y),e}function _(e,t){return g(e,t,s.transformPoint),e}function b(e,t){return Object.keys(e).forEach((function(r){var a=e[r];r.indexOf("pos")>=0?_(a,t):r.indexOf("tan")>=0||r.indexOf("binorm")>=0?x(a,t):r.indexOf("norm")>=0&&v(a,t)})),e}function F(e,t,r){return e=e||2,{position:{numComponents:2,data:[(t=t||0)+-1*(e*=.5),(r=r||0)+-1*e,t+1*e,r+-1*e,t+-1*e,r+1*e,t+1*e,r+1*e]},normal:[0,0,1,0,0,1,0,0,1,0,0,1],texcoord:[0,0,1,0,0,1,1,1],indices:[0,1,2,2,1,3]}}function C(e,t,r,a,n){e=e||1,t=t||1,r=r||1,a=a||1,n=n||s.identity();for(var o=(r+1)*(a+1),i=m(3,o),l=m(3,o),u=m(2,o),d=0;d<=a;d++)for(var c=0;c<=r;c++){var h=c/r,f=d/a;i.push(e*h-.5*e,0,t*f-.5*t),l.push(0,1,0),u.push(h,f)}for(var p=r+1,g=m(3,r*a*2,Uint16Array),y=0;y<a;y++)for(var x=0;x<r;x++)g.push((y+0)*p+x,(y+1)*p+x,(y+0)*p+x+1),g.push((y+1)*p+x,(y+1)*p+x+1,(y+0)*p+x+1);return b({position:i,normal:l,texcoord:u,indices:g},n)}function w(e,t,r,a,n,o,i){if(t<=0||r<=0)throw new Error("subdivisionAxis and subdivisionHeight must be > 0");a=a||0,o=o||0;for(var s=(n=n||Math.PI)-a,l=(i=i||2*Math.PI)-o,u=(t+1)*(r+1),d=m(3,u),c=m(3,u),h=m(2,u),f=0;f<=r;f++)for(var p=0;p<=t;p++){var g=p/t,y=f/r,x=l*g+o,v=s*y+a,_=Math.sin(x),b=Math.cos(x),F=Math.sin(v),C=b*F,w=Math.cos(v),S=_*F;d.push(e*C,e*w,e*S),c.push(C,w,S),h.push(1-g,y)}for(var M=t+1,A=m(3,t*r*2,Uint16Array),E=0;E<t;E++)for(var D=0;D<r;D++)A.push((D+0)*M+E,(D+0)*M+E+1,(D+1)*M+E),A.push((D+1)*M+E,(D+0)*M+E+1,(D+1)*M+E+1);return{position:d,normal:c,texcoord:h,indices:A}}var S=[[3,7,5,1],[6,2,0,4],[6,7,3,2],[0,1,5,4],[7,6,4,5],[2,3,1,0]];function M(e){for(var t=(e=e||1)/2,r=[[-t,-t,-t],[+t,-t,-t],[-t,+t,-t],[+t,+t,-t],[-t,-t,+t],[+t,-t,+t],[-t,+t,+t],[+t,+t,+t]],a=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],n=[[1,0],[0,0],[0,1],[1,1]],o=m(3,24),i=m(3,24),s=m(2,24),l=m(3,12,Uint16Array),u=0;u<6;++u){for(var d=S[u],c=0;c<4;++c){var h=r[d[c]],f=a[u],p=n[c];o.push(h),i.push(f),s.push(p)}var g=4*u;l.push(g+0,g+1,g+2),l.push(g+0,g+2,g+3)}return{position:o,normal:i,texcoord:s,indices:l}}function A(e,t,r,a,n,o,i){if(a<3)throw new Error("radialSubdivisions must be 3 or greater");if(n<1)throw new Error("verticalSubdivisions must be 1 or greater");for(var s=void 0===o||o,l=void 0===i||i,u=(s?2:0)+(l?2:0),d=(a+1)*(n+1+u),c=m(3,d),h=m(3,d),f=m(2,d),p=m(3,a*(n+u/2)*2,Uint16Array),g=a+1,y=Math.atan2(e-t,r),x=Math.cos(y),v=Math.sin(y),_=n+(l?2:0),b=s?-2:0;b<=_;++b){var F=b/n,C=r*F,w=void 0;b<0?(C=0,F=1,w=e):b>n?(C=r,F=1,w=t):w=e+b/n*(t-e),-2!==b&&b!==n+2||(w=0,F=0),C-=r/2;for(var S=0;S<g;++S){var M=Math.sin(S*Math.PI*2/a),A=Math.cos(S*Math.PI*2/a);c.push(M*w,C,A*w),b<0?h.push(0,-1,0):b>n?h.push(0,1,0):0===w?h.push(0,0,0):h.push(M*x,v,A*x),f.push(S/a,1-F)}}for(var E=0;E<n+u;++E)if(!(1===E&&s||E===n+u-2&&l))for(var D=0;D<a;++D)p.push(g*(E+0)+0+D,g*(E+0)+1+D,g*(E+1)+1+D),p.push(g*(E+0)+0+D,g*(E+1)+1+D,g*(E+1)+0+D);return{position:c,normal:h,texcoord:f,indices:p}}function E(e,t){t=t||[];for(var r=[],a=0;a<e.length;a+=4){var n=e[a],o=e.slice(a+1,a+4);o.push.apply(o,t);for(var i=0;i<n;++i)r.push.apply(r,o)}return r}function D(){var e=[0,0,0,0,150,0,30,0,0,0,150,0,30,150,0,30,0,0,30,0,0,30,30,0,100,0,0,30,30,0,100,30,0,100,0,0,30,60,0,30,90,0,67,60,0,30,90,0,67,90,0,67,60,0,0,0,30,30,0,30,0,150,30,0,150,30,30,0,30,30,150,30,30,0,30,100,0,30,30,30,30,30,30,30,100,0,30,100,30,30,30,60,30,67,60,30,30,90,30,30,90,30,67,60,30,67,90,30,0,0,0,100,0,0,100,0,30,0,0,0,100,0,30,0,0,30,100,0,0,100,30,0,100,30,30,100,0,0,100,30,30,100,0,30,30,30,0,30,30,30,100,30,30,30,30,0,100,30,30,100,30,0,30,30,0,30,60,30,30,30,30,30,30,0,30,60,0,30,60,30,30,60,0,67,60,30,30,60,30,30,60,0,67,60,0,67,60,30,67,60,0,67,90,30,67,60,30,67,60,0,67,90,0,67,90,30,30,90,0,30,90,30,67,90,30,30,90,0,67,90,30,67,90,0,30,90,0,30,150,30,30,90,30,30,90,0,30,150,0,30,150,30,0,150,0,0,150,30,30,150,30,0,150,0,30,150,30,30,150,0,0,0,0,0,0,30,0,150,30,0,0,0,0,150,30,0,150,0],t=E([18,0,0,1,18,0,0,-1,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,-1,0,6,-1,0,0]),r=E([18,200,70,120,18,80,70,200,6,70,200,210,6,200,200,70,6,210,100,70,6,210,160,70,6,70,180,210,6,100,70,210,6,76,210,100,6,140,210,80,6,90,130,110,6,160,160,220],[255]),a=e.length/3,n={position:m(3,a),texcoord:m(2,a),normal:m(3,a),color:m(4,a,Uint8Array),indices:m(3,a/3,Uint16Array)};n.position.push(e),n.texcoord.push([.22,.19,.22,.79,.34,.19,.22,.79,.34,.79,.34,.19,.34,.19,.34,.31,.62,.19,.34,.31,.62,.31,.62,.19,.34,.43,.34,.55,.49,.43,.34,.55,.49,.55,.49,.43,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,1,1,1,0,0,1,1,1,0]),n.normal.push(t),n.color.push(r);for(var o=0;o<a;++o)n.indices.push(o);return n}function T(e,t,r,a,n,o,i){if(n<=0)throw new Error("subdivisionDown must be > 0");var s=(i=i||1)-(o=o||0),u=2*(n+1)*4,d=m(3,u),c=m(3,u),h=m(2,u);function f(e,t,r){return e+(t-e)*r}function p(t,r,i,u,m,p){for(var g=0;g<=n;g++){var y=r/1,x=g/n,v=2*(y-.5),_=(o+x*s)*Math.PI,b=Math.sin(_),F=Math.cos(_),C=f(e,t,b),w=v*a,S=F*e,M=b*C;d.push(w,S,M);var A=l.add(l.multiply([0,b,F],i),u);c.push(A),h.push(y*m+p,x)}}for(var g=0;g<2;g++){var y=2*(g/1-.5);p(t,g,[1,1,1],[0,0,0],1,0),p(t,g,[0,0,0],[y,0,0],0,0),p(r,g,[1,1,1],[0,0,0],1,0),p(r,g,[0,0,0],[y,0,0],0,1)}var x=m(3,2*n*4,Uint16Array);function v(e,t){for(var r=0;r<n;++r)x.push(e+r+0,e+r+1,t+r+0),x.push(e+r+1,t+r+1,t+r+0)}var _=n+1;return v(0*_,4*_),v(5*_,7*_),v(6*_,2*_),v(3*_,1*_),{position:d,normal:c,texcoord:h,indices:x}}function k(e,t,r,a,n,o){return A(e,e,t,r,a,n,o)}function B(e,t,r,a,n,o){if(r<3)throw new Error("radialSubdivisions must be 3 or greater");if(a<3)throw new Error("verticalSubdivisions must be 3 or greater");n=n||0;for(var i=(o=o||2*Math.PI)-n,s=r+1,l=a+1,u=s*l,d=m(3,u),c=m(3,u),h=m(2,u),f=m(3,r*a*2,Uint16Array),p=0;p<l;++p)for(var g=p/a,y=g*Math.PI*2,x=Math.sin(y),v=e+x*t,_=Math.cos(y),b=_*t,F=0;F<s;++F){var C=F/r,w=n+C*i,S=Math.sin(w),M=Math.cos(w),A=S*v,E=M*v,D=S*x,T=M*x;d.push(A,b,E),c.push(D,_,T),h.push(C,1-g)}for(var k=0;k<a;++k)for(var B=0;B<r;++B){var L=1+B,P=1+k;f.push(s*k+B,s*P+B,s*k+L),f.push(s*P+B,s*P+L,s*k+L)}return{position:d,normal:c,texcoord:h,indices:f}}function L(e,t,r,a,n){if(t<3)throw new Error("divisions must be at least 3");n=n||1,a=a||0;for(var o=(t+1)*((r=r||1)+1),i=m(3,o),s=m(3,o),l=m(2,o),u=m(3,r*t*2,Uint16Array),d=0,c=e-a,h=t+1,f=0;f<=r;++f){for(var p=a+c*Math.pow(f/r,n),g=0;g<=t;++g){var y=2*Math.PI*g/t,x=p*Math.cos(y),v=p*Math.sin(y);if(i.push(x,0,v),s.push(0,1,0),l.push(1-g/t,f/r),f>0&&g!==t){var _=d+(g+1),b=d+g,F=d+g-h,C=d+(g+1)-h;u.push(_,b,F),u.push(_,F,C)}}d+=t+1}return{position:i,normal:s,texcoord:l,indices:u}}function P(e){return function(t){var r=e.apply(this,Array.prototype.slice.call(arguments,1));return n.createBuffersFromArrays(t,r)}}function O(e){return function(t){var r=e.apply(null,Array.prototype.slice.call(arguments,1));return n.createBufferInfoFromArrays(t,r)}}var I=["numComponents","size","type","normalize","stride","offset","attrib","name","attribName"];function U(e,t,r,a){a=a||0;for(var n=e.length,o=0;o<n;++o)t[r+o]=e[o]+a}function W(e,t){var r=c(e),a=new r.constructor(t),n=a;return r.numComponents&&r.numElements&&f(a,r.numComponents),e.data&&(n={data:a},o.copyNamedProperties(I,e,n)),n}t.create3DFBufferInfo=O(D),t.create3DFBuffers=P(D),t.createCubeBufferInfo=O(M),t.createCubeBuffers=P(M),t.createPlaneBufferInfo=O(C),t.createPlaneBuffers=P(C),t.createSphereBufferInfo=O(w),t.createSphereBuffers=P(w),t.createTruncatedConeBufferInfo=O(A),t.createTruncatedConeBuffers=P(A),t.createXYQuadBufferInfo=O(F),t.createXYQuadBuffers=P(F);var R=t.createCrescentBufferInfo=O(T),z=t.createCrescentBuffers=P(T);t.createCylinderBufferInfo=O(k),t.createCylinderBuffers=P(k),t.createTorusBufferInfo=O(B),t.createTorusBuffers=P(B),t.createDiscBufferInfo=O(L),t.createDiscBuffers=P(L),t.createCresentBufferInfo=R,t.createCresentBuffers=z,t.createCresentVertices=T},"./src/programs.js":(e,t,r)=>{function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}t.__esModule=!0,t.bindTransformFeedbackInfo=Ae,t.bindUniformBlock=Be,t.createAttributeSetters=Oe,t.createProgram=me,t.createProgramAsync=void 0,t.createProgramFromScripts=function(e,t,r,a,n){var o,i=de(r,a,n),s=[],l=m(t);try{for(l.s();!(o=l.n()).done;){var u=o.value,d=v(u);if(!d)return le(i,"unknown script element: ".concat(u));s.push(d.text)}}catch(e){l.e(e)}finally{l.f()}return me(e,s,i)},t.createProgramFromSources=_e,t.createProgramInfo=Re,t.createProgramInfoAsync=void 0,t.createProgramInfoFromProgram=Ue,t.createProgramInfos=je,t.createProgramInfosAsync=void 0,t.createPrograms=Ve,t.createProgramsAsync=void 0,t.createTransformFeedback=function(e,t,r){var a=e.createTransformFeedback();return e.bindTransformFeedback(M,a),e.useProgram(t.program),Ae(e,t,r),e.bindTransformFeedback(M,null),a},t.createTransformFeedbackInfo=Me,t.createUniformBlockInfo=function(e,t,r){return ke(e,t.program,t.uniformBlockSpec,r)},t.createUniformBlockInfoFromProgram=ke,t.createUniformBlockSpecFromProgram=Ee,t.createUniformSetters=Se,t.setAttributes=Ie,t.setBlockUniforms=function(e,t){var r=e.setters;for(var a in t){var n=r[a];n&&n(t[a])}},t.setBuffersAndAttributes=function(e,t,r){r.vertexArrayObject?e.bindVertexArray(r.vertexArrayObject):(Ie(t.attribSetters||t,r.attribs),r.indices&&e.bindBuffer(C,r.indices))},t.setUniformBlock=function(e,t,r){Be(e,t,r)&&e.bufferData(w,r.array,b)},t.setUniforms=Pe,t.setUniformsAndBindTextures=void 0;var n=s(r("./src/utils.js")),o=s(r("./src/helper.js"));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(i=function(e){return e?r:t})(e)}function s(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var r=i(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var l=o?Object.getOwnPropertyDescriptor(e,s):null;l&&(l.get||l.set)?Object.defineProperty(n,s,l):n[s]=e[s]}return n.default=e,r&&r.set(e,n),n}function l(){l=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",d=i.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function h(e,t,r,a){var n=t&&t.prototype instanceof v?t:v,i=Object.create(n.prototype),s=new B(a||[]);return o(i,"_invoke",{value:E(e,r,s)}),i}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var m="suspendedStart",p="suspendedYield",g="executing",y="completed",x={};function v(){}function _(){}function b(){}var F={};c(F,s,(function(){return this}));var C=Object.getPrototypeOf,w=C&&C(C(L([])));w&&w!==r&&n.call(w,s)&&(F=w);var S=b.prototype=v.prototype=Object.create(F);function M(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function A(e,t){function r(o,i,s,l){var u=f(e[o],e,i);if("throw"!==u.type){var d=u.arg,c=d.value;return c&&"object"==a(c)&&n.call(c,"__await")?t.resolve(c.__await).then((function(e){r("next",e,s,l)}),(function(e){r("throw",e,s,l)})):t.resolve(c).then((function(e){d.value=e,s(d)}),(function(e){return r("throw",e,s,l)}))}l(u.arg)}var i;o(this,"_invoke",{value:function(e,a){function n(){return new t((function(t,n){r(e,a,t,n)}))}return i=i?i.then(n,n):n()}})}function E(t,r,a){var n=m;return function(o,i){if(n===g)throw new Error("Generator is already running");if(n===y){if("throw"===o)throw i;return{value:e,done:!0}}for(a.method=o,a.arg=i;;){var s=a.delegate;if(s){var l=D(s,a);if(l){if(l===x)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(n===m)throw n=y,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);n=g;var u=f(t,r,a);if("normal"===u.type){if(n=a.done?y:p,u.arg===x)continue;return{value:u.arg,done:a.done}}"throw"===u.type&&(n=y,a.method="throw",a.arg=u.arg)}}}function D(t,r){var a=r.method,n=t.iterator[a];if(n===e)return r.delegate=null,"throw"===a&&t.iterator.return&&(r.method="return",r.arg=e,D(t,r),"throw"===r.method)||"return"!==a&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+a+"' method")),x;var o=f(n,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,x;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,x):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,x)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function B(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function L(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,i=function r(){for(;++o<t.length;)if(n.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(a(t)+" is not iterable")}return _.prototype=b,o(S,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:_,configurable:!0}),_.displayName=c(b,d,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===_||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,c(e,d,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},M(A.prototype),c(A.prototype,u,(function(){return this})),t.AsyncIterator=A,t.async=function(e,r,a,n,o){void 0===o&&(o=Promise);var i=new A(h(e,r,a,n),o);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},M(S),c(S,d,"Generator"),c(S,s,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var a in t)r.push(a);return r.reverse(),function e(){for(;r.length;){var a=r.pop();if(a in t)return e.value=a,e.done=!1,e}return e.done=!0,e}},t.values=L,B.prototype={constructor:B,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(k),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function a(a,n){return s.type="throw",s.arg=t,r.next=a,n&&(r.method="next",r.arg=e),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],s=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(l&&u){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,x):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),x},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),x}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var a=r.completion;if("throw"===a.type){var n=a.arg;k(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,a){return this.delegate={iterator:L(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=e),x}},t}function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){var n,o,i,s;n=e,o=t,i=r[t],s=function(e){if("object"!=a(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o),(o="symbol"==a(s)?s:String(s))in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(e,t,r,a,n,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(a,n)}function h(e){return function(){var t=this,r=arguments;return new Promise((function(a,n){var o=e.apply(t,r);function i(e){c(o,a,n,i,s,"next",e)}function s(e){c(o,a,n,i,s,"throw",e)}i(void 0)}))}}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,o,i,s=[],l=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=o.call(r)).done)&&(s.push(a.value),s.length!==t);l=!0);}catch(e){u=!0,n=e}finally{try{if(!l&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw n}}return s}}(e,t)||p(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=p(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw o}}}}function p(e,t){if(e){if("string"==typeof e)return g(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g(e,t):void 0}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}var y=o.error,x=o.warn;function v(e){return"undefined"!=typeof document&&document.getElementById?document.getElementById(e):null}var _=33984,b=35048,F=34962,C=34963,w=35345,S=35982,M=36386,A=35713,E=35714,D=35632,T=35633,k=35981,B=35718,L=35721,P=35971,O=35382,I=35396,U=35398,W=35392,R=35395,z=5124,V=3553,j=34067,G=32879,N=35866,H={};function q(e,t){return H[t].bindPoint}function Z(e,t){return function(r){e.uniform1i(t,r)}}function X(e,t){return function(r){e.uniform1iv(t,r)}}function Y(e,t){return function(r){e.uniform2iv(t,r)}}function K(e,t){return function(r){e.uniform3iv(t,r)}}function J(e,t){return function(r){e.uniform4iv(t,r)}}function Q(e,t,r,a){var i=q(0,t);return n.isWebGL2(e)?function(t){var n,s;!t||o.isTexture(e,t)?(n=t,s=null):(n=t.texture,s=t.sampler),e.uniform1i(a,r),e.activeTexture(_+r),e.bindTexture(i,n),e.bindSampler(r,s)}:function(t){e.uniform1i(a,r),e.activeTexture(_+r),e.bindTexture(i,t)}}function $(e,t,r,a,i){for(var s=q(0,t),l=new Int32Array(i),u=0;u<i;++u)l[u]=r+u;return n.isWebGL2(e)?function(t){e.uniform1iv(a,l),t.forEach((function(t,a){var n,i;e.activeTexture(_+l[a]),!t||o.isTexture(e,t)?(n=t,i=null):(n=t.texture,i=t.sampler),e.bindSampler(r,i),e.bindTexture(s,n)}))}:function(t){e.uniform1iv(a,l),t.forEach((function(t,r){e.activeTexture(_+l[r]),e.bindTexture(s,t)}))}}function ee(e,t){return function(r){if(r.value)switch(e.disableVertexAttribArray(t),r.value.length){case 4:e.vertexAttrib4fv(t,r.value);break;case 3:e.vertexAttrib3fv(t,r.value);break;case 2:e.vertexAttrib2fv(t,r.value);break;case 1:e.vertexAttrib1fv(t,r.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else e.bindBuffer(F,r.buffer),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,r.numComponents||r.size,r.type||5126,r.normalize||!1,r.stride||0,r.offset||0),e.vertexAttribDivisor&&e.vertexAttribDivisor(t,r.divisor||0)}}function te(e,t){return function(r){if(r.value){if(e.disableVertexAttribArray(t),4!==r.value.length)throw new Error("The length of an integer constant value must be 4!");e.vertexAttrib4iv(t,r.value)}else e.bindBuffer(F,r.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,r.numComponents||r.size,r.type||z,r.stride||0,r.offset||0),e.vertexAttribDivisor&&e.vertexAttribDivisor(t,r.divisor||0)}}function re(e,t){return function(r){if(r.value){if(e.disableVertexAttribArray(t),4!==r.value.length)throw new Error("The length of an unsigned integer constant value must be 4!");e.vertexAttrib4uiv(t,r.value)}else e.bindBuffer(F,r.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,r.numComponents||r.size,r.type||5125,r.stride||0,r.offset||0),e.vertexAttribDivisor&&e.vertexAttribDivisor(t,r.divisor||0)}}function ae(e,t,r){var a=r.size,n=r.count;return function(r){e.bindBuffer(F,r.buffer);for(var o=r.size||r.numComponents||a,i=o/n,s=r.type||5126,l=H[s].size*o,u=r.normalize||!1,d=r.offset||0,c=l/n,h=0;h<n;++h)e.enableVertexAttribArray(t+h),e.vertexAttribPointer(t+h,i,s,u,l,d+c*h),e.vertexAttribDivisor&&e.vertexAttribDivisor(t+h,r.divisor||0)}}H[5126]={Type:Float32Array,size:4,setter:function(e,t){return function(r){e.uniform1f(t,r)}},arraySetter:function(e,t){return function(r){e.uniform1fv(t,r)}}},H[35664]={Type:Float32Array,size:8,setter:function(e,t){return function(r){e.uniform2fv(t,r)}},cols:2},H[35665]={Type:Float32Array,size:12,setter:function(e,t){return function(r){e.uniform3fv(t,r)}},cols:3},H[35666]={Type:Float32Array,size:16,setter:function(e,t){return function(r){e.uniform4fv(t,r)}},cols:4},H[z]={Type:Int32Array,size:4,setter:Z,arraySetter:X},H[35667]={Type:Int32Array,size:8,setter:Y,cols:2},H[35668]={Type:Int32Array,size:12,setter:K,cols:3},H[35669]={Type:Int32Array,size:16,setter:J,cols:4},H[5125]={Type:Uint32Array,size:4,setter:function(e,t){return function(r){e.uniform1ui(t,r)}},arraySetter:function(e,t){return function(r){e.uniform1uiv(t,r)}}},H[36294]={Type:Uint32Array,size:8,setter:function(e,t){return function(r){e.uniform2uiv(t,r)}},cols:2},H[36295]={Type:Uint32Array,size:12,setter:function(e,t){return function(r){e.uniform3uiv(t,r)}},cols:3},H[36296]={Type:Uint32Array,size:16,setter:function(e,t){return function(r){e.uniform4uiv(t,r)}},cols:4},H[35670]={Type:Uint32Array,size:4,setter:Z,arraySetter:X},H[35671]={Type:Uint32Array,size:8,setter:Y,cols:2},H[35672]={Type:Uint32Array,size:12,setter:K,cols:3},H[35673]={Type:Uint32Array,size:16,setter:J,cols:4},H[35674]={Type:Float32Array,size:32,setter:function(e,t){return function(r){e.uniformMatrix2fv(t,!1,r)}},rows:2,cols:2},H[35675]={Type:Float32Array,size:48,setter:function(e,t){return function(r){e.uniformMatrix3fv(t,!1,r)}},rows:3,cols:3},H[35676]={Type:Float32Array,size:64,setter:function(e,t){return function(r){e.uniformMatrix4fv(t,!1,r)}},rows:4,cols:4},H[35685]={Type:Float32Array,size:32,setter:function(e,t){return function(r){e.uniformMatrix2x3fv(t,!1,r)}},rows:2,cols:3},H[35686]={Type:Float32Array,size:32,setter:function(e,t){return function(r){e.uniformMatrix2x4fv(t,!1,r)}},rows:2,cols:4},H[35687]={Type:Float32Array,size:48,setter:function(e,t){return function(r){e.uniformMatrix3x2fv(t,!1,r)}},rows:3,cols:2},H[35688]={Type:Float32Array,size:48,setter:function(e,t){return function(r){e.uniformMatrix3x4fv(t,!1,r)}},rows:3,cols:4},H[35689]={Type:Float32Array,size:64,setter:function(e,t){return function(r){e.uniformMatrix4x2fv(t,!1,r)}},rows:4,cols:2},H[35690]={Type:Float32Array,size:64,setter:function(e,t){return function(r){e.uniformMatrix4x3fv(t,!1,r)}},rows:4,cols:3},H[35678]={Type:null,size:0,setter:Q,arraySetter:$,bindPoint:V},H[35680]={Type:null,size:0,setter:Q,arraySetter:$,bindPoint:j},H[35679]={Type:null,size:0,setter:Q,arraySetter:$,bindPoint:G},H[35682]={Type:null,size:0,setter:Q,arraySetter:$,bindPoint:V},H[36289]={Type:null,size:0,setter:Q,arraySetter:$,bindPoint:N},H[36292]={Type:null,size:0,setter:Q,arraySetter:$,bindPoint:N},H[36293]={Type:null,size:0,setter:Q,arraySetter:$,bindPoint:j},H[36298]={Type:null,size:0,setter:Q,arraySetter:$,bindPoint:V},H[36299]={Type:null,size:0,setter:Q,arraySetter:$,bindPoint:G},H[36300]={Type:null,size:0,setter:Q,arraySetter:$,bindPoint:j},H[36303]={Type:null,size:0,setter:Q,arraySetter:$,bindPoint:N},H[36306]={Type:null,size:0,setter:Q,arraySetter:$,bindPoint:V},H[36307]={Type:null,size:0,setter:Q,arraySetter:$,bindPoint:G},H[36308]={Type:null,size:0,setter:Q,arraySetter:$,bindPoint:j},H[36311]={Type:null,size:0,setter:Q,arraySetter:$,bindPoint:N};var ne={};ne[5126]={size:4,setter:ee},ne[35664]={size:8,setter:ee},ne[35665]={size:12,setter:ee},ne[35666]={size:16,setter:ee},ne[z]={size:4,setter:te},ne[35667]={size:8,setter:te},ne[35668]={size:12,setter:te},ne[35669]={size:16,setter:te},ne[5125]={size:4,setter:re},ne[36294]={size:8,setter:re},ne[36295]={size:12,setter:re},ne[36296]={size:16,setter:re},ne[35670]={size:4,setter:te},ne[35671]={size:8,setter:te},ne[35672]={size:12,setter:te},ne[35673]={size:16,setter:te},ne[35674]={size:4,setter:ae,count:2},ne[35675]={size:9,setter:ae,count:3},ne[35676]={size:16,setter:ae,count:4};var oe=/ERROR:\s*\d+:(\d+)/gi,ie=/^[ \t]*\n/;function se(e){var t=0;return ie.test(e)&&(t=1,e=e.replace(ie,"")),{lineOffset:t,shaderSource:e}}function le(e,t){return e.errorCallback(t),e.callback&&setTimeout((function(){e.callback("".concat(t,"\n").concat(e.errors.join("\n")))})),null}function ue(e,t,r,a){if(a=a||y,!e.getShaderParameter(r,A)){var o=e.getShaderInfoLog(r),i=se(e.getShaderSource(r)),s=i.lineOffset,l=i.shaderSource,u="".concat(function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=function(e){if(Array.isArray(e))return g(e)}(t=r.matchAll(oe))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||p(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),o=new Map(n.map((function(e,t){var a=parseInt(e[1]),o=n[t+1],i=o?o.index:r.length;return[a-1,r.substring(e.index,i)]})));return e.split("\n").map((function(e,t){var r=o.get(t);return"".concat(t+1+a,": ").concat(e).concat(r?"\n\n^^^ ".concat(r):"")})).join("\n")}(l,o,s),"\nError compiling ").concat(n.glEnumToString(e,t),": ").concat(o);return a(u),u}return""}function de(e,t,r){var a,n,o;if("function"==typeof t&&(r=t,t=void 0),"function"==typeof e)r=e,e=void 0;else if(e&&!Array.isArray(e)){var i=e;r=i.errorCallback,e=i.attribLocations,a=i.transformFeedbackVaryings,n=i.transformFeedbackMode,o=i.callback}var s=r||y,l=[],u={errorCallback:function(e){l.push(e);for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];s.apply(void 0,[e].concat(r))},transformFeedbackVaryings:a,transformFeedbackMode:n,callback:o,errors:l},d={};return Array.isArray(e)?e.forEach((function(e,r){d[e]=t?t[r]:r})):d=e||{},u.attribLocations=d,u}var ce=["VERTEX_SHADER","FRAGMENT_SHADER"],he=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(t){return setTimeout(t,e)}))};function fe(e,t,r){for(var a,n=e.createProgram(),o=de(r),i=o.attribLocations,s=o.transformFeedbackVaryings,l=o.transformFeedbackMode,u=0;u<t.length;++u){var d=t[u];if("string"==typeof d){var c=v(d),h=c?c.text:d,m=e[ce[u]];c&&c.type&&(m=((a=c.type).indexOf("frag")>=0?D:a.indexOf("vert")>=0?T:void 0)||m),d=e.createShader(m),e.shaderSource(d,se(h).shaderSource),e.compileShader(d),e.attachShader(n,d)}}Object.entries(i).forEach((function(t){var r=f(t,2),a=r[0],o=r[1];return e.bindAttribLocation(n,o,a)}));var p=s;return p&&(p.attribs&&(p=p.attribs),Array.isArray(p)||(p=Object.keys(p)),e.transformFeedbackVaryings(n,p,l||k)),e.linkProgram(n),n}function me(e,t,r,a,n){var o=de(r,a,n),i=new Set(t),s=fe(e,t,o);function l(e,t){var r=ve(e,t,o.errorCallback);return r&&function(e,t,r){var a,n=m(e.getAttachedShaders(t));try{for(n.s();!(a=n.n()).done;){var o=a.value;r.has(o)&&e.deleteShader(o)}}catch(e){n.e(e)}finally{n.f()}e.deleteProgram(t)}(e,t,i),r}if(!o.callback)return l(e,s)?void 0:s;ge(e,s).then((function(){var t=l(e,s);o.callback(t,t?void 0:s)}))}function pe(e){return function(t,r){for(var a=arguments.length,n=new Array(a>2?a-2:0),o=2;o<a;o++)n[o-2]=arguments[o];return new Promise((function(a,o){var i=de.apply(void 0,n);i.callback=function(e,t){e?o(e):a(t)},e(t,r,i)}))}}function ge(e,t){return ye.apply(this,arguments)}function ye(){return(ye=h(l().mark((function e(t,r){var a,n,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=t.getExtension("KHR_parallel_shader_compile"),n=a?function(e,t){return e.getProgramParameter(t,a.COMPLETION_STATUS_KHR)}:function(){return!0},o=0;case 3:return e.next=5,he(o);case 5:o=1e3/60;case 6:if(!n(t,r)){e.next=3;break}case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xe(){return(xe=h(l().mark((function e(t,r){var a,n,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=0,n=Object.values(r);case 1:if(!(a<n.length)){e.next=8;break}return o=n[a],e.next=5,ge(t,o);case 5:a++,e.next=1;break;case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ve(e,t,r){if(r=r||y,!e.getProgramParameter(t,E)){var a=e.getProgramInfoLog(t);r("Error in program linking: ".concat(a));var n=e.getAttachedShaders(t).map((function(t){return ue(e,e.getShaderParameter(t,e.SHADER_TYPE),t,r)}));return"".concat(a,"\n").concat(n.filter((function(e){return e})).join("\n"))}}function _e(e,t,r,a,n){return me(e,t,r,a,n)}function be(e){var t=e.name;return t.startsWith("gl_")||t.startsWith("webgl_")}t.createProgramAsync=pe(me),t.createProgramInfoAsync=pe(Re);var Fe=/(\.|\[|]|\w+)/g,Ce=function(e){return e>="0"&&e<="9"};function we(e,t,r,a){for(var n=e.split(Fe).filter((function(e){return""!==e})),o=0,i="";;){var s=n[o++];i+=s;var l=Ce(s[0]),u=l?parseInt(s):s;if(l&&(i+=n[o++]),o===n.length){r[u]=t;break}var d=n[o++],c="["===d,h=r[u]||(c?[]:{});r[u]=h,r=h,a[i]=a[i]||function(e){return function(t){Le(e,t)}}(h),i+=d}}function Se(e,t){var r=0;function a(t,a,n){var o,i=a.name.endsWith("[0]"),s=a.type,l=H[s];if(!l)throw new Error("unknown type: 0x".concat(s.toString(16)));if(l.bindPoint){var u=r;r+=a.size,o=i?l.arraySetter(e,s,u,n,a.size):l.setter(e,s,u,n,a.size)}else o=l.arraySetter&&i?l.arraySetter(e,n):l.setter(e,n);return o.location=n,o}for(var n={},o={},i=e.getProgramParameter(t,B),s=0;s<i;++s){var l=e.getActiveUniform(t,s);if(!be(l)){var u=l.name;u.endsWith("[0]")&&(u=u.substr(0,u.length-3));var d=e.getUniformLocation(t,l.name);if(d){var c=a(0,l,d);n[u]=c,we(u,c,o,n)}}}return n}function Me(e,t){for(var r={},a=e.getProgramParameter(t,P),n=0;n<a;++n){var o=e.getTransformFeedbackVarying(t,n);r[o.name]={index:n,type:o.type,size:o.size}}return r}function Ae(e,t,r){for(var a in t.transformFeedbackInfo&&(t=t.transformFeedbackInfo),r.attribs&&(r=r.attribs),r){var n=t[a];if(n){var o=r[a];o.offset?e.bindBufferRange(S,n.index,o.buffer,o.offset,o.size):e.bindBufferBase(S,n.index,o.buffer)}}}function Ee(e,t){for(var r=e.getProgramParameter(t,B),a=[],n=[],o=0;o<r;++o){n.push(o),a.push({});var i=e.getActiveUniform(t,o);a[o].name=i.name}[["UNIFORM_TYPE","type"],["UNIFORM_SIZE","size"],["UNIFORM_BLOCK_INDEX","blockNdx"],["UNIFORM_OFFSET","offset"]].forEach((function(r){var o=r[0],i=r[1];e.getActiveUniforms(t,n,e[o]).forEach((function(e,t){a[t][i]=e}))}));for(var s={},l=e.getProgramParameter(t,O),u=0;u<l;++u){var d=e.getActiveUniformBlockName(t,u),c={index:e.getUniformBlockIndex(t,d),usedByVertexShader:e.getActiveUniformBlockParameter(t,u,I),usedByFragmentShader:e.getActiveUniformBlockParameter(t,u,U),size:e.getActiveUniformBlockParameter(t,u,W),uniformIndices:e.getActiveUniformBlockParameter(t,u,R)};c.used=c.usedByVertexShader||c.usedByFragmentShader,s[d]=c}return{blockSpecs:s,uniformData:a}}var De=/\[\d+\]\.$/,Te=function(e,t){return((e+(t-1))/t|0)*t};function ke(e,t,r,a){var n=r.blockSpecs,o=r.uniformData,i=n[a];if(!i)return x("no uniform block object named:",a),{name:a,uniforms:{}};var s=new ArrayBuffer(i.size),l=e.createBuffer(),u=i.index;e.bindBuffer(w,l),e.uniformBlockBinding(t,i.index,u);var d=a+".";De.test(d)&&(d=d.replace(De,"."));var c={},h={},f={};return i.uniformIndices.forEach((function(e){var t=o[e],r=t.name;r.startsWith(d)&&(r=r.substr(d.length));var a=r.endsWith("[0]");a&&(r=r.substr(0,r.length-3));var n=H[t.type],i=n.Type,l=a?Te(n.size,16)*t.size:n.size*t.size,u=new i(s,t.offset,l/i.BYTES_PER_ELEMENT);c[r]=u;var m=function(e,t,r,a){if(t||r){a=a||1;var n=e.length/4;return function(t){for(var r=0,o=0,i=0;i<n;++i){for(var s=0;s<a;++s)e[r++]=t[o++];r+=4-a}}}return function(t){t.length?e.set(t):e[0]=t}}(u,a,n.rows,n.cols);h[r]=m,we(r,m,f,h)})),{name:a,array:s,asFloat:new Float32Array(s),buffer:l,uniforms:c,setters:h}}function Be(e,t,r){var a=(t.uniformBlockSpec||t).blockSpecs[r.name];if(a){var n=a.index;return e.bindBufferRange(w,n,r.buffer,r.offset||0,r.array.byteLength),!0}return!1}function Le(e,t){for(var r in t){var a=e[r];"function"==typeof a?a(t[r]):Le(e[r],t[r])}}function Pe(e){for(var t=e.uniformSetters||e,r=arguments.length<=1?0:arguments.length-1,a=0;a<r;++a){var n=a+1<1||arguments.length<=a+1?void 0:arguments[a+1];if(Array.isArray(n))for(var o=n.length,i=0;i<o;++i)Pe(t,n[i]);else for(var s in n){var l=t[s];l&&l(n[s])}}}function Oe(e,t){for(var r={},a=e.getProgramParameter(t,L),n=0;n<a;++n){var o=e.getActiveAttrib(t,n);if(!be(o)){var i=e.getAttribLocation(t,o.name),s=ne[o.type],l=s.setter(e,i,s);l.location=i,r[o.name]=l}}return r}function Ie(e,t){for(var r in t){var a=e[r];a&&a(t[r])}}function Ue(e,t){var r={program:t,uniformSetters:Se(e,t),attribSetters:Oe(e,t)};return n.isWebGL2(e)&&(r.uniformBlockSpec=Ee(e,t),r.transformFeedbackInfo=Me(e,t)),r}t.setUniformsAndBindTextures=Pe;var We=/\s|{|}|;/;function Re(e,t,r,a,n){var o=de(r,a,n),i=[];if(t=t.map((function(e){if(!We.test(e)){var t=v(e);if(t)e=t.text;else{var r="no element with id: ".concat(e);o.errorCallback(r),i.push(r)}}return e})),i.length)return le(o,"");var s=o.callback;s&&(o.callback=function(t,r){s(t,t?void 0:Ue(e,r))});var l=_e(e,t,o);return l?Ue(e,l):null}function ze(e,t,r,a,n){for(var o=0,i=Object.entries(t);o<i.length;o++){var s=f(i[o],2),l=s[0],u=s[1],c=d({},n),h=r[l];Array.isArray(h)||Object.assign(c,h);var p=ve(e,u,c.errorCallback);if(p){for(var g=0,y=Object.values(t);g<y.length;g++){var x=y[g],v=e.getAttachedShaders(x);e.deleteProgram(x);var _,b=m(v);try{for(b.s();!(_=b.n()).done;){var F=_.value;a.has(F)||e.deleteShader(F)}}catch(e){b.e(e)}finally{b.f()}}return p}}}function Ve(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=new Set,n=Object.fromEntries(Object.entries(t).map((function(t){var n=f(t,2),o=n[0],i=n[1],s=d({},r),l=Array.isArray(i)?i:i.shaders;return Array.isArray(i)||Object.assign(s,i),l.forEach(a.add,a),[o,fe(e,l,s)]})));if(!r.callback)return ze(e,n,t,a,r)?void 0:n;(function(e,t){return xe.apply(this,arguments)})(e,n).then((function(){var o=ze(e,n,t,a,r);r.callback(o,o?void 0:n)}))}function je(e,t,r){function a(e,t){return Object.fromEntries(Object.entries(t).map((function(t){var r=f(t,2),a=r[0],n=r[1];return[a,Ue(e,n)]})))}var n=(r=de(r)).callback;n&&(r.callback=function(t,r){n(t,t?void 0:a(e,r))});var o=Ve(e,t,r);if(!n&&o)return a(e,o)}t.createProgramsAsync=pe(Ve),t.createProgramInfosAsync=pe(je)},"./src/textures.js":(e,t,r)=>{function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}t.__esModule=!0,t.canFilter=Tt,t.canGenerateMipmap=Dt,t.createSampler=Rt,t.createSamplers=function(e,t){var r={};return Object.keys(t).forEach((function(a){r[a]=Rt(e,t[a])})),r},t.createTexture=Qt,t.createTextures=function(e,t,r){r=r||Ht;var a=0,n=[],o={},i={};function s(){0===a&&setTimeout((function(){r(n.length?n:void 0,o,i)}),0)}return Object.keys(t).forEach((function(r){var l,u,d=t[r];("string"==typeof(u=d.src)||Array.isArray(u)&&"string"==typeof u[0])&&(l=function(e,t,o){i[r]=o,--a,e&&n.push(e),s()},++a),o[r]=Qt(e,d,l)})),s(),o},t.getBytesPerElementForInternalFormat=Mt,t.getFormatAndTypeForInternalFormat=At,t.getNumComponentsForFormat=function(e){var t=Ct[e];if(!t)throw"unknown format: "+e;return t.numColorComponents},t.loadTextureFromUrl=Yt,t.resizeTexture=function(e,t,r,a,n,o){a=a||r.width,n=n||r.height,o=o||r.depth;var i=r.target||w;e.bindTexture(i,t);var s,l=r.level||0,u=r.internalFormat||r.format||g,d=At(u),c=r.format||d.format,f=r.src;if(s=f&&(h(f)||Array.isArray(f)&&"number"==typeof f[0])?r.type||kt(0,f,d.type):r.type||d.type,i===S)for(var m=0;m<6;++m)e.texImage2D(E+m,l,u,a,n,0,c,s,null);else i===M||i===A?e.texImage3D(i,l,u,a,n,o,0,c,s,null):e.texImage2D(i,l,u,a,n,0,c,s,null)},t.setDefaultTextureColor=Lt,t.setEmptyTexture=Jt,t.setSamplerParameters=Wt,t.setTextureDefaults_=function(e){i.copyExistingProperties(e,c),e.textureColor&&Lt(e.textureColor)},t.setTextureFilteringForSize=zt,t.setTextureFromArray=Kt,t.setTextureFromElement=Nt,t.setTextureParameters=Ut;var n=l(r("./src/utils.js")),o=l(r("./src/typedarrays.js")),i=l(r("./src/helper.js"));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}function l(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var l=o?Object.getOwnPropertyDescriptor(e,i):null;l&&(l.get||l.set)?Object.defineProperty(n,i,l):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}var u,d,c={textureColor:new Uint8Array([128,192,255,255]),textureOptions:{},crossOrigin:void 0},h=o.isArrayBuffer,f=function(){return u=u||("undefined"!=typeof document&&document.createElement?document.createElement("canvas").getContext("2d"):null)},m=6406,p=6407,g=6408,y=6409,x=6410,v=6402,_=34041,b=33071,F=9728,C=9729,w=3553,S=34067,M=32879,A=35866,E=34069,D=34070,T=34071,k=34072,B=34073,L=34074,P=10241,O=10240,I=10242,U=10243,W=32882,R=33082,z=33083,V=33084,j=33085,G=34892,N=34893,H=3317,q=3314,Z=32878,X=3316,Y=3315,K=32877,J=37443,Q=37441,$=37440,ee=33321,te=36756,re=33325,ae=33326,ne=33330,oe=33329,ie=33338,se=33337,le=33340,ue=33339,de=33323,ce=36757,he=33327,fe=33328,me=33336,pe=33335,ge=33332,ye=33331,xe=33334,ve=33333,_e=32849,be=35905,Fe=36194,Ce=36758,we=35898,Se=35901,Me=34843,Ae=34837,Ee=36221,De=36239,Te=36215,ke=36233,Be=36209,Le=36227,Pe=32856,Oe=35907,Ie=36759,Ue=32855,We=32854,Re=32857,ze=34842,Ve=34836,je=36220,Ge=36238,Ne=36975,He=36214,qe=36232,Ze=36226,Xe=36208,Ye=33189,Ke=33190,Je=36012,Qe=36013,$e=35056,et=5120,tt=5121,rt=5122,at=5123,nt=5124,ot=5125,it=5126,st=32819,lt=32820,ut=33635,dt=5131,ct=36193,ht=33640,ft=35899,mt=35902,pt=36269,gt=34042,yt=33319,xt=33320,vt=6403,_t=36244,bt=36248,Ft=36249,Ct={},wt=Ct;function St(e){if(!d){var t={};t[m]={textureFormat:m,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[tt,dt,ct,it]},t[y]={textureFormat:y,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[tt,dt,ct,it]},t[x]={textureFormat:x,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2,4,4,8],type:[tt,dt,ct,it]},t[p]={textureFormat:p,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,6,6,12,2],type:[tt,dt,ct,it,ut]},t[g]={textureFormat:g,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,8,8,16,2,2],type:[tt,dt,ct,it,st,lt]},t[v]={textureFormat:v,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[ot,at]},t[ee]={textureFormat:vt,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1],type:[tt]},t[te]={textureFormat:vt,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[1],type:[et]},t[re]={textureFormat:vt,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4,2],type:[it,dt]},t[ae]={textureFormat:vt,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[4],type:[it]},t[ne]={textureFormat:_t,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[tt]},t[oe]={textureFormat:_t,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[et]},t[ge]={textureFormat:_t,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[at]},t[ye]={textureFormat:_t,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[rt]},t[xe]={textureFormat:_t,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[ot]},t[ve]={textureFormat:_t,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[nt]},t[de]={textureFormat:yt,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2],type:[tt]},t[ce]={textureFormat:yt,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[2],type:[et]},t[he]={textureFormat:yt,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[8,4],type:[it,dt]},t[fe]={textureFormat:yt,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[8],type:[it]},t[me]={textureFormat:xt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[tt]},t[pe]={textureFormat:xt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[et]},t[ie]={textureFormat:xt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[at]},t[se]={textureFormat:xt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[rt]},t[le]={textureFormat:xt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[ot]},t[ue]={textureFormat:xt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[nt]},t[_e]={textureFormat:p,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3],type:[tt]},t[be]={textureFormat:p,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[tt]},t[Fe]={textureFormat:p,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,2],type:[tt,ut]},t[Ce]={textureFormat:p,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[et]},t[we]={textureFormat:p,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[it,dt,ft]},t[Se]={textureFormat:p,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[it,dt,mt]},t[Me]={textureFormat:p,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6],type:[it,dt]},t[Ae]={textureFormat:p,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[it]},t[Ee]={textureFormat:bt,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[tt]},t[De]={textureFormat:bt,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[et]},t[Te]={textureFormat:bt,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[at]},t[ke]={textureFormat:bt,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[rt]},t[Be]={textureFormat:bt,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[ot]},t[Le]={textureFormat:bt,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[nt]},t[Pe]={textureFormat:g,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[tt]},t[Oe]={textureFormat:g,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[tt]},t[Ie]={textureFormat:g,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4],type:[et]},t[Ue]={textureFormat:g,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2,4],type:[tt,lt,ht]},t[We]={textureFormat:g,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2],type:[tt,st]},t[Re]={textureFormat:g,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[ht]},t[ze]={textureFormat:g,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[16,8],type:[it,dt]},t[Ve]={textureFormat:g,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[16],type:[it]},t[je]={textureFormat:Ft,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[tt]},t[Ge]={textureFormat:Ft,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[et]},t[Ne]={textureFormat:Ft,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[ht]},t[He]={textureFormat:Ft,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[at]},t[qe]={textureFormat:Ft,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[rt]},t[Ze]={textureFormat:Ft,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[nt]},t[Xe]={textureFormat:Ft,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[ot]},t[Ye]={textureFormat:v,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[at,ot]},t[Ke]={textureFormat:v,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[ot]},t[Je]={textureFormat:v,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[it]},t[$e]={textureFormat:_,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[gt]},t[Qe]={textureFormat:_,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[pt]},Object.keys(t).forEach((function(e){var r=t[e];r.bytesPerElementMap={},r.bytesPerElement.forEach((function(e,t){var a=r.type[t];r.bytesPerElementMap[a]=e}))})),d=t}return d[e]}function Mt(e,t){var r=St(e);if(!r)throw"unknown internal format";var a=r.bytesPerElementMap[t];if(void 0===a)throw"unknown internal format";return a}function At(e){var t=St(e);if(!t)throw"unknown internal format";return{format:t.textureFormat,type:t.type[0]}}function Et(e){return!(e&e-1)}function Dt(e,t,r,a){if(!n.isWebGL2(e))return Et(t)&&Et(r);var o=St(a);if(!o)throw"unknown internal format";return o.colorRenderable&&o.textureFilterable}function Tt(e){var t=St(e);if(!t)throw"unknown internal format";return t.textureFilterable}function kt(e,t,r){return h(t)?o.getGLTypeForTypedArray(t):r||tt}function Bt(e,t,r,a,n){if(n%1!=0)throw"can't guess dimensions";if(r||a){if(a){if(!r&&(r=n/a)%1)throw"can't guess dimensions"}else if((a=n/r)%1)throw"can't guess dimensions"}else{var o=Math.sqrt(n/(t===S?6:1));o%1==0?(r=o,a=o):(r=n,a=1)}return{width:r,height:a}}function Lt(e){c.textureColor=new Uint8Array([255*e[0],255*e[1],255*e[2],255*e[3]])}function Pt(e,t){void 0!==t.colorspaceConversion&&e.pixelStorei(J,t.colorspaceConversion),void 0!==t.premultiplyAlpha&&e.pixelStorei(Q,t.premultiplyAlpha),void 0!==t.flipY&&e.pixelStorei($,t.flipY)}function Ot(e){e.pixelStorei(H,4),n.isWebGL2(e)&&(e.pixelStorei(q,0),e.pixelStorei(Z,0),e.pixelStorei(X,0),e.pixelStorei(Y,0),e.pixelStorei(K,0))}function It(e,t,r,a){a.minMag&&(r.call(e,t,P,a.minMag),r.call(e,t,O,a.minMag)),a.min&&r.call(e,t,P,a.min),a.mag&&r.call(e,t,O,a.mag),a.wrap&&(r.call(e,t,I,a.wrap),r.call(e,t,U,a.wrap),(t===M||i.isSampler(e,t))&&r.call(e,t,W,a.wrap)),a.wrapR&&r.call(e,t,W,a.wrapR),a.wrapS&&r.call(e,t,I,a.wrapS),a.wrapT&&r.call(e,t,U,a.wrapT),void 0!==a.minLod&&r.call(e,t,R,a.minLod),void 0!==a.maxLod&&r.call(e,t,z,a.maxLod),void 0!==a.baseLevel&&r.call(e,t,V,a.baseLevel),void 0!==a.maxLevel&&r.call(e,t,j,a.maxLevel),void 0!==a.compareFunc&&r.call(e,t,N,a.compareFunc),void 0!==a.compareMode&&r.call(e,t,G,a.compareMode)}function Ut(e,t,r){var a=r.target||w;e.bindTexture(a,t),It(e,a,e.texParameteri,r)}function Wt(e,t,r){It(e,t,e.samplerParameteri,r)}function Rt(e,t){var r=e.createSampler();return Wt(e,r,t),r}function zt(e,t,r,a,n,o){r=r||c.textureOptions,o=o||g;var i=r.target||w;if(a=a||r.width,n=n||r.height,e.bindTexture(i,t),Dt(e,a,n,o))e.generateMipmap(i);else{var s=Tt(o)?C:F;e.texParameteri(i,P,s),e.texParameteri(i,O,s),e.texParameteri(i,I,b),e.texParameteri(i,U,b)}}function Vt(e){return!0===e.auto||void 0===e.auto&&void 0===e.level}function jt(e,t){return(t=t||{}).cubeFaceOrder||[E,D,T,k,B,L]}function Gt(e,t){var r=jt(0,t).map((function(e,t){return{face:e,ndx:t}}));return r.sort((function(e,t){return e.face-t.face})),r}function Nt(e,t,r,a){var n=(a=a||c.textureOptions).target||w,o=a.level||0,i=r.width,s=r.height,l=a.internalFormat||a.format||g,u=At(l),d=a.format||u.format,h=a.type||u.type;if(Pt(e,a),e.bindTexture(n,t),n===S){var m,p,y=r.width,x=r.height;if(y/6===x)m=x,p=[0,0,1,0,2,0,3,0,4,0,5,0];else if(x/6===y)m=y,p=[0,0,0,1,0,2,0,3,0,4,0,5];else if(y/3==x/2)m=y/3,p=[0,0,1,0,2,0,0,1,1,1,2,1];else{if(y/2!=x/3)throw"can't figure out cube map from element: "+(r.src?r.src:r.nodeName);m=y/2,p=[0,0,1,0,0,1,1,1,0,2,1,2]}var v=f();v?(v.canvas.width=m,v.canvas.height=m,i=m,s=m,Gt(0,a).forEach((function(t){var a=p[2*t.ndx+0]*m,n=p[2*t.ndx+1]*m;v.drawImage(r,a,n,m,m,0,0,m,m),e.texImage2D(t.face,o,l,d,h,v.canvas)})),v.canvas.width=1,v.canvas.height=1):"undefined"!=typeof createImageBitmap&&(i=m,s=m,Gt(0,a).forEach((function(u){var c=p[2*u.ndx+0]*m,f=p[2*u.ndx+1]*m;e.texImage2D(u.face,o,l,m,m,0,d,h,null),createImageBitmap(r,c,f,m,m,{premultiplyAlpha:"none",colorSpaceConversion:"none"}).then((function(r){Pt(e,a),e.bindTexture(n,t),e.texImage2D(u.face,o,l,d,h,r),Vt(a)&&zt(e,t,a,i,s,l)}))})))}else if(n===M||n===A){var _=Math.min(r.width,r.height),b=Math.max(r.width,r.height),F=b/_;if(F%1!=0)throw"can not compute 3D dimensions of element";var C=r.width===b?1:0,E=r.height===b?1:0;e.pixelStorei(H,1),e.pixelStorei(q,r.width),e.pixelStorei(Z,0),e.pixelStorei(K,0),e.texImage3D(n,o,l,_,_,_,0,d,h,null);for(var D=0;D<F;++D){var T=D*_*C,k=D*_*E;e.pixelStorei(X,T),e.pixelStorei(Y,k),e.texSubImage3D(n,o,0,0,D,_,_,1,d,h,r)}Ot(e)}else e.texImage2D(n,o,l,d,h,r);Vt(a)&&zt(e,t,a,i,s,l),Ut(e,t,a)}function Ht(){}function qt(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof ImageData&&e instanceof ImageData||"undefined"!=typeof HTMLElement&&e instanceof HTMLElement}function Zt(e,t,r){return qt(e)?(setTimeout((function(){r(null,e)})),e):function(e,t,r){var a;if(r=r||Ht,t=void 0!==t?t:c.crossOrigin,t=function(e,t){return void 0!==t||function(e){if("undefined"!=typeof document){var t=document.createElement("a");return t.href=e,t.hostname===location.hostname&&t.port===location.port&&t.protocol===location.protocol}var r=new URL(location.href).origin;return new URL(e,location.href).origin===r}(e)?t:"anonymous"}(e,t),"undefined"!=typeof Image){a=new Image,void 0!==t&&(a.crossOrigin=t);var n=function(){a.removeEventListener("error",o),a.removeEventListener("load",s),a=null},o=function(){var t="couldn't load image: "+e;i.error(t),r(t,a),n()},s=function(){r(null,a),n()};return a.addEventListener("error",o),a.addEventListener("load",s),a.src=e,a}if("undefined"!=typeof ImageBitmap){var l,u,d=function(){r(l,u)},h={};t&&(h.mode="cors"),fetch(e,h).then((function(e){if(!e.ok)throw e;return e.blob()})).then((function(e){return createImageBitmap(e,{premultiplyAlpha:"none",colorSpaceConversion:"none"})})).then((function(e){u=e,setTimeout(d)})).catch((function(e){l=e,setTimeout(d)})),a=null}return a}(e,t,r)}function Xt(e,t,r){var a=(r=r||c.textureOptions).target||w;if(e.bindTexture(a,t),!1!==r.color){var n=function(e){return e=e||c.textureColor,h(e)?e:new Uint8Array([255*e[0],255*e[1],255*e[2],255*e[3]])}(r.color);if(a===S)for(var o=0;o<6;++o)e.texImage2D(E+o,0,g,1,1,0,g,tt,n);else a===M||a===A?e.texImage3D(a,0,g,1,1,1,0,g,tt,n):e.texImage2D(a,0,g,1,1,0,g,tt,n)}}function Yt(e,t,r,a){return a=a||Ht,r=r||c.textureOptions,Xt(e,t,r),Zt((r=Object.assign({},r)).src,r.crossOrigin,(function(n,o){n?a(n,t,o):(Nt(e,t,o,r),a(null,t,o))}))}function Kt(e,t,r,a){var i=(a=a||c.textureOptions).target||w;e.bindTexture(i,t);var s=a.width,l=a.height,u=a.depth,d=a.level||0,f=a.internalFormat||a.format||g,m=At(f),p=a.format||m.format,y=a.type||kt(0,r,m.type);if(h(r))r instanceof Uint8ClampedArray&&(r=new Uint8Array(r.buffer));else{var x=o.getTypedArrayTypeForGLType(y);r=new x(r)}var v,_=Mt(f,y),b=r.byteLength/_;if(b%1)throw"length wrong size for format: "+n.glEnumToString(e,p);if(i===M||i===A)if(s||l||u)!s||l&&u?!l||s&&u?(v=Bt(0,i,s,l,b/u),s=v.width,l=v.height):(v=Bt(0,i,s,u,b/l),s=v.width,u=v.height):(v=Bt(0,i,l,u,b/s),l=v.width,u=v.height);else{var F=Math.cbrt(b);if(F%1!=0)throw"can't guess cube size of array of numElements: "+b;s=F,l=F,u=F}else v=Bt(0,i,s,l,b),s=v.width,l=v.height;if(Ot(e),e.pixelStorei(H,a.unpackAlignment||1),Pt(e,a),i===S){var C=b/6*(_/r.BYTES_PER_ELEMENT);Gt(0,a).forEach((function(t){var a=C*t.ndx,n=r.subarray(a,a+C);e.texImage2D(t.face,d,f,s,l,0,p,y,n)}))}else i===M||i===A?e.texImage3D(i,d,f,s,l,u,0,p,y,r):e.texImage2D(i,d,f,s,l,0,p,y,r);return{width:s,height:l,depth:u,type:y}}function Jt(e,t,r){var a=r.target||w;e.bindTexture(a,t);var n=r.level||0,o=r.internalFormat||r.format||g,i=At(o),s=r.format||i.format,l=r.type||i.type;if(Pt(e,r),a===S)for(var u=0;u<6;++u)e.texImage2D(E+u,n,o,r.width,r.height,0,s,l,null);else a===M||a===A?e.texImage3D(a,n,o,r.width,r.height,r.depth,0,s,l,null):e.texImage2D(a,n,o,r.width,r.height,0,s,l,null)}function Qt(e,t,r){r=r||Ht,t=t||c.textureOptions;var a=e.createTexture(),n=t.target||w,o=t.width||1,i=t.height||1,s=t.internalFormat||g;e.bindTexture(n,a),n===S&&(e.texParameteri(n,I,b),e.texParameteri(n,U,b));var l=t.src;if(l)if("function"==typeof l&&(l=l(e,t)),"string"==typeof l)Yt(e,a,t,r);else if(h(l)||Array.isArray(l)&&("number"==typeof l[0]||Array.isArray(l[0])||h(l[0]))){var u=Kt(e,a,l,t);o=u.width,i=u.height}else Array.isArray(l)&&("string"==typeof l[0]||qt(l[0]))?n===S?function(e,t,r,a){a=a||Ht;var n=r.src;if(6!==n.length)throw"there must be 6 urls for a cubemap";var o=r.level||0,i=r.internalFormat||r.format||g,s=At(i),l=r.format||s.format,u=r.type||tt,d=r.target||w;if(d!==S)throw"target must be TEXTURE_CUBE_MAP";Xt(e,t,r),r=Object.assign({},r);var c,h=6,f=[],m=jt(0,r);c=n.map((function(n,s){return Zt(n,r.crossOrigin,(p=m[s],function(n,s){--h,n?f.push(n):s.width!==s.height?f.push("cubemap face img is not a square: "+s.src):(Pt(e,r),e.bindTexture(d,t),5===h?jt().forEach((function(t){e.texImage2D(t,o,i,l,u,s)})):e.texImage2D(p,o,i,l,u,s),Vt(r)&&e.generateMipmap(d)),0===h&&a(f.length?f:void 0,t,c)}));var p}))}(e,a,t,r):function(e,t,r,a){a=a||Ht;var n=r.src,o=r.internalFormat||r.format||g,i=At(o),s=r.format||i.format,l=r.type||tt,u=r.target||A;if(u!==M&&u!==A)throw"target must be TEXTURE_3D or TEXTURE_2D_ARRAY";Xt(e,t,r),r=Object.assign({},r);var d,c=n.length,h=[],m=r.level||0,p=r.width,y=r.height,x=n.length,v=!0;d=n.map((function(n,i){return Zt(n,r.crossOrigin,(g=i,function(n,i){if(--c,n)h.push(n);else{if(Pt(e,r),e.bindTexture(u,t),v){v=!1,p=r.width||i.width,y=r.height||i.height,e.texImage3D(u,m,o,p,y,x,0,s,l,null);for(var _=0;_<x;++_)e.texSubImage3D(u,m,0,0,_,p,y,1,s,l,i)}else{var b,F=i;i.width===p&&i.height===y||(F=(b=f()).canvas,b.canvas.width=p,b.canvas.height=y,b.drawImage(i,0,0,p,y)),e.texSubImage3D(u,m,0,0,g,p,y,1,s,l,F),b&&F===b.canvas&&(b.canvas.width=0,b.canvas.height=0)}Vt(r)&&e.generateMipmap(u)}0===c&&a(h.length?h:void 0,t,d)}));var g}))}(e,a,t,r):(Nt(e,a,l,t),o=l.width,i=l.height);else Jt(e,a,t);return Vt(t)&&zt(e,a,t,o,i,s),Ut(e,a,t),a}wt[m]={numColorComponents:1},wt[y]={numColorComponents:1},wt[x]={numColorComponents:2},wt[p]={numColorComponents:3},wt[g]={numColorComponents:4},wt[vt]={numColorComponents:1},wt[_t]={numColorComponents:1},wt[yt]={numColorComponents:2},wt[xt]={numColorComponents:2},wt[p]={numColorComponents:3},wt[bt]={numColorComponents:3},wt[g]={numColorComponents:4},wt[Ft]={numColorComponents:4},wt[v]={numColorComponents:1},wt[_]={numColorComponents:2}},"./src/twgl-full.js":(e,t,r)=>{function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}t.__esModule=!0;var n={m4:!0,v3:!0,primitives:!0};t.v3=t.primitives=t.m4=void 0;var o=d(r("./src/m4.js"));t.m4=o;var i=d(r("./src/v3.js"));t.v3=i;var s=d(r("./src/primitives.js"));t.primitives=s;var l=r("./src/twgl.js");function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}function d(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var r=u(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===l[e]||(t[e]=l[e]))}))},"./src/twgl.js":(e,t,r)=>{function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}t.__esModule=!0;var n={addExtensionsToContext:!0,getContext:!0,getWebGLContext:!0,resizeCanvasToDisplaySize:!0,setDefaults:!0,attributes:!0,textures:!0,utils:!0,draw:!0,framebuffers:!0,programs:!0,typedarrays:!0,vertexArrays:!0};t.addExtensionsToContext=_,t.framebuffers=t.draw=t.attributes=void 0,t.getContext=function(e,t){var r=function(e,t){for(var r=["webgl2","webgl","experimental-webgl"],a=null,n=0;n<r.length;++n)if(a=e.getContext(r[n],t)){g.addExtensionsToContext&&_(a);break}return a}(e,t);return r},t.getWebGLContext=function(e,t){var r=function(e,t){for(var r=["webgl","experimental-webgl"],a=null,n=0;n<r.length;++n)if(a=e.getContext(r[n],t)){g.addExtensionsToContext&&_(a);break}return a}(e,t);return r},t.programs=void 0,t.resizeCanvasToDisplaySize=function(e,t){t=t||1,t=Math.max(0,t);var r=e.clientWidth*t|0,a=e.clientHeight*t|0;return(e.width!==r||e.height!==a)&&(e.width=r,e.height=a,!0)},t.setDefaults=function(e){s.copyExistingProperties(e,g),o.setAttributeDefaults_(e),i.setTextureDefaults_(e)},t.vertexArrays=t.utils=t.typedarrays=t.textures=void 0;var o=p(r("./src/attributes.js"));t.attributes=o,Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===o[e]||(t[e]=o[e]))}));var i=p(r("./src/textures.js"));t.textures=i,Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===i[e]||(t[e]=i[e]))}));var s=p(r("./src/helper.js")),l=p(r("./src/utils.js"));t.utils=l,Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===l[e]||(t[e]=l[e]))}));var u=p(r("./src/draw.js"));t.draw=u,Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===u[e]||(t[e]=u[e]))}));var d=p(r("./src/framebuffers.js"));t.framebuffers=d,Object.keys(d).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===d[e]||(t[e]=d[e]))}));var c=p(r("./src/programs.js"));t.programs=c,Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===c[e]||(t[e]=c[e]))}));var h=p(r("./src/typedarrays.js"));t.typedarrays=h,Object.keys(h).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===h[e]||(t[e]=h[e]))}));var f=p(r("./src/vertex-arrays.js"));function m(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(m=function(e){return e?r:t})(e)}function p(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var r=m(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var s=o?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(n,i,s):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}t.vertexArrays=f,Object.keys(f).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===f[e]||(t[e]=f[e]))}));var g={addExtensionsToContext:!0},y=/^(.*?)_/;function x(e,t){l.glEnumToString(e,0);var r=e.getExtension(t);if(r){var a={},n=y.exec(t)[1],o="_"+n;for(var i in r){var u=r[i],d="function"==typeof u,c=d?n:o,h=i;i.endsWith(c)&&(h=i.substring(0,i.length-c.length)),void 0!==e[h]?d||e[h]===u||s.warn(h,e[h],u,i):d?e[h]=function(e){return function(){return e.apply(r,arguments)}}(u):(e[h]=u,a[h]=u)}a.constructor={name:r.constructor.name},l.glEnumToString(a,0)}return r}var v=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_color_buffer_float","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2","EXT_frag_depth","EXT_sRGB","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_depth_texture","WEBGL_draw_buffers"];function _(e){for(var t=0;t<v.length;++t)x(e,v[t])}},"./src/typedarrays.js":(e,t)=>{t.__esModule=!0,t.getGLTypeForTypedArray=function(e){if(e instanceof Int8Array)return r;if(e instanceof Uint8Array)return a;if(e instanceof Uint8ClampedArray)return a;if(e instanceof Int16Array)return n;if(e instanceof Uint16Array)return o;if(e instanceof Int32Array)return i;if(e instanceof Uint32Array)return s;if(e instanceof Float32Array)return l;throw new Error("unsupported typed array type")},t.getGLTypeForTypedArrayType=function(e){if(e===Int8Array)return r;if(e===Uint8Array)return a;if(e===Uint8ClampedArray)return a;if(e===Int16Array)return n;if(e===Uint16Array)return o;if(e===Int32Array)return i;if(e===Uint32Array)return s;if(e===Float32Array)return l;throw new Error("unsupported typed array type")},t.getTypedArrayTypeForGLType=function(e){var t=u[e];if(!t)throw new Error("unknown gl type");return t},t.isArrayBuffer=void 0;var r=5120,a=5121,n=5122,o=5123,i=5124,s=5125,l=5126,u={},d=u;d[r]=Int8Array,d[a]=Uint8Array,d[n]=Int16Array,d[o]=Uint16Array,d[i]=Int32Array,d[s]=Uint32Array,d[l]=Float32Array,d[32819]=Uint16Array,d[32820]=Uint16Array,d[33635]=Uint16Array,d[5131]=Uint16Array,d[33640]=Uint32Array,d[35899]=Uint32Array,d[35902]=Uint32Array,d[36269]=Uint32Array,d[34042]=Uint32Array,t.isArrayBuffer="undefined"!=typeof SharedArrayBuffer?function(e){return e&&e.buffer&&(e.buffer instanceof ArrayBuffer||e.buffer instanceof SharedArrayBuffer)}:function(e){return e&&e.buffer&&e.buffer instanceof ArrayBuffer}},"./src/utils.js":(e,t)=>{var r,a;t.__esModule=!0,t.glEnumToString=void 0,t.isWebGL1=function(e){return!e.texStorage2D},t.isWebGL2=function(e){return!!e.texStorage2D},t.glEnumToString=(r={},a={},function(e,t){return function(e){var t=e.constructor.name;if(!r[t]){for(var n in e)if("number"==typeof e[n]){var o=a[e[n]];a[e[n]]=o?"".concat(o," | ").concat(n):n}r[t]=!0}}(e),a[t]||("number"==typeof t?"0x".concat(t.toString(16)):t)})},"./src/v3.js":(e,t)=>{t.__esModule=!0,t.add=function(e,t,a){return(a=a||new r(3))[0]=e[0]+t[0],a[1]=e[1]+t[1],a[2]=e[2]+t[2],a},t.copy=function(e,t){return(t=t||new r(3))[0]=e[0],t[1]=e[1],t[2]=e[2],t},t.create=function(e,t,a){var n=new r(3);return e&&(n[0]=e),t&&(n[1]=t),a&&(n[2]=a),n},t.cross=function(e,t,a){a=a||new r(3);var n=e[2]*t[0]-e[0]*t[2],o=e[0]*t[1]-e[1]*t[0];return a[0]=e[1]*t[2]-e[2]*t[1],a[1]=n,a[2]=o,a},t.distance=function(e,t){var r=e[0]-t[0],a=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(r*r+a*a+n*n)},t.distanceSq=function(e,t){var r=e[0]-t[0],a=e[1]-t[1],n=e[2]-t[2];return r*r+a*a+n*n},t.divScalar=function(e,t,a){return(a=a||new r(3))[0]=e[0]/t,a[1]=e[1]/t,a[2]=e[2]/t,a},t.divide=function(e,t,a){return(a=a||new r(3))[0]=e[0]/t[0],a[1]=e[1]/t[1],a[2]=e[2]/t[2],a},t.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},t.length=function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},t.lengthSq=function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},t.lerp=function(e,t,a,n){return(n=n||new r(3))[0]=e[0]+a*(t[0]-e[0]),n[1]=e[1]+a*(t[1]-e[1]),n[2]=e[2]+a*(t[2]-e[2]),n},t.lerpV=function(e,t,a,n){return(n=n||new r(3))[0]=e[0]+a[0]*(t[0]-e[0]),n[1]=e[1]+a[1]*(t[1]-e[1]),n[2]=e[2]+a[2]*(t[2]-e[2]),n},t.max=function(e,t,a){return(a=a||new r(3))[0]=Math.max(e[0],t[0]),a[1]=Math.max(e[1],t[1]),a[2]=Math.max(e[2],t[2]),a},t.min=function(e,t,a){return(a=a||new r(3))[0]=Math.min(e[0],t[0]),a[1]=Math.min(e[1],t[1]),a[2]=Math.min(e[2],t[2]),a},t.mulScalar=function(e,t,a){return(a=a||new r(3))[0]=e[0]*t,a[1]=e[1]*t,a[2]=e[2]*t,a},t.multiply=function(e,t,a){return(a=a||new r(3))[0]=e[0]*t[0],a[1]=e[1]*t[1],a[2]=e[2]*t[2],a},t.negate=function(e,t){return(t=t||new r(3))[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},t.normalize=function(e,t){t=t||new r(3);var a=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=Math.sqrt(a);return n>1e-5?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=0,t[1]=0,t[2]=0),t},t.setDefaultType=function(e){var t=r;return r=e,t},t.subtract=function(e,t,a){return(a=a||new r(3))[0]=e[0]-t[0],a[1]=e[1]-t[1],a[2]=e[2]-t[2],a};var r=Float32Array},"./src/vertex-arrays.js":(e,t,r)=>{function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}t.__esModule=!0,t.createVAOAndSetAttributes=s,t.createVAOFromBufferInfo=function(e,t,r){return s(e,t.attribSetters||t,r.attribs,r.indices)},t.createVertexArrayInfo=function(e,t,r){var a=e.createVertexArray();return e.bindVertexArray(a),t.length||(t=[t]),t.forEach((function(t){n.setBuffersAndAttributes(e,t,r)})),e.bindVertexArray(null),{numElements:r.numElements,elementType:r.elementType,vertexArrayObject:a}};var n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var l=i?Object.getOwnPropertyDescriptor(e,s):null;l&&(l.get||l.set)?Object.defineProperty(n,s,l):n[s]=e[s]}return n.default=e,r&&r.set(e,n),n}(r("./src/programs.js"));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}var i=34963;function s(e,t,r,a){var o=e.createVertexArray();return e.bindVertexArray(o),n.setAttributes(t,r),a&&e.bindBuffer(i,a),e.bindVertexArray(null),o}}},t={},r=function r(a){var n=t[a];if(void 0!==n)return n.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,r),o.exports}("./src/twgl-full.js");return r})(),e.exports=t()},8049:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});const a="precision mediump float;\r\n\r\nuniform vec4 u_color;\r\n\r\nvoid main() {\r\n    gl_FragColor = u_color;\r\n}"},8156:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(5748),t),n(r(7604),t),n(r(8219),t),n(r(2462),t),n(r(6919),t),n(r(1722),t),n(r(4849),t),n(r(6303),t)},8219:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(7293),t),n(r(1278),t),n(r(6940),t),n(r(1017),t)},8344:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});const a="precision mediump float;\r\n\r\nuniform vec3 u_cameraPos;\r\n\r\n// Simple lighting params\r\nuniform vec4 u_ambientColor;\r\nuniform vec4 u_lightColor;\r\nuniform vec3 u_lightDir;\r\n\r\nuniform int u_pixelShader;\r\nuniform int u_blendMode;\r\nuniform bool u_unlit;\r\n\r\nuniform sampler2D u_texture1;\r\nuniform sampler2D u_texture2;\r\nuniform sampler2D u_texture3;\r\n\r\nvarying vec2 v_texCoord1;\r\nvarying vec2 v_texCoord2;\r\nvarying vec2 v_texCoord3;\r\nvarying vec4 v_color1;\r\nvarying vec4 v_color2;\r\nvarying vec3 v_normal;\r\nvarying vec3 v_position;\r\n\r\nfloat saturate(float v) { return clamp(v, 0.0, 1.0); }\r\n\r\nvec3 calculateSpecular(float texAlpha) {\r\n    vec3 normal = normalize(v_normal);\r\n    vec3 eyeDir = normalize(u_cameraPos - v_position.xyz);\r\n    vec3 halfDir = normalize(u_lightDir + eyeDir);\r\n    float attenuationDir = saturate(dot(normal, u_lightDir));\r\n    float spec = (1.25 * pow(saturate(dot(normal, halfDir)), 8.0));\r\n    vec3 specTerm = ((((vec3(mix(pow((1.0 - saturate(dot(u_lightDir, halfDir))), 5.0), 1.0, texAlpha)) * spec) * u_lightColor.rgb) * attenuationDir));\r\n    return specTerm;\r\n}\r\n\r\nvoid main() {\r\n    vec4 texture1 = texture2D(u_texture1, v_texCoord1);\r\n    vec4 texture2 = texture2D(u_texture2, v_texCoord2);\r\n    vec4 texture3 = texture2D(u_texture3, v_texCoord3);\r\n\r\n    // BlendMode AlphaKey\r\n    if (u_blendMode > 0) {\r\n        if (texture1.a < 0.501960814) {\r\n            discard;\r\n        }\r\n    }\r\n\r\n    vec4 outputColor = vec4(0.0, 0.0, 0.0, 1.0);\r\n    vec3 materialColor = vec3(0.0);\r\n    vec3 specular = vec3(0.0);\r\n    vec3 emissiveColor = vec3(0.0);\r\n    float finalOpacity = 0.0;\r\n    float distFade = 1.0;\r\n;\r\n    if (u_pixelShader == 21) {\r\n        // None\r\n        materialColor = texture1.rgb * texture2.rgb;\r\n        finalOpacity = texture1.a;\r\n    } else if (u_pixelShader == 0) {\r\n        // DiffuseT1\r\n        materialColor = texture1.rgb;\r\n        finalOpacity = texture1.a;\r\n    } else if (u_pixelShader == 1) {\r\n        // Specular\r\n        materialColor = texture1.rgb;\r\n        specular = calculateSpecular(texture1.a);\r\n        finalOpacity = texture1.a;\r\n    } else if (u_pixelShader == 2) {\r\n        // Metal\r\n        materialColor = texture1.rgb;\r\n        specular = calculateSpecular(((texture1 * 4.0) * texture1.a).x);\r\n        finalOpacity = texture1.a;\r\n    } else if (u_pixelShader == 3) {\r\n        // Env\r\n        materialColor = texture1.rgb ;\r\n        emissiveColor = texture2.rgb * texture1.a * distFade;\r\n        finalOpacity = 1.0;\r\n    } else if (u_pixelShader == 4) {\r\n        // Opaque\r\n        materialColor = texture1.rgb ;\r\n        finalOpacity = 1.0;\r\n    } else if (u_pixelShader == 5) {\r\n        // EnvMetal\r\n        materialColor = texture1.rgb ;\r\n        emissiveColor = (((texture1.rgb * texture1.a) * texture2.rgb) * distFade);\r\n        finalOpacity = 1.0;\r\n    } else if (u_pixelShader == 6) {\r\n        // TwoLayerDiffuse\r\n        vec3 layer1 = texture1.rgb;\r\n        vec3 layer2 = mix(layer1, texture2.rgb, texture2.a);\r\n        materialColor = mix(layer2, layer1, v_color2.a);\r\n        finalOpacity = texture1.a;\r\n    } else if (u_pixelShader == 7) {\r\n        // TwoLayerEnvMetal\r\n        vec4 colorMix = mix(texture1, texture2, 1.0 - v_color2.a);\r\n        materialColor = colorMix.rgb ;\r\n        emissiveColor = (colorMix.rgb * colorMix.a) * texture3.rgb * distFade;\r\n        finalOpacity = texture1.a;\r\n    } else if (u_pixelShader == 8) {\r\n        // TwoLayerTerrain\r\n        vec3 layer1 = texture1.rgb;\r\n        vec3 layer2 = texture2.rgb;\r\n        materialColor = mix(layer2, layer1, v_color2.a);\r\n        specular = calculateSpecular(texture2.a * (1.0 - v_color2.a));\r\n        finalOpacity = texture1.a;\r\n    } else if (u_pixelShader == 9) {\r\n        // DiffuseEmissive\r\n        materialColor = texture1.rgb ;\r\n        emissiveColor = texture2.rgb * texture2.a * v_color2.a;\r\n        finalOpacity = texture1.a;\r\n    } else if (u_pixelShader == 10) {\r\n        // MaskedEnvMetal\r\n        float mixFactor = clamp((texture3.a * v_color2.a), 0.0, 1.0);\r\n        materialColor =\r\n            mix(mix(((texture1.rgb * texture2.rgb) * 2.0), texture3.rgb, mixFactor), texture1.rgb, texture1.a);\r\n        finalOpacity = texture1.a;\r\n    } else if (u_pixelShader == 11) {\r\n        // EnvMetalEmissive\r\n        materialColor = texture1.rgb ;\r\n        emissiveColor =\r\n            (\r\n                ((texture1.rgb * texture1.a) * texture2.rgb) +\r\n                ((texture3.rgb * texture3.a) * v_color2.a)\r\n            );\r\n        finalOpacity = texture1.a;\r\n    } else if (u_pixelShader == 12) {\r\n        // TwoLayerDiffuseOpaque\r\n        materialColor = mix(texture2.rgb, texture1.rgb, v_color2.a);\r\n        finalOpacity = 1.0;\r\n    } else if (u_pixelShader == 13) {\r\n        // TwoLayerDiffuseEmissive\r\n        vec3 t1diffuse = (texture2.rgb * (1.0 - texture2.a));\r\n        materialColor = mix(t1diffuse, texture1.rgb, v_color2.a);\r\n        emissiveColor = (texture2.rgb * texture2.a) * (1.0 - v_color2.a);\r\n        finalOpacity = texture1.a;\r\n    } else if (u_pixelShader == 14) {\r\n        // AdditiveMaskedEnvMetal\r\n        materialColor = mix(\r\n            (texture1.rgb * texture2.rgb * 2.0) + (texture3.rgb * clamp(texture3.a * v_color2.a, 0.0, 1.0)),\r\n            texture1.rgb,\r\n            vec3(texture1.a)\r\n        );\r\n        finalOpacity = 1.0;\r\n    } else if (u_pixelShader == 15) {\r\n        // TwoLayerDiffuseMod2x\r\n        vec3 layer1 = texture1.rgb;\r\n        vec3 layer2 = mix(layer1, texture2.rgb, vec3(texture2.a));\r\n        vec3 layer3 = mix(layer2, layer1, vec3(v_color2.a));\r\n        materialColor = layer3 * texture3.rgb * 2.0;\r\n        finalOpacity = texture1.a;\r\n    } else if (u_pixelShader == 16) {\r\n        // TwoLayerDiffuseMod2xNA\r\n        vec3 layer1 = ((texture1.rgb * texture2.rgb) * 2.0);\r\n        materialColor = mix(texture1.rgb, layer1, vec3(v_color2.a)) ;\r\n        finalOpacity = texture1.a;\r\n    } else if (u_pixelShader == 17) {\r\n        // TwoLayerDiffuseAlpha\r\n        vec3 layer1 = texture1.rgb;\r\n        vec3 layer2 = mix(layer1, texture2.rgb, vec3(texture2.a));\r\n        vec3 layer3 = mix(layer2, layer1, vec3(texture3.a));\r\n        materialColor = ((layer3 * texture3.rgb) * 2.0);\r\n        finalOpacity = texture1.a;\r\n    } else if (u_pixelShader == 18) {\r\n        // Lod\r\n        materialColor = texture1.rgb;\r\n        finalOpacity = texture1.a;\r\n    } else {\r\n        // unsupported shader\r\n        gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\r\n        return;\r\n    }\r\n\r\n    if (!u_unlit) {\r\n        vec4 lightColor = u_ambientColor;\r\n        float diffStrength = max(0.0, dot(v_normal, u_lightDir));\r\n        lightColor += u_lightColor * diffStrength;\r\n        lightColor = clamp(lightColor, vec4(0,0,0,0), vec4(1,1,1,1));\r\n        outputColor.rgb = materialColor * lightColor.rgb;\r\n        outputColor.a = 1.0;\r\n    } else {\r\n        outputColor = vec4(materialColor, 1.0);\r\n    }\r\n    outputColor += vec4(specular, 0.0);\r\n    outputColor += vec4(emissiveColor, 0);\r\n\r\n    gl_FragColor = outputColor;\r\n}"},8381:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});const a="precision mediump float;\r\nprecision mediump int;\r\n\r\nattribute vec3 a_position;\r\nattribute vec4 a_color;\r\nattribute vec2 a_texCoord1;\r\n\r\nuniform mat4 u_projectionMatrix;\r\nuniform mat4 u_viewMatrix;\r\n\r\nvarying vec4 v_color;\r\nvarying vec2 v_texCoord1;\r\n\r\nvoid main() {\r\n    vec4 aPositionVec4 = vec4(a_position, 1);\r\n\r\n    v_color = a_color;\r\n    v_texCoord1 = a_texCoord1;\r\n    vec4 vertexViewSpace = u_viewMatrix * aPositionVec4;\r\n\r\n    gl_Position = u_projectionMatrix * vertexViewSpace;\r\n}\r\n"},8389:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});const a="precision mediump float;\r\n\r\nuniform int u_vertexShader;\r\n\r\nuniform mat4 u_modelMatrix;\r\nuniform mat4 u_viewMatrix;\r\nuniform mat4 u_projectionMatrix;\r\n\r\nvarying vec2 v_texCoord1;\r\nvarying vec2 v_texCoord2;\r\nvarying vec2 v_texCoord3;\r\nvarying vec4 v_color1;\r\nvarying vec4 v_color2;\r\nvarying vec3 v_normal;\r\nvarying vec3 v_position;\r\n\r\nattribute vec3 a_position;\r\nattribute vec3 a_normal;\r\nattribute vec4 a_color1;\r\nattribute vec4 a_color2;\r\nattribute vec2 a_texCoord1;\r\nattribute vec2 a_texCoord2;\r\nattribute vec2 a_texCoord3;\r\n\r\nvec3 normalizedMatrixMultiply(mat4 matrix, vec3 vector) {\r\n    // Pull out the squared scaling.\r\n    vec3 t_SqScale = vec3(\r\n        dot(matrix[0], matrix[0]), \r\n        dot(matrix[1], matrix[1]), \r\n        dot(matrix[2], matrix[2])\r\n    );\r\n    return normalize(matrix * vec4(vector / t_SqScale, 0.0)).xyz;\r\n}\r\n\r\nvec2 posToTexCoord(vec3 pos, vec3 normal) {\r\n    vec3 reflection = reflect(normalize(pos), normal);\r\n    return normalize(reflection).xy * 0.5 + vec2(0.5);\r\n}   \r\n\r\nvoid main() {\r\n    v_position = (u_modelMatrix * vec4(a_position, 1.0)).xyz;\r\n    v_normal = normalizedMatrixMultiply(u_modelMatrix, a_normal);\r\n    v_color1 = a_color1.bgra * vec4(1/255);\r\n    v_color2 = a_color2 * vec4(1/255);\r\n\r\n    vec3 viewPosition = (u_viewMatrix * vec4(v_position, 1.0)).xyz;\r\n    vec3 viewNormal = (u_viewMatrix * vec4(v_normal, 0.0)).xyz;\r\n    gl_Position = u_projectionMatrix * vec4(viewPosition, 1.0);\r\n\r\n    if (u_vertexShader == 9) { \r\n        // None\r\n       v_texCoord1 = a_texCoord1;\r\n       v_texCoord2 = a_texCoord2;\r\n       v_texCoord3 = a_texCoord3;\r\n   } else if (u_vertexShader == 0) {\r\n    //DiffuseT1;\r\n       v_texCoord1 = a_texCoord1;\r\n       v_texCoord2 = a_texCoord2; //not used\r\n       v_texCoord3 = a_texCoord3; //not used\r\n   } else if (u_vertexShader == 1) {\r\n    //DiffuseT1Ref1\r\n       v_texCoord1 = a_texCoord1;\r\n       v_texCoord2 = reflect(normalize(viewPosition), viewNormal).xy;\r\n       v_texCoord3 = a_texCoord3; //not used\r\n   } else if (u_vertexShader == 2) {\r\n    //DiffuseT1EnvT2\r\n       v_texCoord1 = a_texCoord1;\r\n       v_texCoord2 = posToTexCoord(viewPosition, viewNormal);\r\n       v_texCoord3 = a_texCoord3;\r\n   } else if (u_vertexShader == 3) {\r\n    // SpecularT1\r\n       v_texCoord1 = a_texCoord1;\r\n       v_texCoord2 = a_texCoord2; //not used\r\n       v_texCoord3 = a_texCoord3; //not used\r\n   } else if (u_vertexShader == 4) {\r\n    // DiffuseComp\r\n       v_texCoord1 = a_texCoord1;\r\n       v_texCoord2 = a_texCoord2; //not used\r\n       v_texCoord3 = a_texCoord3; //not used\r\n   } else if (u_vertexShader == 5) {\r\n    //DiffuseCompRefl\r\n       v_texCoord1 = a_texCoord1;\r\n       v_texCoord2 = a_texCoord2;\r\n       v_texCoord3 = reflect(normalize(viewPosition), viewNormal).xy;\r\n   } else if (u_vertexShader == 6) {\r\n    //DiffuseCompTerrain\r\n       v_texCoord1 = a_texCoord1;\r\n       v_texCoord2 = viewPosition.xy * -0.239999995;\r\n       v_texCoord3 = a_texCoord3; //not used\r\n   } else if (u_vertexShader == 7) {\r\n    //DiffuseCompAlpha\r\n       v_texCoord1 = a_texCoord1;\r\n       v_texCoord2 = viewPosition.xy * -0.239999995;\r\n       v_texCoord3 = a_texCoord3; //not used\r\n   } else if (u_vertexShader == 8) {\r\n    // Parralax\r\n       v_texCoord1 = a_texCoord1;\r\n       v_texCoord2 = a_texCoord2;\r\n       v_texCoord3 = a_texCoord3;\r\n   }\r\n}"},8411:(e,t,r)=>{"use strict";const{_tr_init:a,_tr_stored_block:n,_tr_flush_block:o,_tr_tally:i,_tr_align:s}=r(3665),l=r(3269),u=r(4823),d=r(4674),{Z_NO_FLUSH:c,Z_PARTIAL_FLUSH:h,Z_FULL_FLUSH:f,Z_FINISH:m,Z_BLOCK:p,Z_OK:g,Z_STREAM_END:y,Z_STREAM_ERROR:x,Z_DATA_ERROR:v,Z_BUF_ERROR:_,Z_DEFAULT_COMPRESSION:b,Z_FILTERED:F,Z_HUFFMAN_ONLY:C,Z_RLE:w,Z_FIXED:S,Z_DEFAULT_STRATEGY:M,Z_UNKNOWN:A,Z_DEFLATED:E}=r(9681),D=258,T=262,k=42,B=113,L=666,P=(e,t)=>(e.msg=d[t],t),O=e=>2*e-(e>4?9:0),I=e=>{let t=e.length;for(;--t>=0;)e[t]=0},U=e=>{let t,r,a,n=e.w_size;t=e.hash_size,a=t;do{r=e.head[--a],e.head[a]=r>=n?r-n:0}while(--t);t=n,a=t;do{r=e.prev[--a],e.prev[a]=r>=n?r-n:0}while(--t)};let W=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask;const R=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))},z=(e,t)=>{o(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,R(e.strm)},V=(e,t)=>{e.pending_buf[e.pending++]=t},j=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},G=(e,t,r,a)=>{let n=e.avail_in;return n>a&&(n=a),0===n?0:(e.avail_in-=n,t.set(e.input.subarray(e.next_in,e.next_in+n),r),1===e.state.wrap?e.adler=l(e.adler,t,n,r):2===e.state.wrap&&(e.adler=u(e.adler,t,n,r)),e.next_in+=n,e.total_in+=n,n)},N=(e,t)=>{let r,a,n=e.max_chain_length,o=e.strstart,i=e.prev_length,s=e.nice_match;const l=e.strstart>e.w_size-T?e.strstart-(e.w_size-T):0,u=e.window,d=e.w_mask,c=e.prev,h=e.strstart+D;let f=u[o+i-1],m=u[o+i];e.prev_length>=e.good_match&&(n>>=2),s>e.lookahead&&(s=e.lookahead);do{if(r=t,u[r+i]===m&&u[r+i-1]===f&&u[r]===u[o]&&u[++r]===u[o+1]){o+=2,r++;do{}while(u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&o<h);if(a=D-(h-o),o=h-D,a>i){if(e.match_start=t,i=a,a>=s)break;f=u[o+i-1],m=u[o+i]}}}while((t=c[t&d])>l&&0!=--n);return i<=e.lookahead?i:e.lookahead},H=e=>{const t=e.w_size;let r,a,n;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-T)&&(e.window.set(e.window.subarray(t,t+t-a),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),U(e),a+=t),0===e.strm.avail_in)break;if(r=G(e.strm,e.window,e.strstart+e.lookahead,a),e.lookahead+=r,e.lookahead+e.insert>=3)for(n=e.strstart-e.insert,e.ins_h=e.window[n],e.ins_h=W(e,e.ins_h,e.window[n+1]);e.insert&&(e.ins_h=W(e,e.ins_h,e.window[n+3-1]),e.prev[n&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=n,n++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<T&&0!==e.strm.avail_in)},q=(e,t)=>{let r,a,o,i=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,s=0,l=e.strm.avail_in;do{if(r=65535,o=e.bi_valid+42>>3,e.strm.avail_out<o)break;if(o=e.strm.avail_out-o,a=e.strstart-e.block_start,r>a+e.strm.avail_in&&(r=a+e.strm.avail_in),r>o&&(r=o),r<i&&(0===r&&t!==m||t===c||r!==a+e.strm.avail_in))break;s=t===m&&r===a+e.strm.avail_in?1:0,n(e,0,0,s),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,R(e.strm),a&&(a>r&&(a=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+a),e.strm.next_out),e.strm.next_out+=a,e.strm.avail_out-=a,e.strm.total_out+=a,e.block_start+=a,r-=a),r&&(G(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(0===s);return l-=e.strm.avail_in,l&&(l>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=l&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-l,e.strm.next_in),e.strstart),e.strstart+=l,e.insert+=l>e.w_size-e.insert?e.w_size-e.insert:l),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),s?4:t!==c&&t!==m&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(o=e.window_size-e.strstart,e.strm.avail_in>o&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,o+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),o>e.strm.avail_in&&(o=e.strm.avail_in),o&&(G(e.strm,e.window,e.strstart,o),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.high_water<e.strstart&&(e.high_water=e.strstart),o=e.bi_valid+42>>3,o=e.pending_buf_size-o>65535?65535:e.pending_buf_size-o,i=o>e.w_size?e.w_size:o,a=e.strstart-e.block_start,(a>=i||(a||t===m)&&t!==c&&0===e.strm.avail_in&&a<=o)&&(r=a>o?o:a,s=t===m&&0===e.strm.avail_in&&r===a?1:0,n(e,e.block_start,r,s),e.block_start+=r,R(e.strm)),s?3:1)},Z=(e,t)=>{let r,a;for(;;){if(e.lookahead<T){if(H(e),e.lookahead<T&&t===c)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=W(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-T&&(e.match_length=N(e,r)),e.match_length>=3)if(a=i(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=W(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=W(e,e.ins_h,e.window[e.strstart+1]);else a=i(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(a&&(z(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===m?(z(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(z(e,!1),0===e.strm.avail_out)?1:2},X=(e,t)=>{let r,a,n;for(;;){if(e.lookahead<T){if(H(e),e.lookahead<T&&t===c)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=W(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-T&&(e.match_length=N(e,r),e.match_length<=5&&(e.strategy===F||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){n=e.strstart+e.lookahead-3,a=i(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=n&&(e.ins_h=W(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,a&&(z(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(a=i(e,0,e.window[e.strstart-1]),a&&z(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(a=i(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===m?(z(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(z(e,!1),0===e.strm.avail_out)?1:2};function Y(e,t,r,a,n){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=a,this.func=n}const K=[new Y(0,0,0,0,q),new Y(4,4,8,4,Z),new Y(4,5,16,8,Z),new Y(4,6,32,32,Z),new Y(4,4,16,16,X),new Y(8,16,32,32,X),new Y(8,16,128,128,X),new Y(8,32,128,256,X),new Y(32,128,258,1024,X),new Y(32,258,258,4096,X)];function J(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=E,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),I(this.dyn_ltree),I(this.dyn_dtree),I(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),I(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),I(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Q=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==k&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==B&&t.status!==L?1:0},$=e=>{if(Q(e))return P(e,x);e.total_in=e.total_out=0,e.data_type=A;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?k:B,e.adler=2===t.wrap?0:1,t.last_flush=-2,a(t),g},ee=e=>{const t=$(e);var r;return t===g&&((r=e.state).window_size=2*r.w_size,I(r.head),r.max_lazy_match=K[r.level].max_lazy,r.good_match=K[r.level].good_length,r.nice_match=K[r.level].nice_length,r.max_chain_length=K[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0),t},te=(e,t,r,a,n,o)=>{if(!e)return x;let i=1;if(t===b&&(t=6),a<0?(i=0,a=-a):a>15&&(i=2,a-=16),n<1||n>9||r!==E||a<8||a>15||t<0||t>9||o<0||o>S||8===a&&1!==i)return P(e,x);8===a&&(a=9);const s=new J;return e.state=s,s.strm=e,s.status=k,s.wrap=i,s.gzhead=null,s.w_bits=a,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=n+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<n+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.sym_buf=s.lit_bufsize,s.sym_end=3*(s.lit_bufsize-1),s.level=t,s.strategy=o,s.method=r,ee(e)};e.exports.deflateInit=(e,t)=>te(e,t,E,15,8,M),e.exports.deflateInit2=te,e.exports.deflateReset=ee,e.exports.deflateResetKeep=$,e.exports.deflateSetHeader=(e,t)=>Q(e)||2!==e.state.wrap?x:(e.state.gzhead=t,g),e.exports.deflate=(e,t)=>{if(Q(e)||t>p||t<0)return e?P(e,x):x;const r=e.state;if(!e.output||0!==e.avail_in&&!e.input||r.status===L&&t!==m)return P(e,0===e.avail_out?_:x);const a=r.last_flush;if(r.last_flush=t,0!==r.pending){if(R(e),0===e.avail_out)return r.last_flush=-1,g}else if(0===e.avail_in&&O(t)<=O(a)&&t!==m)return P(e,_);if(r.status===L&&0!==e.avail_in)return P(e,_);if(r.status===k&&0===r.wrap&&(r.status=B),r.status===k){let t=E+(r.w_bits-8<<4)<<8,a=-1;if(a=r.strategy>=C||r.level<2?0:r.level<6?1:6===r.level?2:3,t|=a<<6,0!==r.strstart&&(t|=32),t+=31-t%31,j(r,t),0!==r.strstart&&(j(r,e.adler>>>16),j(r,65535&e.adler)),e.adler=1,r.status=B,R(e),0!==r.pending)return r.last_flush=-1,g}if(57===r.status)if(e.adler=0,V(r,31),V(r,139),V(r,8),r.gzhead)V(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),V(r,255&r.gzhead.time),V(r,r.gzhead.time>>8&255),V(r,r.gzhead.time>>16&255),V(r,r.gzhead.time>>24&255),V(r,9===r.level?2:r.strategy>=C||r.level<2?4:0),V(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(V(r,255&r.gzhead.extra.length),V(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=u(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(V(r,0),V(r,0),V(r,0),V(r,0),V(r,0),V(r,9===r.level?2:r.strategy>=C||r.level<2?4:0),V(r,3),r.status=B,R(e),0!==r.pending)return r.last_flush=-1,g;if(69===r.status){if(r.gzhead.extra){let t=r.pending,a=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+a>r.pending_buf_size;){let n=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+n),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>t&&(e.adler=u(e.adler,r.pending_buf,r.pending-t,t)),r.gzindex+=n,R(e),0!==r.pending)return r.last_flush=-1,g;t=0,a-=n}let n=new Uint8Array(r.gzhead.extra);r.pending_buf.set(n.subarray(r.gzindex,r.gzindex+a),r.pending),r.pending+=a,r.gzhead.hcrc&&r.pending>t&&(e.adler=u(e.adler,r.pending_buf,r.pending-t,t)),r.gzindex=0}r.status=73}if(73===r.status){if(r.gzhead.name){let t,a=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>a&&(e.adler=u(e.adler,r.pending_buf,r.pending-a,a)),R(e),0!==r.pending)return r.last_flush=-1,g;a=0}t=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,V(r,t)}while(0!==t);r.gzhead.hcrc&&r.pending>a&&(e.adler=u(e.adler,r.pending_buf,r.pending-a,a)),r.gzindex=0}r.status=91}if(91===r.status){if(r.gzhead.comment){let t,a=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>a&&(e.adler=u(e.adler,r.pending_buf,r.pending-a,a)),R(e),0!==r.pending)return r.last_flush=-1,g;a=0}t=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,V(r,t)}while(0!==t);r.gzhead.hcrc&&r.pending>a&&(e.adler=u(e.adler,r.pending_buf,r.pending-a,a))}r.status=103}if(103===r.status){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(R(e),0!==r.pending))return r.last_flush=-1,g;V(r,255&e.adler),V(r,e.adler>>8&255),e.adler=0}if(r.status=B,R(e),0!==r.pending)return r.last_flush=-1,g}if(0!==e.avail_in||0!==r.lookahead||t!==c&&r.status!==L){let a=0===r.level?q(r,t):r.strategy===C?((e,t)=>{let r;for(;;){if(0===e.lookahead&&(H(e),0===e.lookahead)){if(t===c)return 1;break}if(e.match_length=0,r=i(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(z(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===m?(z(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(z(e,!1),0===e.strm.avail_out)?1:2})(r,t):r.strategy===w?((e,t)=>{let r,a,n,o;const s=e.window;for(;;){if(e.lookahead<=D){if(H(e),e.lookahead<=D&&t===c)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(n=e.strstart-1,a=s[n],a===s[++n]&&a===s[++n]&&a===s[++n])){o=e.strstart+D;do{}while(a===s[++n]&&a===s[++n]&&a===s[++n]&&a===s[++n]&&a===s[++n]&&a===s[++n]&&a===s[++n]&&a===s[++n]&&n<o);e.match_length=D-(o-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=i(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=i(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(z(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===m?(z(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(z(e,!1),0===e.strm.avail_out)?1:2})(r,t):K[r.level].func(r,t);if(3!==a&&4!==a||(r.status=L),1===a||3===a)return 0===e.avail_out&&(r.last_flush=-1),g;if(2===a&&(t===h?s(r):t!==p&&(n(r,0,0,!1),t===f&&(I(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),R(e),0===e.avail_out))return r.last_flush=-1,g}return t!==m?g:r.wrap<=0?y:(2===r.wrap?(V(r,255&e.adler),V(r,e.adler>>8&255),V(r,e.adler>>16&255),V(r,e.adler>>24&255),V(r,255&e.total_in),V(r,e.total_in>>8&255),V(r,e.total_in>>16&255),V(r,e.total_in>>24&255)):(j(r,e.adler>>>16),j(r,65535&e.adler)),R(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?g:y)},e.exports.deflateEnd=e=>{if(Q(e))return x;const t=e.state.status;return e.state=null,t===B?P(e,v):g},e.exports.deflateSetDictionary=(e,t)=>{let r=t.length;if(Q(e))return x;const a=e.state,n=a.wrap;if(2===n||1===n&&a.status!==k||a.lookahead)return x;if(1===n&&(e.adler=l(e.adler,t,r,0)),a.wrap=0,r>=a.w_size){0===n&&(I(a.head),a.strstart=0,a.block_start=0,a.insert=0);let e=new Uint8Array(a.w_size);e.set(t.subarray(r-a.w_size,r),0),t=e,r=a.w_size}const o=e.avail_in,i=e.next_in,s=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,H(a);a.lookahead>=3;){let e=a.strstart,t=a.lookahead-2;do{a.ins_h=W(a,a.ins_h,a.window[e+3-1]),a.prev[e&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=e,e++}while(--t);a.strstart=e,a.lookahead=2,H(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,e.next_in=i,e.input=s,e.avail_in=o,a.wrap=n,g},e.exports.deflateInfo="pako deflate (from Nodeca project)"},8418:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},8521:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorldPositionedObject=void 0;const a=r(1278);t.WorldPositionedObject=class{constructor(){this.children=[],this.worldModelMatrix=a.Float44.identity(),this.localModelMatrix=a.Float44.identity(),this.invWorldModelMatrix=a.Float44.invert(this.worldModelMatrix),this.isDisposing=!1}initialize(e){this.engine=e}update(e){if(this.isDisposing)return;const t=[];for(const e of this.children)e.isDisposing&&t.push(e);this.children=this.children.filter((e=>-1===t.indexOf(e)))}dispose(){if(this.isDisposing=!0,this.children)for(const e of this.children)e.dispose();this.children=null,this.engine=null,this.worldModelMatrix=null,this.invWorldModelMatrix=null}updateModelMatrixFromParent(){a.Float44.copy(this.localModelMatrix,this.worldModelMatrix);let e=this.parent;for(;e;)a.Float44.multiply(this.worldModelMatrix,e.worldModelMatrix,this.worldModelMatrix),e=e.parent;a.Float44.invert(this.worldModelMatrix,this.invWorldModelMatrix)}setModelMatrix(e,t,r){a.Float44.identity(this.localModelMatrix),null!==e&&a.Float44.translate(this.localModelMatrix,e,this.localModelMatrix),null!=t&&a.Float44.multiply(this.localModelMatrix,a.Float44.fromQuat(t),this.localModelMatrix),null!=r&&a.Float44.scale(this.localModelMatrix,r,this.localModelMatrix),this.updateModelMatrixFromParent();for(const e of this.children)e.updateModelMatrixFromParent()}}},8648:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(1737),t),n(r(8418),t)},8680:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});const a="precision mediump float;\r\n\r\nvarying vec4 v_color;\r\nvarying vec2 v_texCoord1;\r\nvarying vec2 v_texCoord2;\r\nvarying vec2 v_texCoord3;\r\nvarying float v_alphaCutoff;\r\n\r\nuniform int u_pixelShader;\r\nuniform sampler2D u_texture1;\r\nuniform sampler2D u_texture2;\r\nuniform sampler2D u_texture3;\r\nuniform float u_alphaTreshold;\r\nuniform float u_alphaMult;\r\nuniform float u_colorMult;\r\n\r\nvoid main(void) {\r\n    vec4 tex = vec4(1, 1, 1, 1);\r\n    vec4 tex2 = vec4(1, 1, 1, 1);\r\n    vec4 tex3 = vec4(1, 1, 1, 1);\r\n\r\n    // gl_FragColor = color;\r\n    tex = texture2D(u_texture1, v_texCoord1).rgba;\r\n    tex2 = texture2D(u_texture2, v_texCoord2).rgba;\r\n    tex3 = texture2D(u_texture3, v_texCoord3).rgba;\r\n\r\n    vec3 matDiffuse = (tex * v_color).rgb; \r\n    float opacity = tex.a * v_color.a;\r\n\r\n    if (u_pixelShader == 0) {\r\n        matDiffuse = v_color.xyz * tex.rgb;\r\n        opacity = tex.a*v_color.a;    \r\n    } else if (u_pixelShader == 1) {\r\n        vec4 textureMod = tex*tex2;\r\n        float texAlpha = (textureMod.w * tex3.w);\r\n        opacity = texAlpha*v_color.a;\r\n        matDiffuse = v_color.xyz * textureMod.rgb;\r\n    } else if (u_pixelShader == 2) {\r\n        vec4 textureMod = tex*tex2*tex3;\r\n        float texAlpha = textureMod.w;\r\n        matDiffuse = v_color.xyz * textureMod.rgb;\r\n        opacity = texAlpha*v_color.a;\r\n    } else if (u_pixelShader == 3) {\r\n        vec4 textureMod = tex*tex2*tex3;\r\n        float texAlpha = textureMod.w;\r\n        matDiffuse = v_color.xyz;\r\n        opacity = texAlpha*v_color.a;\r\n    } else if (u_pixelShader == 4) {\r\n        discard; \r\n    }\r\n    \r\n    matDiffuse = matDiffuse.rgb * u_colorMult;\r\n    opacity = opacity * u_alphaMult;\r\n\r\n    if (opacity < u_alphaTreshold) {\r\n        discard;\r\n    }\r\n    if (opacity < v_alphaCutoff) {\r\n        discard;\r\n    }\r\n    \r\n    gl_FragColor = vec4(matDiffuse.rgb, opacity);\r\n}"},8803:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(7229),t),n(r(2690),t)},8997:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});const a="attribute vec3 a_position;\r\nattribute vec4 a_color;\r\nattribute vec2 a_texCoord1;\r\nattribute vec2 a_texCoord2;\r\nattribute vec2 a_texCoord3;\r\nattribute float a_alphaCutoff;\r\n\r\nvarying vec4 v_color;\r\nvarying vec2 v_texCoord1;\r\nvarying vec2 v_texCoord2;\r\nvarying vec2 v_texCoord3;\r\nvarying float v_alphaCutoff;\r\n\r\nuniform mat4 u_projectionMatrix;\r\nuniform mat4 u_viewMatrix;\r\n\r\nvoid main(void) {\r\n    vec4 pos = vec4(a_position, 1);\r\n    gl_Position = u_projectionMatrix * u_viewMatrix * pos;\r\n    \r\n    v_color = a_color;\r\n    v_texCoord1 = a_texCoord1;\r\n    v_texCoord2 = a_texCoord2;\r\n    v_texCoord3 = a_texCoord3;\r\n    v_alphaCutoff = a_alphaCutoff;\r\n}"},9174:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Camera=void 0;const a=r(1278);t.Camera=class{constructor(){this.viewMatrix=a.Float44.identity(),a.Float44.rotateX(this.viewMatrix,-90*Math.PI/180,this.viewMatrix),a.Float44.invert(this.viewMatrix),this.position=a.Float3.zero()}initialize(e){this.engine=e}update(e){}dispose(){this.isDisposing=!0,this.viewMatrix=null,this.position=null,this.lastBoundingBox=null}getViewMatrix(){return a.Float44.copy(this.viewMatrix)}resizeForBoundingBox(e){if(this.lastBoundingBox=e,e){const{min:t,max:r}=e;a.Float3.copy(r,this.position),a.Float44.lookAt(this.position,[0,0,0],[0,0,1],this.viewMatrix),a.Float44.invert(this.viewMatrix,this.viewMatrix)}}getBoundingBox(){return this.lastBoundingBox}}},9266:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};function o(e,t,r){return r.indexOf(e)===t}Object.defineProperty(t,"__esModule",{value:!0}),t.hasFlagsActive=function(e,t){return(e&t)===t},t.distinct=function(e){return e.filter(o)},n(r(3975),t)},9551:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(4741),t),n(r(7243),t),n(r(4176),t),n(r(2673),t)},9674:e=>{"use strict";const t=16209;e.exports=function(e,r){let a,n,o,i,s,l,u,d,c,h,f,m,p,g,y,x,v,_,b,F,C,w,S,M;const A=e.state;a=e.next_in,S=e.input,n=a+(e.avail_in-5),o=e.next_out,M=e.output,i=o-(r-e.avail_out),s=o+(e.avail_out-257),l=A.dmax,u=A.wsize,d=A.whave,c=A.wnext,h=A.window,f=A.hold,m=A.bits,p=A.lencode,g=A.distcode,y=(1<<A.lenbits)-1,x=(1<<A.distbits)-1;e:do{m<15&&(f+=S[a++]<<m,m+=8,f+=S[a++]<<m,m+=8),v=p[f&y];t:for(;;){if(_=v>>>24,f>>>=_,m-=_,_=v>>>16&255,0===_)M[o++]=65535&v;else{if(!(16&_)){if(64&_){if(32&_){A.mode=16191;break e}e.msg="invalid literal/length code",A.mode=t;break e}v=p[(65535&v)+(f&(1<<_)-1)];continue t}for(b=65535&v,_&=15,_&&(m<_&&(f+=S[a++]<<m,m+=8),b+=f&(1<<_)-1,f>>>=_,m-=_),m<15&&(f+=S[a++]<<m,m+=8,f+=S[a++]<<m,m+=8),v=g[f&x];;){if(_=v>>>24,f>>>=_,m-=_,_=v>>>16&255,16&_){if(F=65535&v,_&=15,m<_&&(f+=S[a++]<<m,m+=8,m<_&&(f+=S[a++]<<m,m+=8)),F+=f&(1<<_)-1,F>l){e.msg="invalid distance too far back",A.mode=t;break e}if(f>>>=_,m-=_,_=o-i,F>_){if(_=F-_,_>d&&A.sane){e.msg="invalid distance too far back",A.mode=t;break e}if(C=0,w=h,0===c){if(C+=u-_,_<b){b-=_;do{M[o++]=h[C++]}while(--_);C=o-F,w=M}}else if(c<_){if(C+=u+c-_,_-=c,_<b){b-=_;do{M[o++]=h[C++]}while(--_);if(C=0,c<b){_=c,b-=_;do{M[o++]=h[C++]}while(--_);C=o-F,w=M}}}else if(C+=c-_,_<b){b-=_;do{M[o++]=h[C++]}while(--_);C=o-F,w=M}for(;b>2;)M[o++]=w[C++],M[o++]=w[C++],M[o++]=w[C++],b-=3;b&&(M[o++]=w[C++],b>1&&(M[o++]=w[C++]))}else{C=o-F;do{M[o++]=M[C++],M[o++]=M[C++],M[o++]=M[C++],b-=3}while(b>2);b&&(M[o++]=M[C++],b>1&&(M[o++]=M[C++]))}break}if(64&_){e.msg="invalid distance code",A.mode=t;break e}v=g[(65535&v)+(f&(1<<_)-1)]}}break}}while(a<n&&o<s);b=m>>3,a-=b,m-=b<<3,f&=(1<<m)-1,e.next_in=a,e.next_out=o,e.avail_in=a<n?n-a+5:5-(a-n),e.avail_out=o<s?s-o+257:257-(o-s),A.hold=f,A.bits=m}},9681:e=>{"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},9805:e=>{"use strict";const t=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);e.exports.assign=function(e){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const a=r.shift();if(a){if("object"!=typeof a)throw new TypeError(a+"must be non-object");for(const r in a)t(a,r)&&(e[r]=a[r])}}return e},e.exports.flattenChunks=e=>{let t=0;for(let r=0,a=e.length;r<a;r++)t+=e[r].length;const r=new Uint8Array(t);for(let t=0,a=0,n=e.length;t<n;t++){let n=e[t];r.set(n,a),a+=n.length}return r}}},t={};function r(a){var n=t[a];if(void 0!==n)return n.exports;var o=t[a]={exports:{}};return e[a].call(o.exports,o,o.exports,r),o.exports}return r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r(8156)})()));