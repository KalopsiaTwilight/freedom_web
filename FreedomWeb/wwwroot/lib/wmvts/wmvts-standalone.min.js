/*! For license information please see wmvts-standalone.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["wmvts-standalone"]=t():e["wmvts-standalone"]=t()}(this,(()=>(()=>{var e={45:function(e,t,r){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SkinLayerTextureCombiner=void 0;const i=r(1639),o=r(8204),n=r(1017),s=a(r(9257)),l=a(r(6452)),u="CHAR-SKIN";class d extends o.Disposable{constructor(e,t,r,a){super(),this.parentId=e.modelId,this.renderer=e.renderer,this.textureType=t,this.width=r,this.height=a,this.blackTexture=this.renderer.getSolidColorTexture([0,0,0,0]),this.blendProgram=this.renderer.getShaderProgram(this,"SKIN_BLEND",s.default,l.default),this.dataBuffers=this.renderer.getDataBuffers(this,"SKIN-RECT",(e=>{const t=e.createVertexDataBuffer([{index:this.blendProgram.getAttribLocation("a_texCoord"),size:2,type:n.BufferDataType.Float,normalized:!1,stride:8,offset:0}],!0);t.setData(new Float32Array([0,0,1,0,0,1,1,1]));const r=e.createVertexIndexBuffer(!0);return r.setData(new Uint16Array([0,1,2,1,3,2])),e.createDataBuffers(t,r)})),this.frameBuffer=this.renderer.graphics.createFrameBuffer(this.width,this.height),this.outputTexture=this.renderer.graphics.createEmptyTexture(this.width,this.height),this.backgroundTexture=this.renderer.graphics.createEmptyTexture(this.width,this.height),this.currentBatchId=0,this.resolution=new Float32Array([this.width,this.height])}dispose(){this.isDisposing||(super.dispose(),this.renderer=null,this.blackTexture.dispose(),this.blackTexture=null,this.frameBuffer.dispose(),this.frameBuffer=null,this.outputTexture.dispose(),this.outputTexture=null,this.backgroundTexture.dispose(),this.backgroundTexture=null,this.resolution=null)}clear(){if(this.isDisposing)return;this.currentBatchId=0;const e=new n.GenericBatchRequest(u,this.parentId,this.textureType,this.currentBatchId++);e.do((e=>{e.useFrameBuffer(this.frameBuffer);const t=i.Float4.create(0,0,0,1);e.setColorBufferToTexture(this.outputTexture),e.clearFrame(t),e.setColorBufferToTexture(this.backgroundTexture),e.clearFrame(t)})),this.renderer.submitOtherGraphicsRequest(e)}drawTextureSection(e,t,r,a,i,o){if(this.isDisposing)return;if(!e[0])return;const s=new n.RenderMaterial,l=e[0].width<a||e[0].height<i,d={u_drawX:t/this.width,u_drawY:r/this.height,u_drawWidth:a/this.width,u_drawHeight:i/this.height,u_blendMode:o,u_backgroundResolution:this.resolution,u_isUpscaled:l,u_textureResolution:new Float32Array([e[0].width,e[0].height]),u_diffuseTexture:e[0]?e[0]:this.blackTexture,u_specularTexture:e[1]?e[1]:this.blackTexture,u_emissiveTexture:e[2]?e[2]:this.blackTexture,u_backgroundTexture:this.backgroundTexture};s.useShaderProgram(this.blendProgram),s.useBlendMode(n.GxBlend.GxBlend_Opaque),s.useBackFaceCulling(!1),s.useDepthTest(!1),s.useDepthWrite(!1),s.useColorMask(n.ColorMask.All),s.useUniforms(d);const c=new n.OffMainDrawingRequest(u,this.parentId,this.textureType,this.currentBatchId++);c.useMaterial(s).useDataBuffers(this.dataBuffers).useFrameBuffer(this.frameBuffer).writeColorOutputToTexture(this.outputTexture).captureCurrentFrameToTexture(this.backgroundTexture).drawIndexedTriangles(0,6),this.renderer.submitOtherGraphicsRequest(c)}}t.SkinLayerTextureCombiner=d},105:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseWoWModelViewer=void 0;const a=r(6303),i=r(1639),o=r(8283);t.BaseWoWModelViewer=class{constructor(e){if(!(null==e?void 0:e.dataLoader))throw"dataLoader is a required argument for WoWModelViewer";this.options=e,this.iocContainer=new o.DefaultIoCContainer,this.setupIOC(),this.objectFactory=this.iocContainer.getObjectFactory(),this.initializeRenderer()}getSceneBoundingBox(){return this.renderer.getSceneBoundingBox()}getCameraFov(){return this.renderer.fov}addM2Model(e){const t=this.objectFactory.createM2Model(e);return this.addSceneObject(t),t}addWMOModel(e){const t=this.objectFactory.createWMOModel(e);return this.addSceneObject(t),t}addCharacterModel(e){const t=this.objectFactory.createCharacterModel(e);return this.addSceneObject(t),t}addItemModel(e){const t=this.objectFactory.createItemModel(e);return this.addSceneObject(t),t}addTextureVariantModel(e){const t=this.objectFactory.createTextureVariantModel(e);return this.addSceneObject(t),t}addSceneObject(e){this.renderer.addSceneObject(e)}removeSceneObject(e,t=!0){this.renderer.removeSceneObject(e,t)}useStaticCamera(e=!0){const t=new a.Camera(e);return this.renderer.switchCamera(t),t}useRotatingCamera(e=!0){const t=new a.RotatingCamera(e);return this.renderer.switchCamera(t),t}useCamera(e){this.renderer.switchCamera(e)}useCameraFov(e){this.renderer.fov=e,this.renderer.resize(this.width,this.height)}useBackgroundColor(e){i.Float4.copy(e,this.renderer.clearColor)}useSunDirection(e){i.Float3.copy(e,this.renderer.sunDir),i.Float3.normalize(e,this.renderer.exteriorDirectColorDir)}useExteriorAmbientColor(e){i.Float4.copy(e,this.renderer.exteriorAmbientColor)}useExteriorDirectColor(e){i.Float4.copy(e,this.renderer.exteriorDirectColor)}useInteriorSunDirection(e){i.Float3.copy(e,this.renderer.interiorSunDir),i.Float3.normalize(e,this.renderer.interiorDirectColorDir)}useOceanCloseColor(e){i.Float4.copy(e,this.renderer.oceanCloseColor)}useOceanFarColor(e){i.Float4.copy(e,this.renderer.oceanFarColor)}useRiverCloseColor(e){i.Float4.copy(e,this.renderer.riverCloseColor)}useRiverFarColor(e){i.Float4.copy(e,this.renderer.riverFarColor)}useWaterAlphas(e){i.Float4.copy(e,this.renderer.waterAlphas)}setDoodadRenderDistance(e){this.renderer.doodadRenderDistance=e}setupIOC(){if(this.iocContainer.setDataLoader(this.options.dataLoader),this.iocContainer.setErrorHandler(this.options.onError),this.iocContainer.setProgressReporter(this.options.progressReporter),this.iocContainer.createDefaults(),!this.options.ioc)return;const e=this.options.ioc;e.dataManager&&this.iocContainer.setDataManager(e.dataManager),e.modelPickingStrategy&&this.iocContainer.setModelPickingStrategy(e.modelPickingStrategy),e.objectFactory&&this.iocContainer.setObjectFactory(e.objectFactory),e.objectIdentifier&&this.iocContainer.setObjectIdentifier(e.objectIdentifier),e.rngFactory&&this.iocContainer.setRandomNumberGeneratorCtor(e.rngFactory),e.texturePickingStrategy&&this.iocContainer.setTexturePickingStrategy(e.texturePickingStrategy)}}},177:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});const a="precision mediump float;\r\n            \r\nattribute vec2 a_texCoord;\r\nattribute vec2 a_position;\r\n\r\nvarying vec2 v_texCoord;\r\n\r\nvoid main() {\r\n    v_texCoord = a_texCoord;\r\n    gl_Position = vec4(a_position, 0, 1);\r\n}"},207:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FirstPersonCamera=void 0;const a=r(1639),i=r(8204);var o;!function(e){e[e.None=0]="None",e[e.Positive=1]="Positive",e[e.Negative=-1]="Negative"}(o||(o={}));class n extends i.Disposable{constructor(e,t=!0){super(),this.containerElement=e,this.viewMatrix=a.Float44.identity(),this.cameraMatrix=a.Float44.identity(),this.position=a.Float3.create(0,0,0),this.rotation=a.Float3.create(0,0,Math.PI),this.xMovement=o.None,this.yMovement=o.None,this.zMovement=o.None,this.movementSpeed=50,this.isDraggingMouse=!1,this.resizeOnSceneExpand=t}getViewMatrix(){return this.isDisposing?a.Float44.identity():this.viewMatrix}attachToRenderer(e){this.isDisposing||(this.renderer=e,this.onMouseDown=this.handleMouseDown.bind(this),this.onTouchStart=this.handleTouchStart.bind(this),this.containerElement.addEventListener("mousedown",this.onMouseDown),this.containerElement.addEventListener("touchstart",this.onTouchStart),document&&(this.onMouseUp=this.handleDragRelease.bind(this),this.onTouchEnd=this.handleDragRelease.bind(this),this.onMouseMove=this.handleMouseMove.bind(this),this.onTouchMove=this.handleTouchMove.bind(this),this.onKeyUp=this.handleKeyDown.bind(this),this.onKeyDown=this.handleKeyUp.bind(this),document.addEventListener("keydown",this.onKeyUp),document.addEventListener("keyup",this.onKeyDown),document.addEventListener("mouseup",this.onMouseUp),document.addEventListener("touchend",this.onTouchEnd),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("touchmove",this.onTouchMove),document.addEventListener("pointerlockchange",(()=>{}))),this.resizeOnSceneExpand&&(this.scaleToSceneBoundingBox(),this.resizeCallbackFn=()=>{this.scaleToSceneBoundingBox()},this.renderer.on("sceneBoundingBoxUpdate",this.resizeCallbackFn)))}update(e){if(this.isDisposing)return;e>100&&(e=100);const t=a.Float4.quatFromEulers(this.rotation[0],this.rotation[1],this.rotation[2]),r=a.Float44.fromQuat(t),i=a.Float3.create(this.xMovement,this.yMovement,this.zMovement);a.Float3.normalize(i,i);const o=a.Float3.create(this.movementSpeed,this.movementSpeed,this.movementSpeed),n=a.Float3.create(e/1e3,e/1e3,e/1e3);a.Float3.multiply(o,n,o),a.Float3.multiply(o,i,i),a.Float44.transformPoint(i,r,i),a.Float3.add(i,this.position,this.position),a.Float44.identity(this.cameraMatrix),a.Float44.rotateX(this.cameraMatrix,Math.PI/180*90,this.cameraMatrix),a.Float44.translate(this.cameraMatrix,this.position,this.cameraMatrix),a.Float44.multiply(this.cameraMatrix,r,this.cameraMatrix),a.Float44.invert(this.cameraMatrix,this.viewMatrix)}setMovementSpeed(e){this.movementSpeed=e}dispose(){this.isDisposing||(super.dispose(),this.renderer.off("sceneBoundingBoxUpdate",this.resizeCallbackFn),this.containerElement.removeEventListener("mousedown",this.onMouseDown),this.containerElement.removeEventListener("touchstart",this.onTouchStart),this.onMouseDown=null,this.onTouchStart=null,document&&(document.removeEventListener("keydown",this.onKeyUp),document.removeEventListener("keyup",this.onKeyDown),document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("touchend",this.onTouchEnd),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("touchmove",this.onTouchMove),this.onMouseUp=null,this.onTouchEnd=null,this.onMouseMove=null,this.onTouchMove=null,this.onKeyUp=null,this.onKeyDown=null),this.position=null,this.rotation=null,this.viewMatrix=null,this.cameraMatrix=null,this.containerElement=null,this.renderer=null)}scaleToSceneBoundingBox(){if(this.isDisposing)return;const e=this.renderer.getSceneBoundingBox(),t=2*a.AABB.sphereRadius(e);a.Float3.zero(this.position),this.position[0]+=t,a.Float3.zero(this.rotation),this.rotation[1]=Math.PI/2}handleKeyDown(e){switch(e.key.toUpperCase()){case"W":return this.zMovement=o.Negative,!1;case"S":return this.zMovement=o.Positive,!1;case"A":return this.xMovement=o.Negative,!1;case"D":return this.xMovement=o.Positive,!1;case"Q":return this.yMovement=o.Positive,!1;case"E":return this.yMovement=o.Negative,!1}return!0}handleKeyUp(e){switch(e.key.toUpperCase()){case"W":case"S":return this.zMovement=o.None,!1;case"A":case"D":return this.xMovement=o.None,!1;case"Q":case"E":return this.yMovement=o.None,!1}return!0}handleMouseDown(e){2!=e.button&&(this.isDraggingMouse=!0,e.preventDefault(),document&&!document.pointerLockElement&&this.containerElement.requestPointerLock())}handleTouchStart(e){e.preventDefault(),document&&!document.pointerLockElement&&this.containerElement.requestPointerLock()}handleMouseMove(e){this.isDraggingMouse&&this.handleDrag(e.movementX,e.movementY)}handleTouchMove(e){this.handleDrag(e.touches[0].clientX,e.touches[0].clientY)}handleDrag(e,t){if(this.isDisposing)return;const r=-Math.PI/180/4,a=e*r,i=t*r;this.rotation[1]+=a,this.rotation[0]+=i}handleDragRelease(){this.isDraggingMouse=!1,document&&document.pointerLockElement&&document.exitPointerLock()}}t.FirstPersonCamera=n},269:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebGlDataTexture=t.WebGlFrameBuffer=t.WebGlNativeVertexArrayObject=t.WebGLShaderProgram=t.WebGlVertexDataBuffer=t.WebGLVertexIndexBuffer=t.WebGlVertexAttribPointer=t.WebGLTextureAbstraction=t.WebGlGraphics=void 0;const a=r(7983),i=r(1639),o=r(8204),n=r(2388),s=r(7690);class l extends s.CachedGraphics{constructor(e){super(),this.gl=e,this.glVaoExt=e.getExtension("OES_vertex_array_object"),this.glFloatTextures=this.gl.getExtension("OES_texture_float")}startFrame(e,t){super.startFrame(e,t),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.viewport(0,0,e,t),this.gl.depthFunc(this.gl.LEQUAL)}clearFrame(e){e&&this.gl.clearColor(e[0],e[1],e[2],e[3]),this.gl.depthMask(!0),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}endFrame(){this.lastUsedDatabuffers&&this.lastUsedDatabuffers.unbind(),this.lastUsedFrameBuffer&&this.lastUsedFrameBuffer.unbind(),this.gl.bindTexture(this.gl.TEXTURE_2D,null)}activateBlendMode(e){switch(e===n.GxBlend.GxBlend_Opaque?this.gl.disable(this.gl.BLEND):(this.gl.enable(this.gl.BLEND),this.gl.blendEquation(this.gl.FUNC_ADD)),e){case n.GxBlend.GxBlend_Opaque:break;case n.GxBlend.GxBlend_AlphaKey:this.gl.blendFuncSeparate(this.gl.ONE,this.gl.ZERO,this.gl.ONE,this.gl.ONE);break;case n.GxBlend.GxBlend_Alpha:this.gl.blendFuncSeparate(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA);break;case n.GxBlend.GxBlend_Add:this.gl.blendFuncSeparate(this.gl.SRC_ALPHA,this.gl.ONE,this.gl.ZERO,this.gl.ONE);break;case n.GxBlend.GxBlend_Mod:this.gl.blendFuncSeparate(this.gl.DST_COLOR,this.gl.ZERO,this.gl.DST_ALPHA,this.gl.ZERO);break;case n.GxBlend.GxBlend_Mod2x:this.gl.blendFuncSeparate(this.gl.DST_COLOR,this.gl.SRC_COLOR,this.gl.DST_ALPHA,this.gl.SRC_ALPHA);break;case n.GxBlend.GxBlend_ModAdd:this.gl.blendFuncSeparate(this.gl.DST_COLOR,this.gl.ONE,this.gl.DST_ALPHA,this.gl.ONE);break;case n.GxBlend.GxBlend_InvSrcAlphaAdd:this.gl.blendFuncSeparate(this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE);break;case n.GxBlend.GxBlend_InvSrcAlphaOpaque:this.gl.blendFuncSeparate(this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ZERO,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ZERO);break;case n.GxBlend.GxBlend_SrcAlphaOpaque:this.gl.blendFuncSeparate(this.gl.SRC_ALPHA,this.gl.ZERO,this.gl.SRC_ALPHA,this.gl.ZERO);break;case n.GxBlend.GxBlend_NoAlphaAdd:this.gl.blendFuncSeparate(this.gl.ONE,this.gl.ONE,this.gl.ZERO,this.gl.ONE);break;case n.GxBlend.GxBlend_ConstantAlpha:this.gl.blendFuncSeparate(this.gl.CONSTANT_ALPHA,this.gl.ONE_MINUS_CONSTANT_ALPHA,this.gl.CONSTANT_ALPHA,this.gl.ONE_MINUS_CONSTANT_ALPHA);break;case n.GxBlend.GxBlend_Screen:this.gl.blendFuncSeparate(this.gl.ONE_MINUS_DST_COLOR,this.gl.ONE,this.gl.ONE,this.gl.ZERO);break;case n.GxBlend.GxBlend_BlendAdd:this.gl.blendFuncSeparate(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA)}}activateDepthWrite(e){this.gl.depthMask(e)}activateDepthTest(e){this.useGlFeature(this.gl.DEPTH_TEST,e)}activateBackFaceCulling(e){this.useGlFeature(this.gl.CULL_FACE,e)}activateCounterClockWiseFrontFaces(e){e?this.gl.frontFace(this.gl.CCW):this.gl.frontFace(this.gl.CW)}activateColorMask(e){this.gl.colorMask((e&n.ColorMask.Red)>0,(e&n.ColorMask.Green)>0,(e&n.ColorMask.Blue)>0,(e&n.ColorMask.Alpha)>0)}setColorBufferToTexture(e){const t=e.texture;this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,t,0)}drawTriangles(e,t){this.gl.drawArrays(this.gl.TRIANGLES,e,t)}drawIndexedTriangles(e,t){this.gl.drawElements(this.gl.TRIANGLES,t,this.gl.UNSIGNED_SHORT,e)}drawIndexedTriangleStrip(e,t){this.gl.drawElements(this.gl.TRIANGLE_STRIP,t,this.gl.UNSIGNED_SHORT,e)}copyFrameToTexture(e,t,r,a,i){e.bind(),this.gl.copyTexImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,t,r,a,i,0),e.unbind()}useGlFeature(e,t){t?this.gl.enable(e):this.gl.disable(e)}createSolidColorTexture(e){const t=this.gl,r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(i.Float4.scale(e,255))),t.bindTexture(t.TEXTURE_2D,null);const a=new u(this.gl,r);return a.width=1,a.height=1,a}createEmptyTexture(e,t){const r=this.gl,a=r.createTexture();r.bindTexture(r.TEXTURE_2D,a),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,t,0,r.RGBA,r.UNSIGNED_BYTE,null),r.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),r.bindTexture(r.TEXTURE_2D,null);const i=new u(this.gl,a);return i.width=e,i.height=t,i}createDataTexture(e){if(!this.glFloatTextures)throw new Error("This function requires the OES_texture_float extension for WebGL");return new g(this.gl,e)}createTextureFromImg(e,t){const r=new u(this.gl,(0,a.createTexture)(this.gl,{premultiplyAlpha:(null==t?void 0:t.preMultiplyAlpha)?t.preMultiplyAlpha:0,src:e,auto:!0,wrapS:(null==t?void 0:t.clampS)?this.gl.CLAMP_TO_EDGE:this.gl.REPEAT,wrapT:(null==t?void 0:t.clampT)?this.gl.CLAMP_TO_EDGE:this.gl.REPEAT}));return r.width=e.width,r.height=e.height,r}createTextureFromRawImgData(e,t){const r=new u(this.gl,(0,a.createTexture)(this.gl,{premultiplyAlpha:(null==t?void 0:t.preMultiplyAlpha)?t.preMultiplyAlpha:0,src:e.pixelData,width:e.width,height:e.height,auto:!0,wrapS:(null==t?void 0:t.clampS)?this.gl.CLAMP_TO_EDGE:this.gl.REPEAT,wrapT:(null==t?void 0:t.clampT)?this.gl.CLAMP_TO_EDGE:this.gl.REPEAT}));return r.width=e.width,r.height=e.height,r}createVertexIndexBuffer(e){return new c(this.gl,e)}createVertexDataBuffer(e,t){return new h(this.gl,e.map((e=>new d(this.gl,e.index,e.size,e.type?e.type:n.BufferDataType.Float,!!e.normalized,e.stride?e.stride:0,e.offset?e.offset:0))),t)}createShaderProgram(e,t,r){return new f(this.gl,e,t,r)}createDataBuffers(e,t){const r=new p(this.gl,this.glVaoExt);return e&&r.setIndexBuffer(e),t&&r.addVertexDataBuffer(t),r}createFrameBuffer(e,t){return new m(this.gl,e,t)}}t.WebGlGraphics=l;class u extends o.Disposable{constructor(e,t){super(),this.gl=e,this.texture=t,this.fileId=0,this.width=0,this.height=0}bind(){this.isDisposing||this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture)}unbind(){this.isDisposing||this.gl.bindTexture(this.gl.TEXTURE_2D,null)}swapFor(e){this.height=e.height,this.width=e.width,this.texture=e.texture,this.fileId=e.fileId}dispose(){this.isDisposing||(super.dispose(),this.gl.deleteTexture(this.texture),this.texture=null,this.gl=null)}}t.WebGLTextureAbstraction=u;class d{constructor(e,t,r,a,i,o,s){switch(this.gl=e,this.index=t,this.size=r,this.normalized=i,this.stride=o,this.offset=s,a){case n.BufferDataType.UInt8:this.type=e.UNSIGNED_BYTE;break;case n.BufferDataType.UInt16:this.type=e.UNSIGNED_SHORT;break;case n.BufferDataType.UInt32:this.type=e.UNSIGNED_INT;break;case n.BufferDataType.Int8:this.type=e.BYTE;break;case n.BufferDataType.Int16:this.type=e.SHORT;break;case n.BufferDataType.Int32:this.type=e.INT;break;case n.BufferDataType.Float:this.type=e.FLOAT}}bind(){this.gl.enableVertexAttribArray(this.index),this.gl.vertexAttribPointer(this.index,this.size,this.type,this.normalized,this.stride,this.offset)}unbind(){}dispose(){this.gl=null}}t.WebGlVertexAttribPointer=d;class c extends o.Disposable{constructor(e,t){super(),this.gl=e,this.dynamic=t,this.buffer=e.createBuffer(),this.size=0}setData(e){this.isDisposing||(this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.buffer),this.size<e.byteLength?(this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,e,this.dynamic?this.gl.DYNAMIC_DRAW:this.gl.STATIC_DRAW),this.size=e.byteLength):this.gl.bufferSubData(this.gl.ELEMENT_ARRAY_BUFFER,0,e),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null))}bind(){this.isDisposing||this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.buffer)}unbind(){this.isDisposing||this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null)}dispose(){this.isDisposing||(super.dispose(),this.gl.deleteBuffer(this.buffer))}}t.WebGLVertexIndexBuffer=c;class h extends o.Disposable{constructor(e,t,r){super(),this.gl=e,this.dynamic=r,this.buffer=e.createBuffer(),this.size=0,this.pointers=t}bind(){if(!this.isDisposing){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer);for(const e of this.pointers)e.bind()}}unbind(){this.isDisposing||this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)}setData(e){this.isDisposing||(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer),this.size<e.byteLength?(this.gl.bufferData(this.gl.ARRAY_BUFFER,e,this.dynamic?this.gl.DYNAMIC_DRAW:this.gl.STATIC_DRAW),this.size=e.byteLength):this.gl.bufferSubData(this.gl.ARRAY_BUFFER,0,e),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null))}dispose(){if(!this.isDisposing){super.dispose(),this.gl.deleteBuffer(this.buffer);for(const e of this.pointers)e.dispose();this.pointers=null,this.buffer=null,this.gl=null}}}t.WebGlVertexDataBuffer=h;class f extends o.Disposable{constructor(e,t,r,i){if(super(),this.gl=e,this.programInfo=(0,a.createProgramInfo)(e,[t,r],{attribLocations:i}),!this.programInfo)throw"Failed to create program"}getAttribLocation(e){if(!this.isDisposing)return this.gl.getAttribLocation(this.programInfo.program,e)}bind(){this.isDisposing||(this.gl.useProgram(this.programInfo.program),this.lastUniforms=null)}useUniforms(e){if(!this.isDisposing&&e!==this.lastUniforms){this.lastUniforms=e;for(let t in e)e[t]&&e[t].texture&&(e[t]=e[t].texture);(0,a.setUniforms)(this.programInfo,e)}}unbind(){this.isDisposing||this.gl.useProgram(null)}dispose(){this.isDisposing||(super.dispose(),this.gl.deleteProgram(this.programInfo.program),this.programInfo=null,this.lastUniforms=null,this.gl=null)}}t.WebGLShaderProgram=f;class p extends o.Disposable{constructor(e,t){super(),this.gl=e,this.glVaoExt=t,this.webGlVAO=t.createVertexArrayOES(),this.vertexDataBuffers=[]}setIndexBuffer(e){this.isDisposing||(this.bind(),e.bind(),this.unbind(),this.vertexIndexBuffer=e)}addVertexDataBuffer(e){this.isDisposing||(this.bind(),e.bind(),this.unbind(),this.vertexDataBuffers.push(e))}bind(){this.isDisposing||this.glVaoExt.bindVertexArrayOES(this.webGlVAO)}unbind(){this.isDisposing||this.glVaoExt.bindVertexArrayOES(null)}dispose(){if(!this.isDisposing){super.dispose(),this.vertexIndexBuffer.dispose(),this.glVaoExt.deleteVertexArrayOES(this.webGlVAO);for(const e of this.vertexDataBuffers)e.dispose();this.vertexDataBuffers=null,this.webGlVAO=null,this.glVaoExt=null,this.gl=null}}}t.WebGlNativeVertexArrayObject=p;class m extends o.Disposable{constructor(e,t,r){super(),this.gl=e,this.width=t,this.height=r,this.glFrameBuffer=e.createFramebuffer()}bind(){this.isDisposing||(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.glFrameBuffer),this.gl.viewport(0,0,this.width,this.height))}unbind(){this.isDisposing||this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)}dispose(){this.isDisposing||(super.dispose(),this.gl.deleteFramebuffer(this.glFrameBuffer),this.glFrameBuffer=null,this.gl=null)}}t.WebGlFrameBuffer=m;class g extends o.Disposable{constructor(e,t){super(),this.gl=e,this.texture=this.gl.createTexture(),this.width=t,this.bind(),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.unbind()}setData(e,t,r){let a=e;if(e.length%4!=0){a=new Float32Array(4*r);for(let i=0;i<r;i++){const r=i*t,o=4*i;for(let i=0;i<t;i++)a[o+i]=e[r+i]}}this.bind(),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.width,r,0,this.gl.RGBA,this.gl.FLOAT,a),this.unbind()}bind(){this.isDisposing||this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture)}unbind(){this.isDisposing||this.gl.bindTexture(this.gl.TEXTURE_2D,null)}dispose(){this.isDisposing||(super.dispose(),this.gl.deleteTexture(this.texture))}}t.WebGlDataTexture=g},304:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});const a="\r\nprecision mediump float;\r\nprecision mediump int;\r\nuniform sampler2D u_texture;\r\n\r\nvarying vec4 v_color;\r\nvarying vec2 v_texCoord1;\r\n\r\nvoid main() {\r\n    vec4 tex = texture2D(u_texture, v_texCoord1).rgba;\r\n    gl_FragColor = vec4((v_color.rgb*tex.rgb), tex.a * v_color.a);\r\n}"},492:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});const a="precision mediump float;\r\n\r\nattribute vec3 a_position;\r\nattribute vec2 a_texCoord;\r\n\r\nuniform float u_linewidth;\r\nuniform vec3 u_segmentStart;\r\nuniform vec3 u_segmentEnd;\r\n\r\nuniform mat4 u_projectionMatrix;\r\nuniform mat4 u_modelMatrix;\r\nuniform mat4 u_viewMatrix;\r\n\r\nvarying vec2 v_texCoord;\r\nvarying vec4 v_position;\r\n\r\nvoid main() {\r\n    vec3 position = a_position;\r\n    v_texCoord = a_texCoord;\r\n\r\n    mat4 modelViewMatrix = u_viewMatrix * u_modelMatrix;\r\n    vec4 start = modelViewMatrix * vec4( u_segmentStart, 1.0 );\r\n    vec4 end = modelViewMatrix * vec4( u_segmentEnd, 1.0 );\r\n\r\n    vec3 worldDir = normalize( end.xyz - start.xyz );\r\n    vec3 midPoint = normalize( mix( start.xyz, end.xyz, 0.5 ) );\r\n    vec3 segLength = normalize( cross( worldDir, midPoint ) );\r\n    v_position = position.y < 0.5 ? start: end;\r\n\r\n    float segmentWidth = u_linewidth * 0.5;\r\n    v_position.xyz += position.x * segmentWidth * segLength;\r\n\r\n    vec4 clip = u_projectionMatrix * v_position;\r\n    gl_Position = clip;\r\n}"},599:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},708:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(2129),t),i(r(3613),t),i(r(6679),t),i(r(4312),t),i(r(1783),t),i(r(1854),t),i(r(6837),t)},909:function(e,t,r){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.M2ParticleEmitter=void 0;const i=r(1639),o=r(8204),n=r(1017),s=a(r(8680)),l=a(r(8997)),u=r(2807),d=r(3104),c=r(7729),h=[0,0,1,2,3,4],f=[0,1,2,10,3,4,5,13],p=new Array(128);for(let e=0;e<128;e++)p[e]=Math.random();class m{}class g{constructor(){this.center=i.Float3.zero(),this.ageValues={scale:i.Float2.zero(),color:i.Float3.zero(),headCell:0,tailCell:0,alpha:1,alphaCutoff:0}}}class y extends o.Disposable{constructor(e,t,r,a){super(),this.index=e,this.renderer=t.renderer,this.parent=t,this.m2data=r,this.exp2Data=a,this.rng=t.rng,this.emitterModelMatrix=i.Float44.identity(),this.previousPosition=i.Float3.zero(),this.zOrder=0,this.inheritedScale=0,this.burstTime=0,this.particles=[],this.burstVec=i.Float3.zero(),this.fullDeltaPosition=i.Float3.zero(),this.stepDeltaPosition=i.Float3.zero(),this.emissionCounter=0,this.vertexData=[],this.particleToView=i.Float44.identity(),this.particlesFixMat=i.Float44.create(0,1,0,0,-1,0,0,0,0,0,1,0,0,0,0,1),this.quadToView=i.Float33.identity(),this.quadToViewZVector=i.Float3.zero(),this.nrQuads=0,(null==a?void 0:a.alphaCutoff)&&(this.alphaCutOffTrack=new c.LocalAnimatedValueNumber(a.alphaCutoff)),this.colorTrack=new c.LocalAnimatedFloat3(this.m2data.colorTrack),this.alphaTrack=new c.LocalAnimatedValueNumber(this.m2data.alphaTrack),this.scaleTrack=new c.LocalAnimatedValueFloat2(this.m2data.scaleTrack),this.headCellTrack=new c.LocalAnimatedValueNumber(this.m2data.headCellTrack),this.tailCellTrack=new c.LocalAnimatedValueNumber(this.m2data.tailCellTrack),this.show=!0,this.initialize()}dispose(){var e;this.isDisposing||(super.dispose(),this.parent=null,this.renderer=null,this.m2data=null,this.exp2Data=null,this.rng=null,this.particleGenerator.dispose(),this.particleGenerator=null,this.particleColorOverride=null,this.colorTrack.dispose(),this.colorTrack=null,this.alphaTrack.dispose(),this.alphaTrack=null,this.scaleTrack.dispose(),this.scaleTrack=null,this.headCellTrack.dispose(),this.headCellTrack=null,this.tailCellTrack.dispose(),this.tailCellTrack=null,null===(e=this.alphaCutOffTrack)||void 0===e||e.dispose(),this.alphaCutOffTrack=null,this.particlesFixMat=null,this.particles=null,this.emitterModelMatrix=null,this.previousPosition=null,this.burstVec=null,this.fullDeltaPosition=null,this.stepDeltaPosition=null,this.particleToView=null,this.quadToView=null,this.quadToViewZVector=null,this.databuffers.dispose(),this.shaderProgram=null,this.databuffers=null,this.indexBuffer=null,this.vertexBuffer=null,this.material=null)}initialize(){if(this.m2data.particleColorIndex>=11&&this.m2data.particleColorIndex<=13){const e=this.m2data.particleColorIndex-11;this.parent.particleColorOverrides[e]&&(this.particleColorOverride=this.parent.particleColorOverrides[e])}switch(this.m2data.emitterType){case 1:this.particleGenerator=new u.PlaneParticleGenerator(this.rng,this.m2data);break;case 2:this.particleGenerator=new d.SphereParticleGenerator(this.rng,this.m2data,!!(256&this.m2data.flags));break;default:throw"Found unimplemented particle generator "+this.m2data.emitterType}const e=this.m2data.followSpeed2-this.m2data.followSpeed2;0!=e?(this.followMult=(this.m2data.followScale2-this.m2data.followScale1)/e,this.followBase=this.m2data.followScale1-this.m2data.followSpeed1*this.followMult):(this.followMult=0,this.followBase=0);let t=this.m2data.textureDimensionsColumns;t<=0&&(t=1);let r=this.m2data.textureDimensionsRows;r<=0&&(r=1),this.textureIndexMask=t*r-1;let a=t,i=-1;for(;a;)++i,a>>=1;if(this.textureColBits=i,this.textureColMask=t-1,this.randomizedTextureIndexMask=0,(32768&this.m2data.flags)>0){let e=(this.textureIndexMask+1)*this.rng.getInt();this.randomizedTextureIndexMask=e/4294967296|0}this.texScaleX=1/t,this.texScaleY=1/r;let o=!1;(269484032&this.m2data.flags)>0?(o=!!(268435456&this.m2data.flags),this.particleType=o?2:3):this.particleType=0;let n=!1,s=!1;(268435456&this.m2data.flags)>0?s=(1073741824&this.m2data.flags)>0:1048576&this.m2data.flags||(n=!(1&this.m2data.flags)),2===this.particleType||2===this.particleType&&o?this.shaderId=s?3:2:3==this.particleType?this.shaderId=5:this.shaderId=n?1:0,this.setupGraphics()}update(e){if(this.isDisposing)return;if(!this.particleGenerator)return;if(this.parent.animationState.isPaused)return;e*=.001,this.updateAnimatedProps();const t=i.Float44.identity();i.Float44.multiply(t,this.parent.worldModelMatrix,t),i.Float44.multiply(t,this.parent.boneData[this.m2data.bone].positionMatrix,t);const r=i.Float44.identity();i.Float44.createWithTranslation(this.m2data.position,r),i.Float44.multiply(t,r,t),i.Float44.multiply(t,this.particlesFixMat,t),this.updateParticles(e,t)}draw(){if(this.isDisposing||!this.show)return;if(this.particles.length<=0)return;this.updateVertexBuffer(),this.vertexBuffer.setData(new Float32Array(this.vertexData));const e=new n.DrawingBatchRequest("M2-PARTICLE",this.parent.fileId,this.index);e.useMaterial(this.material).useDataBuffers(this.databuffers).drawIndexedTriangles(0,6*this.nrQuads|0),this.renderer.submitDrawRequest(e)}updateParticles(e,t){if(null==this.particleGenerator)return;i.Float44.getTranslation(this.emitterModelMatrix,this.previousPosition);let r=i.Float4.zero();if(i.Float44.getTranslation(t,r),r[3]=1,i.Float44.transformDirection4(r,this.renderer.viewMatrix,r),this.zOrder=r[2],i.Float44.copy(t,this.emitterModelMatrix),this.inheritedScale=i.Float3.length(i.Float44.getColumn4(this.emitterModelMatrix,0)),e>0){const t=i.Float44.getTranslation(this.emitterModelMatrix);if(this.fullDeltaPosition=i.Float3.subtract(t,this.previousPosition),16384&this.m2data.flags){let t=this.followMult*(i.Float3.length(this.fullDeltaPosition)/e)+this.followBase;t>=0&&(t=Math.min(t,1)),i.Float3.scale(this.fullDeltaPosition,t,this.stepDeltaPosition)}if(64&this.m2data.flags){this.burstTime+=e;let t=.03;if(this.burstTime>t)if(this.burstTime=0,0==this.particles.length){let e=t/this.burstTime*this.m2data.burstMultiplier;i.Float3.multiply(this.fullDeltaPosition,i.Float3.fromScalar(e),this.burstVec)}else i.Float3.set(this.burstVec,0,0,0)}this.processSteps(e)}}processSteps(e){if((e=Math.max(e,0))<.1)i.Float3.copy(this.fullDeltaPosition,this.stepDeltaPosition);else{let t=Math.floor(e/.1);e=-.1*t+e;let r=Math.min(Math.floor(this.particleGenerator.getAnimatedProps().lifespan/.1),t),a=r+1,o=1;o=a<0?1:a,i.Float3.scale(this.fullDeltaPosition,1/o,this.stepDeltaPosition);for(let e=0;e<r;e++)this.processStep(.1)}this.processStep(e)}processStep(e){let t=new m;if(!(e<0)){this.calcForces(t,e),this.emitNewParticles(e);for(let r=0;r<this.particles.length;r++){let a=this.particles[r];a.age=a.age+e,a.age>Math.max(this.particleGenerator.getLifespan(a.seed),.001)?(this.particles.splice(r,1),r--):this.updateParticle(a,e,t)||(this.particles.splice(r,1),r--)}}}calcForces(e,t){e.windVector=i.Float3.zero(),e.gravity=i.Float3.zero(),e.position=i.Float3.zero(),e.drag=0,i.Float3.multiply(this.m2data.windVector,i.Float3.fromScalar(t),e.windVector);let r=i.Float3.zero();this.particleGenerator.getGravity(r),i.Float3.multiply(r,i.Float3.fromScalar(t),e.gravity),i.Float3.multiply(r,i.Float3.fromScalar(t*t*.5),e.position),e.drag=Math.min(this.m2data.drag*t,1)}emitNewParticles(e){if(!this.activeNow)return;let t=this.particleGenerator.getNextEmissionRate();for(this.emissionCounter=this.emissionCounter+e*t;this.emissionCounter>1;)this.createNewParticle(e),this.emissionCounter-=1}createNewParticle(e){const t=this.particleGenerator.generateParticle(e);if(16&this.m2data.flags||(i.Float44.transformDirection3_1(t.position,this.emitterModelMatrix,t.position),i.Float44.transformDirection3_0(t.velocity,this.emitterModelMatrix,t.velocity),8192&this.m2data.flags&&(t.position[2]=0)),64&this.m2data.flags){const e=1+this.particleGenerator.animatedProps.speedVariation*this.rng.getSignedFloat(),r=i.Float3.zero();i.Float3.scale(this.burstVec,e,r),i.Float3.add(t.velocity,r,t.velocity)}if(this.particleType>=2)for(let e=0;e<2;e++){t.texturePosition[e][0]=this.rng.getFloat(),t.texturePosition[e][1]=this.rng.getFloat();let r=i.Float2.scale(this.m2data.multiTextureParam1[e],this.rng.getSignedFloat()),a=this.m2data.multiTextureParam0[e];t.textureVelocity[e]=i.Float2.add(r,a)}this.particles.push(t)}updateParticle(e,t,r){if(this.particleType>=2)for(let r=0;r<2;r++){let a=e.texturePosition[r][0]+.1*t*e.textureVelocity[r][0];e.texturePosition[r][0]=a-Math.floor(a),a=e.texturePosition[r][1]+.1*t*e.textureVelocity[r][1],e.texturePosition[r][1]=a-Math.floor(a)}i.Float3.add(e.velocity,r.windVector,e.velocity),16384&this.m2data.flags&&2*t<e.age&&i.Float3.add(e.position,this.stepDeltaPosition,e.position);const a=i.Float3.multiply(e.velocity,i.Float3.fromScalar(t));if(i.Float3.add(e.velocity,r.gravity,e.velocity),i.Float3.scale(e.velocity,1-r.drag,e.velocity),i.Float3.add(e.position,a,e.position),i.Float3.add(e.position,r.position,e.position),2===this.m2data.emitterType&&128&this.m2data.flags){const t=i.Float3.copy(e.position);if(16&this.m2data.flags){if(i.Float3.dot(t,a)>0)return!1}else if(i.Float3.subtract(e.position,i.Float44.getTranslation(this.emitterModelMatrix),t),i.Float3.dot(t,a)>0)return!1}return!0}updateVertexBuffer(){if(this.vertexData.length=0,0==this.particles.length&&null!=this.particleGenerator)return;this.calculateQuadToViewEtc();let e=0;for(let t=0;t<this.particles.length;t++){let r=this.particles[t],a=new g;if(this.calculatePreRenderData(r,a)&&(131072&this.m2data.flags&&(this.buildVertex1(r,a),e++),262144&this.m2data.flags&&(this.buildVertex2(r,a),e++)),e>=1e3)break}this.nrQuads=e}calculateQuadToViewEtc(){if(16&this.m2data.flags?i.Float44.multiply(this.renderer.viewMatrix,this.emitterModelMatrix,this.particleToView):i.Float44.copy(this.renderer.viewMatrix,this.particleToView),4096&this.m2data.flags){if(i.Float33.getRotationMatrix(this.particleToView,this.quadToView),16&this.m2data.flags&&Math.abs(this.inheritedScale)>0){let e=1/this.inheritedScale;i.Float33.scale(this.quadToView,e,this.quadToView)}i.Float3.set(this.quadToViewZVector,this.quadToView[6],this.quadToView[7],this.quadToView[8]),i.Float3.lengthSquared(this.quadToViewZVector)<=2.3841858e-7?i.Float3.set(this.quadToViewZVector,0,0,1):i.Float3.normalize(this.quadToViewZVector,this.quadToViewZVector)}}calculatePreRenderData(e,t){const r=this.m2data.twinklePercent,a=this.m2data.twinkleScale[0],o=this.m2data.twinkleScale[1]-a;let n=0;if((r<1||0!=o)&&(n=127&e.age*this.m2data.twinkleSpeed+e.seed),r<p[n])return 0;this.fillTimedParticleData(e,t);const s=o*p[n]+a;return i.Float2.scale(t.ageValues.scale,s,t.ageValues.scale),32&this.m2data.flags&&i.Float2.scale(t.ageValues.scale,this.inheritedScale,t.ageValues.scale),i.Float44.transformDirection3_1(e.position,this.particleToView,t.center),1}fillTimedParticleData(e,t){this.rng.setSeed(e.seed);let r=e.age/this.particleGenerator.getMaxLifespan();r=Math.max(0,Math.min(1,r));const a=i.Float3.create(255,255,255),o=i.Float2.create(1,1),n=t.ageValues;if(this.colorTrack.getValueAtTimestamp(32767*r,a,n.color,this.particleColorOverride),i.Float3.scale(n.color,1/255,n.color),this.scaleTrack.getValueAtTimestamp(32767*r,o,n.scale),n.alpha=this.alphaTrack.getValueAtTimestamp(32767*r,32767)/32767,this.exp2Data?n.alphaCutoff=this.alphaCutOffTrack.getValueAtTimestamp(r,0)/32767:n.alphaCutoff=0,this.headCellTrack.timestamps.length>0)n.headCell=this.headCellTrack.getValueAtTimestamp(32767*r,0),n.headCell=this.textureIndexMask&n.headCell+this.randomizedTextureIndexMask;else if(65536&this.m2data.flags){let e=Math.floor((this.textureIndexMask+1)*this.rng.getFloat());n.headCell=e}else n.headCell=0;if(n.tailCell=this.tailCellTrack.getValueAtTimestamp(32767*r,0),n.tailCell=n.tailCell+this.randomizedTextureIndexMask&this.textureIndexMask,524288&this.m2data.flags)n.scale[0]=Math.max(1+this.rng.getSignedFloat()*this.m2data.scaleVary[0],99999997e-12)*n.scale[0],n.scale[1]=Math.max(1+this.rng.getSignedFloat()*this.m2data.scaleVary[1],99999997e-12)*n.scale[1];else{let e=Math.max(1+this.rng.getSignedFloat()*this.m2data.scaleVary[0],99999997e-12);n.scale[0]=e*n.scale[0],n.scale[1]=e*n.scale[1]}}buildVertex1(e,t){let r=i.Float2.create((t.ageValues.headCell&this.textureColMask)*this.texScaleX,(t.ageValues.headCell>>this.textureColBits)*this.texScaleY),{baseSpin:a,deltaSpin:o}=this.calculateSpin(e),n=0,s=i.Float3.create(0,0,0),l=i.Float3.create(0,0,0),u=!1,d=!!(4096&this.m2data.flags);if(4&this.m2data.flags&&i.Float3.lengthSquared(e.velocity)>2.3841858e-7&&(n=1,!d)){const r=i.Float44.transformDirection3_0(i.Float3.negate(e.velocity),this.particleToView);let a=0,o=i.Float3.lengthSquared(r);a=o<=2.3841858e-7?0:1/Math.sqrt(o);const n=i.Float3.scale(r,a);i.Float3.scale(n,t.ageValues.scale[0],s),i.Float3.set(l,n[1],-n[0],0),i.Float3.scale(l,t.ageValues.scale[1],l),u=!0}if(d&&!u){let r=i.Float33.copy(this.quadToView),d=t.ageValues.scale[0];if(n){let a=0;const o=i.Float3.negate(e.velocity),n=i.Float3.lengthSquared(o);a=n<=2.3841858e-7?0:1/Math.sqrt(n),i.Float33.multiply(this.quadToView,i.Float33.create(o[0]*a,o[1]*a,0,-o[1]*a,o[0]*a,0,0,0,1),r),a>2.3841858e-7&&(d=t.ageValues.scale[0]*(1/Math.sqrt(i.Float3.lengthSquared(e.velocity))/a))}if(i.Float33.getColumn(r,0,s),i.Float3.scale(s,d,s),i.Float33.getColumn(r,1,l),i.Float3.scale(l,t.ageValues.scale[1],l),o=l[0],u=!0,0!=this.m2data.spin||0!=this.m2data.spinVary){let t=a+o*e.age;512&this.m2data.flags&&1&e.seed&&(t=-t);const r=i.Float3.copy(this.quadToViewZVector),n=i.Float33.fromQuat(i.Float4.createQuat(r,t));i.Float33.transformDir(s,n,s),i.Float3.set(l,o,l[1],l[2]),i.Float33.transformDir(l,n,l)}}if(!u)if(0!=this.m2data.spin||0!=this.m2data.spinVary){let r=a+o*e.age;512&this.m2data.flags&&1&e.seed&&(r=-r);let n=Math.cos(r),u=Math.sin(r);i.Float3.set(s,n,u,0),i.Float3.scale(s,t.ageValues.scale[0],s),i.Float3.set(l,-u,n,0),i.Float3.scale(l,t.ageValues.scale[1],l),134217728&this.m2data.flags&&i.Float3.add(t.center,i.Float3.create(l[0],l[1],0),t.center)}else i.Float3.set(s,t.ageValues.scale[0],0,0),i.Float3.set(l,0,t.ageValues.scale[1],0);return this.buildQuad(s,l,t.center,t.ageValues.color,t.ageValues.alpha,t.ageValues.alphaCutoff,r[0],r[1],e.texturePosition),0}buildVertex2(e,t){const r=i.Float2.create((t.ageValues.tailCell&this.textureColMask)*this.texScaleX,(t.ageValues.tailCell>>this.textureColBits)*this.texScaleY),a=i.Float3.create(0,0,0),o=i.Float3.create(0,0,0);let n=this.m2data.tailLength;1024&this.m2data.flags&&(n=Math.min(e.age,n));const s=i.Float3.scale(e.velocity,-1);i.Float44.transformDirection3_0(s,this.particleToView,s),i.Float3.scale(s,n,s);const l=i.Float3.create(s[0],s[1],0);if(i.Float3.dot(l,l)>1e-4){let e=1/i.Float3.length(l);i.Float2.scale(t.ageValues.scale,e,t.ageValues.scale),i.Float2.multiply(l,t.ageValues.scale,l),i.Float3.set(o,-l[1],l[0],0),i.Float3.scale(s,.5,a),i.Float3.add(t.center,a,t.center)}else i.Float3.set(a,.05*t.ageValues.scale[0],0,0),i.Float3.set(o,0,.05*t.ageValues.scale[1],0);return this.buildQuad(a,o,t.center,t.ageValues.color,t.ageValues.alpha,t.ageValues.alphaCutoff,r[0],r[1],e.texturePosition),1}calculateSpin(e){this.rng.setSeed(e.seed);let t=this.m2data.baseSpin,r=this.m2data.spin,a=this.m2data.spinVary,i=this.m2data.baseSpinVary;return 0==t&&0==a||(0!=i&&(t+=this.rng.getSignedFloat()*i),0!=a&&(r+=this.rng.getSignedFloat()*a)),{deltaSpin:r,baseSpin:t}}buildQuad(e,t,r,a,o,n,s,l,u){const d=[-1,-1,1,1],c=[1,-1,1,-1],h=[0,0,1,1],f=[0,1,0,1];let p=i.Float3.zero(),m=i.Float2.zero(),g=i.Float2.zero(),y=i.Float2.zero();for(let x=0;x<4;x++)i.Float3.scale(e,d[x],p),i.Float3.add(i.Float3.scale(t,c[x]),p,p),i.Float3.add(p,r,p),i.Float44.transformPoint(p,this.renderer.invViewMatrix,p),i.Float2.set(m,h[x]*this.texScaleX+s,f[x]*this.texScaleY+l),i.Float2.set(g,h[x]*this.m2data.multiTextureParamX[0]+u[0][0],f[x]*this.m2data.multiTextureParamX[0]+u[0][1]),i.Float2.set(y,h[x]*this.m2data.multiTextureParamX[1]+u[1][0],f[x]*this.m2data.multiTextureParamX[1]+u[1][1]),this.vertexData.push(p[0]),this.vertexData.push(p[1]),this.vertexData.push(p[2]),this.vertexData.push(a[0]),this.vertexData.push(a[1]),this.vertexData.push(a[2]),this.vertexData.push(o),this.vertexData.push(m[0]),this.vertexData.push(m[1]),this.vertexData.push(g[0]),this.vertexData.push(g[1]),this.vertexData.push(y[0]),this.vertexData.push(y[1]),this.vertexData.push(n)}updateAnimatedProps(){const e=this.parent.animationState;let t=this.particleGenerator.getAnimatedProps(),r=!0;e.hasAnimatedValuesForTrack(this.m2data.enabledIn)&&(r=e.getNumberTrackValue(this.m2data.enabledIn)>0),this.activeNow=r;const a=i.Float3.zero();r&&(t.emissionSpeed=e.getNumberTrackValue(this.m2data.emissionSpeed,0),t.speedVariation=e.getNumberTrackValue(this.m2data.speedVariation,0),t.verticalRange=e.getNumberTrackValue(this.m2data.verticalRange,0),t.horizontalRange=e.getNumberTrackValue(this.m2data.horizontalRange,0),e.getFloat3TrackValue(this.m2data.gravity,a,t.gravity),t.lifespan=e.getNumberTrackValue(this.m2data.lifespan,0),t.emissionRate=e.getNumberTrackValue(this.m2data.emissionRate,0),t.emissionAreaY=e.getNumberTrackValue(this.m2data.emissionAreaWidth,0),t.emissionAreaX=e.getNumberTrackValue(this.m2data.emissionAreaLength,0),this.exp2Data?t.zSource=this.exp2Data.zSource:t.zSource=e.getNumberTrackValue(this.m2data.zSource,0))}getPixelShader(){return h[this.shaderId]}setupGraphics(){this.shaderProgram=this.renderer.getShaderProgram(this,"M2ParticleEmitter",l.default,s.default),this.vertexBuffer=this.renderer.graphics.createVertexDataBuffer([{index:this.shaderProgram.getAttribLocation("a_position"),size:3,type:n.BufferDataType.Float,normalized:!1,stride:56,offset:0},{index:this.shaderProgram.getAttribLocation("a_color"),size:4,type:n.BufferDataType.Float,normalized:!1,stride:56,offset:12},{index:this.shaderProgram.getAttribLocation("a_texCoord1"),size:2,type:n.BufferDataType.Float,normalized:!1,stride:56,offset:28},{index:this.shaderProgram.getAttribLocation("a_texCoord2"),size:2,type:n.BufferDataType.Float,normalized:!1,stride:56,offset:36},{index:this.shaderProgram.getAttribLocation("a_texCoord3"),size:2,type:n.BufferDataType.Float,normalized:!1,stride:56,offset:44},{index:this.shaderProgram.getAttribLocation("a_alphaCutoff"),size:1,type:n.BufferDataType.Float,normalized:!1,stride:56,offset:52}],!0),this.indexBuffer=this.renderer.graphics.createVertexIndexBuffer(!0);let e=new Uint16Array(6e3);for(let t=0;t<1e3;t++)e[6*t+0]=4*t+0,e[6*t+1]=4*t+1,e[6*t+2]=4*t+2,e[6*t+3]=4*t+3,e[6*t+4]=4*t+2,e[6*t+5]=4*t+1;this.indexBuffer.setData(e),this.databuffers=this.renderer.graphics.createDataBuffers(this.vertexBuffer,this.indexBuffer);const t=this.m2data.texture,r=[null,null,null];if(268435456&this.m2data.flags){const e=[0,0,0];e[0]=31&t,e[1]=t>>5&31,e[2]=t>>10&31;for(let t=0;t<e.length;t++){const a=e[t];r[t]=this.parent.textureObjects[a]}}else t>-1&&(r[0]=this.parent.textureObjects[t]);this.material=this.renderer.getBaseMaterial(),this.material.useShaderProgram(this.shaderProgram);let a,i=this.m2data.blendingType;a=0===i?-1:1===i?.501960814:.0039215689,this.material.useBackFaceCulling(!1),this.material.useCounterClockWiseFrontFaces(!this.parent.isMirrored),this.material.useBlendMode(i<f.length?f[i]:n.GxBlend.GxBlend_Opaque),this.material.useDepthTest(!0),this.material.useDepthWrite(!1),this.material.useColorMask(n.ColorMask.Alpha|n.ColorMask.Blue|n.ColorMask.Green|n.ColorMask.Red),this.material.useUniforms({u_pixelShader:this.getPixelShader(),u_texture1:r[0],u_texture2:r[1],u_texture3:r[2],u_alphaTreshold:a,u_alphaMult:this.exp2Data?this.exp2Data.alphaMult:1,u_colorMult:this.exp2Data?this.exp2Data.colorMult:1})}}t.M2ParticleEmitter=y},979:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(5053),t),i(r(3907),t)},1017:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(2388),t),i(r(7690),t),i(r(269),t),i(r(5716),t)},1132:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CharacterInventory=void 0;const a=r(708),i=r(8204),o=r(7693),n={[o.EquipmentSlot.Head]:[o.GeoSet.Helmet,o.GeoSet.Head],[o.EquipmentSlot.Neck]:[],[o.EquipmentSlot.Shoulders]:[o.GeoSet.Shoulders],[o.EquipmentSlot.Body]:[o.GeoSet.Sleeves,o.GeoSet.ShirtDoublet,o.GeoSet.LowerBody,o.GeoSet.Torso,o.GeoSet.ArmUpper],[o.EquipmentSlot.Shirt]:[o.GeoSet.Sleeves,o.GeoSet.ShirtDoublet],[o.EquipmentSlot.Waist]:[o.GeoSet.Belt],[o.EquipmentSlot.Legs]:[o.GeoSet.PantDoublet,o.GeoSet.Legcuffs,o.GeoSet.LowerBody],[o.EquipmentSlot.Feet]:[o.GeoSet.Boots,o.GeoSet.Feet],[o.EquipmentSlot.Wrists]:[o.GeoSet.HandAttachments],[o.EquipmentSlot.Hands]:[o.GeoSet.Wrists,o.GeoSet.HandAttachments],[o.EquipmentSlot.Finger1]:[],[o.EquipmentSlot.Finger2]:[],[o.EquipmentSlot.Trinket1]:[],[o.EquipmentSlot.Trinket2]:[],[o.EquipmentSlot.Back]:[o.GeoSet.Cloak],[o.EquipmentSlot.MainHand]:[],[o.EquipmentSlot.OffHand]:[],[o.EquipmentSlot.Ranged]:[],[o.EquipmentSlot.Tabard]:[o.GeoSet.Tabard],[o.EquipmentSlot.End]:[]},s={[o.EquipmentSlot.Head]:11,[o.EquipmentSlot.Neck]:0,[o.EquipmentSlot.Shoulders]:10,[o.EquipmentSlot.Body]:5,[o.EquipmentSlot.Shirt]:1,[o.EquipmentSlot.Waist]:8,[o.EquipmentSlot.Legs]:2,[o.EquipmentSlot.Feet]:3,[o.EquipmentSlot.Wrists]:4,[o.EquipmentSlot.Hands]:6,[o.EquipmentSlot.Finger1]:0,[o.EquipmentSlot.Finger2]:0,[o.EquipmentSlot.Trinket1]:0,[o.EquipmentSlot.Trinket2]:0,[o.EquipmentSlot.Back]:9,[o.EquipmentSlot.MainHand]:0,[o.EquipmentSlot.OffHand]:0,[o.EquipmentSlot.Ranged]:0,[o.EquipmentSlot.Tabard]:7,[o.EquipmentSlot.End]:0};class l extends i.Disposable{get isLoaded(){for(const e in this.inventoryData){const t=this.inventoryData[e];if(t&&t.model1&&!t.model1.isLoaded||t.model2&&!t.model2.isLoaded)return!1}return!0}constructor(e,t){super(),this.parent=e,this.inventoryData={},this.objectFactory=t}hasItemInSlot(e){return!!this.inventoryData[e]}equipItem(e,t,r){if(this.isDisposing)return;this.unloadItem(e);const i=this.objectFactory.createItemModel(t);let n;return i.equipTo(this.parent),i.once("componentsLoaded",(t=>{this.parent.once("modelDataLoaded",(()=>{if(t.isDisposing)return;const r=this.getAttachmentIdsForSlot(e,t.itemMetadata.inventoryType),a=e===o.EquipmentSlot.Back?t.component2:t.component1;if(r.length>0&&a){const e=this.parent.getAttachment(r[0]);this.parent.addAttachedModel(a,e)}if(r.length>1&&t.component2){const e=this.parent.getAttachment(r[1]);this.parent.addAttachedModel(t.component2,e)}})),this.updateAttachmentGeosets(e,t)})),i.once("loaded",(e=>{this.parent.reloadSkinTextures(),this.parent.updateGeosets()})),i.once("metadataLoaded",(t=>{const r=t.itemMetadata.inventoryType;e===o.EquipmentSlot.MainHand&&this.parent.setHandAnimation(!0,!0),e===o.EquipmentSlot.OffHand&&this.parent.setHandAnimation(!1,!0),e===o.EquipmentSlot.Ranged&&r!==a.InventoryType.Quiver&&this.parent.setHandAnimation(!1,!0)})),r&&(n=this.objectFactory.createItemModel(r),n.equipTo(this.parent),n.once("componentsLoaded",(t=>{this.parent.once("modelDataLoaded",(()=>{if(t.isDisposing)return;const r=this.getAttachmentIdsForSlot(e,t.itemMetadata.inventoryType),a=e===o.EquipmentSlot.Back?t.component2:t.component1;if(r.length>0&&a){const e=this.parent.getAttachment(r[0]);this.parent.addAttachedModel(a,e)}if(r.length>1&&t.component2){const e=this.parent.getAttachment(r[1]);this.parent.addAttachedModel(t.component2,e)}})),this.updateAttachmentGeosets(e,t)}))),this.inventoryData[e]={displayId1:t,displayId2:r,model1:i,model2:n},i.once("disposed",(()=>{this.unequipItem(e)})),n&&n.once("disposed",(()=>{this.unequipItem(e)})),r?[i,n]:i}unequipItem(e){if(this.isDisposing)return;if(!this.inventoryData[e])return;const t=this.inventoryData[e].model1.inventoryType;this.unloadItem(e),this.parent.updateGeosets(),this.parent.reloadSkinTextures(),e===o.EquipmentSlot.MainHand&&this.parent.setHandAnimation(!0,!1),e===o.EquipmentSlot.OffHand&&this.parent.setHandAnimation(!1,!1),e===o.EquipmentSlot.Ranged&&t!==a.InventoryType.Quiver&&this.parent.setHandAnimation(!1,!1)}update(e){if(!this.isDisposing)for(const t in this.inventoryData){const r=this.inventoryData[t];r&&(r.model1.update(e),r.model2&&r.model2.update(e))}}draw(){if(!this.isDisposing)for(const e in this.inventoryData){const t=this.inventoryData[e];t&&(t.model1.draw(),t.model2&&t.model2.draw())}}dispose(){if(!this.isDisposing){super.dispose();for(const e in this.inventoryData)this.unloadItem(e);this.inventoryData=null,this.parent=null}}getGeosetToggles(){if(!this.isLoaded||this.isDisposing)return{};const e={},t=this.inventoryData[o.EquipmentSlot.Head];if(t){const r=t.model1.itemMetadata,a=0===this.parent.gender?r.hideGeoset1:r.hideGeoset2;if(a)for(const t of a)t.raceId===this.parent.race&&(e[t.geosetGroup]=-1)}const r=Object.values(o.EquipmentSlot).sort(((e,t)=>s[e]-s[t]));for(const t of r){const r=this.inventoryData[t];if(!r)continue;const a=n[t],i=r.model1.itemMetadata.geosetGroup;for(let t=0;t<a.length;t++)i[t]&&(e[a[t]]=i[t]+1)}const i=this.inventoryData[o.EquipmentSlot.Hands];i&&i.model1.itemMetadata.geosetGroup[0]&&(e[o.GeoSet.Sleeves]=1);const l=this.inventoryData[o.EquipmentSlot.Tabard];if(l&&(l.model1.itemMetadata.flags&a.ItemFeatureFlag.UnknownEffect1&&(e[o.GeoSet.Torso]=2),!e[o.GeoSet.Tabard])){const t=this.inventoryData[o.EquipmentSlot.Waist];t&&t.model1.itemMetadata.flags&a.ItemFeatureFlag.DisableTabardGeo?e[o.GeoSet.Tabard]=3:e[o.GeoSet.Tabard]=2}const u=this.inventoryData[o.EquipmentSlot.Feet];return u&&!e[o.GeoSet.Feet]&&u.model1.itemMetadata.flags&a.ItemFeatureFlag.UnknownEffect1?e[o.GeoSet.Feet]=2:e[o.GeoSet.Feet]=1,e[o.GeoSet.LowerBody]&&(e[o.GeoSet.Legcuffs]=1,e[o.GeoSet.PantDoublet]=1,e[o.GeoSet.Boots]=1,e[o.GeoSet.Tabard]=1),e}getItemTextures(){if(!this.isLoaded||this.isDisposing)return{};const e={},t=Object.values(o.EquipmentSlot).sort(((e,t)=>s[e]-s[t]));for(const r of t){const t=this.inventoryData[r];if(!t)continue;const a=t.model1;for(const t in a.sectionTextures){const r=parseInt(t,10);e[r]||(e[r]=[]),e[r].push(a.sectionTextures[t])}}return e}shouldDrawUnderwear(){var e,t,r;let a=!0;const i=[o.EquipmentSlot.Body,o.EquipmentSlot.Shirt];for(const r of i)a=a&&!(this.inventoryData[r]&&(null===(t=null===(e=this.inventoryData[r].model1)||void 0===e?void 0:e.sectionTextures)||void 0===t?void 0:t[o.TextureSection.UpperTorso]));const n=[o.EquipmentSlot.Body,o.EquipmentSlot.Legs];let s=!0;for(const e of n)s=s&&!(this.inventoryData[e]&&(null===(r=this.inventoryData[e].model1.sectionTextures)||void 0===r?void 0:r[o.TextureSection.UpperLeg]));return[s,a]}updateAttachmentGeosets(e,t){if(this.isDisposing)return;const r=t.itemMetadata,a=n[e];t.component1&&this.updateAttachmentGeoSetsForComponent(t.component1,a,r.geosetGroup,r.attachmentGeosetGroup),t.component2&&this.updateAttachmentGeoSetsForComponent(t.component2,a,r.geosetGroup,r.attachmentGeosetGroup)}updateAttachmentGeoSetsForComponent(e,t,r,a){if(!this.isDisposing){e.toggleGeosets(1,5300,!1);for(let i=0;i<t.length;i++){const o=100*t[i];r[i]>0&&e.toggleGeoset(o+r[i],!0),a[i]>0&&e.toggleGeoset(o+a[i]+1,!0)}}}unloadItem(e){if(this.isDisposing)return;const t=this.inventoryData[e];t&&(t.model1.dispose(),t.model2&&t.model2.dispose(),delete this.inventoryData[e])}getAttachmentIdsForSlot(e,t){if(!this.isDisposing)switch(e){case o.EquipmentSlot.Head:return[11];case o.EquipmentSlot.Shoulders:return[6,5];case o.EquipmentSlot.Waist:return[53];case o.EquipmentSlot.Back:return[57];case o.EquipmentSlot.MainHand:return[1];case o.EquipmentSlot.OffHand:return t===a.InventoryType.Shield?[0]:[2];case o.EquipmentSlot.Ranged:return t===a.InventoryType.Quiver?[55]:[2];default:return[]}}}t.CharacterInventory=l},1173:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Positioner=void 0;const a=r(1639);t.Positioner=class{constructor(e){this.data=e,this.currentState=e.states.find((t=>t.id===e.firstStateId)),this.life=e.startLife,this.transformMatrix=a.Float44.identity()}update(e){a.Float44.identity(this.transformMatrix),a.Float44.translate(this.transformMatrix,this.getPosition(),this.transformMatrix)}getPosition(){const e=a.Float3.zero(),t=this.currentState.positionEntry;if(!t)return e;switch(t.srcValType){case 1:e[0]=t.srcVal;case 2:e[1]=t.srcVal;case 3:e[0]=-t.srcVal/3}return e}}},1178:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});const a="precision mediump float;\r\nprecision mediump int;\r\n\r\nattribute vec3 a_position;\r\nattribute vec2 a_texCoord;\r\nattribute float a_depth;\r\n\r\nuniform mat4 u_modelMatrix;\r\nuniform mat4 u_viewMatrix;\r\nuniform mat4 u_projectionMatrix;\r\n\r\n//out vec2 vTexCoord;\r\nvarying vec3 v_position;\r\nvarying vec2 v_texCoord;\r\nvarying float v_depth;\r\nvarying vec3 v_normal;\r\n\r\nmat4 invert(mat4 inputMatrix) {\r\n    float\r\n        m00 = inputMatrix[0][0], m01 = inputMatrix[0][1], m02 = inputMatrix[0][2], m03 = inputMatrix[0][3],\r\n        m10 = inputMatrix[1][0], m11 = inputMatrix[1][1], m12 = inputMatrix[1][2], m13 = inputMatrix[1][3],\r\n        m20 = inputMatrix[2][0], m21 = inputMatrix[2][1], m22 = inputMatrix[2][2], m23 = inputMatrix[2][3],\r\n        m30 = inputMatrix[3][0], m31 = inputMatrix[3][1], m32 = inputMatrix[3][2], m33 = inputMatrix[3][3];\r\n\r\n    float \r\n        t0 = m00 * m11 - m01 * m10,\r\n        t1 = m00 * m12 - m02 * m10,\r\n        t2 = m00 * m13 - m03 * m10,\r\n        t3 = m01 * m12 - m02 * m11,\r\n        t4 = m01 * m13 - m03 * m11,\r\n        t5 = m02 * m13 - m03 * m12,\r\n        t6 = m20 * m31 - m21 * m30,\r\n        t7 = m20 * m32 - m22 * m30,\r\n        t8 = m20 * m33 - m23 * m30,\r\n        t9 = m21 * m32 - m22 * m31,\r\n        t10 = m21 * m33 - m23 * m31,\r\n        t11 = m22 * m33 - m23 * m32,\r\n        determinant = t0 * t11 - t1 * t10 + t2 * t9 + t3 * t8 - t4 * t7 + t5 * t6;\r\n\r\n    return mat4(\r\n        m11 * t11 - m12 * t10 + m13 * t9,\r\n        m02 * t10 - m01 * t11 - m03 * t9,\r\n        m31 * t5 - m32 * t4 + m33 * t3,\r\n        m22 * t4 - m21 * t5 - m23 * t3,\r\n        m12 * t8 - m10 * t11 - m13 * t7,\r\n        m00 * t11 - m02 * t8 + m03 * t7,\r\n        m32 * t2 - m30 * t5 - m33 * t1,\r\n        m20 * t5 - m22 * t2 + m23 * t1,\r\n        m10 * t10 - m11 * t8 + m13 * t6,\r\n        m01 * t8 - m00 * t10 - m03 * t6,\r\n        m30 * t4 - m31 * t2 + m33 * t0,\r\n        m21 * t2 - m20 * t4 - m23 * t0,\r\n        m11 * t7 - m10 * t9 - m12 * t6,\r\n        m00 * t9 - m01 * t7 + m02 * t6,\r\n        m31 * t1 - m30 * t3 - m32 * t0,\r\n        m20 * t3 - m21 * t1 + m22 * t0\r\n    ) / determinant;\r\n}\r\n\r\nhighp mat4 transpose(in highp mat4 inputMatrix) {\r\n    return mat4(\r\n        vec4(inputMatrix[0][0], inputMatrix[1][0], inputMatrix[2][0], inputMatrix[3][0]),\r\n        vec4(inputMatrix[0][1], inputMatrix[1][1], inputMatrix[2][1], inputMatrix[3][1]),\r\n        vec4(inputMatrix[0][2], inputMatrix[1][2], inputMatrix[2][2], inputMatrix[3][2]),\r\n        vec4(inputMatrix[0][3], inputMatrix[1][3], inputMatrix[2][3], inputMatrix[3][3])\r\n    );\r\n}\r\n\r\nvoid main() {\r\n    vec4 aPositionVec4 = vec4(a_position.xyz, 1);\r\n    mat4 viewModelMat = u_viewMatrix * u_modelMatrix;\r\n\r\n    vec4 cameraPoint = viewModelMat * aPositionVec4;\r\n\r\n    mat4 viewModelMatForNormal = transpose(invert(viewModelMat));\r\n\r\n    gl_Position = u_projectionMatrix * cameraPoint;\r\n    v_position = cameraPoint.xyz;\r\n    v_normal = normalize(viewModelMatForNormal * vec4(0,0,1.0, 0.0)).xyz;\r\n    v_depth = a_depth;\r\n    v_texCoord = a_texCoord;\r\n}\r\n"},1312:function(e,t,r){"use strict";var a=this&&this.__awaiter||function(e,t,r,a){return new(r||(r=Promise))((function(i,o){function n(e){try{l(a.next(e))}catch(e){o(e)}}function s(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}l((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.NodeRenderer=void 0;const i=r(5981);class o extends i.BaseRenderer{constructor(e){super(e),this.getImageDataFn=e.getImageDataFn}now(){return Date.now()}processTexture(e,t,r){return a(this,void 0,void 0,(function*(){const a=yield this.getImageDataFn(t),i=this.graphics.createTextureFromRawImgData(a,r);return i.fileId=e,i}))}}t.NodeRenderer=o},1353:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RenderObject=void 0;const a=r(8204);class i extends a.Disposable{get isAttachedToRenderer(){return null!=this.renderer}attachToRenderer(e){this.renderer=e}detachFromRenderer(){this.renderer=null}canExecuteCallbackNow(e){return"loaded"===e?this.isLoaded:super.canExecuteCallbackNow(e)}}t.RenderObject=i},1447:(e,t,r)=>{"use strict";const a=r(3269),i=r(4823),o=r(7293),n=r(1998),{Z_FINISH:s,Z_BLOCK:l,Z_TREES:u,Z_OK:d,Z_STREAM_END:c,Z_NEED_DICT:h,Z_STREAM_ERROR:f,Z_DATA_ERROR:p,Z_MEM_ERROR:m,Z_BUF_ERROR:g,Z_DEFLATED:y}=r(9681),x=16180,v=16190,b=16191,_=16192,F=16194,C=16199,w=16200,M=16206,S=16209,D=16210,A=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function T(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const E=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<x||t.mode>16211?1:0},B=e=>{if(E(e))return f;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=x,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,d},k=e=>{if(E(e))return f;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,B(e)},L=(e,t)=>{let r;if(E(e))return f;const a=e.state;return t<0?(r=0,t=-t):(r=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?f:(null!==a.window&&a.wbits!==t&&(a.window=null),a.wrap=r,a.wbits=t,k(e))},P=(e,t)=>{if(!e)return f;const r=new T;e.state=r,r.strm=e,r.window=null,r.mode=x;const a=L(e,t);return a!==d&&(e.state=null),a};let I,O,R=!0;const U=e=>{if(R){I=new Int32Array(512),O=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(n(1,e.lens,0,288,I,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;n(2,e.lens,0,32,O,0,e.work,{bits:5}),R=!1}e.lencode=I,e.lenbits=9,e.distcode=O,e.distbits=5},W=(e,t,r,a)=>{let i;const o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),a>=o.wsize?(o.window.set(t.subarray(r-o.wsize,r),0),o.wnext=0,o.whave=o.wsize):(i=o.wsize-o.wnext,i>a&&(i=a),o.window.set(t.subarray(r-a,r-a+i),o.wnext),(a-=i)?(o.window.set(t.subarray(r-a,r),0),o.wnext=a,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0};e.exports.inflateReset=k,e.exports.inflateReset2=L,e.exports.inflateResetKeep=B,e.exports.inflateInit=e=>P(e,15),e.exports.inflateInit2=P,e.exports.inflate=(e,t)=>{let r,T,B,k,L,P,I,O,R,V,z,j,G,H,N,q,K,Z,X,Y,$,Q,J=0;const ee=new Uint8Array(4);let te,re;const ae=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(E(e)||!e.output||!e.input&&0!==e.avail_in)return f;r=e.state,r.mode===b&&(r.mode=_),L=e.next_out,B=e.output,I=e.avail_out,k=e.next_in,T=e.input,P=e.avail_in,O=r.hold,R=r.bits,V=P,z=I,Q=d;e:for(;;)switch(r.mode){case x:if(0===r.wrap){r.mode=_;break}for(;R<16;){if(0===P)break e;P--,O+=T[k++]<<R,R+=8}if(2&r.wrap&&35615===O){0===r.wbits&&(r.wbits=15),r.check=0,ee[0]=255&O,ee[1]=O>>>8&255,r.check=i(r.check,ee,2,0),O=0,R=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&O)<<8)+(O>>8))%31){e.msg="incorrect header check",r.mode=S;break}if((15&O)!==y){e.msg="unknown compression method",r.mode=S;break}if(O>>>=4,R-=4,$=8+(15&O),0===r.wbits&&(r.wbits=$),$>15||$>r.wbits){e.msg="invalid window size",r.mode=S;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=512&O?16189:b,O=0,R=0;break;case 16181:for(;R<16;){if(0===P)break e;P--,O+=T[k++]<<R,R+=8}if(r.flags=O,(255&r.flags)!==y){e.msg="unknown compression method",r.mode=S;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=S;break}r.head&&(r.head.text=O>>8&1),512&r.flags&&4&r.wrap&&(ee[0]=255&O,ee[1]=O>>>8&255,r.check=i(r.check,ee,2,0)),O=0,R=0,r.mode=16182;case 16182:for(;R<32;){if(0===P)break e;P--,O+=T[k++]<<R,R+=8}r.head&&(r.head.time=O),512&r.flags&&4&r.wrap&&(ee[0]=255&O,ee[1]=O>>>8&255,ee[2]=O>>>16&255,ee[3]=O>>>24&255,r.check=i(r.check,ee,4,0)),O=0,R=0,r.mode=16183;case 16183:for(;R<16;){if(0===P)break e;P--,O+=T[k++]<<R,R+=8}r.head&&(r.head.xflags=255&O,r.head.os=O>>8),512&r.flags&&4&r.wrap&&(ee[0]=255&O,ee[1]=O>>>8&255,r.check=i(r.check,ee,2,0)),O=0,R=0,r.mode=16184;case 16184:if(1024&r.flags){for(;R<16;){if(0===P)break e;P--,O+=T[k++]<<R,R+=8}r.length=O,r.head&&(r.head.extra_len=O),512&r.flags&&4&r.wrap&&(ee[0]=255&O,ee[1]=O>>>8&255,r.check=i(r.check,ee,2,0)),O=0,R=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&r.flags&&(j=r.length,j>P&&(j=P),j&&(r.head&&($=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(T.subarray(k,k+j),$)),512&r.flags&&4&r.wrap&&(r.check=i(r.check,T,j,k)),P-=j,k+=j,r.length-=j),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&r.flags){if(0===P)break e;j=0;do{$=T[k+j++],r.head&&$&&r.length<65536&&(r.head.name+=String.fromCharCode($))}while($&&j<P);if(512&r.flags&&4&r.wrap&&(r.check=i(r.check,T,j,k)),P-=j,k+=j,$)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&r.flags){if(0===P)break e;j=0;do{$=T[k+j++],r.head&&$&&r.length<65536&&(r.head.comment+=String.fromCharCode($))}while($&&j<P);if(512&r.flags&&4&r.wrap&&(r.check=i(r.check,T,j,k)),P-=j,k+=j,$)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&r.flags){for(;R<16;){if(0===P)break e;P--,O+=T[k++]<<R,R+=8}if(4&r.wrap&&O!==(65535&r.check)){e.msg="header crc mismatch",r.mode=S;break}O=0,R=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=b;break;case 16189:for(;R<32;){if(0===P)break e;P--,O+=T[k++]<<R,R+=8}e.adler=r.check=A(O),O=0,R=0,r.mode=v;case v:if(0===r.havedict)return e.next_out=L,e.avail_out=I,e.next_in=k,e.avail_in=P,r.hold=O,r.bits=R,h;e.adler=r.check=1,r.mode=b;case b:if(t===l||t===u)break e;case _:if(r.last){O>>>=7&R,R-=7&R,r.mode=M;break}for(;R<3;){if(0===P)break e;P--,O+=T[k++]<<R,R+=8}switch(r.last=1&O,O>>>=1,R-=1,3&O){case 0:r.mode=16193;break;case 1:if(U(r),r.mode=C,t===u){O>>>=2,R-=2;break e}break;case 2:r.mode=16196;break;case 3:e.msg="invalid block type",r.mode=S}O>>>=2,R-=2;break;case 16193:for(O>>>=7&R,R-=7&R;R<32;){if(0===P)break e;P--,O+=T[k++]<<R,R+=8}if((65535&O)!=(O>>>16^65535)){e.msg="invalid stored block lengths",r.mode=S;break}if(r.length=65535&O,O=0,R=0,r.mode=F,t===u)break e;case F:r.mode=16195;case 16195:if(j=r.length,j){if(j>P&&(j=P),j>I&&(j=I),0===j)break e;B.set(T.subarray(k,k+j),L),P-=j,k+=j,I-=j,L+=j,r.length-=j;break}r.mode=b;break;case 16196:for(;R<14;){if(0===P)break e;P--,O+=T[k++]<<R,R+=8}if(r.nlen=257+(31&O),O>>>=5,R-=5,r.ndist=1+(31&O),O>>>=5,R-=5,r.ncode=4+(15&O),O>>>=4,R-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=S;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;R<3;){if(0===P)break e;P--,O+=T[k++]<<R,R+=8}r.lens[ae[r.have++]]=7&O,O>>>=3,R-=3}for(;r.have<19;)r.lens[ae[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,te={bits:r.lenbits},Q=n(0,r.lens,0,19,r.lencode,0,r.work,te),r.lenbits=te.bits,Q){e.msg="invalid code lengths set",r.mode=S;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;J=r.lencode[O&(1<<r.lenbits)-1],N=J>>>24,q=J>>>16&255,K=65535&J,!(N<=R);){if(0===P)break e;P--,O+=T[k++]<<R,R+=8}if(K<16)O>>>=N,R-=N,r.lens[r.have++]=K;else{if(16===K){for(re=N+2;R<re;){if(0===P)break e;P--,O+=T[k++]<<R,R+=8}if(O>>>=N,R-=N,0===r.have){e.msg="invalid bit length repeat",r.mode=S;break}$=r.lens[r.have-1],j=3+(3&O),O>>>=2,R-=2}else if(17===K){for(re=N+3;R<re;){if(0===P)break e;P--,O+=T[k++]<<R,R+=8}O>>>=N,R-=N,$=0,j=3+(7&O),O>>>=3,R-=3}else{for(re=N+7;R<re;){if(0===P)break e;P--,O+=T[k++]<<R,R+=8}O>>>=N,R-=N,$=0,j=11+(127&O),O>>>=7,R-=7}if(r.have+j>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=S;break}for(;j--;)r.lens[r.have++]=$}}if(r.mode===S)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=S;break}if(r.lenbits=9,te={bits:r.lenbits},Q=n(1,r.lens,0,r.nlen,r.lencode,0,r.work,te),r.lenbits=te.bits,Q){e.msg="invalid literal/lengths set",r.mode=S;break}if(r.distbits=6,r.distcode=r.distdyn,te={bits:r.distbits},Q=n(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,te),r.distbits=te.bits,Q){e.msg="invalid distances set",r.mode=S;break}if(r.mode=C,t===u)break e;case C:r.mode=w;case w:if(P>=6&&I>=258){e.next_out=L,e.avail_out=I,e.next_in=k,e.avail_in=P,r.hold=O,r.bits=R,o(e,z),L=e.next_out,B=e.output,I=e.avail_out,k=e.next_in,T=e.input,P=e.avail_in,O=r.hold,R=r.bits,r.mode===b&&(r.back=-1);break}for(r.back=0;J=r.lencode[O&(1<<r.lenbits)-1],N=J>>>24,q=J>>>16&255,K=65535&J,!(N<=R);){if(0===P)break e;P--,O+=T[k++]<<R,R+=8}if(q&&!(240&q)){for(Z=N,X=q,Y=K;J=r.lencode[Y+((O&(1<<Z+X)-1)>>Z)],N=J>>>24,q=J>>>16&255,K=65535&J,!(Z+N<=R);){if(0===P)break e;P--,O+=T[k++]<<R,R+=8}O>>>=Z,R-=Z,r.back+=Z}if(O>>>=N,R-=N,r.back+=N,r.length=K,0===q){r.mode=16205;break}if(32&q){r.back=-1,r.mode=b;break}if(64&q){e.msg="invalid literal/length code",r.mode=S;break}r.extra=15&q,r.mode=16201;case 16201:if(r.extra){for(re=r.extra;R<re;){if(0===P)break e;P--,O+=T[k++]<<R,R+=8}r.length+=O&(1<<r.extra)-1,O>>>=r.extra,R-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;J=r.distcode[O&(1<<r.distbits)-1],N=J>>>24,q=J>>>16&255,K=65535&J,!(N<=R);){if(0===P)break e;P--,O+=T[k++]<<R,R+=8}if(!(240&q)){for(Z=N,X=q,Y=K;J=r.distcode[Y+((O&(1<<Z+X)-1)>>Z)],N=J>>>24,q=J>>>16&255,K=65535&J,!(Z+N<=R);){if(0===P)break e;P--,O+=T[k++]<<R,R+=8}O>>>=Z,R-=Z,r.back+=Z}if(O>>>=N,R-=N,r.back+=N,64&q){e.msg="invalid distance code",r.mode=S;break}r.offset=K,r.extra=15&q,r.mode=16203;case 16203:if(r.extra){for(re=r.extra;R<re;){if(0===P)break e;P--,O+=T[k++]<<R,R+=8}r.offset+=O&(1<<r.extra)-1,O>>>=r.extra,R-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=S;break}r.mode=16204;case 16204:if(0===I)break e;if(j=z-I,r.offset>j){if(j=r.offset-j,j>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=S;break}j>r.wnext?(j-=r.wnext,G=r.wsize-j):G=r.wnext-j,j>r.length&&(j=r.length),H=r.window}else H=B,G=L-r.offset,j=r.length;j>I&&(j=I),I-=j,r.length-=j;do{B[L++]=H[G++]}while(--j);0===r.length&&(r.mode=w);break;case 16205:if(0===I)break e;B[L++]=r.length,I--,r.mode=w;break;case M:if(r.wrap){for(;R<32;){if(0===P)break e;P--,O|=T[k++]<<R,R+=8}if(z-=I,e.total_out+=z,r.total+=z,4&r.wrap&&z&&(e.adler=r.check=r.flags?i(r.check,B,z,L-z):a(r.check,B,z,L-z)),z=I,4&r.wrap&&(r.flags?O:A(O))!==r.check){e.msg="incorrect data check",r.mode=S;break}O=0,R=0}r.mode=16207;case 16207:if(r.wrap&&r.flags){for(;R<32;){if(0===P)break e;P--,O+=T[k++]<<R,R+=8}if(4&r.wrap&&O!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=S;break}O=0,R=0}r.mode=16208;case 16208:Q=c;break e;case S:Q=p;break e;case D:return m;default:return f}return e.next_out=L,e.avail_out=I,e.next_in=k,e.avail_in=P,r.hold=O,r.bits=R,(r.wsize||z!==e.avail_out&&r.mode<S&&(r.mode<M||t!==s))&&W(e,e.output,e.next_out,z-e.avail_out)?(r.mode=D,m):(V-=e.avail_in,z-=e.avail_out,e.total_in+=V,e.total_out+=z,r.total+=z,4&r.wrap&&z&&(e.adler=r.check=r.flags?i(r.check,B,z,e.next_out-z):a(r.check,B,z,e.next_out-z)),e.data_type=r.bits+(r.last?64:0)+(r.mode===b?128:0)+(r.mode===C||r.mode===F?256:0),(0===V&&0===z||t===s)&&Q===d&&(Q=g),Q)},e.exports.inflateEnd=e=>{if(E(e))return f;let t=e.state;return t.window&&(t.window=null),e.state=null,d},e.exports.inflateGetHeader=(e,t)=>{if(E(e))return f;const r=e.state;return 2&r.wrap?(r.head=t,t.done=!1,d):f},e.exports.inflateSetDictionary=(e,t)=>{const r=t.length;let i,o,n;return E(e)?f:(i=e.state,0!==i.wrap&&i.mode!==v?f:i.mode===v&&(o=1,o=a(o,t,r,0),o!==i.check)?p:(n=W(e,t,r,r),n?(i.mode=D,m):(i.havedict=1,d)))},e.exports.inflateInfo="pako inflate (from Nodeca project)"},1639:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(9277),t),i(r(8875),t),i(r(3055),t),i(r(6239),t)},1668:(e,t,r)=>{"use strict";const{Deflate:a,deflate:i,deflateRaw:o,gzip:n}=r(3303),{Inflate:s,inflate:l,inflateRaw:u,ungzip:d}=r(7083),c=r(9681);e.exports.Deflate=a,e.exports.deflate=i,e.exports.deflateRaw=o,e.exports.gzip=n,e.exports.Inflate=s,e.exports.inflate=l,e.exports.inflateRaw=u,e.exports.ungzip=d,e.exports.constants=c},1670:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserWoWModelViewer=void 0;const a=r(8219),i=r(6303),o=r(105);class n extends o.BaseWoWModelViewer{constructor(e){var t,r,a;if(!document&&!(null===(t=null==e?void 0:e.canvas)||void 0===t?void 0:t.createCanvas))throw"canvas.createCanvas is a required argument for WoWModelViewer when running outside of a browser context";if(!(null===(r=null==e?void 0:e.canvas)||void 0===r?void 0:r.container)&&!(null===(a=null==e?void 0:e.canvas)||void 0===a?void 0:a.createCanvas))throw"canvas.container is a required argument for WoWModelViewer when not providing a canvas via canvas.createCanvas";super(e)}initializeRenderer(){var e,t,r,o,n,s,l,u,d;this.options.canvas.createCanvas?this.canvas=this.options.canvas.createCanvas():this.canvas=document.createElement("canvas");const c=this.options.canvas.container?this.options.canvas.container:this.canvas.parentElement;c&&(this.width=c.getBoundingClientRect().width,this.height=c.getBoundingClientRect().height,this.viewerContainer=document.createElement("div"),this.viewerContainer.className="wmvts-container",this.viewerContainer.style.lineHeight="0",this.viewerContainer.style.position="relative",c.append(this.viewerContainer),this.viewerContainer.append(this.canvas),this.options.canvas.resizeToContainer)&&new ResizeObserver((()=>{this.width=this.viewerContainer.getBoundingClientRect().width,this.height=this.viewerContainer.getBoundingClientRect().height,this.resize(this.width,this.height)})).observe(this.viewerContainer),this.options.canvas.width&&(this.width=this.options.canvas.width),this.options.canvas.height&&(this.height=this.options.canvas.height);let h=this.canvas.getContext("webgl",{alpha:!0,premultipliedAlpha:!1});const f=new a.WebGlGraphics(h);if(this.renderer=new a.BrowserRenderer({graphics:f,dataLoader:this.iocContainer.getDataLoader(),dataManager:this.iocContainer.getDataManager(),objectIdentifier:this.iocContainer.getObjectIdentifier(),progress:this.options.progressReporter,container:this.viewerContainer,errorHandler:this.options.onError,cacheTtl:null===(e=this.options.misc)||void 0===e?void 0:e.cacheTtl,cameraFov:null===(t=this.options.scene)||void 0===t?void 0:t.cameraFov,clearColor:null===(r=this.options.scene)||void 0===r?void 0:r.backgroundColor,interiorSunDir:null===(o=this.options.scene)||void 0===o?void 0:o.interiorSunDirection,sunDir:null===(n=this.options.scene)||void 0===n?void 0:n.sunDirection,exteriorAmbientColor:null===(s=this.options.scene)||void 0===s?void 0:s.exteriorAmbientColor,exteriorDirectColor:null===(l=this.options.scene)||void 0===l?void 0:l.exteriorDirectColor}),this.resize(this.width,this.height),this.renderer.sceneCamera=null!==(d=null===(u=this.options.scene)||void 0===u?void 0:u.camera)&&void 0!==d?d:new i.Camera,this.options.scene&&this.options.scene.objects)for(const e of this.options.scene.objects)this.renderer.addSceneObject(e);this.renderer.start()}showDebug(){this.renderer.enableDebug()}hideDebug(){this.renderer.disableDebug()}enableDebugPortals(){this.renderer.enableDebugPortals()}disableDebugPortals(){this.renderer.disableDebugPortals()}useFirstPersonCamera(e=!0){const t=new i.FirstPersonCamera(this.viewerContainer,e);return this.renderer.switchCamera(t),t}useOrbitalCamera(e=!0){const t=new i.OrbitalCamera(this.viewerContainer,e);return this.renderer.switchCamera(t),t}resize(e,t){this.renderer&&this.renderer.width===e&&this.renderer.height===t||(this.canvas.width=e,this.canvas.height=t,this.renderer.resize(e,t))}}t.BrowserWoWModelViewer=n},1722:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleProgressReporter=void 0;const a=r(4849);class i extends a.BaseProgressReporter{constructor(e,t){super(e),this.options=t,this.setupElements()}onUpdateCount(){this.textContainer.textContent=this.currentOperation+` (${this.filesProcessed} / ${this.totalFiles})`}setupElements(){var e;this.container.style.position="relative";const t=document.createElement("style");t.textContent=".simpleProgress {\n  padding: 0 5px 8px 0;\n  background: repeating-linear-gradient(90deg,currentColor 0 8%,#0000 0 10%) 200% 100%/200% 3px no-repeat;\n  animation: l3 2s steps(6) infinite;\n}\n@keyframes l3 {to{background-position: 80% 100%}}",document.head.appendChild(t),this.progressContainer=document.createElement("div"),this.progressContainer.className="simpleProgress",this.progressContainer.style.display="none",this.progressContainer.style.position="absolute",this.progressContainer.style.bottom="1em",this.progressContainer.style.right="0",this.progressContainer.style.left="25%",this.progressContainer.style.width="50%",this.progressContainer.style.zIndex="1",this.progressContainer.style.color="#FFF",this.container.appendChild(this.progressContainer),this.textContainer=document.createElement("p"),this.textContainer.style.position="relative",this.textContainer.style.margin="0",this.textContainer.style.color="white",this.textContainer.style.textAlign="center",this.textContainer.style.marginBottom="1em",this.progressContainer.appendChild(this.textContainer),null===(e=this.options)||void 0===e||e.onSetupElements(this)}showElements(){this.progressContainer.style.display="block",this.onUpdateCount()}hideElements(){this.progressContainer.style.display="none",this.textContainer.textContent=""}}t.SimpleProgressReporter=i},1783:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},1851:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(7515),t),i(r(7707),t)},1854:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},1996:e=>{"use strict";let t=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){t=!1}const r=new Uint8Array(256);for(let e=0;e<256;e++)r[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;r[254]=r[254]=1,e.exports.string2buf=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,r,a,i,o,n=e.length,s=0;for(i=0;i<n;i++)r=e.charCodeAt(i),55296==(64512&r)&&i+1<n&&(a=e.charCodeAt(i+1),56320==(64512&a)&&(r=65536+(r-55296<<10)+(a-56320),i++)),s+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(s),o=0,i=0;o<s;i++)r=e.charCodeAt(i),55296==(64512&r)&&i+1<n&&(a=e.charCodeAt(i+1),56320==(64512&a)&&(r=65536+(r-55296<<10)+(a-56320),i++)),r<128?t[o++]=r:r<2048?(t[o++]=192|r>>>6,t[o++]=128|63&r):r<65536?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|63&r):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|63&r);return t},e.exports.buf2string=(e,a)=>{const i=a||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,a));let o,n;const s=new Array(2*i);for(n=0,o=0;o<i;){let t=e[o++];if(t<128){s[n++]=t;continue}let a=r[t];if(a>4)s[n++]=65533,o+=a-1;else{for(t&=2===a?31:3===a?15:7;a>1&&o<i;)t=t<<6|63&e[o++],a--;a>1?s[n++]=65533:t<65536?s[n++]=t:(t-=65536,s[n++]=55296|t>>10&1023,s[n++]=56320|1023&t)}}return((e,r)=>{if(r<65534&&e.subarray&&t)return String.fromCharCode.apply(null,e.length===r?e:e.subarray(0,r));let a="";for(let t=0;t<r;t++)a+=String.fromCharCode(e[t]);return a})(s,n)},e.exports.utf8border=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let a=t-1;for(;a>=0&&128==(192&e[a]);)a--;return a<0||0===a?t:a+r[e[a]]>t?a:t}},1998:e=>{"use strict";const t=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),r=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),a=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),i=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);e.exports=(e,o,n,s,l,u,d,c)=>{const h=c.bits;let f,p,m,g,y,x,v=0,b=0,_=0,F=0,C=0,w=0,M=0,S=0,D=0,A=0,T=null;const E=new Uint16Array(16),B=new Uint16Array(16);let k,L,P,I=null;for(v=0;v<=15;v++)E[v]=0;for(b=0;b<s;b++)E[o[n+b]]++;for(C=h,F=15;F>=1&&0===E[F];F--);if(C>F&&(C=F),0===F)return l[u++]=20971520,l[u++]=20971520,c.bits=1,0;for(_=1;_<F&&0===E[_];_++);for(C<_&&(C=_),S=1,v=1;v<=15;v++)if(S<<=1,S-=E[v],S<0)return-1;if(S>0&&(0===e||1!==F))return-1;for(B[1]=0,v=1;v<15;v++)B[v+1]=B[v]+E[v];for(b=0;b<s;b++)0!==o[n+b]&&(d[B[o[n+b]]++]=b);if(0===e?(T=I=d,x=20):1===e?(T=t,I=r,x=257):(T=a,I=i,x=0),A=0,b=0,v=_,y=u,w=C,M=0,m=-1,D=1<<C,g=D-1,1===e&&D>852||2===e&&D>592)return 1;for(;;){k=v-M,d[b]+1<x?(L=0,P=d[b]):d[b]>=x?(L=I[d[b]-x],P=T[d[b]-x]):(L=96,P=0),f=1<<v-M,p=1<<w,_=p;do{p-=f,l[y+(A>>M)+p]=k<<24|L<<16|P}while(0!==p);for(f=1<<v-1;A&f;)f>>=1;if(0!==f?(A&=f-1,A+=f):A=0,b++,0==--E[v]){if(v===F)break;v=o[n+d[b]]}if(v>C&&(A&g)!==m){for(0===M&&(M=C),y+=_,w=v-M,S=1<<w;w+M<F&&(S-=E[w+M],!(S<=0));)w++,S<<=1;if(D+=1<<w,1===e&&D>852||2===e&&D>592)return 1;m=A&g,l[m]=C<<24|w<<16|y-u}}return 0!==A&&(l[y+A]=v-M<<24|64<<16),c.bits=C,0}},2129:(e,t)=>{"use strict";var r,a;Object.defineProperty(t,"__esModule",{value:!0}),t.ItemFeatureFlag=t.InventoryType=void 0,function(e){e[e.Head=1]="Head",e[e.Neck=2]="Neck",e[e.Shoulders=3]="Shoulders",e[e.Shirt=4]="Shirt",e[e.Chest=5]="Chest",e[e.Waist=6]="Waist",e[e.Legs=7]="Legs",e[e.Feet=8]="Feet",e[e.Wrists=9]="Wrists",e[e.Hands=10]="Hands",e[e.Finger=11]="Finger",e[e.Trinket=12]="Trinket",e[e.OneHand=13]="OneHand",e[e.Shield=14]="Shield",e[e.Ranged=15]="Ranged",e[e.Back=16]="Back",e[e.TwoHand=17]="TwoHand",e[e.Bag=18]="Bag",e[e.Tabard=19]="Tabard",e[e.Robe=20]="Robe",e[e.MainHand=21]="MainHand",e[e.OffHand=22]="OffHand",e[e.HeldInOffHand=23]="HeldInOffHand",e[e.Projectile=24]="Projectile",e[e.Thrown=25]="Thrown",e[e.RangedRight=26]="RangedRight",e[e.Quiver=27]="Quiver",e[e.Relic=28]="Relic",e[e.ProfessionTool=29]="ProfessionTool",e[e.ProfessionAccesory=30]="ProfessionAccesory"}(r||(t.InventoryType=r={})),function(e){e[e.EmblazonedTabard=1]="EmblazonedTabard",e[e.NoSheathedKit=2]="NoSheathedKit",e[e.HidePantsAndBelt=4]="HidePantsAndBelt",e[e.EmblazonedTabardRare=8]="EmblazonedTabardRare",e[e.EmblazonedTabardEpic=16]="EmblazonedTabardEpic",e[e.UseSpearRangedWeaponAttachment=32]="UseSpearRangedWeaponAttachment",e[e.InheritCharacterAnimation=64]="InheritCharacterAnimation",e[e.MirrorAnimasFomRightShoulderToLeft=128]="MirrorAnimasFomRightShoulderToLeft",e[e.MirrorModelWhenEquippedonOffHand=256]="MirrorModelWhenEquippedonOffHand",e[e.DisableTabardGeo=512]="DisableTabardGeo",e[e.MirrorModelWhenEquippedonMainHand=1024]="MirrorModelWhenEquippedonMainHand",e[e.MirrorModelWhenSheathed=2048]="MirrorModelWhenSheathed",e[e.FlipModelWhenSheathed=4096]="FlipModelWhenSheathed",e[e.UseAlternateWeaponTrailEndpoint=8192]="UseAlternateWeaponTrailEndpoint",e[e.ForceSheathedifequippedasweapon=16384]="ForceSheathedifequippedasweapon",e[e.DontCloseHands=32768]="DontCloseHands",e[e.ForceUnsheathedforSpellCombatAnims=65536]="ForceUnsheathedforSpellCombatAnims",e[e.BrewmasterUnsheathe=131072]="BrewmasterUnsheathe",e[e.HideBeltBuckle=262144]="HideBeltBuckle",e[e.NoDefaultBowstring=524288]="NoDefaultBowstring",e[e.UnknownEffect1=1048576]="UnknownEffect1",e[e.UnknownEffect2=2097152]="UnknownEffect2",e[e.UnknownEffect3=4194304]="UnknownEffect3",e[e.UnknownEffect4=8388608]="UnknownEffect4",e[e.UnknownEffect5=16777216]="UnknownEffect5",e[e.UnknownEffect6=33554432]="UnknownEffect6",e[e.UnknownEffect7=67108864]="UnknownEffect7",e[e.UnknownEffect8=134217728]="UnknownEffect8"}(a||(t.ItemFeatureFlag=a={}))},2222:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isDisposable=function(e){return e&&"function"==typeof e.dispose}},2315:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});const a="precision highp float;\r\nprecision highp int;\r\n\r\nuniform sampler2D u_texture;\r\nuniform ivec2 u_waterParams;\r\n\r\nvarying vec3 v_position;\r\nvarying vec2 v_texCoord;\r\nvarying vec3 v_normal;\r\nvarying float v_depth;\r\n\r\nuniform vec4 u_oceanCloseColor;\r\nuniform vec4 u_oceanFarColor;\r\nuniform vec4 u_riverCloseColor;\r\nuniform vec4 u_riverFarColor;\r\nuniform vec4 u_waterAlphas; // riverShallow, riverDeep, oceanShallow, oceanDeep\r\n\r\n// Simple lighting params, currently unused\r\nuniform bool u_unlit;\r\nuniform vec4 u_ambientColor;\r\nuniform vec4 u_lightColor;\r\nuniform vec3 u_lightDir;\r\n\r\nfloat saturate(float v) { return clamp(v, 0.0, 1.0); }\r\nvec3 saturate(vec3 v) { return clamp(v, vec3(0.0), vec3(1.0)); }\r\n\r\nvoid main() {\r\n    int liquidCategory = int(u_waterParams.x);\r\n    vec4 tex = texture2D(u_texture, v_texCoord);\r\n    vec4 finalColor;\r\n    // Slime or Lava\r\n    if (liquidCategory == 2 || liquidCategory == 3) {\r\n        finalColor = vec4(saturate(tex.xyz), 1.0);\r\n    } else {\r\n        vec4 liquidColor, diffuseColor, specularColor;\r\n        float depth = saturate(v_depth / 50.0);\r\n        // Ocean\r\n        if (liquidCategory == 1) {\r\n            vec4 shallowColor = vec4(u_oceanCloseColor.rgb, u_waterAlphas.b);\r\n            vec4 deepColor = vec4(u_oceanFarColor.rgb, u_waterAlphas.a);\r\n            liquidColor = mix(shallowColor, deepColor, depth);\r\n        } else {\r\n            vec4 shallowColor = vec4(u_riverCloseColor.rgb, u_waterAlphas.r);\r\n            vec4 deepColor = vec4(u_riverFarColor.rgb, u_waterAlphas.g);\r\n            liquidColor = mix(shallowColor, deepColor, depth);\r\n        }\r\n        diffuseColor = vec4(liquidColor.rgb + tex.rgb, liquidColor.a);\r\n        specularColor = vec4(vec3(0.25) * tex.a, 0.0);\r\n        finalColor = diffuseColor + specularColor;\r\n    }\r\n\r\n    gl_FragColor = finalColor;\r\n}"},2388:(e,t)=>{"use strict";var r,a,i;Object.defineProperty(t,"__esModule",{value:!0}),t.M2BlendModeToEGxBlend=t.GxBlend=t.ColorMask=t.BufferDataType=void 0,function(e){e[e.Float=0]="Float",e[e.UInt8=1]="UInt8",e[e.UInt16=2]="UInt16",e[e.UInt32=3]="UInt32",e[e.Int8=4]="Int8",e[e.Int16=5]="Int16",e[e.Int32=6]="Int32"}(r||(t.BufferDataType=r={})),function(e){e[e.None=0]="None",e[e.Red=1]="Red",e[e.Green=2]="Green",e[e.Blue=4]="Blue",e[e.Alpha=8]="Alpha",e[e.All=15]="All"}(a||(t.ColorMask=a={})),function(e){e[e.GxBlend_Invalid=-1]="GxBlend_Invalid",e[e.GxBlend_Opaque=0]="GxBlend_Opaque",e[e.GxBlend_AlphaKey=1]="GxBlend_AlphaKey",e[e.GxBlend_Alpha=2]="GxBlend_Alpha",e[e.GxBlend_Add=3]="GxBlend_Add",e[e.GxBlend_Mod=4]="GxBlend_Mod",e[e.GxBlend_Mod2x=5]="GxBlend_Mod2x",e[e.GxBlend_ModAdd=6]="GxBlend_ModAdd",e[e.GxBlend_InvSrcAlphaAdd=7]="GxBlend_InvSrcAlphaAdd",e[e.GxBlend_InvSrcAlphaOpaque=8]="GxBlend_InvSrcAlphaOpaque",e[e.GxBlend_SrcAlphaOpaque=9]="GxBlend_SrcAlphaOpaque",e[e.GxBlend_NoAlphaAdd=10]="GxBlend_NoAlphaAdd",e[e.GxBlend_ConstantAlpha=11]="GxBlend_ConstantAlpha",e[e.GxBlend_Screen=12]="GxBlend_Screen",e[e.GxBlend_BlendAdd=13]="GxBlend_BlendAdd"}(i||(t.GxBlend=i={}));const o=[i.GxBlend_Opaque,i.GxBlend_AlphaKey,i.GxBlend_Alpha,i.GxBlend_NoAlphaAdd,i.GxBlend_Add,i.GxBlend_Mod,i.GxBlend_Mod2x,i.GxBlend_BlendAdd];t.M2BlendModeToEGxBlend=e=>o[e]},2462:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(7716),t),i(r(6472),t),i(r(6098),t),i(r(5416),t)},2526:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(2820),t),i(r(4271),t)},2561:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(5777),t)},2567:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},2690:(e,t)=>{"use strict";var r,a;Object.defineProperty(t,"__esModule",{value:!0}),t.getWMOPixelShader=t.getWMOVertexShader=t.WMOVertexShader=t.WMOPixelShader=void 0,function(e){e[e.Diffuse=0]="Diffuse",e[e.Specular=1]="Specular",e[e.Metal=2]="Metal",e[e.Env=3]="Env",e[e.Opaque=4]="Opaque",e[e.EnvMetal=5]="EnvMetal",e[e.TwoLayerDiffuse=6]="TwoLayerDiffuse",e[e.TwoLayerEnvMetal=7]="TwoLayerEnvMetal",e[e.TwoLayerTerrain=8]="TwoLayerTerrain",e[e.DiffuseEmissive=9]="DiffuseEmissive",e[e.MaskedEnvMetal=10]="MaskedEnvMetal",e[e.EnvMetalEmissive=11]="EnvMetalEmissive",e[e.TwoLayerDiffuseOpaque=12]="TwoLayerDiffuseOpaque",e[e.TwoLayerDiffuseEmissive=13]="TwoLayerDiffuseEmissive",e[e.AdditiveMaskedEnvMetal=14]="AdditiveMaskedEnvMetal",e[e.TwoLayerDiffuseMod2x=15]="TwoLayerDiffuseMod2x",e[e.TwoLayerDiffuseMod2xNA=16]="TwoLayerDiffuseMod2xNA",e[e.TwoLayerDiffuseAlpha=17]="TwoLayerDiffuseAlpha",e[e.Lod=18]="Lod",e[e.Parallax=19]="Parallax",e[e.UnkShader=20]="UnkShader",e[e.None=21]="None"}(r||(t.WMOPixelShader=r={})),function(e){e[e.DiffuseT1=0]="DiffuseT1",e[e.DiffuseT1Refl=1]="DiffuseT1Refl",e[e.DiffuseT1EnvT2=2]="DiffuseT1EnvT2",e[e.SpecularT1=3]="SpecularT1",e[e.DiffuseComp=4]="DiffuseComp",e[e.DiffuseCompRefl=5]="DiffuseCompRefl",e[e.DiffuseCompTerrain=6]="DiffuseCompTerrain",e[e.DiffuseCompAlpha=7]="DiffuseCompAlpha",e[e.Parallax=8]="Parallax",e[e.None=9]="None"}(a||(t.WMOVertexShader=a={}));const i=[[a.DiffuseT1,r.Diffuse],[a.SpecularT1,r.Specular],[a.SpecularT1,r.Metal],[a.DiffuseT1Refl,r.Env],[a.DiffuseT1,r.Opaque],[a.DiffuseT1Refl,r.EnvMetal],[a.DiffuseComp,r.TwoLayerDiffuse],[a.DiffuseT1,r.TwoLayerEnvMetal],[a.DiffuseCompTerrain,r.TwoLayerTerrain],[a.DiffuseComp,r.DiffuseEmissive],[a.None,r.None],[a.DiffuseT1EnvT2,r.MaskedEnvMetal],[a.DiffuseT1EnvT2,r.EnvMetalEmissive],[a.DiffuseComp,r.TwoLayerDiffuseOpaque],[a.None,r.None],[a.DiffuseComp,r.TwoLayerDiffuseEmissive],[a.DiffuseT1,r.Diffuse],[a.DiffuseT1EnvT2,r.AdditiveMaskedEnvMetal],[a.DiffuseCompAlpha,r.TwoLayerDiffuseMod2x],[a.DiffuseComp,r.TwoLayerDiffuseMod2xNA],[a.DiffuseCompAlpha,r.TwoLayerDiffuseAlpha],[a.DiffuseT1,r.Lod],[a.Parallax,r.Parallax],[a.DiffuseT1,r.UnkShader]];t.getWMOVertexShader=e=>i[e][0],t.getWMOPixelShader=e=>i[e][1]},2715:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},2807:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlaneParticleGenerator=void 0;const a=r(1639),i=r(3064);class o extends i.BaseParticleGenerator{generateParticle(e){let t=e*this.rng.getFloat(),r=this.rng.getFloat(),i=r<1?r>-1?Math.trunc(32767*r+.5):-32767:32767,o=this.getLifespan(i);o<.001&&(o=.001);const n=t%o,s=65535&this.rng.getInt(),l=a.Float3.zero();l[0]=this.rng.getSignedFloat()*this.animatedProps.emissionAreaX*.5,l[1]=this.rng.getSignedFloat()*this.animatedProps.emissionAreaY*.5;let u=this.getNextEmissionSpeed();const d=a.Float3.zero();let c=this.animatedProps.zSource;if(c<.001){let e=this.animatedProps.verticalRange*this.rng.getSignedFloat(),t=this.animatedProps.horizontalRange*this.rng.getSignedFloat(),r=Math.sin(e),i=Math.sin(t),o=Math.cos(e),n=Math.cos(t);a.Float3.set(d,n*r*u,i*r*u,o*u)}else{let e=a.Float3.zero();a.Float3.copy(l,e),e[2]=e[2]-c,a.Float3.length(e)>1e-4&&(a.Float3.normalize(e,e),a.Float3.scale(e,u,d))}return{age:n,position:l,seed:s,state:i,texturePosition:[a.Float2.zero(),a.Float2.zero()],textureVelocity:[a.Float2.zero(),a.Float2.zero()],velocity:d}}}t.PlaneParticleGenerator=o},2820:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},2876:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultObjectFactory=void 0;const a=r(6940),i=r(5911),o=r(2526),n=r(8085);t.DefaultObjectFactory=class{constructor(e){this.iocContainer=e}createM2Model(e){const t=new a.M2Model(this.iocContainer.getDataManager(),this.iocContainer.getRandomNumberGenerator());return t.loadFileId(e),t}createWMOModel(e){const t=new a.WMOModel(this.iocContainer.getDataManager(),this.iocContainer.getObjectFactory());return t.loadFileId(e),t}createItemModel(e){const t=new a.ItemModel(this.iocContainer.getDataManager(),this.iocContainer.getObjectFactory(),this.iocContainer.getTexturePickingStrategy(),this.iocContainer.getModelPickingStrategy());return t.loadDisplayInfoId(e),t}createCharacterModel(e){const t=new a.CharacterModel(this.iocContainer.getDataManager(),this.iocContainer.getRandomNumberGenerator(),this.iocContainer.getObjectFactory(),this.iocContainer.getTexturePickingStrategy());return t.loadModelId(e),t}createTextureVariantModel(e){const t=new a.TextureVariantModel(this.iocContainer.getDataManager(),this.iocContainer.getRandomNumberGenerator());return t.loadFileId(e),t}createItemVisual(e){const t=new o.ItemVisualModel(this.iocContainer.getDataManager(),this.iocContainer.getObjectFactory());return t.loadItemVisualId(e),t}createSpellVisualKit(e){const t=new n.SpellVisualKitModel(this.iocContainer.getDataManager(),this.iocContainer.getObjectFactory());return t.loadSpellVisualKitId(e),t}createLine(e){return new a.Line(e)}createCache(){return new i.SimpleCache}}},2981:function(e,t,r){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.M2RibbonEmitter=void 0;const i=r(1639),o=r(8204),n=r(1017),s=a(r(304)),l=a(r(8381));class u{constructor(){this.pos=i.Float3.zero(),this.color=i.Float4.zero(),this.texCoord=i.Float2.zero()}}class d extends o.Disposable{constructor(e,t,r){super(),this.index=e,this.parent=t,this.m2data=r,this.engine=t.renderer,this.initialize()}initialize(){this.texBox={minX:0,minY:0,maxX:1,maxY:1};let e=Math.ceil(this.m2data.edgesPerSecond),t=Math.max(.25,this.m2data.edgeLifetime),r=Math.ceil(t*e),a=Math.max(r+2,0);this.edgeLifetimes=new Array(a),this.vertices=new Array(2*a);for(let e=0;e<this.vertices.length;e++)this.vertices[e]=new u;this.invLifespan=1/t;let o=this.m2data.textureCols;2147483648&o&&(o=(1&o|o>>1)+(1&o|o>>1));let n=this.m2data.textureRows;2147483648&n&&(n=(1&n|n>>1)+(1&n|n>>1)),this.colLength=(this.texBox.maxX-this.texBox.minX)/o,this.rowLength=(this.texBox.maxY-this.texBox.minY)/n,this.rows=n,this.cols=o,this.edgesPerSecond=e,this.edgeLifetime=t,this.color=i.Float4.create(1,1,1,1),this.texSlot=0,this.texSlotBox={minX:this.texBox.minX,minY:this.texBox.minY,maxX:this.texBox.minX+this.colLength,maxY:this.texBox.minY+this.rowLength},this.heightAbove=10,this.heightBelow=10,this.gravity=this.m2data.gravity,this.visible=!0,this.initializedPosition=!1,this.didSingletonUpdate=!1,this.edgeStart=0,this.edgeEnd=0,this.prevPos=i.Float3.zero(),this.prevDir=i.Float3.zero(),this.prevVertical=i.Float3.zero(),this.currPos=i.Float3.zero(),this.currDir=i.Float3.zero(),this.currVertical=i.Float3.zero(),this.startTime=0,this.below0=i.Float3.zero(),this.below1=i.Float3.zero(),this.above0=i.Float3.zero(),this.above1=i.Float3.zero(),this.prevDirScaled=i.Float3.zero(),this.currDirScaled=i.Float3.zero(),this.minWorldBounds=i.Float3.zero(),this.maxWorldBounds=i.Float3.zero(),this.setupGraphics()}dispose(){this.isDisposing||(super.dispose(),this.parent=null,this.m2data=null,this.engine=null,this.materials=null,this.dataBuffers.dispose(),this.dataBuffers=null,this.indexBuffer=null,this.vertexBuffer=null,this.shaderProgram=null,this.vertices=null,this.edgeLifetimes=null,this.texBox=null,this.color=null,this.prevPos=null,this.prevDir=null,this.prevVertical=null,this.currPos=null,this.currDir=null,this.currVertical=null,this.below0=null,this.below1=null,this.above0=null,this.above1=null,this.prevDirScaled=null,this.currDirScaled=null,this.minWorldBounds=null,this.maxWorldBounds=null)}update(e){if(this.parent.animationState.isPaused)return;for(this.updateAnimatedProps(),this.updatePosition(),e*=.001,this.didSingletonUpdate||this.edgesPerSecond>0&&(e=1/this.edgesPerSecond+99999997e-12),e>=0?this.edgeLifetime<=e&&(e=this.edgeLifetime):e=0;e+this.edgeLifetimes[this.edgeStart]>=this.edgeLifetime&&this.edgeStart!=this.edgeEnd;)this.edgeStart=this.advance(this.edgeStart,1);if(this.visible&&this.initializedPosition){this.updateDeltas();const t=e*this.edgesPerSecond+this.startTime;let r,a,i,o=!1,n=0;if(t<1?o=!0:(a=this.startTime,r=1/(t-a),i=Math.max(Math.floor(t-1),0)),!o&&i>-1)for(n=0;-1!==i;)n+=1,a=this.startTime,this.vertices[2*this.edgeEnd].color=this.color,this.vertices[2*this.edgeEnd+1].color=this.color,this.interpEdge((n-a)*r*-e,(n-a)*r,1),i--;this.startTime=t-Math.floor(t),this.interpEdge(0,1,0);const s=this.vertices[2*this.edgeEnd];s.texCoord[0]=this.texSlotBox.minX,s.texCoord[1]=this.texSlotBox.minY,s.color=this.color;const l=this.vertices[2*this.edgeEnd+1];l.texCoord[0]=this.texSlotBox.maxX,l.texCoord[1]=this.texSlotBox.maxY,l.color=this.color}this.minWorldBounds[2]=34028235e30,this.minWorldBounds[1]=34028235e30,this.minWorldBounds[0]=34028235e30,this.maxWorldBounds[2]=-34028235e30,this.maxWorldBounds[1]=-34028235e30,this.maxWorldBounds[0]=-34028235e30;let t=this.edgeStart;for(;t!=this.edgeEnd;){const r=this.vertices[2*t],a=this.vertices[2*t+1],i=2*this.gravity*this.edgeLifetimes[t]*e+e*this.gravity*e;r.pos[2]=r.pos[2]+i,a.pos[2]=i+a.pos[2],this.minWorldBounds[0]=Math.min(this.minWorldBounds[0],r.pos[0],a.pos[0]),this.minWorldBounds[1]=Math.min(this.minWorldBounds[1],r.pos[1],a.pos[1]),this.minWorldBounds[2]=Math.min(this.minWorldBounds[2],r.pos[2],a.pos[2]),this.maxWorldBounds[0]=Math.max(this.maxWorldBounds[0],r.pos[0],a.pos[0]),this.maxWorldBounds[1]=Math.max(this.maxWorldBounds[1],r.pos[1],a.pos[1]),this.maxWorldBounds[2]=Math.max(this.maxWorldBounds[2],r.pos[2],a.pos[2]),this.edgeLifetimes[t]=e+this.edgeLifetimes[t];const o=this.colLength*this.edgeLifetimes[t]*this.invLifespan+this.texSlotBox.minX;r.texCoord[0]=o,r.texCoord[1]=this.texSlotBox.minY,a.texCoord[0]=o,a.texCoord[1]=this.texSlotBox.maxY;const n=t+1;t=n-this.edgeLifetimes.length,this.edgeLifetimes.length>n&&(t=n)}this.didSingletonUpdate=!0,this.updateBuffers()}draw(){if(!this.isDisposing&&this.edgeStart!=this.edgeEnd)for(let e=0;e<this.materials.length;e++){const t=this.edgeEnd>this.edgeStart?2*(this.edgeEnd-this.edgeStart)+2:2*(this.edgeLifetimes.length+this.edgeEnd-this.edgeStart)+2,r=new n.DrawingBatchRequest("M2-RIBBON",this.parent.fileId,this.index,e);r.useMaterial(this.materials[e]).useDataBuffers(this.dataBuffers).drawIndexedTriangleStrip(2*this.edgeStart*2,t),this.engine.submitDrawRequest(r)}}updateAnimatedProps(){let e=i.Float3.zero(),t=1;e=this.parent.animationState.getFloat3TrackValue(this.m2data.colorTrack,e),t=this.parent.animationState.getNumberTrackValue(this.m2data.alphaTrack,0),i.Float3.copy(e,this.color),this.color[3]=Math.max(t/32767,0),this.heightAbove=this.parent.animationState.getNumberTrackValue(this.m2data.heightAboveTrack,0),this.heightBelow=this.parent.animationState.getNumberTrackValue(this.m2data.heightBelowTrack,0);const r=this.parent.animationState.getNumberTrackValue(this.m2data.texSlotTrack,0);if(this.texSlot!=r){this.texSlot=r;let e=r%this.cols;2147483648&e&&(e=(1&e|e>>1)+(1&e|e>>1));const t=e*this.colLength+this.texBox.minX;this.texSlotBox.minX=t;let a=r/this.cols;2147483648&a&&(a=1&a|a>>1,a+=a);let i=a*this.rowLength+this.texBox.minY;this.texSlotBox.minY=i,this.texSlotBox.maxX=t+this.colLength,this.texSlotBox.maxY=i+this.rowLength}const a=this.parent.animationState.getNumberTrackValue(this.m2data.visibilityTrack,1)>0;a||(this.initializedPosition=!1),this.visible=a}updatePosition(){if(this.visible){const e=i.Float44.identity();i.Float44.multiply(this.parent.worldModelMatrix,this.parent.boneData[this.m2data.boneIndex].positionMatrix,e),i.Float44.translate(e,this.m2data.position,e);const t=i.Float3.zero();i.Float44.getTranslation(e,t),this.initializedPosition?(i.Float3.copy(this.currPos,this.prevPos),i.Float3.copy(this.currDir,this.prevDir),i.Float3.copy(this.currVertical,this.prevVertical)):(i.Float3.copy(t,this.prevPos),this.prevDir=i.Float44.getColumn3(e,2),this.prevVertical=i.Float44.getColumn3(e,1),this.startTime=0,this.initializedPosition=!0),this.currPos=t,this.currDir=i.Float44.getColumn3(e,2),this.currVertical=i.Float44.getColumn3(e,1)}}advance(e,t){let r=e+t,a=this.edgeLifetimes.length;return r>=a&&(r-=a),r}updateDeltas(){let e=i.Float3.zero();i.Float3.subtract(this.prevPos,this.prevPos,e);let t=i.Float3.length(e);i.Float3.scale(this.prevVertical,this.heightBelow,e),i.Float3.subtract(this.prevPos,e,this.below0),i.Float3.scale(this.currVertical,this.heightBelow,e),i.Float3.subtract(this.currPos,e,this.below1),i.Float3.scale(this.prevVertical,this.heightAbove,e),i.Float3.add(this.prevPos,e,this.above0),i.Float3.scale(this.currVertical,this.heightAbove,e),i.Float3.add(this.currPos,e,this.above1),i.Float3.scale(this.prevDir,t,this.prevDirScaled),i.Float3.scale(this.currDir,t,this.currDirScaled)}interpEdge(e,t,r){const a=this.vertices[2*this.edgeEnd],o=this.vertices[2*this.edgeEnd+1],n=i.Float3.zero();i.Float3.scale(this.currDirScaled,1-t,n),i.Float3.subtract(this.below1,n,n),i.Float3.scale(n,t,a.pos),i.Float3.scale(this.prevDirScaled,t,n),i.Float3.add(this.below0,n,n),i.Float3.scale(n,1-t,n),i.Float3.add(a.pos,n,a.pos),i.Float3.scale(this.currDirScaled,1-t,n),i.Float3.subtract(this.above1,n,n),i.Float3.scale(n,t,o.pos),i.Float3.scale(this.prevDirScaled,t,n),i.Float3.add(this.above0,n,n),i.Float3.scale(n,1-t,n),i.Float3.add(o.pos,n,o.pos),this.edgeLifetimes[this.edgeEnd]=e,this.edgeEnd=this.edgeEnd+r,this.edgeEnd>=this.edgeLifetimes.length&&(this.edgeEnd-=this.edgeLifetimes.length)}updateBuffers(){let e=new Array(this.vertices.length),t=0;for(let r=0;r<this.vertices.length;++r)e[t++]=this.vertices[r].pos[0],e[t++]=this.vertices[r].pos[1],e[t++]=this.vertices[r].pos[2],e[t++]=this.vertices[r].color[0],e[t++]=this.vertices[r].color[1],e[t++]=this.vertices[r].color[2],e[t++]=this.vertices[r].color[3],e[t++]=this.vertices[r].texCoord[0],e[t++]=this.vertices[r].texCoord[1];this.vertexBuffer.setData(new Float32Array(e))}setupGraphics(){this.shaderProgram=this.engine.getShaderProgram(this,"M2RibbonEmitter",l.default,s.default),this.vertexBuffer=this.engine.graphics.createVertexDataBuffer([{index:this.shaderProgram.getAttribLocation("a_position"),size:3,type:n.BufferDataType.Float,normalized:!1,stride:36,offset:0},{index:this.shaderProgram.getAttribLocation("a_color"),size:4,type:n.BufferDataType.Float,normalized:!1,stride:36,offset:12},{index:this.shaderProgram.getAttribLocation("a_texCoord1"),size:2,type:n.BufferDataType.Float,normalized:!1,stride:36,offset:28}],!0),this.indexBuffer=this.engine.graphics.createVertexIndexBuffer(!0);let e=new Uint16Array(4*this.edgeLifetimes.length);for(let t=0;t<e.length;t++)e[t]=t%(2*this.edgeLifetimes.length);this.indexBuffer.setData(e),this.dataBuffers=this.engine.graphics.createDataBuffers(this.vertexBuffer,this.indexBuffer),this.materials=[];for(let e=0;e<this.m2data.textureIndices.length;e++){const t=this.m2data.textureIndices[e];if(t<=-1||t>this.parent.modelData.textures.length)continue;const r=this.parent.textureObjects[t];let a=e;a>=this.m2data.materialIndices.length&&(a=0);const i=this.parent.modelData.materials[this.m2data.materialIndices[a]];let o=(0,n.M2BlendModeToEGxBlend)(i.blendingMode);o===n.GxBlend.GxBlend_Opaque&&(o=n.GxBlend.GxBlend_Alpha);let s=this.engine.getBaseMaterial();s.useShaderProgram(this.shaderProgram),s.useBackFaceCulling(!1),s.useCounterClockWiseFrontFaces(!this.parent.isMirrored),s.useBlendMode(o),s.useDepthTest(!0),s.useDepthWrite(!1),s.useColorMask(n.ColorMask.Alpha|n.ColorMask.Blue|n.ColorMask.Green|n.ColorMask.Red),s.useUniforms({u_texture:r}),this.materials.push(s)}}}t.M2RibbonEmitter=d},3055:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Float2=t.Float3=t.Float4=t.Axis=void 0;const r="undefined"!=typeof Float32Array?Float32Array:Array;var a,i,o,n;!function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z",e[e.W=3]="W"}(a||(t.Axis=a={})),function(e){function t(e){return e?(e[0]=0,e[1]=0,e[2]=0,e[3]=0,e):i(0,0,0,0)}function a(e){if(e)return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e;const t=new r(4);return r!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=1),t}function i(e,t,a,i){const o=new r(4);return o[0]=e,o[1]=t,o[2]=a,o[3]=i,o}function o(e,t,r){return(r=r||a())[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r}function n(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}e.zero=t,e.one=function(e){return e?(e[0]=1,e[1]=1,e[2]=1,e[3]=1,e):i(1,1,1,1)},e.identity=a,e.create=i,e.fromVec3=function(e){return i(e[0],e[1],e[2],1)},e.copy=function(e,t){return(t=t||a())[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},e.set=function(e,t,r,a,i){return e[0]=t,e[1]=r,e[2]=a,e[3]=i,e},e.add=function(e,t,r){return(r=r||a())[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r},e.subtract=function(e,t,r){return(r=r||a())[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r[3]=e[3]-t[3],r},e.scale=o,e.length=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},e.normalize=function(e,t){t=t||a();let r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3];return r>0&&(r=1/Math.sqrt(r)),o(e,r,t)},e.dot=n,e.lerp=function(e,t,r,i){i=i||a();let o,s,l=e[0],u=e[1],d=e[2],c=e[3],h=t[0],f=t[1],p=t[2],m=t[3],g=n(e,t);if(g<0&&(g=-g,h=-h,f=-f,p=-p,m=-m),1-g>1e-6){const e=Math.acos(g),t=Math.sin(e);o=Math.sin((1-r)*e)/t,s=Math.sin(r*e)/t}else o=1-r,s=r;return i[0]=o*l+s*h,i[1]=o*u+s*f,i[2]=o*d+s*p,i[3]=o*c+s*m,i},e.cross=function(e,r,a){a=a||t();let i=e[0],o=e[1],n=e[2],s=r[0],l=r[1],u=r[2];return a[0]=o*u-n*l,a[1]=n*s-i*u,a[2]=i*l-o*s,a[3]=0,a},e.createQuat=function(e,t,r){r=r||a(),t*=.5;let i=Math.sin(t);return r[0]=i*e[0],r[1]=i*e[1],r[2]=i*e[2],r[3]=Math.cos(t),r},e.quatFromEulers=function(e,t,r,i){i=i||a();const o=Math.cos(e/2),n=Math.sin(e/2),s=Math.cos(t/2),l=Math.sin(t/2),u=Math.cos(r/2),d=Math.sin(r/2);return i[0]=n*s*u-o*l*d,i[1]=o*l*u+n*s*d,i[2]=o*s*d-n*l*u,i[3]=o*s*u+n*l*d,i},e.quatMultiply=function(e,t,r){r=r||a();const i=e[0],o=e[1],n=e[2],s=e[3],l=t[0],u=t[1],d=t[2],c=t[3];return r[0]=i*l-o*u-n*d-s*c,r[1]=i*u+o*l-n*c+s*d,r[2]=i*d+o*c+n*l-s*u,r[3]=i*c-o*d+n*u+s*l,r},e.quatInvert=function(e,t){return(t=t||a())[0]=e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}}(i||(t.Float4=i={})),function(e){function t(e){return e?(e[0]=0,e[1]=0,e[2]=0,e):i(0,0,0)}function i(e,t,a){const i=new r(3);return i[0]=e,i[1]=t,i[2]=a,i}function o(e,r,a){return(a=a||t())[0]=e[0]*r,a[1]=e[1]*r,a[2]=e[2]*r,a}e.zero=t,e.one=function(e){return e?(e[0]=1,e[1]=1,e[2]=1,e):i(1,1,1)},e.create=i,e.fromScalar=function(e){return i(e,e,e)},e.distance=function(e,t){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},e.copy=function(e,r){return(r=r||t())[0]=e[0],r[1]=e[1],r[2]=e[2],r},e.set=function(e,t,r,a){return e[0]=t,e[1]=r,e[2]=a,e},e.add=function(e,r,a){return(a=a||t())[0]=e[0]+r[0],a[1]=e[1]+r[1],a[2]=e[2]+r[2],a},e.subtract=function(e,r,a){return(a=a||t())[0]=e[0]-r[0],a[1]=e[1]-r[1],a[2]=e[2]-r[2],a},e.scale=o,e.length=function(e){return Math.hypot(e[0],e[1],e[2])},e.lengthSquared=function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},e.normalize=function(e,r){r=r||t();let a=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];return a>0&&(a=1/Math.sqrt(a)),o(e,a,r)},e.multiply=function(e,r,a){return(a=a||t())[0]=e[0]*r[0],a[1]=e[1]*r[1],a[2]=e[2]*r[2],a},e.negate=function(e,r){return(r=r||t())[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r},e.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},e.cross=function(e,r,a){a=a||t();let i=e[0],o=e[1],n=e[2],s=r[0],l=r[1],u=r[2];return a[0]=o*u-n*l,a[1]=n*s-i*u,a[2]=i*l-o*s,a},e.lerp=function(e,r,a,i){return(i=i||t())[0]=e[0]+a*(r[0]-e[0]),i[1]=e[1]+a*(r[1]-e[1]),i[2]=e[2]+a*(r[2]-e[2]),i},e.fromSpherical=function(e,r,a,i){return(i=i||t())[0]=e*Math.sin(r)*Math.cos(a),i[1]=e*Math.sin(r)*Math.sin(a),i[2]=e*Math.cos(r),i},e.projectToVec2=function(e,t){switch(t){case a.X:return n.create(e[1],e[2]);case a.Y:return n.create(e[2],e[0]);case a.Z:return n.create(e[0],e[1])}}}(o||(t.Float3=o={})),function(e){function t(e){if(e)return e[0]=0,e[1]=0,e;const t=new r(2);return r!=Float32Array&&(t[0]=0,t[1]=0),t}e.zero=t,e.create=function(e,t){const a=new r(2);return a[0]=e,a[1]=t,a},e.copy=function(e,r){return(r=r||t())[0]=e[0],r[1]=e[1],r},e.set=function(e,t,r){return e[0]=t,e[1]=r,e},e.add=function(e,r,a){return(a=a||t())[0]=e[0]+r[0],a[1]=e[1]+r[1],a},e.subtract=function(e,r,a){return(a=a||t())[0]=e[0]-r[0],a[1]=e[1]-r[1],a},e.scale=function(e,r,a){return(a=a||t())[0]=e[0]*r,a[1]=e[1]*r,a},e.multiply=function(e,r,a){return(a=a||t())[0]=e[0]*r[0],a[1]=e[1]*r[1],a},e.negate=function(e,r){return(r=r||t())[0]=-e[0],r[1]=-e[1],r},e.lerp=function(e,r,a,i){return(i=i||t())[0]=e[0]+a*(r[0]-e[0]),i[1]=e[0]+a*(r[1]-e[1]),i}}(n||(t.Float2=n={}))},3064:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseParticleGenerator=t.AnimatedParticleGeneratorProps=void 0;const a=r(1639),i=r(8204);class o{constructor(){this.emissionSpeed=0,this.speedVariation=0,this.lifespan=0,this.emissionRate=0,this.gravity=a.Float3.zero(),this.zSource=0,this.emissionAreaX=0,this.emissionAreaY=0,this.verticalRange=0,this.horizontalRange=0}}t.AnimatedParticleGeneratorProps=o;class n extends i.Disposable{constructor(e,t){super(),this.rng=e,this.m2Data=t,this.animatedProps=new o}dispose(){this.isDisposing||(super.dispose(),this.rng=null,this.animatedProps=null,this.m2Data=null)}getNextEmissionRate(){return this.animatedProps.emissionRate+this.rng.getSignedFloat()*this.m2Data.emissionRateVary}getMaxEmissionRate(){return this.animatedProps.emissionRate+this.m2Data.emissionRateVary}getMaxLifespan(){return this.animatedProps.lifespan+this.m2Data.lifespanVary}getLifespan(e){return this.animatedProps.lifespan+1/32767*e*this.m2Data.lifespanVary}getNextEmissionSpeed(){return this.animatedProps.emissionSpeed+this.animatedProps.speedVariation*this.rng.getSignedFloat()}getAnimatedProps(){return this.animatedProps}getGravity(e){a.Float3.copy(this.animatedProps.gravity,e)}}t.BaseParticleGenerator=n},3104:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SphereParticleGenerator=void 0;const a=r(1639),i=r(3064);class o extends i.BaseParticleGenerator{constructor(e,t,r){super(e,t),this.particlesGoUp=r}generateParticle(e){let t=e*this.rng.getFloat(),r=this.rng.getFloat();const i=r<1?r>-1?Math.trunc(32767*r+.5):-32767:32767;let o=this.getLifespan(i);o<.001&&(o=.001);const n=t%o,s=65535&this.rng.getInt(),l=this.animatedProps.emissionAreaY-this.animatedProps.emissionAreaX;let u=this.animatedProps.emissionAreaX+l*this.rng.getFloat(),d=this.animatedProps.verticalRange*this.rng.getFloat(),c=this.animatedProps.horizontalRange*this.rng.getFloat(),h=Math.cos(d),f=a.Float3.create(h*Math.cos(c),h*Math.sin(c),Math.sin(d));const p=a.Float3.zero();a.Float3.scale(f,u,p);let m=this.animatedProps.zSource,g=a.Float3.create(.5,.5,.5);return 0==m?this.particlesGoUp?a.Float3.set(g,0,0,1):a.Float3.set(g,h*Math.cos(c),h*Math.sin(c),Math.sin(d)):(a.Float3.set(g,0,0,m),a.Float3.subtract(p,g,g),a.Float3.length(g)>1e-4&&a.Float3.normalize(g,g)),{age:n,position:p,seed:s,state:i,velocity:a.Float3.scale(g,this.getNextEmissionSpeed()),texturePosition:[a.Float2.zero(),a.Float2.zero()],textureVelocity:[a.Float2.zero(),a.Float2.zero()]}}}t.SphereParticleGenerator=o},3256:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Camera=void 0;const a=r(1639),i=r(8204);class o extends i.Disposable{constructor(e=!0){super(),this.viewMatrix=a.Float44.identity(),this.cameraMatrix=a.Float44.identity(),a.Float44.rotateX(this.viewMatrix,-90*Math.PI/180,this.viewMatrix),a.Float44.invert(this.viewMatrix),this.position=a.Float3.zero(),this.rotation=a.Float3.zero(),this.resizeOnSceneExpand=e}setPosition(e){this.isDisposing||(a.Float3.copy(e,this.position),this.recreateViewMatrix())}setRotation(e){this.isDisposing||(a.Float3.copy(e,this.rotation),this.recreateViewMatrix())}setRoll(e){this.isDisposing||(this.rotation[0]=e,this.recreateViewMatrix())}setRollDeg(e){this.isDisposing||(this.rotation[0]=e*Math.PI/180,this.recreateViewMatrix())}setPitch(e){this.isDisposing||(this.rotation[1]=e,this.recreateViewMatrix())}setPitchDeg(e){this.isDisposing||(this.rotation[1]=e*Math.PI/180,this.recreateViewMatrix())}setYaw(e){this.isDisposing||(this.rotation[2]=e,this.recreateViewMatrix())}setYawDeg(e){this.isDisposing||(this.rotation[2]=e*Math.PI/180,this.recreateViewMatrix())}attachToRenderer(e){this.isDisposing||(this.renderer=e,this.resizeOnSceneExpand&&(this.resizeCallbackFn=()=>{this.scaleToSceneBoundingBox()},this.renderer.on("sceneBoundingBoxUpdate",this.resizeCallbackFn),this.scaleToSceneBoundingBox()))}update(e){}dispose(){this.isDisposing||(super.dispose(),this.renderer.off("sceneBoundingBoxUpdate",this.resizeCallbackFn),this.viewMatrix=null,this.position=null,this.rotation=null,this.renderer=null)}getViewMatrix(){return this.isDisposing?a.Float44.identity():this.viewMatrix}scaleToSceneBoundingBox(){if(this.isDisposing)return;const e=this.renderer.getSceneBoundingBox(),t=a.AABB.sphereRadius(e);a.AABB.center(e,this.position);const r=2*t;this.position[0]+=r,a.Float3.zero(this.rotation),this.rotation[1]=Math.PI/2,this.recreateViewMatrix()}recreateViewMatrix(){const e=a.Float4.quatFromEulers(this.rotation[0],this.rotation[1],this.rotation[2]),t=a.Float44.fromQuat(e);a.Float44.identity(this.cameraMatrix),a.Float44.rotateX(this.cameraMatrix,90*Math.PI/180,this.cameraMatrix),a.Float44.translate(this.cameraMatrix,this.position,this.cameraMatrix),a.Float44.multiply(this.cameraMatrix,t,this.cameraMatrix),a.Float44.invert(this.cameraMatrix,this.viewMatrix)}}t.Camera=o},3269:e=>{"use strict";e.exports=(e,t,r,a)=>{let i=65535&e,o=e>>>16&65535,n=0;for(;0!==r;){n=r>2e3?2e3:r,r-=n;do{i=i+t[a++]|0,o=o+i|0}while(--n);i%=65521,o%=65521}return i|o<<16}},3303:(e,t,r)=>{"use strict";const a=r(8411),i=r(9805),o=r(1996),n=r(4674),s=r(4442),l=Object.prototype.toString,{Z_NO_FLUSH:u,Z_SYNC_FLUSH:d,Z_FULL_FLUSH:c,Z_FINISH:h,Z_OK:f,Z_STREAM_END:p,Z_DEFAULT_COMPRESSION:m,Z_DEFAULT_STRATEGY:g,Z_DEFLATED:y}=r(9681);function x(e){this.options=i.assign({level:m,method:y,chunkSize:16384,windowBits:15,memLevel:8,strategy:g},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;let r=a.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==f)throw new Error(n[r]);if(t.header&&a.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?o.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,r=a.deflateSetDictionary(this.strm,e),r!==f)throw new Error(n[r]);this._dict_set=!0}}function v(e,t){const r=new x(t);if(r.push(e,!0),r.err)throw r.msg||n[r.err];return r.result}x.prototype.push=function(e,t){const r=this.strm,i=this.options.chunkSize;let n,s;if(this.ended)return!1;for(s=t===~~t?t:!0===t?h:u,"string"==typeof e?r.input=o.string2buf(e):"[object ArrayBuffer]"===l.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(i),r.next_out=0,r.avail_out=i),(s===d||s===c)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(n=a.deflate(r,s),n===p)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),n=a.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===f;if(0!==r.avail_out){if(s>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},x.prototype.onData=function(e){this.chunks.push(e)},x.prototype.onEnd=function(e){e===f&&(this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},e.exports.Deflate=x,e.exports.deflate=v,e.exports.deflateRaw=function(e,t){return(t=t||{}).raw=!0,v(e,t)},e.exports.gzip=function(e,t){return(t=t||{}).gzip=!0,v(e,t)},e.exports.constants=r(9681)},3335:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NodeWoWModelViewer=void 0;const a=r(8219),i=r(6303),o=r(105);class n extends o.BaseWoWModelViewer{constructor(e){if(!e.createGl)throw"createGL function is required for the Node WoW ModelViewer.";if(!e.getImgData)throw"getImgData function is required for the Node WoW ModelViewer.";super(e)}initializeRenderer(){var e,t,r,o,n,s,l,u,d;this.width=this.options.width?this.options.width:1024,this.height=this.options.height?this.options.height:1024,this.gl=this.options.createGl(this.width,this.height,{alpha:!0,premultipliedAlpha:!1});const c=new a.WebGlGraphics(this.gl);if(this.renderer=new a.NodeRenderer({graphics:c,dataLoader:this.iocContainer.getDataLoader(),dataManager:this.iocContainer.getDataManager(),objectIdentifier:this.iocContainer.getObjectIdentifier(),progress:this.options.progressReporter,getImageDataFn:this.options.getImgData,errorHandler:this.options.onError,cacheTtl:null===(e=this.options.misc)||void 0===e?void 0:e.cacheTtl,cameraFov:null===(t=this.options.scene)||void 0===t?void 0:t.cameraFov,clearColor:null===(r=this.options.scene)||void 0===r?void 0:r.backgroundColor,interiorSunDir:null===(o=this.options.scene)||void 0===o?void 0:o.interiorSunDirection,sunDir:null===(n=this.options.scene)||void 0===n?void 0:n.sunDirection,exteriorAmbientColor:null===(s=this.options.scene)||void 0===s?void 0:s.exteriorAmbientColor,exteriorDirectColor:null===(l=this.options.scene)||void 0===l?void 0:l.exteriorDirectColor}),this.resize(this.width,this.height),this.renderer.sceneCamera=null!==(d=null===(u=this.options.scene)||void 0===u?void 0:u.camera)&&void 0!==d?d:new i.Camera,this.options.scene&&this.options.scene.objects)for(const e of this.options.scene.objects)this.renderer.addSceneObject(e);this.renderer.start()}draw(e){this.renderer.draw(e)}getPixels(){const e=new Uint8Array(this.width*this.height*4);return this.gl.readPixels(0,0,this.width,this.height,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),e}resize(e,t){if(this.renderer&&this.renderer.width===e&&this.renderer.height===t)return;const r=this.gl.getExtension("STACKGL_resize_drawingbuffer");r&&r.resize(e,t),this.width=e,this.height=t,this.renderer.resize(e,t)}}t.NodeWoWModelViewer=n},3388:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});const a="precision mediump float;\r\n                \r\nvarying vec2 v_texCoord;\r\n\r\nuniform vec4 u_transform;\r\nuniform sampler2D u_texture;\r\n\r\nvoid main() {\r\n    gl_FragColor = texture2D( u_texture, v_texCoord * u_transform.zw + u_transform.xy);\r\n}"},3474:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseCWMOFile=function(e){let t=new i.BinaryReader(e);if(1129794895!=t.readUInt32LE())throw new Error("Encountered wrong magic number. File data is probably not CM2 data?");const r=t.readUInt32LE();if(1e3!=r)throw new Error("Incompatible version encountered in CM2. Supported versions are: 1000. Encountered: "+r);const m=t.readUInt32LE(),g=t.readUInt32LE(),y=t.readUInt32LE(),x=t.readUInt32LE(),v=t.readUInt32LE(),b=t.readUInt32LE(),_=t.readUInt32LE(),F=t.readUInt32LE(),C=t.readUInt32LE(),w=t.readUInt32LE(),M=t.readUInt32LE(),S=t.readUInt32LE(),D=t.readUInt32LE(),A=t.readUInt32LE();let T;const E=t.readRemainingBytes();try{T=(0,a.inflate)(E)}catch(e){throw new Error("Error while inflating zlib compressed data: "+e)}if(T.length<A)throw new Error("Compressed data appears to be smaller than expected? Received: "+T.length+" expected: "+A);t=new i.BinaryReader(T.buffer),t.seek(m);const B=t.readUInt32LE(),k=t.readInt16LE(),L=t.readUInt32LE(),P=t.readUInt32LE(),I=(0,o.readColor)(t),O=(0,o.readAABB)(t);t.seek(g);const R=(0,o.readArray)(t,n);t.seek(y);const U=(0,o.readArray)(t,s);t.seek(x);const W=(0,o.readArray)(t,l);t.seek(v);const V=(0,o.readArray)(t,(e=>e.readUInt32LE()));t.seek(b);const z=(0,o.readArray)(t,u);t.seek(_);const j=(0,o.readArray)(t,d);t.seek(F);const G=(0,o.readArray)(t,c);t.seek(C);const H=(0,o.readArray)(t,h);t.seek(w);const N=(0,o.readArray)(t,f);t.seek(M);const q=(0,o.readArray)(t,f);t.seek(S);const K=(0,o.readArray)(t,o.readFloat3);t.seek(D);return{flags:k,fileDataID:B,id:L,skyboxFileId:P,ambientColor:I,boundingBox:O,ambientVolumes:q,doodadDefs:W,doodadIds:V,materials:R,fogs:z,portalRefs:G,portals:H,globalAmbientVolumes:N,portalVertices:K,groups:(0,o.readArray)(t,p),doodadSets:j,groupInfo:U}};const a=r(1668),i=r(9266),o=r(4337);function n(e){return{flags:e.readUInt32LE(),shader:e.readUInt32LE(),blendMode:e.readUInt32LE(),texture1:e.readUInt32LE(),sidnColor:(0,o.readColor)(e),frameSidnColor:(0,o.readColor)(e),texture2:e.readUInt32LE(),diffColor:(0,o.readColor)(e),groundTypeId:e.readUInt32LE(),texture3:e.readUInt32LE(),color2:e.readUInt32LE(),flags2:e.readUInt32LE(),runTimeData:[e.readUInt32LE(),e.readUInt32LE(),e.readUInt32LE(),e.readUInt32LE()]}}function s(e){return{flags:e.readUInt32LE(),boundingBox:(0,o.readAABB)(e)}}function l(e){return{nameOffset:e.readUInt32LE(),flags:e.readUInt32LE(),position:(0,o.readFloat3)(e),rotation:(0,o.readFloat4)(e),scale:e.readFloatLE(),color:(0,o.readColor)(e)}}function u(e){return{flags:e.readUInt32LE(),position:(0,o.readFloat3)(e),smallerRadius:e.readFloatLE(),largerRadius:e.readFloatLE(),fogEnd:e.readFloatLE(),fogStartScalar:e.readFloatLE(),fogColor:(0,o.readColor)(e),uwFogEnd:e.readFloatLE(),uwFogStartScalar:e.readFloatLE(),uwFogColor:(0,o.readColor)(e)}}function d(e){return{startIndex:e.readUInt32LE(),count:e.readUInt32LE(),name:(0,o.readString)(e)}}function c(e){return{portalIndex:e.readUInt16LE(),groupIndex:e.readUInt16LE(),side:e.readInt16LE()}}function h(e){return{startVertex:e.readUInt16LE(),vertexCount:e.readUInt16LE(),plane:(0,o.readFloat4)(e)}}function f(e){return{position:(0,o.readFloat3)(e),start:e.readFloatLE(),end:e.readFloatLE(),color1:(0,o.readColor)(e),color2:(0,o.readColor)(e),color3:(0,o.readColor)(e),flags:e.readUInt32LE(),doodadSetId:e.readUInt16LE()}}function p(e){return{fileDataID:e.readUInt32LE(),lod:e.readInt32LE(),flags:e.readUInt32LE(),boundingBox:(0,o.readAABB)(e),portalsOffset:e.readUInt16LE(),portalCount:e.readUInt16LE(),transBatchCount:e.readUInt16LE(),intBatchCount:e.readUInt16LE(),extBatchCount:e.readUInt16LE(),unknownBatchCount:e.readUInt16LE(),fogIndices:[e.readUInt8(),e.readUInt8(),e.readUInt8(),e.readUInt8()],groupLiquid:e.readUInt32LE(),groupId:e.readUInt32LE(),flags2:e.readUInt32LE(),splitGroupindex:e.readInt16LE(),nextSplitChildIndex:e.readInt16LE(),headerReplacementColor:(0,o.readColor)(e),indices:(0,o.readArray)(e,(e=>e.readUInt16LE())),liquidData:(0,o.readArray)(e,m),bspIndices:(0,o.readArray)(e,(e=>e.readUInt16LE())),bspNodes:(0,o.readArray)(e,g),vertices:(0,o.readArray)(e,o.readFloat3),normals:(0,o.readArray)(e,o.readFloat3),uvList:(0,o.readArray)(e,o.readFloat2),vertexColors:(0,o.readArray)(e,o.readColor),batches:(0,o.readArray)(e,y),doodadReferences:(0,o.readArray)(e,(e=>e.readUInt16LE()))}}function m(e){return{liquidVertices:(0,o.readInt2)(e),liquidTiles:(0,o.readInt2)(e),position:(0,o.readFloat3)(e),materialId:e.readUInt16LE(),vertices:(0,o.readArray)(e,x),tiles:(0,o.readArray)(e,v)}}function g(e){return{flags:e.readUInt16LE(),negChild:e.readInt16LE(),posChild:e.readInt16LE(),faces:e.readUInt16LE(),faceStart:e.readUInt32LE(),planeDistance:e.readFloatLE()}}function y(e){return{materialId:e.readUInt16LE(),startIndex:e.readUInt32LE(),indexCount:e.readUInt16LE(),firstVertex:e.readUInt16LE(),lastVertex:e.readUInt16LE()}}function x(e){return{data:e.readUInt32LE(),height:e.readFloatLE()}}function v(e){return{legacyLiquidType:e.readUInt8(),fishable:e.readUInt8(),shared:e.readUInt8()}}},3598:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ModelAttachEffect=void 0;const a=r(1639),i=r(8521),o=r(6729);class n extends i.WorldPositionedObject{constructor(e){super(),this.objectFactory=e,this.transformMatrix=a.Float44.identity()}get isLoaded(){var e;return(null===(e=this.model)||void 0===e?void 0:e.isLoaded)&&this.textureLoaded}update(e){if(this.isLoaded&&!this.isDisposing){this.positioner.update(e),a.Float44.multiply(this.transformMatrix,this.positioner.transformMatrix,this.localModelMatrix),this.updateModelMatrixFromParent();for(const t of this.children)t.update(e)}}draw(){if(this.isLoaded&&!this.isDisposing)for(const e of this.children)e.draw()}dispose(){this.isDisposing||super.dispose()}loadModelAttachEffect(e){if(!e.spellVisualEffectName)return;const t=e.spellVisualEffectName.modelFileDataId;if(t<=0)return;this.model=this.objectFactory.createM2Model(t),this.addChild(this.model),e.spellVisualEffectName.textureFileDataId?this.renderer.getTexture(this.model,e.spellVisualEffectName.textureFileDataId).then((e=>{this.model.swapTexture(0,e),this.textureLoaded=!0})):this.textureLoaded=!0;const r=a.Float3.copy(e.offset);let{yaw:i,pitch:n,roll:s,scale:l}=e;return a.Float44.transformMatrix(r,i,n,s,l,this.transformMatrix),a.Float44.scale(this.transformMatrix,a.Float3.fromScalar(e.spellVisualEffectName.scale),this.transformMatrix),this.setModelMatrixFromMatrix(this.transformMatrix),e.positioner&&(this.positioner=new o.Positioner(e.positioner)),e.attachmentId}}t.ModelAttachEffect=n},3613:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},3656:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RotatingCamera=void 0;const a=r(1639),i=r(8204);class o extends i.Disposable{constructor(e=!0){super(),this.viewMatrix=a.Float44.identity(),this.resizeOnSceneExpand=e}getViewMatrix(){return this.isDisposing?a.Float44.identity():this.viewMatrix}attachToRenderer(e){this.isDisposing||(this.renderer=e,this.time=0,this.radius=50,this.rotateSpeed=.05,this.resizeOnSceneExpand&&(this.resizeCallbackFn=()=>{this.scaleToSceneBoundingBox()},this.renderer.on("sceneBoundingBoxUpdate",this.resizeCallbackFn),this.scaleToSceneBoundingBox()))}update(e){if(!this.isDisposing){this.time=(this.time+e)%(360/this.rotateSpeed);var t=Math.floor(this.time/(1/this.rotateSpeed))*Math.PI/180,r=a.Float44.identity();a.Float44.rotateX(r,90*Math.PI/180,r),a.Float44.rotateY(r,t,r),a.Float44.translate(r,a.Float3.create(0,0,this.radius),r),a.Float44.invert(r,this.viewMatrix)}}dispose(){this.isDisposing||(super.dispose(),this.renderer.on("sceneBoundingBoxUpdate",this.resizeCallbackFn),this.viewMatrix=null,this.renderer=null)}scaleToSceneBoundingBox(){if(this.isDisposing)return;const{min:e,max:t}=this.renderer.getSceneBoundingBox(),r=a.Float3.subtract(t,e),i=a.Float3.length(r);this.radius=i}}t.RotatingCamera=o},3665:e=>{"use strict";function t(e){let t=e.length;for(;--t>=0;)e[t]=0}const r=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),a=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),i=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),o=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),n=new Array(576);t(n);const s=new Array(60);t(s);const l=new Array(512);t(l);const u=new Array(256);t(u);const d=new Array(29);t(d);const c=new Array(30);function h(e,t,r,a,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=a,this.max_length=i,this.has_stree=e&&e.length}let f,p,m;function g(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}t(c);const y=e=>e<256?l[e]:l[256+(e>>>7)],x=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},v=(e,t,r)=>{e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,x(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},b=(e,t,r)=>{v(e,r[2*t],r[2*t+1])},_=(e,t)=>{let r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1},F=(e,t,r)=>{const a=new Array(16);let i,o,n=0;for(i=1;i<=15;i++)n=n+r[i-1]<<1,a[i]=n;for(o=0;o<=t;o++){let t=e[2*o+1];0!==t&&(e[2*o]=_(a[t]++,t))}},C=e=>{let t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},w=e=>{e.bi_valid>8?x(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},M=(e,t,r,a)=>{const i=2*t,o=2*r;return e[i]<e[o]||e[i]===e[o]&&a[t]<=a[r]},S=(e,t,r)=>{const a=e.heap[r];let i=r<<1;for(;i<=e.heap_len&&(i<e.heap_len&&M(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!M(t,a,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=a},D=(e,t,i)=>{let o,n,s,l,h=0;if(0!==e.sym_next)do{o=255&e.pending_buf[e.sym_buf+h++],o+=(255&e.pending_buf[e.sym_buf+h++])<<8,n=e.pending_buf[e.sym_buf+h++],0===o?b(e,n,t):(s=u[n],b(e,s+256+1,t),l=r[s],0!==l&&(n-=d[s],v(e,n,l)),o--,s=y(o),b(e,s,i),l=a[s],0!==l&&(o-=c[s],v(e,o,l)))}while(h<e.sym_next);b(e,256,t)},A=(e,t)=>{const r=t.dyn_tree,a=t.stat_desc.static_tree,i=t.stat_desc.has_stree,o=t.stat_desc.elems;let n,s,l,u=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<o;n++)0!==r[2*n]?(e.heap[++e.heap_len]=u=n,e.depth[n]=0):r[2*n+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=u<2?++u:0,r[2*l]=1,e.depth[l]=0,e.opt_len--,i&&(e.static_len-=a[2*l+1]);for(t.max_code=u,n=e.heap_len>>1;n>=1;n--)S(e,r,n);l=o;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],S(e,r,1),s=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=s,r[2*l]=r[2*n]+r[2*s],e.depth[l]=(e.depth[n]>=e.depth[s]?e.depth[n]:e.depth[s])+1,r[2*n+1]=r[2*s+1]=l,e.heap[1]=l++,S(e,r,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const r=t.dyn_tree,a=t.max_code,i=t.stat_desc.static_tree,o=t.stat_desc.has_stree,n=t.stat_desc.extra_bits,s=t.stat_desc.extra_base,l=t.stat_desc.max_length;let u,d,c,h,f,p,m=0;for(h=0;h<=15;h++)e.bl_count[h]=0;for(r[2*e.heap[e.heap_max]+1]=0,u=e.heap_max+1;u<573;u++)d=e.heap[u],h=r[2*r[2*d+1]+1]+1,h>l&&(h=l,m++),r[2*d+1]=h,d>a||(e.bl_count[h]++,f=0,d>=s&&(f=n[d-s]),p=r[2*d],e.opt_len+=p*(h+f),o&&(e.static_len+=p*(i[2*d+1]+f)));if(0!==m){do{for(h=l-1;0===e.bl_count[h];)h--;e.bl_count[h]--,e.bl_count[h+1]+=2,e.bl_count[l]--,m-=2}while(m>0);for(h=l;0!==h;h--)for(d=e.bl_count[h];0!==d;)c=e.heap[--u],c>a||(r[2*c+1]!==h&&(e.opt_len+=(h-r[2*c+1])*r[2*c],r[2*c+1]=h),d--)}})(e,t),F(r,u,e.bl_count)},T=(e,t,r)=>{let a,i,o=-1,n=t[1],s=0,l=7,u=4;for(0===n&&(l=138,u=3),t[2*(r+1)+1]=65535,a=0;a<=r;a++)i=n,n=t[2*(a+1)+1],++s<l&&i===n||(s<u?e.bl_tree[2*i]+=s:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,o=i,0===n?(l=138,u=3):i===n?(l=6,u=3):(l=7,u=4))},E=(e,t,r)=>{let a,i,o=-1,n=t[1],s=0,l=7,u=4;for(0===n&&(l=138,u=3),a=0;a<=r;a++)if(i=n,n=t[2*(a+1)+1],!(++s<l&&i===n)){if(s<u)do{b(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==o&&(b(e,i,e.bl_tree),s--),b(e,16,e.bl_tree),v(e,s-3,2)):s<=10?(b(e,17,e.bl_tree),v(e,s-3,3)):(b(e,18,e.bl_tree),v(e,s-11,7));s=0,o=i,0===n?(l=138,u=3):i===n?(l=6,u=3):(l=7,u=4)}};let B=!1;const k=(e,t,r,a)=>{v(e,0+(a?1:0),3),w(e),x(e,r),x(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r};e.exports._tr_init=e=>{B||((()=>{let e,t,o,g,y;const x=new Array(16);for(o=0,g=0;g<28;g++)for(d[g]=o,e=0;e<1<<r[g];e++)u[o++]=g;for(u[o-1]=g,y=0,g=0;g<16;g++)for(c[g]=y,e=0;e<1<<a[g];e++)l[y++]=g;for(y>>=7;g<30;g++)for(c[g]=y<<7,e=0;e<1<<a[g]-7;e++)l[256+y++]=g;for(t=0;t<=15;t++)x[t]=0;for(e=0;e<=143;)n[2*e+1]=8,e++,x[8]++;for(;e<=255;)n[2*e+1]=9,e++,x[9]++;for(;e<=279;)n[2*e+1]=7,e++,x[7]++;for(;e<=287;)n[2*e+1]=8,e++,x[8]++;for(F(n,287,x),e=0;e<30;e++)s[2*e+1]=5,s[2*e]=_(e,5);f=new h(n,r,257,286,15),p=new h(s,a,0,30,15),m=new h(new Array(0),i,0,19,7)})(),B=!0),e.l_desc=new g(e.dyn_ltree,f),e.d_desc=new g(e.dyn_dtree,p),e.bl_desc=new g(e.bl_tree,m),e.bi_buf=0,e.bi_valid=0,C(e)},e.exports._tr_stored_block=k,e.exports._tr_flush_block=(e,t,r,a)=>{let i,l,u=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),A(e,e.l_desc),A(e,e.d_desc),u=(e=>{let t;for(T(e,e.dyn_ltree,e.l_desc.max_code),T(e,e.dyn_dtree,e.d_desc.max_code),A(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*o[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),i=e.opt_len+3+7>>>3,l=e.static_len+3+7>>>3,l<=i&&(i=l)):i=l=r+5,r+4<=i&&-1!==t?k(e,t,r,a):4===e.strategy||l===i?(v(e,2+(a?1:0),3),D(e,n,s)):(v(e,4+(a?1:0),3),((e,t,r,a)=>{let i;for(v(e,t-257,5),v(e,r-1,5),v(e,a-4,4),i=0;i<a;i++)v(e,e.bl_tree[2*o[i]+1],3);E(e,e.dyn_ltree,t-1),E(e,e.dyn_dtree,r-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,u+1),D(e,e.dyn_ltree,e.dyn_dtree)),C(e),a&&w(e)},e.exports._tr_tally=(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(u[r]+256+1)]++,e.dyn_dtree[2*y(t)]++),e.sym_next===e.sym_end),e.exports._tr_align=e=>{v(e,2,3),b(e,256,n),(e=>{16===e.bi_valid?(x(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}},3907:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},3975:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(6677),t),i(r(6085),t)},4176:(e,t)=>{"use strict";var r,a;Object.defineProperty(t,"__esModule",{value:!0}),t.getM2PixelShaderId=t.getM2VertexShaderId=t.getM2ShaderTableEntry=t.M2VertexShader=t.M2PixelShader=void 0,function(e){e[e.Combiners_Opaque=0]="Combiners_Opaque",e[e.Combiners_Mod=1]="Combiners_Mod",e[e.Combiners_Opaque_Mod=2]="Combiners_Opaque_Mod",e[e.Combiners_Opaque_Mod2x=3]="Combiners_Opaque_Mod2x",e[e.Combiners_Opaque_Mod2xNA=4]="Combiners_Opaque_Mod2xNA",e[e.Combiners_Opaque_Opaque=5]="Combiners_Opaque_Opaque",e[e.Combiners_Mod_Mod=6]="Combiners_Mod_Mod",e[e.Combiners_Mod_Mod2x=7]="Combiners_Mod_Mod2x",e[e.Combiners_Mod_Add=8]="Combiners_Mod_Add",e[e.Combiners_Mod_Mod2xNA=9]="Combiners_Mod_Mod2xNA",e[e.Combiners_Mod_AddNA=10]="Combiners_Mod_AddNA",e[e.Combiners_Mod_Opaque=11]="Combiners_Mod_Opaque",e[e.Combiners_Opaque_Mod2xNA_Alpha=12]="Combiners_Opaque_Mod2xNA_Alpha",e[e.Combiners_Opaque_AddAlpha=13]="Combiners_Opaque_AddAlpha",e[e.Combiners_Opaque_AddAlpha_Alpha=14]="Combiners_Opaque_AddAlpha_Alpha",e[e.Combiners_Opaque_Mod2xNA_Alpha_Add=15]="Combiners_Opaque_Mod2xNA_Alpha_Add",e[e.Combiners_Mod_AddAlpha=16]="Combiners_Mod_AddAlpha",e[e.Combiners_Mod_AddAlpha_Alpha=17]="Combiners_Mod_AddAlpha_Alpha",e[e.Combiners_Opaque_Alpha_Alpha=18]="Combiners_Opaque_Alpha_Alpha",e[e.Combiners_Opaque_Mod2xNA_Alpha_3s=19]="Combiners_Opaque_Mod2xNA_Alpha_3s",e[e.Combiners_Opaque_AddAlpha_Wgt=20]="Combiners_Opaque_AddAlpha_Wgt",e[e.Combiners_Mod_Add_Alpha=21]="Combiners_Mod_Add_Alpha",e[e.Combiners_Opaque_ModNA_Alpha=22]="Combiners_Opaque_ModNA_Alpha",e[e.Combiners_Mod_AddAlpha_Wgt=23]="Combiners_Mod_AddAlpha_Wgt",e[e.Combiners_Opaque_Mod_Add_Wgt=24]="Combiners_Opaque_Mod_Add_Wgt",e[e.Combiners_Opaque_Mod2xNA_Alpha_UnshAlpha=25]="Combiners_Opaque_Mod2xNA_Alpha_UnshAlpha",e[e.Combiners_Mod_Dual_Crossfade=26]="Combiners_Mod_Dual_Crossfade",e[e.Combiners_Opaque_Mod2xNA_Alpha_Alpha=27]="Combiners_Opaque_Mod2xNA_Alpha_Alpha",e[e.Combiners_Mod_Masked_Dual_Crossfade=28]="Combiners_Mod_Masked_Dual_Crossfade",e[e.Combiners_Opaque_Alpha=29]="Combiners_Opaque_Alpha",e[e.Guild=30]="Guild",e[e.Guild_NoBorder=31]="Guild_NoBorder",e[e.Guild_Opaque=32]="Guild_Opaque",e[e.Combiners_Mod_Depth=33]="Combiners_Mod_Depth",e[e.Illum=34]="Illum",e[e.Combiners_Mod_Mod_Mod_Const=35]="Combiners_Mod_Mod_Mod_Const",e[e.NewUnkCombiner=36]="NewUnkCombiner"}(r||(t.M2PixelShader=r={})),function(e){e[e.Diffuse_T1=0]="Diffuse_T1",e[e.Diffuse_Env=1]="Diffuse_Env",e[e.Diffuse_T1_T2=2]="Diffuse_T1_T2",e[e.Diffuse_T1_Env=3]="Diffuse_T1_Env",e[e.Diffuse_Env_T1=4]="Diffuse_Env_T1",e[e.Diffuse_Env_Env=5]="Diffuse_Env_Env",e[e.Diffuse_T1_Env_T1=6]="Diffuse_T1_Env_T1",e[e.Diffuse_T1_T1=7]="Diffuse_T1_T1",e[e.Diffuse_T1_T1_T1=8]="Diffuse_T1_T1_T1",e[e.Diffuse_EdgeFade_T1=9]="Diffuse_EdgeFade_T1",e[e.Diffuse_T2=10]="Diffuse_T2",e[e.Diffuse_T1_Env_T2=11]="Diffuse_T1_Env_T2",e[e.Diffuse_EdgeFade_T1_T2=12]="Diffuse_EdgeFade_T1_T2",e[e.Diffuse_EdgeFade_Env=13]="Diffuse_EdgeFade_Env",e[e.Diffuse_T1_T2_T1=14]="Diffuse_T1_T2_T1",e[e.Diffuse_T1_T2_T3=15]="Diffuse_T1_T2_T3",e[e.Color_T1_T2_T3=16]="Color_T1_T2_T3",e[e.BW_Diffuse_T1=17]="BW_Diffuse_T1",e[e.BW_Diffuse_T1_T2=18]="BW_Diffuse_T1_T2"}(a||(t.M2VertexShader=a={}));const i=[[r.Combiners_Opaque_Mod2xNA_Alpha,a.Diffuse_T1_Env],[r.Combiners_Opaque_AddAlpha,a.Diffuse_T1_Env],[r.Combiners_Opaque_AddAlpha_Alpha,a.Diffuse_T1_Env],[r.Combiners_Opaque_Mod2xNA_Alpha_Add,a.Diffuse_T1_Env_T1],[r.Combiners_Mod_AddAlpha,a.Diffuse_T1_Env],[r.Combiners_Opaque_AddAlpha,a.Diffuse_T1_T1],[r.Combiners_Mod_AddAlpha,a.Diffuse_T1_T1],[r.Combiners_Mod_AddAlpha_Alpha,a.Diffuse_T1_Env],[r.Combiners_Opaque_Alpha_Alpha,a.Diffuse_T1_Env],[r.Combiners_Opaque_Mod2xNA_Alpha_3s,a.Diffuse_T1_Env_T1],[r.Combiners_Opaque_AddAlpha_Wgt,a.Diffuse_T1_T1],[r.Combiners_Mod_Add_Alpha,a.Diffuse_T1_Env],[r.Combiners_Opaque_ModNA_Alpha,a.Diffuse_T1_Env],[r.Combiners_Mod_AddAlpha_Wgt,a.Diffuse_T1_Env],[r.Combiners_Mod_AddAlpha_Wgt,a.Diffuse_T1_T1],[r.Combiners_Opaque_AddAlpha_Wgt,a.Diffuse_T1_T2],[r.Combiners_Opaque_Mod_Add_Wgt,a.Diffuse_T1_Env],[r.Combiners_Opaque_Mod2xNA_Alpha_UnshAlpha,a.Diffuse_T1_Env_T1],[r.Combiners_Mod_Dual_Crossfade,a.Diffuse_T1],[r.Combiners_Mod_Depth,a.Diffuse_EdgeFade_T1],[r.Combiners_Opaque_Mod2xNA_Alpha_Alpha,a.Diffuse_T1_Env_T2],[r.Combiners_Mod_Mod,a.Diffuse_EdgeFade_T1_T2],[r.Combiners_Mod_Masked_Dual_Crossfade,a.Diffuse_T1_T2],[r.Combiners_Opaque_Alpha,a.Diffuse_T1_T1],[r.Combiners_Opaque_Mod2xNA_Alpha_UnshAlpha,a.Diffuse_T1_Env_T2],[r.Combiners_Mod_Depth,a.Diffuse_EdgeFade_Env],[r.Guild,a.Diffuse_T1_T2_T1],[r.Guild_NoBorder,a.Diffuse_T1_T2],[r.Guild_Opaque,a.Diffuse_T1_T2_T1],[r.Illum,a.Diffuse_T1_T1],[r.Combiners_Mod_Mod_Mod_Const,a.Diffuse_T1_T2_T3],[r.Combiners_Mod_Mod_Mod_Const,a.Color_T1_T2_T3],[r.Combiners_Opaque,a.Diffuse_T1],[r.Combiners_Mod_Mod2x,a.Diffuse_EdgeFade_T1_T2],[r.Combiners_Mod,a.Diffuse_EdgeFade_T1],[r.NewUnkCombiner,a.Diffuse_EdgeFade_T1_T2]];t.getM2ShaderTableEntry=e=>{const t=32767&e;if(t>=i.length)throw"Wrong shaderId for vertex shader";return i[t]},t.getM2VertexShaderId=(e,r)=>(32768&e&&(0,t.getM2ShaderTableEntry)(e)[1],1==r?128&e?a.Diffuse_Env:16384&e?a.Diffuse_T2:a.Diffuse_T1:128&e?8&e?a.Diffuse_Env_Env:a.Diffuse_Env_T1:8&e?a.Diffuse_T1_Env:16384&e?a.Diffuse_T1_T2:a.Diffuse_T1_T1),t.getM2PixelShaderId=(e,a)=>{if(32768&e)return(0,t.getM2ShaderTableEntry)(e)[0];if(1===a)return 112&e?r.Combiners_Mod:r.Combiners_Opaque;if(112&e)switch(7&e){case 0:return r.Combiners_Mod_Opaque;case 3:return r.Combiners_Mod_Add;case 4:return r.Combiners_Mod_Mod2x;case 6:return r.Combiners_Mod_Mod2xNA;case 7:return r.Combiners_Mod_AddNA;default:return r.Combiners_Mod_Mod}else switch(7&e){case 0:return r.Combiners_Opaque_Opaque;case 3:case 7:return r.Combiners_Opaque_AddAlpha;case 4:return r.Combiners_Opaque_Mod2x;case 6:return r.Combiners_Opaque_Mod2xNA;default:return r.Combiners_Opaque_Mod}}},4271:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ItemVisualModel=void 0;const a=r(1639),i=r(8521);class o extends i.WorldPositionedObject{constructor(e,t){super(),this.objectFactory=t,this.dataManager=e,this.effectModels=[]}get isLoaded(){return null!=this.itemVisualMetadata&&this.effectsLoaded}attachToRenderer(e){super.attachToRenderer(e),this.itemVisualId&&!this.isLoaded&&this.dataManager.getItemVisualMetadata(this.itemVisualId).then(this.onItemVisualMetadataLoaded.bind(this))}attachTo(e){this.isDisposing||(this.attachedItemModel=e,this.attachedItemModel.once("componentsLoaded",(()=>{this.attachedItemComponentModel=this.attachedItemModel.component1,this.attachedItemComponentModel.addChild(this),this.updateModelMatrixFromParent()})))}loadItemVisualId(e){this.isDisposing||this.itemVisualId!==e&&(this.itemVisualId=e,this.renderer&&this.dataManager.getItemVisualMetadata(this.itemVisualId).then(this.onItemVisualMetadataLoaded.bind(this)))}update(e){if(!this.isDisposing)for(const t of this.effectModels)t.update(e)}draw(){if(!this.isDisposing)for(const e of this.effectModels)e.draw()}dispose(){if(!this.isDisposing){super.dispose();for(const e of this.effectModels)e.dispose();this.effectModels=null,this.attachedItemModel=null,this.attachedItemComponentModel=null,this.itemVisualMetadata=null,this.dataManager=null,this.objectFactory=null}}pauseAnimation(){this.once("effectsLoaded",(()=>{for(const e of this.children)e.pauseAnimation()}))}resumeAnimation(){this.once("effectsLoaded",(()=>{for(const e of this.children)e.resumeAnimation()}))}canExecuteCallbackNow(e){switch(e){case"effectsLoaded":return this.effectsLoaded;case"metadataLoaded":return null!=this.itemVisualMetadata}return super.canExecuteCallbackNow(e)}onItemVisualMetadataLoaded(e){e?this.isDisposing||this.attachedItemModel&&(this.itemVisualMetadata=e,this.attachedItemModel.once("componentsLoaded",(()=>{const e=[];for(let t=0;t<this.itemVisualMetadata.effects.length;t++){const r=this.itemVisualMetadata.effects[t];if(-1===r.subClassId||r.subClassId==this.attachedItemModel.subClassId){if(r.modelFileDataId){const t=this.objectFactory.createM2Model(r.modelFileDataId);this.effectModels.push(t),this.addChild(t),t.once("disposed",(()=>this.dispose()));const i=a.Float3.create(r.scale,r.scale,r.scale);t.scale=i;const o=r.attachmentId-1;if(-1!==o){const e=this.attachedItemComponentModel.getAttachment(o);this.attachedItemComponentModel.addAttachedModel(t,e)}e.push(t.onceAsync("loaded"))}if(r.spellVisualKitId){const e=this.objectFactory.createSpellVisualKit(r.spellVisualKitId),t=this.attachedItemComponentModel?this.attachedItemComponentModel:this.attachedItemModel.character;t&&e.attachTo(t),this.addChild(e)}}}Promise.all(e).then((()=>{this.effectsLoaded=!0,this.processCallbacks("effectsLoaded"),this.processCallbacks("loaded")}))})),this.processCallbacks("metadataLoaded")):this.dispose()}}t.ItemVisualModel=o},4312:(e,t)=>{"use strict";var r,a,i,o;Object.defineProperty(t,"__esModule",{value:!0}),t.PositionerStateEntryType=t.SpellVisualEffectNameType=t.CurveType=t.SpellVisualKitEffectType=void 0,function(e){e[e.None=0]="None",e[e.Procedural=1]="Procedural",e[e.ModelAttach=2]="ModelAttach",e[e.CameraEffect=3]="CameraEffect",e[e.CameraEffect2=4]="CameraEffect2",e[e.SoundKit=5]="SoundKit",e[e.SpellVisualAnim=6]="SpellVisualAnim",e[e.Shadowy=7]="Shadowy",e[e.Emission=8]="Emission",e[e.Outline=9]="Outline",e[e.UnitSoundType=10]="UnitSoundType",e[e.Dissolve=11]="Dissolve",e[e.EdgeGlow=12]="EdgeGlow",e[e.Beam=13]="Beam",e[e.ClientScene=14]="ClientScene",e[e.Unknown1=15]="Unknown1",e[e.Gradient=16]="Gradient",e[e.Barrage=17]="Barrage",e[e.Rope=18]="Rope",e[e.Screen=19]="Screen"}(r||(t.SpellVisualKitEffectType=r={})),function(e){e[e.Linear=0]="Linear",e[e.Cubic=1]="Cubic",e[e.Bezier=2]="Bezier",e[e.Cosine=3]="Cosine"}(a||(t.CurveType=a={})),function(e){e[e.FileDataID=0]="FileDataID",e[e.Item=1]="Item",e[e.CreatureDisplayInfo=2]="CreatureDisplayInfo",e[e.Unk1=3]="Unk1",e[e.Unk2=4]="Unk2",e[e.Unk3=5]="Unk3",e[e.Unk4=6]="Unk4",e[e.Unk5=7]="Unk5",e[e.Unk6=8]="Unk6",e[e.Unk7=9]="Unk7",e[e.Unk8=10]="Unk8"}(i||(t.SpellVisualEffectNameType=i={})),function(e){e[e.Position=0]="Position",e[e.Rotation=1]="Rotation",e[e.Scale=2]="Scale"}(o||(t.PositionerStateEntryType=o={}))},4337:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readInt2=function(e){return[e.readInt32LE(),e.readInt32LE()]},t.readFloat2=function(e){return a.Float2.create(e.readFloatLE(),e.readFloatLE())},t.readFloat3=i,t.readFloat4=function(e){return a.Float4.create(e.readFloatLE(),e.readFloatLE(),e.readFloatLE(),e.readFloatLE())},t.readQuaternion=function(e){return a.Float4.create(-e.readFloatLE(),-e.readFloatLE(),-e.readFloatLE(),e.readFloatLE())},t.readColor=function(e){return[e.readUInt8(),e.readUInt8(),e.readUInt8(),e.readUInt8()]},t.readFloat44=function(e){return a.Float44.create(e.readFloatLE(),e.readFloatLE(),e.readFloatLE(),e.readFloatLE(),e.readFloatLE(),e.readFloatLE(),e.readFloatLE(),e.readFloatLE(),e.readFloatLE(),e.readFloatLE(),e.readFloatLE(),e.readFloatLE(),e.readFloatLE(),e.readFloatLE(),e.readFloatLE(),e.readFloatLE())},t.readAABB=function(e){return a.AABB.create(i(e),i(e))},t.readString=function(e){const t=new Uint8Array(o(e,(e=>e.readUInt8())));return(new TextDecoder).decode(t)},t.readArray=o;const a=r(1639);function i(e){return a.Float3.create(e.readFloatLE(),e.readFloatLE(),e.readFloatLE())}function o(e,t){const r=e.readInt32LE();if(r>0){const a=new Array(r);for(let i=0;i<r;i++)a[i]=t(e,i);return a}return[]}},4442:e=>{"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},4510:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isWorldPositionedObject=function(e){return e&&e.worldModelMatrix&&e.worldBoundingBox}},4521:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OrbitalCamera=t.DragOperation=void 0;const a=r(1639),i=r(8204);var o;!function(e){e[e.None=0]="None",e[e.Rotation=1]="Rotation",e[e.Translation=2]="Translation"}(o||(t.DragOperation=o={}));class n extends i.Disposable{constructor(e,t=!0,r=1,i=3){super(),this.resizeOnSceneExpand=t,this.containerElement=e,this.cameraMatrix=a.Float44.identity(),this.viewMatrix=a.Float44.identity(),this.currentDragOperation=o.None,this.targetLocation=a.Float3.create(0,0,0),this.upDir=a.Float3.create(0,0,1),this.cameraTranslation=a.Float3.zero(),this.theta=Math.PI/4,this.phi=0,this.currentRadius=500,this.minRadius=200,this.minRadiusFactor=r,this.maxRadius=1e3,this.maxRadiusFactor=i,this.zoomFactor=20,this.currentZoom=0,this.zoomDecay=.7,this.position=a.Float3.fromSpherical(this.currentRadius,this.theta,this.phi),a.Float3.add(this.position,this.targetLocation),a.Float44.lookAt(this.position,this.targetLocation,this.upDir,this.cameraMatrix)}getViewMatrix(){return this.isDisposing?a.Float44.identity():this.viewMatrix}attachToRenderer(e){if(this.isDisposing)return;this.renderer=e,this.onContextMenu=e=>(e.preventDefault(),!1),this.onMouseDown=this.handleMouseDown.bind(this),this.onTouchStart=this.handleTouchStart.bind(this),this.onWheel=this.handleWheel.bind(this),this.containerElement.addEventListener("contextmenu",this.onContextMenu),this.containerElement.addEventListener("mousedown",this.onMouseDown),this.containerElement.addEventListener("touchstart",this.onTouchStart),this.containerElement.addEventListener("wheel",this.onWheel);const t=this.containerElement.getBoundingClientRect();this.containerWidth=t.width,this.containerHeight=t.height,document&&(this.onMouseUp=this.handleDragRelease.bind(this),this.onTouchEnd=this.handleDragRelease.bind(this),this.onMouseMove=this.handleMouseMove.bind(this),this.onTouchMove=this.handleTouchMove.bind(this),document.addEventListener("mouseup",this.onMouseUp),document.addEventListener("touchend",this.onTouchEnd),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("touchmove",this.onTouchMove)),this.resizeOnSceneExpand&&(this.scaleToSceneBoundingBox(),this.resizeCallbackFn=()=>{this.scaleToSceneBoundingBox()},this.renderer.on("sceneBoundingBoxUpdate",this.resizeCallbackFn))}update(e){this.isDisposing||(0!=this.currentZoom&&(this.currentRadius=this.currentRadius+this.currentZoom*this.zoomFactor,this.currentRadius=Math.min(Math.max(this.minRadius,this.currentRadius),this.maxRadius),this.currentZoom*=this.zoomDecay,this.currentZoom<1e-4&&(this.currentZoom=0),a.Float3.fromSpherical(this.currentRadius,this.theta,this.phi,this.position)),a.Float44.lookAt(this.position,this.targetLocation,this.upDir,this.cameraMatrix),a.Float44.translate(this.cameraMatrix,this.cameraTranslation,this.cameraMatrix),a.Float44.invert(this.cameraMatrix,this.viewMatrix))}dispose(){this.isDisposing||(super.dispose(),this.renderer.off("sceneBoundingBoxUpdate",this.resizeCallbackFn),this.containerElement.removeEventListener("contextmenu",this.onContextMenu),this.containerElement.removeEventListener("mousedown",this.onMouseDown),this.containerElement.removeEventListener("touchstart",this.onTouchStart),this.containerElement.removeEventListener("wheel",this.onWheel),this.onContextMenu=null,this.onMouseDown=null,this.onTouchStart=null,this.onWheel=null,document&&(document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("touchend",this.onTouchEnd),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("touchmove",this.onTouchMove),this.onMouseUp=null,this.onTouchEnd=null,this.onMouseMove=null,this.onTouchMove=null),this.containerElement=null,this.viewMatrix=null,this.cameraMatrix=null,this.targetLocation=null,this.upDir=null,this.cameraTranslation=null,this.renderer=null)}handleMouseDown(e){2==e.button||e.ctrlKey?this.currentDragOperation=o.Translation:this.currentDragOperation=o.Rotation,this.lastDragX=e.clientX,this.lastDragY=e.clientY,e.preventDefault()}handleTouchStart(e){this.currentDragOperation=o.Rotation,this.lastDragX=e.touches[0].clientX,this.lastDragY=e.touches[0].clientY,e.preventDefault()}handleMouseMove(e){this.handleDrag(e.x,e.y)}handleTouchMove(e){this.handleDrag(e.touches[0].clientX,e.touches[0].clientY)}handleDrag(e,t){if(this.isDisposing)return;if(this.currentDragOperation===o.None)return;const r=(e-this.lastDragX)/this.containerWidth,i=(t-this.lastDragY)/this.containerHeight;if(this.currentDragOperation===o.Translation){const e=a.Float3.create(-r*this.currentRadius,i*this.currentRadius,0);a.Float3.add(this.cameraTranslation,e,this.cameraTranslation)}else{const e=Math.PI,t=r*e,o=i*e;this.theta=Math.min(Math.max(this.theta-o-o,.25),Math.PI-.25),this.phi-=t,a.Float3.fromSpherical(this.currentRadius,this.theta,this.phi,this.position)}this.lastDragX=e,this.lastDragY=t}handleDragRelease(){this.currentDragOperation=o.None}handleWheel(e){this.currentZoom=e.deltaY<0?-1:1,e.preventDefault()}scaleToSceneBoundingBox(){if(this.isDisposing)return;const e=this.renderer.getSceneBoundingBox(),t=a.AABB.sphereRadius(e);this.minRadius=t*this.minRadiusFactor,this.currentRadius=this.maxRadiusFactor/2*t,this.maxRadius=this.maxRadiusFactor*t,this.zoomFactor=this.maxRadius/50,a.Float3.zero(this.cameraTranslation),a.Float3.fromSpherical(this.currentRadius,this.theta,this.phi,this.position)}}t.OrbitalCamera=n},4540:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WmoShaderBuilder=void 0;const a=r(2690),i={a_position:0,a_normal:1,a_color1:2,a_color2:3,a_texCoord1:4,a_texCoord2:5,a_texCoord3:6};t.WmoShaderBuilder=class{static getAttribLocations(){return i}static getShaderProgram(e,t,r){const a=this.getShaderName(r),[i,o]=this.getShaderProgramTexts(e,r);return e.getShaderProgram(t,a,i,o,this.getAttribLocations())}static getShaderName(e){const t=(0,a.getWMOVertexShader)(e),r=(0,a.getWMOPixelShader)(e);return"WMO-"+a.WMOVertexShader[t]+"-"+a.WMOPixelShader[r]}static getShaderProgramTexts(e,t){const r=(0,a.getWMOVertexShader)(t),i=(0,a.getWMOPixelShader)(t);return[this.getVertProgramText(r),this.getFragProgramText(e,i)]}static getAttribLocation(e){return i[e]}static getVertProgramText(e){return`precision mediump float;\n\nuniform mat4 u_modelMatrix;\nuniform mat4 u_viewMatrix;\nuniform mat4 u_projectionMatrix;\n\nvarying vec2 v_texCoord1;\nvarying vec2 v_texCoord2;\nvarying vec2 v_texCoord3;\nvarying vec4 v_color1;\nvarying vec4 v_color2;\nvarying vec3 v_normal;\nvarying vec3 v_position;\n\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec4 a_color1;\nattribute vec4 a_color2;\nattribute vec2 a_texCoord1;\nattribute vec2 a_texCoord2;\nattribute vec2 a_texCoord3;\n\nvec3 normalizedMatrixMultiply(mat4 matrix, vec3 vector) {\n    // Pull out the squared scaling.\n    vec3 t_SqScale = vec3(\n        dot(matrix[0], matrix[0]), \n        dot(matrix[1], matrix[1]), \n        dot(matrix[2], matrix[2])\n    );\n    return normalize(matrix * vec4(vector / t_SqScale, 0.0)).xyz;\n}\n\nvec2 posToTexCoord(vec3 pos, vec3 normal) {\n    vec3 reflection = reflect(normalize(pos), normal);\n    return normalize(reflection).xy * 0.5 + vec2(0.5);\n}   \n\nvoid main() {\n    v_position = (u_modelMatrix * vec4(a_position, 1.0)).xyz;\n    v_normal = normalizedMatrixMultiply(u_modelMatrix, a_normal);\n    v_color1 = a_color1.bgra * vec4(1/255);\n    v_color2 = a_color2 * vec4(1/255);\n\n    vec3 viewPosition = (u_viewMatrix * vec4(v_position, 1.0)).xyz;\n    vec3 viewNormal = (u_viewMatrix * vec4(v_normal, 0.0)).xyz;\n    gl_Position = u_projectionMatrix * vec4(viewPosition, 1.0);\n\n    ${this.getVertexShaderText(e)}\n}\n`}static getFragProgramText(e,t){return`\nprecision mediump float;\n\nuniform vec3 u_cameraPos;\n\n${e.getLightingUniforms()}\n\nuniform int u_blendMode;\nuniform bool u_unlit;\n\nuniform sampler2D u_texture1;\nuniform sampler2D u_texture2;\nuniform sampler2D u_texture3;\n\nvarying vec2 v_texCoord1;\nvarying vec2 v_texCoord2;\nvarying vec2 v_texCoord3;\nvarying vec4 v_color1;\nvarying vec4 v_color2;\nvarying vec3 v_normal;\nvarying vec3 v_position;\n\nfloat saturate(float v) { return clamp(v, 0.0, 1.0); }\n\n${e.getLightingFunction()}\n\nvec3 calculateSpecular(float texAlpha) {\n    vec3 normal = normalize(v_normal);\n\n    vec3 sunDir = vec3(0.);\n    vec3 sunColor = vec3(0.);\n\n    if (u_applyInteriorLighting) {\n        sunDir = -u_interiorDirectColorDir;\n        sunColor = u_interiorDirectColor.rgb;\n    } else {\n        sunDir = u_exteriorDirectColorDir;\n        sunColor = u_exteriorDirectColor.rgb;\n    }\n\n    vec3 eyeDir = normalize(u_cameraPos - v_position.xyz);\n    vec3 halfDir = normalize(sunDir + eyeDir);\n    float attenuationDir = saturate(dot(normal, sunDir));\n    float spec = 1.25 * pow(saturate(dot(normal, halfDir)), 8.0);\n    vec3 specTerm = vec3(mix(pow((1.0 - saturate(dot(sunDir, halfDir))), 5.0), 1.0, texAlpha)) * spec * sunColor.rgb * attenuationDir;\n    return specTerm;\n}\n\nvoid main() {\n    vec4 texture1 = texture2D(u_texture1, v_texCoord1);\n    vec4 texture2 = texture2D(u_texture2, v_texCoord2);\n    vec4 texture3 = texture2D(u_texture3, v_texCoord3);\n\n    // BlendMode AlphaKey\n    if (u_blendMode > 0) {\n        if (texture1.a < 0.501960814) {\n            discard;\n        }\n    }\n\n    vec4 outputColor = vec4(0.0, 0.0, 0.0, 1.0);\n    vec3 materialColor = vec3(0.0);\n    vec3 specular = vec3(0.0);\n    vec3 emissiveColor = vec3(0.0);\n    float finalOpacity = 0.0;\n    float distFade = 1.0;\n\n    ${this.getPixelShaderText(t)}\n\n    outputColor.rgb = light(!u_unlit, materialColor, v_normal, v_color1.rgb, specular, emissiveColor);\n    \n    gl_FragColor = outputColor;\n}\n`}static getVertexShaderText(e){switch(e){case a.WMOVertexShader.None:return"\nv_texCoord1 = a_texCoord1;\nv_texCoord2 = a_texCoord2;\nv_texCoord3 = a_texCoord3;\n        ";case a.WMOVertexShader.DiffuseT1:return";\nv_texCoord1 = a_texCoord1;\nv_texCoord2 = a_texCoord2; \nv_texCoord3 = a_texCoord3; \n        ";case a.WMOVertexShader.DiffuseT1Refl:return"\nv_texCoord1 = a_texCoord1;\nv_texCoord2 = reflect(normalize(viewPosition), viewNormal).xy;\nv_texCoord3 = a_texCoord3; \n        ";case a.WMOVertexShader.DiffuseT1EnvT2:return"\nv_texCoord1 = a_texCoord1;\nv_texCoord2 = posToTexCoord(viewPosition, viewNormal);\nv_texCoord3 = a_texCoord3;\n        ";case a.WMOVertexShader.SpecularT1:case a.WMOVertexShader.DiffuseComp:return"\nv_texCoord1 = a_texCoord1;\nv_texCoord2 = a_texCoord2; \nv_texCoord3 = a_texCoord3; \n        ";case a.WMOVertexShader.DiffuseCompRefl:return"\nv_texCoord1 = a_texCoord1;\nv_texCoord2 = a_texCoord2;\nv_texCoord3 = reflect(normalize(viewPosition), viewNormal).xy;\n        ";case a.WMOVertexShader.DiffuseCompTerrain:case a.WMOVertexShader.DiffuseCompAlpha:return"\nv_texCoord1 = a_texCoord1;\nv_texCoord2 = viewPosition.xy * -0.239999995;\nv_texCoord3 = a_texCoord3; \n        ";case a.WMOVertexShader.Parallax:return"\nv_texCoord1 = a_texCoord1;\nv_texCoord2 = a_texCoord2;\nv_texCoord3 = a_texCoord3;\n        ";default:throw new Error("Unknown WMO vertex shader: "+e)}}static getPixelShaderText(e){switch(e){case a.WMOPixelShader.None:return"\nmaterialColor = texture1.rgb * texture2.rgb;\nfinalOpacity = texture1.a;\n";case a.WMOPixelShader.Diffuse:return"\nmaterialColor = texture1.rgb;\nfinalOpacity = texture1.a;\n";case a.WMOPixelShader.Specular:return"\nmaterialColor = texture1.rgb;\nspecular = calculateSpecular(texture1.a);\nfinalOpacity = texture1.a;\n";case a.WMOPixelShader.Metal:return"\nmaterialColor = texture1.rgb;\nspecular = calculateSpecular(((texture1 * 4.0) * texture1.a).x);\nfinalOpacity = texture1.a;\n";case a.WMOPixelShader.Env:return"\nmaterialColor = texture1.rgb ;\nemissiveColor = texture2.rgb * texture1.a * distFade;\nfinalOpacity = 1.0;\n";case a.WMOPixelShader.Opaque:return"\nmaterialColor = texture1.rgb ;\nfinalOpacity = 1.0;\n";case a.WMOPixelShader.EnvMetal:return"\nmaterialColor = texture1.rgb ;\nemissiveColor = (((texture1.rgb * texture1.a) * texture2.rgb) * distFade);\nfinalOpacity = 1.0;\n";case a.WMOPixelShader.TwoLayerDiffuse:return"\nvec3 layer1 = texture1.rgb;\nvec3 layer2 = mix(layer1, texture2.rgb, texture2.a);\nmaterialColor = mix(layer2, layer1, v_color2.a);\nfinalOpacity = texture1.a;\n";case a.WMOPixelShader.TwoLayerEnvMetal:return"\nvec4 colorMix = mix(texture1, texture2, 1.0 - v_color2.a);\nmaterialColor = colorMix.rgb ;\nemissiveColor = (colorMix.rgb * colorMix.a) * texture3.rgb * distFade;\nfinalOpacity = texture1.a;\n";case a.WMOPixelShader.TwoLayerTerrain:return"\nvec3 layer1 = texture1.rgb;\nvec3 layer2 = texture2.rgb;\nmaterialColor = mix(layer2, layer1, v_color2.a);\nspecular = calculateSpecular(texture2.a * (1.0 - v_color2.a));\nfinalOpacity = texture1.a;\n";case a.WMOPixelShader.DiffuseEmissive:return"\nmaterialColor = texture1.rgb ;\nemissiveColor = texture2.rgb * texture2.a * v_color2.a;\nfinalOpacity = texture1.a;\n";case a.WMOPixelShader.MaskedEnvMetal:return"\nfloat mixFactor = clamp((texture3.a * v_color2.a), 0.0, 1.0);\nmaterialColor =\n    mix(mix(((texture1.rgb * texture2.rgb) * 2.0), texture3.rgb, mixFactor), texture1.rgb, texture1.a);\nfinalOpacity = texture1.a;\n";case a.WMOPixelShader.EnvMetalEmissive:return"\nmaterialColor = texture1.rgb ;\nemissiveColor =\n    (\n        ((texture1.rgb * texture1.a) * texture2.rgb) +\n        ((texture3.rgb * texture3.a) * v_color2.a)\n    );\nfinalOpacity = texture1.a;\n";case a.WMOPixelShader.TwoLayerDiffuseOpaque:return"\nmaterialColor = mix(texture2.rgb, texture1.rgb, v_color2.a);\nfinalOpacity = 1.0;\n";case a.WMOPixelShader.TwoLayerDiffuseEmissive:return"\nvec3 t1diffuse = (texture2.rgb * (1.0 - texture2.a));\nmaterialColor = mix(t1diffuse, texture1.rgb, v_color2.a);\nemissiveColor = (texture2.rgb * texture2.a) * (1.0 - v_color2.a);\nfinalOpacity = texture1.a;\n";case a.WMOPixelShader.AdditiveMaskedEnvMetal:return"\nmaterialColor = mix(\n    (texture1.rgb * texture2.rgb * 2.0) + (texture3.rgb * clamp(texture3.a * v_color2.a, 0.0, 1.0)),\n    texture1.rgb,\n    vec3(texture1.a)\n);\nfinalOpacity = 1.0;\n";case a.WMOPixelShader.TwoLayerDiffuseMod2x:return"\nvec3 layer1 = texture1.rgb;\nvec3 layer2 = mix(layer1, texture2.rgb, vec3(texture2.a));\nvec3 layer3 = mix(layer2, layer1, vec3(v_color2.a));\nmaterialColor = layer3 * texture3.rgb * 2.0;\nfinalOpacity = texture1.a;\n";case a.WMOPixelShader.TwoLayerDiffuseMod2xNA:return"\nvec3 layer1 = ((texture1.rgb * texture2.rgb) * 2.0);\nmaterialColor = mix(texture1.rgb, layer1, vec3(v_color2.a));\nfinalOpacity = texture1.a;\n";case a.WMOPixelShader.TwoLayerDiffuseAlpha:return"\nvec3 layer1 = texture1.rgb;\nvec3 layer2 = mix(layer1, texture2.rgb, vec3(texture2.a));\nvec3 layer3 = mix(layer2, layer1, vec3(texture3.a));\nmaterialColor = ((layer3 * texture3.rgb) * 2.0);\nfinalOpacity = texture1.a;\n";case a.WMOPixelShader.Lod:return"\nmaterialColor = texture1.rgb;\nfinalOpacity = texture1.a;\n";default:throw new Error("Unknown WMO Pixel Shader: "+e)}}}},4674:e=>{"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},4741:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnimationState=void 0;const a=r(2462),i=r(1639),o=r(8204),n=(e,t,r)=>e+r*(t-e),s=e=>e;class l extends o.Disposable{constructor(e,t){super(),this.animations=e,this.currentAnimActiveTime=0,this.nextAnimActiveTime=0,this.blendFactor=1,this.globalLoops=t,this.globalTimers=new Array(this.globalLoops.length);for(let e=0;e<this.globalTimers.length;e++)this.globalTimers[e]=0;this.speed=1}dispose(){this.isDisposing||(super.dispose(),this.animations=null,this.globalTimers=null,this.globalLoops=null,this.currentAnimation=null,this.nextAnimation=null)}useAnimation(e){this.currentAnimActiveTime=0,this.currentAnimation=this.animations.find((t=>t.id===e&&0===t.variationIndex)),this.currentAnimation||(this.currentAnimation=this.animations.find((e=>0===e.id&&0===e.variationIndex))),this.blendFactor=0,this.getNextVariation()}update(e){if(this.isPaused)return;this.currentAnimActiveTime+=e*this.speed;for(let t=0;t<this.globalTimers.length;t++)this.globalTimers[t]+=e,this.globalLoops[t]>0&&(this.globalTimers[t]%=this.globalLoops[t]);let t=this.currentAnimation.duration-this.currentAnimActiveTime;if(this.nextAnimation){const e=this.nextAnimation.blendTimeIn;e>0&&t<e?(this.nextAnimActiveTime=(e-t)%this.nextAnimation.duration,this.blendFactor=t/e):this.blendFactor=1}t<=0&&(this.nextAnimation?(this.currentAnimation=this.nextAnimation,this.currentAnimActiveTime=this.nextAnimActiveTime,this.getNextVariation()):this.currentAnimActiveTime%=this.currentAnimation.duration)}getNextVariation(){if(this.nextAnimation=this.currentAnimation,this.nextAnimActiveTime=0,this.currentAnimation.variationNext>-1){let e=32767*Math.random(),t=0;for(t+=this.animations[this.currentAnimation.variationNext].frequency;t<e&&this.nextAnimation.variationNext>-1;)this.nextAnimation=this.animations[this.currentAnimation.variationNext],t+=this.nextAnimation.frequency}else{const e=this.animations.find((e=>e.id==this.currentAnimation.id&&0===e.variationIndex));e&&(this.nextAnimation=e)}for(;!(a.WoWAnimationFlags.PrimaryBoneSequence&this.nextAnimation.flags)&&(a.WoWAnimationFlags.IsAlias&this.nextAnimation.flags)>0;)this.nextAnimation=this.animations[this.nextAnimation.aliasNext]}hasAnimatedValuesForTrack(e){if(!e||!e.animations.length)return!1;let t=this.currentAnimation.id;this.currentAnimation.id>e.animations.length&&(t=0);const r=e.animations[t];return r&&r.timeStamps.length>0}getFloat3TrackValue(e,t,r){return this.getTrackValueInt(i.Float3.lerp,i.Float3.copy,e,t,r)}getFloat4TrackValue(e,t,r){return this.getTrackValueInt(i.Float4.lerp,i.Float4.copy,e,t,r)}getNumberTrackValue(e,t){return this.getTrackValueInt(n,s,e,t,0)}getTrackValueInt(e,t,r,a,i){if(!r||0===r.animations.length)return a;let o=this.currentAnimation.aliasNext;o>=r.animations.length&&(o=0);let n=this.calculateAnimatedValue(e,t,r,o,this.currentAnimActiveTime,a,i);if(this.blendFactor<=0||this.blendFactor>=1)return n;let s=this.nextAnimation.aliasNext;return s>=r.animations.length&&(s=0),e(this.calculateAnimatedValue(e,t,r,s,this.nextAnimActiveTime,a,i),n,this.blendFactor,i)}calculateAnimatedValue(e,t,r,a,i,o,n){const s=r.animations[a];if(0===s.values.length)return o;if(1===s.values.length)return t(s.values[0],n);if(s.values.length>1){r.globalSequence>=0&&(i=r.globalSequence<this.globalTimers.length?this.globalTimers[r.globalSequence]:this.globalTimers[0]);const a=s.timeStamps[s.timeStamps.length-1];a>0&&i>=a&&(r.globalSequence<0?i%=a:i=a);let o=s.timeStamps.findIndex((e=>e>i));o<0&&(o=s.timeStamps.length-1);const l=o-1;if(1!==r.interpolationType)return t(s.values[l],n);const u=s.timeStamps[l],d=s.timeStamps[o];let c=0;return u!==d&&(c=(i-u)/(d-u)),e(s.values[l],s.values[o],c,n)}}}t.AnimationState=l},4823:e=>{"use strict";const t=new Uint32Array((()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var a=0;a<8;a++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t})());e.exports=(e,r,a,i)=>{const o=t,n=i+a;e^=-1;for(let t=i;t<n;t++)e=e>>>8^o[255&(e^r[t])];return~e}},4849:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseProgressReporter=void 0,t.BaseProgressReporter=class{constructor(e){this.resetState(),this.isDisposing=!1,this.container=e,this.finishLoadingAfterMs=100}dispose(){this.isDisposing=!0,this.progressPerFile=null}calcTotalProgress(){let e=0;for(const t in this.progressPerFile)e+=this.progressPerFile[t];return e/=this.totalFiles,e}update(e,t){this.progressPerFile[e]=t}onUpdateCount(){}addFileToOperation(e){this.totalFiles++,this.onUpdateCount(),this.progressPerFile[e]=0,this.startDrawing()}removeFileFromOperation(e){void 0!==this.progressPerFile[e]&&(delete this.progressPerFile[e],this.filesProcessed++),this.onUpdateCount(),0===Object.keys(this.progressPerFile).length&&setTimeout(this.checkFinish.bind(this),this.finishLoadingAfterMs)}checkFinish(){0===Object.keys(this.progressPerFile).length&&this.finishOperation()}setOperation(e){""===this.currentOperation&&(this.currentOperation=e)}finishOperation(){this.resetState(),this.hideElements()}startDrawing(){this.show||(this.show=!0,this.showElements())}resetState(){this.show=!1,this.currentOperation="",this.progressPerFile={},this.filesProcessed=0,this.totalFiles=0}}},5053:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Line=void 0;const a=r(1639),i=r(8521),o=r(6956);class n extends i.WorldPositionedObject{constructor(e=10){super(),this.fileId=-1,this.lineWidth=e,this.segments=[]}addSegment(e,t){const r=new o.LineSegment(this.lineWidth,e,t);this.segments.push(r),this.addChild(r),this.setBoundingBox(a.AABB.merge(this.localBoundingBox,r.localBoundingBox))}attachToRenderer(e){this.isAttachedToRenderer||(super.attachToRenderer(e),this.setTexture(this.renderer.getSolidColorTexture([1,0,0,1])),this.isLoaded=!0)}update(e){if(this.isLoaded&&!this.isDisposing)for(const t of this.children)t.update(e)}draw(){if(this.isLoaded&&!this.isDisposing)for(const e of this.children)e.draw()}dispose(){this.isDisposing||super.dispose()}setTexture(e){this.texture=e;for(const t of this.segments)t.setTexture(e)}}t.Line=n},5182:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebGlCache=void 0;const a=r(2222),i=r(8204);class o extends i.Disposable{constructor(e=3e5){super(),this.items={},this.maxTtl=e}dispose(){if(!this.isDisposing){super.dispose();for(const e of this.getKeys())this.delete(e);this.items=null}}update(e){const t=this.getKeys();for(const r of t){const t=this.items[r];t.owners.length>0||-1!=t.ttl&&(t.ttl-=e,t.ttl<0&&this.delete(r))}}addOwner(e,t){this.isDisposing||this.items[e]&&this.items[e].owners.push(t)}removeOwner(e,t){this.isDisposing||this.items[e]&&(this.items[e].owners=this.items[e].owners.filter((e=>e!==t)))}delete(e){const t=this.items[e];(0,a.isDisposable)(t.value)&&t.value.dispose(),delete this.items[e]}contains(e){return!this.isDisposing&&!!this.items[e]}get(e){if(this.isDisposing)return null;const t=this.items[e];return t?(t.ttl=this.maxTtl,t.value):null}store(e,t,r=this.maxTtl){this.items[e]={ttl:r,value:t,owners:[]}}getKeys(){return this.isDisposing?null:Object.keys(this.items)}}t.WebGlCache=o},5416:(e,t)=>{"use strict";var r,a,i,o,n,s,l;Object.defineProperty(t,"__esModule",{value:!0}),t.WowWorldModelBspNodeFlags=t.WMOShader=t.WoWWorldModelMaterialMaterialFlags=t.WMODoodadFlags=t.WowWorldModelGroupFlags2=t.WowWorldModelGroupFlags=t.WorldModelRootFlags=void 0,function(e){e[e.DoNoAttenuateVerticesBasedOnDistanceToPortal=1]="DoNoAttenuateVerticesBasedOnDistanceToPortal",e[e.UseUnifiedRenderPath=2]="UseUnifiedRenderPath",e[e.UseLiquidTypeDbcId=4]="UseLiquidTypeDbcId",e[e.DoNotFixVertexColorAlpha=8]="DoNotFixVertexColorAlpha",e[e.Lod=16]="Lod",e[e.DefaultMaxLod=32]="DefaultMaxLod",e[e.Unknown_0x40=64]="Unknown_0x40",e[e.Unknown_0x80=128]="Unknown_0x80",e[e.Unknown_0x100=256]="Unknown_0x100",e[e.Unknown_0x200=512]="Unknown_0x200",e[e.Unknown_0x400=1024]="Unknown_0x400",e[e.Unknown_0x800=2048]="Unknown_0x800"}(r||(t.WorldModelRootFlags=r={})),function(e){e[e.BspTree=1]="BspTree",e[e.LightMap=2]="LightMap",e[e.VertexColors=4]="VertexColors",e[e.Exterior=8]="Exterior",e[e.Unknown_0x10=16]="Unknown_0x10",e[e.Unknown_0x20=32]="Unknown_0x20",e[e.ExteriorLit=64]="ExteriorLit",e[e.Unreachable=128]="Unreachable",e[e.ShowExteriorSky=256]="ShowExteriorSky",e[e.HasLights=512]="HasLights",e[e.Lod=1024]="Lod",e[e.HasDoodads=2048]="HasDoodads",e[e.HasWater=4096]="HasWater",e[e.Interior=8192]="Interior",e[e.Unknown_0x4000=16384]="Unknown_0x4000",e[e.Unknown_0x8000=32768]="Unknown_0x8000",e[e.AlwaysDraw=65536]="AlwaysDraw",e[e.Unknown_0x20000=131072]="Unknown_0x20000",e[e.ShowSkybox=262144]="ShowSkybox",e[e.IsOceanWater=524288]="IsOceanWater",e[e.Unknown_0x100000=1048576]="Unknown_0x100000",e[e.IsMountAllowed=2097152]="IsMountAllowed",e[e.Unknown_0x400000=4194304]="Unknown_0x400000",e[e.Unknown_0x800000=8388608]="Unknown_0x800000",e[e.Has2VertexColors=16777216]="Has2VertexColors",e[e.Has2UVs=33554432]="Has2UVs",e[e.AntiPortal=67108864]="AntiPortal",e[e.Unknown_0x8000000=134217728]="Unknown_0x8000000",e[e.Unknown_0x10000000=268435456]="Unknown_0x10000000",e[e.Unknown_0x20000000=536870912]="Unknown_0x20000000",e[e.Has3UVs=1073741824]="Has3UVs",e[e.Unknown_0x80000000=2147483648]="Unknown_0x80000000"}(a||(t.WowWorldModelGroupFlags=a={})),function(e){e[e.CanCutTerrain=1]="CanCutTerrain",e[e.Unknown_0x2=2]="Unknown_0x2",e[e.Unknown_0x4=4]="Unknown_0x4",e[e.Unknown_0x8=8]="Unknown_0x8",e[e.Unknown_0x10=16]="Unknown_0x10",e[e.Unknown_0x20=32]="Unknown_0x20",e[e.IsSplitGroupParent=64]="IsSplitGroupParent",e[e.IsSplitGroupChild=128]="IsSplitGroupChild",e[e.AttachmentMesh=256]="AttachmentMesh"}(i||(t.WowWorldModelGroupFlags2=i={})),function(e){e[e.AcceptProjTexture=1]="AcceptProjTexture",e[e.UseInteriorLighting=2]="UseInteriorLighting",e[e.Unknown_0x4=4]="Unknown_0x4",e[e.Unknown_0x8=8]="Unknown_0x8",e[e.Unknown_0x10=16]="Unknown_0x10",e[e.Unknown_0x20=32]="Unknown_0x20",e[e.Unknown_0x40=64]="Unknown_0x40",e[e.Unknown_0x80=128]="Unknown_0x80"}(o||(t.WMODoodadFlags=o={})),function(e){e[e.Unlit=1]="Unlit",e[e.Unfogged=2]="Unfogged",e[e.Unculled=4]="Unculled",e[e.Extlight=8]="Extlight",e[e.Sidn=16]="Sidn",e[e.Window=32]="Window",e[e.ClampS=64]="ClampS",e[e.ClampT=128]="ClampT",e[e.Unknown_0x100=256]="Unknown_0x100",e[e.Unknown_0x200=512]="Unknown_0x200",e[e.Unknown_0x400=1024]="Unknown_0x400",e[e.Unknown_0x800=2048]="Unknown_0x800",e[e.Unknown_0x1000=4096]="Unknown_0x1000",e[e.Unknown_0x2000=8192]="Unknown_0x2000",e[e.Unknown_0x4000=16384]="Unknown_0x4000",e[e.Unknown_0x8000=32768]="Unknown_0x8000",e[e.Unknown_0x10000=65536]="Unknown_0x10000",e[e.Unknown_0x20000=131072]="Unknown_0x20000",e[e.Unknown_0x40000=262144]="Unknown_0x40000",e[e.Unknown_0x80000=524288]="Unknown_0x80000",e[e.Unknown_0x100000=1048576]="Unknown_0x100000",e[e.Unknown_0x200000=2097152]="Unknown_0x200000",e[e.Unknown_0x400000=4194304]="Unknown_0x400000",e[e.Unknown_0x800000=8388608]="Unknown_0x800000"}(n||(t.WoWWorldModelMaterialMaterialFlags=n={})),function(e){e[e.Diffuse=0]="Diffuse",e[e.Specular=1]="Specular",e[e.Metal=2]="Metal",e[e.Env=3]="Env",e[e.Opaque=4]="Opaque",e[e.EnvMetal=5]="EnvMetal",e[e.TwoLayerDiffuse=6]="TwoLayerDiffuse",e[e.TwoLayerEnvMetal=7]="TwoLayerEnvMetal",e[e.TwoLayerTerrain=8]="TwoLayerTerrain",e[e.DiffuseEmissive=9]="DiffuseEmissive",e[e.WaterWindow=10]="WaterWindow",e[e.MaskedEnvMetal=11]="MaskedEnvMetal",e[e.EnvMetalEmissive=12]="EnvMetalEmissive",e[e.TwoLayerDiffuseOpaque=13]="TwoLayerDiffuseOpaque",e[e.SubmarineWindow=14]="SubmarineWindow",e[e.TwoLayerDiffuseEmissive=15]="TwoLayerDiffuseEmissive",e[e.DiffuseTerrain=16]="DiffuseTerrain",e[e.AdditiveMaskedEnvMetal=17]="AdditiveMaskedEnvMetal",e[e.TwoLayerDiffuseMod2x=18]="TwoLayerDiffuseMod2x",e[e.TwoLayerDiffuseMod2xNA=19]="TwoLayerDiffuseMod2xNA",e[e.TwoLayerDiffuseAlpha=20]="TwoLayerDiffuseAlpha",e[e.Lod=21]="Lod",e[e.Parallax=22]="Parallax",e[e.Unknown_DF_Shader=23]="Unknown_DF_Shader"}(s||(t.WMOShader=s={})),function(e){e[e.XAxis=0]="XAxis",e[e.YAxis=1]="YAxis",e[e.ZAxis=2]="ZAxis",e[e.AxisMask=3]="AxisMask",e[e.Leaf=4]="Leaf",e[e.NoChild=65535]="NoChild"}(l||(t.WowWorldModelBspNodeFlags=l={}))},5510:function(e,t,r){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WMOLiquid=void 0;const i=r(2462),o=r(1639),n=r(9266),s=r(1017),l=r(8521),u=a(r(2315)),d=a(r(1178)),c=1600/3/16/8;var h,f;!function(e){e[e.None=0]="None",e[e.River=1]="River",e[e.Ocean=2]="Ocean",e[e.Wmo=3]="Wmo"}(h||(h={})),function(e){e[e.Water=0]="Water",e[e.Ocean=1]="Ocean",e[e.Lava=2]="Lava",e[e.Slime=3]="Slime"}(f||(f={}));class p extends l.WorldPositionedObject{constructor(e,t,r,a){super(),this.vertices=[],this.indices=[],this.data=e,this.groupData=t,this.wmoFlags=r,this.metadataLoaded=!1,this.texturesLoaded=!1,this.dataManager=a}attachToRenderer(e){super.attachToRenderer(e),this.shaderProgram=e.getShaderProgram(this,"WMOLiquid",d.default,u.default);const t=[],[r,a]=this.data.liquidTiles,l=this.groupData.flags&i.WowWorldModelGroupFlags.Exterior?1e3:0;for(let e=0;e<a+1;e++)for(let a=0;a<r+1;a++){const i=this.data.vertices[e*(r+1)+a],n=this.data.position[0]+c*a,s=this.data.position[1]+c*e,u=i.height;t.push({position:o.Float3.create(n,s,u),x:a,y:e,depth:l})}this.setBoundingBox(o.AABB.fromVertices(t.map((e=>e.position))));let h=0,f=-1;this.vertices=[],this.indices=[];for(let e=0;e<a;e++)for(let a=0;a<r&&!(h>=65532);a++){const i=e*r+a,o=this.data.tiles[i];if(8&o.legacyLiquidType)continue;const n=e*(r+1)+a,s=[n,n+1,n+r+2,n+r+1];for(const e of s)e>t.length||this.vertices.push(t[e]);this.indices.push(h),this.indices.push(h+1),this.indices.push(h+2),this.indices.push(h+2),this.indices.push(h+3),this.indices.push(h),h+=4,f<0&&(f=o.legacyLiquidType)}const p=this.renderer.graphics.createVertexDataBuffer([{index:this.shaderProgram.getAttribLocation("a_position"),size:3,type:s.BufferDataType.Float,normalized:!1,stride:24,offset:0},{index:this.shaderProgram.getAttribLocation("a_texCoord"),size:2,type:s.BufferDataType.Float,normalized:!1,stride:24,offset:12},{index:this.shaderProgram.getAttribLocation("a_depth"),size:1,type:s.BufferDataType.Float,normalized:!1,stride:24,offset:20}],!0),m=new Uint8Array(24*this.vertices.length),g=new n.BinaryWriter(m.buffer);for(let e=0;e<this.vertices.length;e++)g.writeFloatLE(this.vertices[e].position[0]),g.writeFloatLE(this.vertices[e].position[1]),g.writeFloatLE(this.vertices[e].position[2]),g.writeFloatLE(this.vertices[e].x),g.writeFloatLE(this.vertices[e].y),g.writeFloatLE(this.vertices[e].depth);p.setData(m);const y=this.renderer.graphics.createVertexIndexBuffer(!0);y.setData(new Uint16Array(this.indices)),this.dataBuffers=this.renderer.graphics.createDataBuffers(p,y),this.liquidType=this.getLiquidType(f),this.dataManager.getLiquidTypeMetadata(this.liquidType).then(this.onMetadataLoaded.bind(this))}draw(){if(!this.isLoaded||this.isDisposing)return;const e=Math.floor(this.renderer.timeElapsed/100%this.animatingTextureCount),t=this.materials[e],r=new s.DrawingBatchRequest("WMO-LIQUID",this.liquidTypeMetadata.id,e);r.useMaterial(t),r.useDataBuffers(this.dataBuffers),r.drawIndexedTriangles(0,this.indices.length),this.renderer.submitDrawRequest(r)}dispose(){this.isDisposing||(super.dispose(),this.data=null,this.groupData=null,this.wmoFlags=null,this.dataBuffers.dispose(),this.dataBuffers=null,this.vertices=null,this.indices=null,this.materials=null,this.liquidTypeMetadata=null,this.textures=null)}get isLoaded(){return this.metadataLoaded&&this.texturesLoaded}onMetadataLoaded(e){if(null==e)return void this.dispose();if(this.isDisposing)return;this.liquidTypeMetadata=e,this.liquidTypeMetadata.name.includes("Slime")?this.liquidCategory=f.Slime:this.liquidTypeMetadata.name.includes("Magma")||this.liquidTypeMetadata.name.includes("Lava")?this.liquidCategory=f.Lava:this.liquidTypeMetadata.name.includes("Ocean")?this.liquidCategory=f.Ocean:this.liquidCategory=f.Water;const t=[];this.textures=new Array(e.textures.length);for(let r=0;r<this.textures.length;r++){const a=e.textures[r].fileDataId;if(a){const e=this.renderer.getTexture(this,a).then((e=>{this.textures[r]=e}));t.push(e)}}this.animatingTextureCount=this.liquidTypeMetadata.namedTextures[0]?e.textures.length:0;const r=this.liquidTypeMetadata.namedTextures[1];r&&r.startsWith("procedural")?(r.includes("River")?this.proceduralTextureType=h.River:r.includes("Ocean")?this.proceduralTextureType=h.Ocean:r.includes("Wmo")&&(this.proceduralTextureType=h.Wmo),this.animatingTextureCount--):(this.proceduralTextureType=h.None,r&&this.animatingTextureCount--);for(let t=2;t<e.namedTextures.length;t++)e.namedTextures[t]&&this.animatingTextureCount--;this.animatingTextureCount=Math.max(0,this.animatingTextureCount),Promise.all(t).then((()=>{this.setupMaterials(),this.texturesLoaded=!0,this.processCallbacks("loaded")})),this.metadataLoaded=!0}getLiquidType(e){let t;if(this.wmoFlags&i.WorldModelRootFlags.UseLiquidTypeDbcId){if(!(this.groupData.groupLiquid<21))return this.groupData.groupLiquid;t=this.groupData.groupLiquid-1}else if(15===this.groupData.groupLiquid)t=e;else{if(!(this.groupData.groupLiquid<21))return this.groupData.groupLiquid+1;t=this.groupData.groupLiquid}const r=3&t;return 1===r?14:2===r?19:3===r?20:this.groupData.flags&i.WowWorldModelGroupFlags.IsOceanWater?14:13}setupMaterials(){this.materials=new Array(this.textures.length);for(let e=0;e<this.textures.length;e++){const t=this.textures[e],r=this.renderer.getBaseMaterial();r.useCounterClockWiseFrontFaces(!0),r.useBackFaceCulling(!1),r.useBlendMode(s.GxBlend.GxBlend_Alpha),r.useDepthTest(!0),r.useDepthWrite(!0),r.useColorMask(s.ColorMask.Alpha|s.ColorMask.Red|s.ColorMask.Blue|s.ColorMask.Green),r.useUniforms({u_texture:t,u_modelMatrix:this.worldModelMatrix,u_waterParams:o.Float2.create(this.liquidCategory,0)}),r.useShaderProgram(this.shaderProgram),this.materials[e]=r}}}t.WMOLiquid=p},5526:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(7319),t),i(r(9724),t)},5716:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GenericBatchRequest=t.OffMainDrawingRequest=t.DrawingBatchRequest=t.RenderingBatchRequest=t.RenderMaterial=t.BatchRequestKey=void 0,t.isDrawingRequest=function(e){return"draw"===e.type},t.isOffMainDrawingRequest=function(e){return"offMainDraw"===e.type},t.isGenericRequest=function(e){return"generic"===e.type};const a=r(2388);class i{constructor(e,t,r,a=0){this.ownerIdentifier=e,this.ownerId=t,this.materialId=r,this.batchIdentifier=a}compareTo(e){const t=this.ownerIdentifier.localeCompare(e.ownerIdentifier);if(0!=t)return t;if(this.ownerId!==e.ownerId)return this.ownerId<e.ownerId?-1:1;const r=this.materialId-e.materialId;return 0!=r?r:this.batchIdentifier-e.batchIdentifier}toString(){return this.ownerIdentifier+"-"+this.ownerId+"-"+this.materialId+"-"+this.batchIdentifier}}t.BatchRequestKey=i,t.RenderMaterial=class{useBlendMode(e){this.blendMode=e}useDepthWrite(e){this.depthWrite=e}useDepthTest(e){this.depthTest=e}useBackFaceCulling(e){this.backFaceCulling=e}useCounterClockWiseFrontFaces(e){this.counterClockWiseFrontFaces=e}useColorMask(e){this.colorMask=e}useShaderProgram(e){this.shaderProgram=e}useUniforms(e){this.uniforms=Object.assign(Object.assign({},this.uniforms),e)}bind(e){e.useBackFaceCulling(this.backFaceCulling),e.useBlendMode(this.blendMode),e.useColorMask(this.colorMask),e.useCounterClockWiseFrontFaces(this.counterClockWiseFrontFaces),e.useDepthTest(this.depthTest),e.useDepthWrite(this.depthWrite),this.shaderProgram&&(e.useShaderProgram(this.shaderProgram),this.shaderProgram.useUniforms(this.uniforms))}};class o{constructor(e,t,r,a=0){this.key=new i(e,t,r,a)}submit(e){this.beforeMain(e),this.main(e),this.afterMain(e)}beforeMain(e){}main(e){}afterMain(e){}compareTo(e){return this.key.compareTo(e.key)}}t.RenderingBatchRequest=o,t.DrawingBatchRequest=class extends o{beforeMain(e){this.material&&this.material.bind(e),this.dataBuffers&&e.useDataBuffers(this.dataBuffers)}useMaterial(e){return this.material=e,this}drawTriangles(e,t){return this.main=r=>r.drawTriangles(e,t),this}drawIndexedTriangles(e,t){return this.main=r=>r.drawIndexedTriangles(e,t),this}drawIndexedTriangleStrip(e,t){return this.main=r=>r.drawIndexedTriangleStrip(e,t),this}useDataBuffers(e){return this.dataBuffers=e,this}compareTo(e){if(!e)return 0;if(this.material&&e.material){const t=(this.material.blendMode>a.GxBlend.GxBlend_Opaque?this.material.blendMode==a.GxBlend.GxBlend_AlphaKey?1:2:0)-(e.material.blendMode>a.GxBlend.GxBlend_Opaque?e.material.blendMode==a.GxBlend.GxBlend_AlphaKey?1:2:0);if(0!=t)return t}return this.key.compareTo(e.key)}},t.OffMainDrawingRequest=class extends o{beforeMain(e){this.frameBuffer&&e.useFrameBuffer(this.frameBuffer),this.colorOutputTexture&&e.setColorBufferToTexture(this.colorOutputTexture),this.copyToTexture&&e.copyFrameToTexture(this.copyToTexture,0,0,this.copyToTexture.width,this.copyToTexture.height),this.material&&this.material.bind(e),this.dataBuffers&&e.useDataBuffers(this.dataBuffers)}useMaterial(e){return this.material=e,this}useFrameBuffer(e){return this.frameBuffer=e,this}writeColorOutputToTexture(e){return this.colorOutputTexture=e,this}captureCurrentFrameToTexture(e){return this.copyToTexture=e,this}drawTriangles(e,t){return this.main=r=>r.drawTriangles(e,t),this}drawIndexedTriangles(e,t){return this.main=r=>r.drawIndexedTriangles(e,t),this}drawIndexedTriangleStrip(e,t){return this.main=r=>r.drawIndexedTriangleStrip(e,t),this}useDataBuffers(e){return this.dataBuffers=e,this}},t.GenericBatchRequest=class extends o{do(e){this.main=e}}},5777:function(e,t,r){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Background=void 0;const i=r(1639),o=r(1017),n=a(r(177)),s=a(r(3388)),l=r(1353),u="BACKGROUND";class d extends l.RenderObject{constructor(){super(),this.fileId=-1,this.transform=i.Float4.create(0,0,1,1)}attachToRenderer(e){this.renderer=e,this.isLoaded||(this.program=this.renderer.getShaderProgram(this,"BG",n.default,s.default),this.dataBuffers=this.renderer.getDataBuffers(this,"BG-RECT",(e=>{const t=e.createVertexDataBuffer([{index:this.program.getAttribLocation("a_texCoord"),size:2,type:o.BufferDataType.Float,normalized:!1,stride:16,offset:0},{index:this.program.getAttribLocation("a_position"),size:2,type:o.BufferDataType.Float,normalized:!1,stride:16,offset:8}],!0);t.setData(new Float32Array([0,0,1,1,1,0,-1,1,0,1,1,-1,1,1,-1,-1]));const r=e.createVertexIndexBuffer(!0);return r.setData(new Uint16Array([0,1,2,1,3,2])),e.createDataBuffers(t,r)})),this.texture=this.renderer.getSolidColorTexture([1,0,0,1]),this.createMaterial(),this.isLoaded=!0)}update(e){}draw(){if(!this.isLoaded||this.isDisposing)return;const e=new o.DrawingBatchRequest(u,-100,0,0);e.useMaterial(this.material).useDataBuffers(this.dataBuffers).drawIndexedTriangles(0,6),this.renderer.submitDrawRequest(e)}dispose(){this.isDisposing||(super.dispose(),this.material=null,this.program=null,this.dataBuffers=null,this.renderer=null,this.transform=null)}setOffset(e){this.isDisposing||(this.transform[0]=e[0],this.transform[1]=e[1])}setScale(e){this.isDisposing||(this.transform[2]=e[0],this.transform[3]=e[1])}setTransform(e){this.isDisposing||i.Float4.copy(e,this.transform)}useColor(e){this.isDisposing||(this.texture=this.renderer.getSolidColorTexture(e),this.createMaterial())}useTexture(e){this.isDisposing||(this.texture=e,this.createMaterial())}useImage(e,t){if(this.isDisposing)return;const r=new Image;r.onload=()=>{const e=new o.GenericBatchRequest(u,-100,0,0);e.do((e=>{const a=e.createTextureFromImg(r,t);this.texture=a,this.createMaterial()})),this.renderer.submitOtherGraphicsRequest(e)},new URL(e,window.location.href).origin!=window.location.origin&&(r.crossOrigin=""),r.src=e}createMaterial(){this.material=new o.RenderMaterial,this.material.useShaderProgram(this.program);const e={u_transform:this.transform,u_texture:this.texture};this.material.useBlendMode(o.GxBlend.GxBlend_Opaque),this.material.useBackFaceCulling(!1),this.material.useDepthTest(!1),this.material.useDepthWrite(!1),this.material.useColorMask(o.ColorMask.All),this.material.useUniforms(e)}}t.Background=d},5911:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleCache=void 0;const a=r(2222),i=r(8204);class o extends i.Disposable{constructor(e=3e5){super(),this.items={},this.maxTtl=e,this.isDisposing=!1}dispose(){this.isDisposing||(super.dispose(),this.items=null)}update(e){const t=this.getKeys();for(const r of t){const t=this.items[r];-1!=t.ttl&&(t.ttl-=e,t.ttl<0&&this.delete(r))}}delete(e){const t=this.items[e];(0,a.isDisposable)(t.value)&&t.value.dispose(),delete this.items[e]}contains(e){return!this.isDisposing&&!!this.items[e]}get(e){if(this.isDisposing)return null;const t=this.items[e];return t?(t.ttl=this.maxTtl,t.value):null}store(e,t,r=this.maxTtl){this.items[e]={ttl:r,value:t}}getKeys(){return this.isDisposing?null:Object.keys(this.items)}}t.SimpleCache=o},5981:function(e,t,r){"use strict";var a=this&&this.__awaiter||function(e,t,r,a){return new(r||(r=Promise))((function(i,o){function n(e){try{l(a.next(e))}catch(e){o(e)}}function s(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}l((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseRenderer=void 0;const i=r(1639),o=r(8204),n=r(6940),s=r(1017),l=r(5182);class u extends o.Disposable{constructor(e){super(),this.graphics=e.graphics,this.dataLoader=e.dataLoader,this.progress=e.progress,this.dataManager=e.dataManager,this.objectIdentifier=e.objectIdentifier,this.dataLoader.useProgressReporter(e.progress),this.errorHandler=e.errorHandler,this.sceneObjects=[],this.sceneBoundingBox=i.AABB.zero(),this.viewMatrix=i.Float44.identity(),this.invViewMatrix=i.Float44.identity(),this.projectionMatrix=i.Float44.identity(),this.projViewMatrix=i.Float44.identity(),this.cameraFrustrum=i.Frustrum.zero(),this.cameraPosition=i.Float3.zero();const t=e.cacheTtl?e.cacheTtl:9e5;this.graphicsCache=new l.WebGlCache(t),this.textureRequests={},this.drawRequests=[],this.otherGraphicsRequests=[],this.clearColor=e.clearColor?e.clearColor:i.Float4.create(.1,.1,.1,1),this.fov=e.cameraFov?e.cameraFov:60,this.sunDir=e.sunDir?e.sunDir:i.Float3.create(-.30822,-.30822,-.9),this.exteriorAmbientColor=e.exteriorAmbientColor?e.exteriorAmbientColor:i.Float4.create(127/255,149/255,170/255,1),this.exteriorDirectColor=e.exteriorDirectColor?e.exteriorDirectColor:i.Float4.create(106/255,86/255,66/255,1),this.exteriorDirectColorDir=i.Float3.normalize(this.sunDir),this.interiorSunDir=e.interiorSunDir?e.interiorSunDir:i.Float3.create(-.30822,-.30822,-.9),this.personalInteriorSunDir=i.Float4.zero(),this.interiorAmbientColor=i.Float4.zero(),this.interiorDirectColor=i.Float4.zero(),this.interiorDirectColorDir=i.Float3.normalize(this.interiorSunDir),this.oceanCloseColor=e.oceanCloseColor?e.oceanCloseColor:i.Float4.create(17/255,75/255,89/255,1),this.oceanFarColor=e.oceanFarColor?e.oceanFarColor:i.Float4.create(0,29/255,41/255,1),this.riverCloseColor=e.riverCloseColor?e.riverCloseColor:i.Float4.create(41/255,76/255,81/255,1),this.riverFarColor=e.riverFarColor?e.riverFarColor:i.Float4.create(26/255,46/255,.2,1),this.waterAlphas=e.waterAlphas?e.waterAlphas:i.Float4.create(.3,.8,.5,1),this.debugPortals=!1,this.doodadRenderDistance=300,this.lastDeltaTime=0,this.timeElapsed=0}dispose(){if(!this.isDisposing){super.dispose(),this.graphics=null,this.dataLoader=null,this.progress=null,this.errorHandler=null,this.sceneCamera=null,this.sunDir=null,this.exteriorAmbientColor=null,this.exteriorDirectColor=null,this.exteriorDirectColorDir=null,this.interiorSunDir=null,this.personalInteriorSunDir=null,this.interiorAmbientColor=null,this.interiorDirectColor=null,this.exteriorDirectColorDir=null,this.oceanCloseColor=null,this.oceanFarColor=null,this.riverCloseColor=null,this.riverFarColor=null,this.waterAlphas=null,this.projectionMatrix=null,this.viewMatrix=null,this.invViewMatrix=null,this.projViewMatrix=null,this.cameraFrustrum=null,this.cameraPosition=null,this.graphicsCache.dispose(),this.graphicsCache=null,this.textureRequests=null,this.drawRequests=null,this.otherGraphicsRequests=null;for(let e=0;e<this.sceneObjects.length;e++)this.sceneObjects[e].dispose();this.sceneObjects=null,this.sceneBoundingBox=null,this.dataManager=null,this.objectIdentifier=null}}draw(e){var t;try{this.processCallbacks("beforeUpdate"),this.sceneCamera.update(e),i.Float44.copy(this.sceneCamera.getViewMatrix(),this.viewMatrix),i.Float44.invert(this.viewMatrix,this.invViewMatrix),i.Float44.multiply(this.projectionMatrix,this.viewMatrix,this.projViewMatrix),i.Frustrum.fromViewMatrix(this.projViewMatrix,this.cameraFrustrum),i.Float44.getTranslation(this.invViewMatrix,this.cameraPosition),this.dataManager.update(e),this.graphicsCache.update(e);for(const t of this.sceneObjects)t.update(e);this.processCallbacks("afterUpdate"),this.processCallbacks("beforeDraw"),this.otherGraphicsRequests.sort(((e,t)=>e.compareTo(t)));for(const e of this.otherGraphicsRequests)e.submit(this.graphics);this.graphics.endFrame(),this.otherGraphicsRequests=[];for(const e of this.sceneObjects)e.draw();this.drawRequests.sort(((e,t)=>e.compareTo(t))),this.graphics.clearFrame(this.clearColor),this.graphics.startFrame(this.width,this.height);for(const e of this.drawRequests)e.submit(this.graphics);this.graphics.endFrame(),this.processCallbacks("afterDraw"),this.drawRequests=[],this.lastDeltaTime=e,this.timeElapsed+=e}catch(e){null===(t=this.errorHandler)||void 0===t||t.call(this,"rendering",null,e)}}start(){this.timeElapsed=0,this.lastDeltaTime=1,this.sceneCamera.attachToRenderer(this),i.Float44.copy(this.sceneCamera.getViewMatrix(),this.viewMatrix),i.Float44.invert(this.viewMatrix,this.invViewMatrix);var e=this.width/this.height;i.Float44.perspective(Math.PI/180*this.fov,e,.1,2e3,this.projectionMatrix)}resize(e,t){this.height=t,this.width=e;var r=this.width/this.height;i.Float44.perspective(Math.PI/180*this.fov,r,.1,2e3,this.projectionMatrix)}switchCamera(e){e.attachToRenderer(this),this.sceneCamera&&this.sceneCamera.dispose(),this.sceneCamera=e}addSceneObject(e){e.attachToRenderer(this),e.once("disposed",(()=>{this.sceneObjects=this.sceneObjects.filter((e=>!e.isDisposing))})),(0,n.isWorldPositionedObject)(e)&&e.once("loaded",(e=>{this.sceneBoundingBox=i.AABB.merge(this.sceneBoundingBox,e.worldBoundingBox),this.processCallbacks("sceneBoundingBoxUpdate")})),this.sceneObjects.push(e)}removeSceneObject(e,t=!0){this.sceneObjects=this.sceneObjects.filter((t=>t!=e)),t?e.dispose():e.detachFromRenderer(),this.recalculateSceneBounds()}recalculateSceneBounds(){this.sceneBoundingBox=i.AABB.zero();for(const e of this.sceneObjects)(0,n.isWorldPositionedObject)(e)&&(this.sceneBoundingBox=i.AABB.merge(this.sceneBoundingBox,e.worldBoundingBox));this.processCallbacks("sceneBoundingBoxUpdate")}submitDrawRequest(e){this.drawRequests.push(e)}submitOtherGraphicsRequest(e){this.otherGraphicsRequests.push(e)}getSolidColorTexture(e){return this.graphics.createSolidColorTexture(e)}getUnknownTexture(){return this.graphics.createSolidColorTexture(i.Float4.create(0,1,0,1))}getTexture(e,t,r){return a(this,void 0,void 0,(function*(){const i=this.objectIdentifier.createIdentifier(e),o="TEXTURE-"+t;if(e.once("disposed",(()=>{this.graphicsCache.removeOwner(o,i)})),this.graphicsCache.contains(o))return this.graphicsCache.addOwner(o,i),this.graphicsCache.get(o);if(this.textureRequests[o]){const e=yield this.textureRequests[o];return this.graphicsCache.contains(o)&&this.graphicsCache.addOwner(o,i),e}const n=this.dataManager.getTextureImageData(t).then((e=>a(this,void 0,void 0,(function*(){return e?yield this.processTexture(t,e,r):null}))));this.textureRequests[o]=n;const s=yield n;return s&&(this.graphicsCache.store(o,s),this.graphicsCache.addOwner(o,i)),delete this.textureRequests[o],s}))}getShaderProgram(e,t,r,a,i){const o=this.objectIdentifier.createIdentifier(e);e.once("disposed",(()=>{this.graphicsCache.removeOwner(n,o)}));const n="PROGRAM-"+t;if(this.graphicsCache.contains(n))return this.graphicsCache.addOwner(n,o),this.graphicsCache.get(n);const s=this.graphics.createShaderProgram(r,a,i);return this.graphicsCache.store(n,s),this.graphicsCache.addOwner(n,o),s}getDataBuffers(e,t,r){const a=this.objectIdentifier.createIdentifier(e);e.once("disposed",(()=>{this.graphicsCache.removeOwner(i,a)}));const i="DATABUFFER-"+t;if(this.graphicsCache.contains(i))return this.graphicsCache.addOwner(i,a),this.graphicsCache.get(i);const o=r(this.graphics);return this.graphicsCache.store(i,o),this.graphicsCache.addOwner(i,a),o}getBaseMaterial(){const e=new s.RenderMaterial;return e.useUniforms({u_viewMatrix:this.viewMatrix,u_projectionMatrix:this.projectionMatrix,u_applyInteriorLighting:!1,u_interiorAmbientColor:this.interiorAmbientColor,u_interiorDirectColor:this.interiorDirectColor,u_interiorDirectColorDir:this.interiorDirectColorDir,u_personalInteriorSunDir:this.personalInteriorSunDir,u_exteriorAmbientColor:this.exteriorAmbientColor,u_exteriorDirectColor:this.exteriorDirectColor,u_exteriorDirectColorDir:this.exteriorDirectColorDir,u_oceanCloseColor:this.oceanCloseColor,u_oceanFarColor:this.oceanFarColor,u_riverCloseColor:this.riverCloseColor,u_riverFarColor:this.riverFarColor,u_waterAlphas:this.waterAlphas}),e}getLightingUniforms(){return"\nuniform bool u_applyInteriorLighting;\nuniform vec4 u_interiorAmbientColor;\nuniform vec4 u_interiorDirectColor;\nuniform vec3 u_interiorDirectColorDir;\nuniform vec4 u_personalInteriorSunDir;\n\nuniform vec4 u_exteriorAmbientColor; \nuniform vec4 u_exteriorDirectColor;\nuniform vec3 u_exteriorDirectColorDir;     \n"}getLightingFunction(){return"\nvec3 calcAmbientLight(vec3 ambient, vec3 precomputedLight, float normalDotLight) {\n    vec3 lightColor = vec3(0.0, 0.0, 0.0);\n    vec3 ambientLight = ambient.rgb + precomputedLight;\n    vec3 skyColor = ambientLight * 1.1;\n    vec3 groundColor = ambientLight * 0.7;\n    lightColor = mix(groundColor, skyColor, 0.5 + 0.5 * normalDotLight);\n    return lightColor;\n}\n\nvec3 light(\n    bool applyLight,\n    vec3 materialColor,\n    vec3 vNormal,\n    vec3 preComputedLight,\n    vec3 specular,\n    vec3 emissive\n) {\n    vec3 result = materialColor;\n    if (applyLight) {\n        vec3 lightColor = vec3(0.0, 0.0, 0.0);\n        vec3 diffuseLight = vec3(0.0, 0.0, 0.0);\n        vec3 normal = normalize(vNormal);\n\n        if (u_applyInteriorLighting) {\n            vec3 interiorSunDir = mix(u_interiorDirectColorDir, u_personalInteriorSunDir.xyz,u_personalInteriorSunDir.w);\n            float normalDotLight = clamp(dot(normal, interiorSunDir), 0.0, 1.0);\n\n            lightColor = calcAmbientLight(\n                u_interiorAmbientColor.rgb,\n                preComputedLight,\n                normalDotLight\n            );\n            diffuseLight = u_interiorDirectColor.xyz * normalDotLight;\n        }\n        else {\n            float normalDotLight = clamp(dot(normal, normalize(-u_exteriorDirectColorDir)), 0.0, 1.0);\n\n            lightColor = calcAmbientLight(\n                u_exteriorAmbientColor.rgb,\n                preComputedLight,\n                normalDotLight\n            );\n            diffuseLight = u_exteriorDirectColor.xyz * normalDotLight;\n        }\n\n        vec3 gammaDiffuseTerm = materialColor * (lightColor + diffuseLight);\n        vec3 emmisiveTerm = emissive;\n        result = gammaDiffuseTerm + emmisiveTerm;\n    }\n\n    return result + specular;\n}        \n"}getSceneBoundingBox(){return this.sceneBoundingBox}}t.BaseRenderer=u},5996:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});const a="precision mediump float;\r\nuniform mat4 u_modelMatrix;\r\nuniform mat4 u_viewMatrix;\r\nuniform mat4 u_projectionMatrix;\r\n\r\nattribute vec3 a_position;\r\n\r\nvoid main() {\r\n    gl_Position = (u_projectionMatrix * u_viewMatrix * u_modelMatrix * vec4(a_position, 1));\r\n}"},6015:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(599),t),i(r(8085),t)},6085:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BinaryWriter=void 0;const a=r(6677);class i extends a.BinaryReader{writeBool(e){this.dataView.setUint8(this.offset,e?1:0),this.offset+=1}writeUInt8(e){this.dataView.setUint8(this.offset,e),this.offset+=1}writeInt8(e){this.dataView.setInt8(this.offset,e),this.offset+=1}writeUInt16BE(e){this.dataView.setUint16(this.offset,e),this.offset+=2}writeUInt16LE(e){this.dataView.setUint16(this.offset,e,!0),this.offset+=2}writeInt16BE(e){this.dataView.setInt16(this.offset,e),this.offset+=2}writeInt16LE(e){this.dataView.setInt16(this.offset,e,!0),this.offset+=2}writeUInt32BE(e){this.dataView.setUint32(this.offset,e),this.offset+=4}writeUInt32LE(e){this.dataView.setUint32(this.offset,e,!0),this.offset+=4}writeInt32BE(e){this.dataView.setInt32(this.offset,e,!0),this.offset+=4}writeInt32LE(e){this.dataView.setInt32(this.offset,e,!0),this.offset+=4}writeFloatBE(e){this.dataView.setFloat32(this.offset,e),this.offset+=4}writeFloatLE(e){this.dataView.setFloat32(this.offset,e,!0),this.offset+=4}}t.BinaryWriter=i},6098:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},6166:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultModelPickingStrategy=t.defaultTexturePickingStrategy=void 0,t.defaultTexturePickingStrategy=(e,t,r,a)=>{if(!e)return null;const i=new Array(24);for(let o=0;o<e.length;o++){let n=e[o];if(n.genderId!==r&&n.genderId<2)continue;if(n.classId!==a&&n.classId>0)continue;if(n.raceId!==t&&n.raceId>0)continue;const s=n.genderId===r?1:0;i[3*(7-4*(n.raceId===t?1:0)+2*(n.classId===t?1:0)+s)+n.usageType]=n.fileDataId}for(let e=0;e<i.length;e+=3)if(i[e])return[i[e],i[e+1],i[e+2]];return[0,0,0]},t.defaultModelPickingStrategy=(e,t,r,a,i)=>{if(!e)return null;const o=new Array(16);for(let n=0;n<e.length;n++){let s=e[n];if(s.genderId!==a&&s.genderId<2)continue;if(s.classId!==i&&s.classId>0)continue;if(s.raceId!==r&&s.raceId>0)continue;if(-1!==t&&s.positionIndex!==t)continue;const l=s.genderId===a?1:0,u=s.raceId===r?1:0,d=s.classId===r?1:0;o[15-(8*(s.positionIndex===t?1:0)-4*u+2*d+l)]=s.fileDataId}for(let e=0;e<o.length;e++)if(o[e])return o[e];return 0}},6239:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BspTree=t.AABB=t.Frustrum=t.Plane=t.FrustrumSide=t.PlaneElem=void 0;const a=r(2462),i=r(8875),o=r(3055);var n,s,l,u,d,c;!function(e){e[e.A=0]="A",e[e.B=1]="B",e[e.C=2]="C",e[e.D=3]="D"}(n||(t.PlaneElem=n={})),function(e){e[e.TOP=0]="TOP",e[e.BOTTOM=1]="BOTTOM",e[e.RIGHT=2]="RIGHT",e[e.LEFT=3]="LEFT",e[e.FAR=4]="FAR",e[e.NEAR=5]="NEAR",e[e.MAX=6]="MAX"}(s||(t.FrustrumSide=s={})),function(e){e.zero=function(){return o.Float4.zero()},e.create=function(e,t){return o.Float4.create(e[0],e[1],e[2],t)},e.majorAxis=function(e){let t=Math.abs(e[0]),r=0;for(let a=1;a<3;a++)Math.abs(e[a])>t&&(t=Math.abs(e[a]),r=a);return r},e.normalize=function(e){const t=o.Float3.length(e);for(let r=0;r<4;r++)e[r]/=t;return e},e.fromEyeAndVertices=function(t,r,a){const i=o.Float3.subtract(r,t),n=o.Float3.subtract(a,t),s=o.Float3.normalize(o.Float3.cross(n,i)),l=o.Float3.dot(s,t);return e.create(s,-l)},e.distanceToPoint=function(e,t){return o.Float3.dot(e,t)+e[3]},e.sideFacingPoint=function(t,r){const a=e.distanceToPoint(t,r);return Math.sign(a)}}(l||(t.Plane=l={})),function(e){e.zero=function(){return[]},e.copy=function(t,r){(r=r||e.zero()).length=t.length;for(let e=0;e<t.length;e++)r[e]=o.Float4.copy(t[e]);return r},e.fromViewMatrix=function(e,t){t=t||[];const r=e[0],a=e[4],i=e[8],n=e[12],u=e[1],d=e[5],c=e[9],h=e[13],f=e[2],p=e[6],m=e[10],g=e[14],y=e[3],x=e[7],v=e[11],b=e[15];for(let e=0;e<s.MAX;e++)t[e]||(t[e]=o.Float4.zero());return o.Float4.set(t[s.LEFT],y+r,x+a,v+i,b+n),l.normalize(t[s.LEFT]),o.Float4.set(t[s.RIGHT],y-r,x-a,v-i,b-n),l.normalize(t[s.RIGHT]),o.Float4.set(t[s.BOTTOM],y+u,x+d,v+c,b+h),l.normalize(t[s.BOTTOM]),o.Float4.set(t[s.TOP],y-u,x-d,v-c,b-h),l.normalize(t[s.TOP]),o.Float4.set(t[s.NEAR],y+f,x+p,v+m,b+g),l.normalize(t[s.NEAR]),o.Float4.set(t[s.FAR],y-f,x-p,v-m,b-g),l.normalize(t[s.FAR]),t},e.transform=function(e,t,r){(r=r||r).length=e.length;const a=i.Float44.invert(t);i.Float44.tranpose(a,a);for(let t=0;t<e.length;t++)r[t]=i.Float44.transformDirection4(e[t],a);return r},e.transformSelf=function(e,t){const r=i.Float44.invert(t);i.Float44.tranpose(r,r);for(let t=0;t<e.length;t++)i.Float44.transformDirection4(e[t],r,e[t])}}(u||(t.Frustrum=u={})),function(e){e.create=function(e,t){return{min:e,max:t}},e.zero=function(){return e.create(o.Float3.zero(),o.Float3.zero())},e.fromVertices=function(t,r=.1){let a,i,n,s,l,u;a=i=n=9999,s=l=u=-9999;for(let e=0;e<t.length;e++){const r=t[e];a=Math.min(a,r[0]),s=Math.max(s,r[0]),i=Math.min(i,r[1]),l=Math.max(l,r[1]),n=Math.min(n,r[2]),u=Math.max(u,r[2])}return e.create(o.Float3.create(a-r,i-r,n-r),o.Float3.create(s+r,l+r,u+r))},e.transform=function(e,t){const r=o.Float3.copy(e.min),a=o.Float3.copy(e.max),i=o.Float3.create(t[12],t[13],t[14]),n=o.Float3.create(t[12],t[13],t[14]);for(let e=0;e<3;e++)for(let o=0;o<3;o++){const s=t[4*e+o]*r[o],l=t[4*e+o]*a[o];i[e]+=s<l?s:l,n[e]+=s<l?l:s}return{min:i,max:n}};const t=[o.Float4.create(0,0,0,1),o.Float4.create(0,0,0,1),o.Float4.create(0,0,0,1),o.Float4.create(0,0,0,1),o.Float4.create(0,0,0,1),o.Float4.create(0,0,0,1),o.Float4.create(0,0,0,1),o.Float4.create(0,0,0,1)];function r(e,t){for(let r=0;r<3;r++)if(e.min[r]>t[r]||e.max[r]<t[r])return!1;return!0}e.merge=function(t,r){return e.fromVertices([t.max,t.min,r.max,r.min],0)},e.corners=function(e){return[o.Float3.create(e.min[0],e.min[1],e.min[2]),o.Float3.create(e.max[0],e.min[1],e.min[2]),o.Float3.create(e.min[0],e.max[1],e.min[2]),o.Float3.create(e.max[0],e.max[1],e.min[2]),o.Float3.create(e.min[0],e.min[1],e.max[2]),o.Float3.create(e.max[0],e.min[1],e.max[2]),o.Float3.create(e.min[0],e.max[1],e.max[2]),o.Float3.create(e.max[0],e.max[1],e.max[2])]},e.sphereRadius=function(t){const r=e.corners(t),a=e.center(t);let i=-1;for(const e of r){const t=o.Float3.distance(e,a);t>i&&(i=t)}return i},e.center=function(e,t){return t=t||o.Float3.zero(),o.Float3.add(e.max,e.min,t),o.Float3.scale(t,.5,t),t},e.visibleInFrustrum=function(e,r){o.Float4.set(t[0],e.min[0],e.min[1],e.min[2],1),o.Float4.set(t[1],e.max[0],e.min[1],e.min[2],1),o.Float4.set(t[2],e.min[0],e.max[1],e.min[2],1),o.Float4.set(t[3],e.max[0],e.max[1],e.min[2],1),o.Float4.set(t[4],e.min[0],e.min[1],e.max[2],1),o.Float4.set(t[5],e.max[0],e.min[1],e.max[2],1),o.Float4.set(t[6],e.min[0],e.max[1],e.max[2],1),o.Float4.set(t[7],e.max[0],e.max[1],e.max[2],1);for(const e of r){let r=!1;for(const a of t)if(o.Float4.dot(e,a)>0){r=!0;break}if(!r)return!1}return!0},e.containsPoint=r,e.containsPointIgnoreMaxZ=function(e,t){for(let r=0;r<2;r++)if(e.min[r]>t[r]||e.max[r]<t[r])return!1;return!(e.min[2]>t[2])},e.containsBoundingBox=function(e,t){return r(e,t.min)&&r(e,t.max)},e.distanceToPoint=function(e,t){if(r(e,t))return 0;const a=o.Float3.zero();for(let r=0;r<3;r++)t[r]<e.min[r]?a[r]=e.min[r]-t[r]:a[r]=t[r]-e.max[r];return o.Float3.length(a)},e.distanceToPointIgnoreAxis=function(e,t,a){if(r(e,t))return 0;const i=o.Float3.zero();for(let r=0;r<3;r++)r!=a&&(t[r]<e.min[r]?i[r]=e.min[r]-t[r]:i[r]=t[r]-e.max[r]);return o.Float3.length(i)}}(d||(t.AABB=d={})),function(e){function t(e,[t,r,a]){let i=Math.min(t[0],r[0],a[0]),n=Math.max(t[0],r[0],a[0]);if(e[0]<i||e[0]>n)return null;let s=Math.min(t[1],r[1],a[1]),l=Math.max(t[1],r[1],a[1]);if(e[1]<s||e[1]>l)return null;let u=Math.min(t[2],r[2],a[2]);if(e[2]<u)return null;let d=o.Float3.subtract(r,t);const c=o.Float3.subtract(a,t),h=o.Float3.cross(d,c);if(h[2]<1e-4)return null;const f=o.Float3.subtract(e,t),p=o.Float3.dot(f,h)/h[2];if(p<0)return null;const m=-f[1],g=f[0],y=(c[0],+c[1]*g/h[2]);if(y<0||y>1)return null;const x=(d[0]*m+d[1]*g)/-h[2];return x<0||y+x>1?null:{dist:p,bary:o.Float3.create(y,x,1-y-x)}}function r(e,t){const r=e.faceIndices[t],[a,o,n]=i(e,r);return[e.vertices[a],e.vertices[o],e.vertices[n]]}function i(e,t){return[e.vertexIndices[3*t+0],e.vertexIndices[3*t+1],e.vertexIndices[3*t+2]]}e.pickClosestTriangle_NegZ=function(e,a,n){let s=Number.MAX_VALUE,l=-1,u=o.Float3.zero();for(const i of n){const n=i.faceStart,d=n+i.faces;for(let i=n;i<d;i++){const n=t(a,r(e,i));n&&n.dist<s&&(s=n.dist,l=i,o.Float3.copy(n.bary,u))}}return{distance:s,baryocentricCoords:u,vertexIndices:i(e,e.faceIndices[l])}},e.findNodesForPoint=function e(t,r,i,n){if(n<0||t.nodes.length<n)return;const s=t.nodes[n];if(s.flags&a.WowWorldModelBspNodeFlags.Leaf)return void i.push(s);const l=function(e){return e.flags&a.WowWorldModelBspNodeFlags.YAxis?o.Axis.Y:e.flags&a.WowWorldModelBspNodeFlags.ZAxis?o.Axis.Z:o.Axis.X}(s);l===o.Axis.Z?(e(t,r,i,s.negChild),e(t,r,i,s.posChild)):(l===o.Axis.X?r[0]:r[1])<s.planeDistance?e(t,r,i,s.negChild):e(t,r,i,s.posChild)},e.createBoundingBoxForNodes=function(e,t){const a=t.reduce(((t,a)=>{const i=Array.from({length:a.faces},((e,t)=>a.faceStart+t)).reduce(((t,a)=>t.concat(r(e,a))),[]);return t.concat(i)}),[]);return d.fromVertices(a,0)}}(c||(t.BspTree=c={}))},6303:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(3256),t),i(r(3656),t),i(r(4521),t),i(r(207),t)},6452:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});const a="precision mediump float;\n\nvarying vec2 v_texCoord;\n\nuniform sampler2D u_diffuseTexture;\nuniform sampler2D u_emissiveTexture;\nuniform sampler2D u_specularTexture;\nuniform sampler2D u_backgroundTexture;\nuniform int u_blendMode;\nuniform vec2 u_backgroundResolution;\n\nvec3 overlay(vec3 a, vec3 b) {\n    vec3 outputColor = vec3(1.0);\n    for(int i = 0; i < 3; i++) {\n        if (a[i] < 0.5) {\n            outputColor[i] = 2.0 * a[i] * b[i];\n        } else {\n            outputColor[i] = 1.0 - (2.0 * (1.0 - a[i]) * (1.0 - b[i]));\n        }\n    }\n    return outputColor;\n}\n\nvec3 screen(vec3 a, vec3 b) {\n    vec3 outputColor = vec3(1.0);\n    for(int i = 0; i < 3; i++) {\n        outputColor[i] = 1.0 - (1.0 - a[i]) * (1.0 - a[i]);\n    }\n    return outputColor;\n}\n\nvoid main() {\n    vec4 diffuse = texture2D(u_diffuseTexture, v_texCoord);\n    vec4 specular = texture2D(u_specularTexture, v_texCoord);\n    vec4 emission = texture2D(u_emissiveTexture, v_texCoord);\n    vec4 backGround = texture2D(u_backgroundTexture, gl_FragCoord.xy / u_backgroundResolution);\n    \n    // Default: Overlay diffuse on background   \n    vec3 materialColor = diffuse.rgb;\n    float opacity = 1.0;\n    // Blit\n    if (u_blendMode == 1) {\n        opacity = diffuse.a;\n    }\n    // Multiply\n    else if (u_blendMode == 4) {\n        vec3 blendColor = backGround.rgb * diffuse.rgb;\n        materialColor = mix(backGround.rgb, blendColor.rgb, diffuse.a);\n    }\n    // Overlay\n    else if(u_blendMode == 6) {\n        vec3 blendColor = overlay(diffuse.rgb, backGround.rgb);\n        materialColor = mix(backGround.rgb, blendColor.rgb, diffuse.a);\n    } \n    // Screen\n    else if (u_blendMode == 7) {\n        vec3 blendColor = screen(diffuse.rgb, backGround.rgb);\n        materialColor = mix(backGround.rgb, blendColor.rgb, diffuse.a);\n    }\n    // Default: Blend layers \n    else {\n        materialColor = mix(backGround.rgb, diffuse.rgb, diffuse.a);\n    }\n\n    vec3 outputColor = materialColor + specular.rgb + emission.rgb;\n\n    gl_FragColor = vec4(outputColor, opacity);\n}"},6466:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(6500),t),i(r(3474),t)},6472:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAnimationName=void 0;const r=["Stand","Death","Spell","Stop","Walk","Run","Dead","Rise","StandWound","CombatWound","CombatCritical","ShuffleLeft","ShuffleRight","Walkbackwards","Stun","HandsClosed","AttackUnarmed","Attack1H","Attack2H","Attack2HL","ParryUnarmed","Parry1H","Parry2H","Parry2HL","ShieldBlock","ReadyUnarmed","Ready1H","Ready2H","Ready2HL","ReadyBow","Dodge","SpellPrecast","SpellCast","SpellCastArea","NPCWelcome","NPCGoodbye","Block","JumpStart","Jump","JumpEnd","Fall","SwimIdle","Swim","SwimLeft","SwimRight","SwimBackwards","AttackBow","FireBow","ReadyRifle","AttackRifle","Loot","ReadySpellDirected","ReadySpellOmni","SpellCastDirected","SpellCastOmni","BattleRoar","ReadyAbility","Special1H","Special2H","ShieldBash","EmoteTalk","EmoteEat","EmoteWork","EmoteUseStanding","EmoteTalkExclamation","EmoteTalkQuestion","EmoteBow","EmoteWave","EmoteCheer","EmoteDance","EmoteLaugh","EmoteSleep","EmoteSitGround","EmoteRude","EmoteRoar","EmoteKneel","EmoteKiss","EmoteCry","EmoteChicken","EmoteBeg","EmoteApplaud","EmoteShout","EmoteFlex","EmoteShy","EmotePoint","Attack1HPierce","Attack2HLoosePierce","AttackOff","AttackOffPierce","Sheath","HipSheath","Mount","RunRight","RunLeft","MountSpecial","Kick","SitGroundDown","SitGround","SitGroundUp","SleepDown","Sleep","SleepUp","SitChairLow","SitChairMed","SitChairHigh","LoadBow","LoadRifle","AttackThrown","ReadyThrown","HoldBow","HoldRifle","HoldThrown","LoadThrown","EmoteSalute","KneelStart","KneelLoop","KneelEnd","AttackUnarmedOff","SpecialUnarmed","StealthWalk","StealthStand","Knockdown","EatingLoop","UseStandingLoop","ChannelCastDirected","ChannelCastOmni","Whirlwind","Birth","UseStandingStart","UseStandingEnd","CreatureSpecial","Drown","Drowned","FishingCast","FishingLoop","Fly","EmoteWorkNoSheathe","EmoteStunNoSheathe","EmoteUseStandingNoSheathe","SpellSleepDown","SpellKneelStart","SpellKneelLoop","SpellKneelEnd","Sprint","InFlight","Spawn","Close","Closed","Open","Opened","Destroy","Destroyed","Rebuild","Custom0","Custom1","Custom2","Custom3","Despawn","Hold","Decay","BowPull","BowRelease","ShipStart","ShipMoving","ShipStop","GroupArrow","Arrow","CorpseArrow","GuideArrow","Sway","DruidCatPounce","DruidCatRip","DruidCatRake","DruidCatRavage","DruidCatClaw","DruidCatCower","DruidBearSwipe","DruidBearBite","DruidBearMaul","DruidBearBash","DragonTail","DragonStomp","DragonSpit","DragonSpitHover","DragonSpitFly","EmoteYes","EmoteNo","JumpLandRun","LootHold","LootUp","StandHigh","Impact","LiftOff","Hover","SuccubusEntice","EmoteTrain","EmoteDead","EmoteDanceOnce","Deflect","EmoteEatNoSheathe","Land","Submerge","Submerged","Cannibalize","ArrowBirth","GroupArrowBirth","CorpseArrowBirth","GuideArrowBirth","EmoteTalkNoSheathe","EmotePointNoSheathe","EmoteSaluteNoSheathe","EmoteDanceSpecial","Mutilate","CustomSpell01","CustomSpell02","CustomSpell03","CustomSpell04","CustomSpell05","CustomSpell06","CustomSpell07","CustomSpell08","CustomSpell09","CustomSpell10","StealthRun","Emerge","Cower","Grab","GrabClosed","GrabThrown","FlyStand","FlyDeath","FlySpell","FlyStop","FlyWalk","FlyRun","FlyDead","FlyRise","FlyStandWound","FlyCombatWound","FlyCombatCritical","FlyShuffleLeft","FlyShuffleRight","FlyWalkbackwards","FlyStun","FlyHandsClosed","FlyAttackUnarmed","FlyAttack1H","FlyAttack2H","FlyAttack2HL","FlyParryUnarmed","FlyParry1H","FlyParry2H","FlyParry2HL","FlyShieldBlock","FlyReadyUnarmed","FlyReady1H","FlyReady2H","FlyReady2HL","FlyReadyBow","FlyDodge","FlySpellPrecast","FlySpellCast","FlySpellCastArea","FlyNPCWelcome","FlyNPCGoodbye","FlyBlock","FlyJumpStart","FlyJump","FlyJumpEnd","FlyFall","FlySwimIdle","FlySwim","FlySwimLeft","FlySwimRight","FlySwimBackwards","FlyAttackBow","FlyFireBow","FlyReadyRifle","FlyAttackRifle","FlyLoot","FlyReadySpellDirected","FlyReadySpellOmni","FlySpellCastDirected","FlySpellCastOmni","FlyBattleRoar","FlyReadyAbility","FlySpecial1H","FlySpecial2H","FlyShieldBash","FlyEmoteTalk","FlyEmoteEat","FlyEmoteWork","FlyEmoteUseStanding","FlyEmoteTalkExclamation","FlyEmoteTalkQuestion","FlyEmoteBow","FlyEmoteWave","FlyEmoteCheer","FlyEmoteDance","FlyEmoteLaugh","FlyEmoteSleep","FlyEmoteSitGround","FlyEmoteRude","FlyEmoteRoar","FlyEmoteKneel","FlyEmoteKiss","FlyEmoteCry","FlyEmoteChicken","FlyEmoteBeg","FlyEmoteApplaud","FlyEmoteShout","FlyEmoteFlex","FlyEmoteShy","FlyEmotePoint","FlyAttack1HPierce","FlyAttack2HLoosePierce","FlyAttackOff","FlyAttackOffPierce","FlySheath","FlyHipSheath","FlyMount","FlyRunRight","FlyRunLeft","FlyMountSpecial","FlyKick","FlySitGroundDown","FlySitGround","FlySitGroundUp","FlySleepDown","FlySleep","FlySleepUp","FlySitChairLow","FlySitChairMed","FlySitChairHigh","FlyLoadBow","FlyLoadRifle","FlyAttackThrown","FlyReadyThrown","FlyHoldBow","FlyHoldRifle","FlyHoldThrown","FlyLoadThrown","FlyEmoteSalute","FlyKneelStart","FlyKneelLoop","FlyKneelEnd","FlyAttackUnarmedOff","FlySpecialUnarmed","FlyStealthWalk","FlyStealthStand","FlyKnockdown","FlyEatingLoop","FlyUseStandingLoop","FlyChannelCastDirected","FlyChannelCastOmni","FlyWhirlwind","FlyBirth","FlyUseStandingStart","FlyUseStandingEnd","FlyCreatureSpecial","FlyDrown","FlyDrowned","FlyFishingCast","FlyFishingLoop","FlyFly","FlyEmoteWorkNoSheathe","FlyEmoteStunNoSheathe","FlyEmoteUseStandingNoSheathe","FlySpellSleepDown","FlySpellKneelStart","FlySpellKneelLoop","FlySpellKneelEnd","FlySprint","FlyInFlight","FlySpawn","FlyClose","FlyClosed","FlyOpen","FlyOpened","FlyDestroy","FlyDestroyed","FlyRebuild","FlyCustom0","FlyCustom1","FlyCustom2","FlyCustom3","FlyDespawn","FlyHold","FlyDecay","FlyBowPull","FlyBowRelease","FlyShipStart","FlyShipMoving","FlyShipStop","FlyGroupArrow","FlyArrow","FlyCorpseArrow","FlyGuideArrow","FlySway","FlyDruidCatPounce","FlyDruidCatRip","FlyDruidCatRake","FlyDruidCatRavage","FlyDruidCatClaw","FlyDruidCatCower","FlyDruidBearSwipe","FlyDruidBearBite","FlyDruidBearMaul","FlyDruidBearBash","FlyDragonTail","FlyDragonStomp","FlyDragonSpit","FlyDragonSpitHover","FlyDragonSpitFly","FlyEmoteYes","FlyEmoteNo","FlyJumpLandRun","FlyLootHold","FlyLootUp","FlyStandHigh","FlyImpact","FlyLiftOff","FlyHover","FlySuccubusEntice","FlyEmoteTrain","FlyEmoteDead","FlyEmoteDanceOnce","FlyDeflect","FlyEmoteEatNoSheathe","FlyLand","FlySubmerge","FlySubmerged","FlyCannibalize","FlyArrowBirth","FlyGroupArrowBirth","FlyCorpseArrowBirth","FlyGuideArrowBirth","FlyEmoteTalkNoSheathe","FlyEmotePointNoSheathe","FlyEmoteSaluteNoSheathe","FlyEmoteDanceSpecial","FlyMutilate","FlyCustomSpell01","FlyCustomSpell02","FlyCustomSpell03","FlyCustomSpell04","FlyCustomSpell05","FlyCustomSpell06","FlyCustomSpell07","FlyCustomSpell08","FlyCustomSpell09","FlyCustomSpell10","FlyStealthRun","FlyEmerge","FlyCower","FlyGrab","FlyGrabClosed","FlyGrabThrown","ToFly","ToHover","ToGround","FlyToFly","FlyToHover","FlyToGround","Settle","FlySettle","DeathStart","DeathLoop","DeathEnd","FlyDeathStart","FlyDeathLoop","FlyDeathEnd","DeathEndHold","FlyDeathEndHold","Strangulate","FlyStrangulate","ReadyJoust","LoadJoust","HoldJoust","FlyReadyJoust","FlyLoadJoust","FlyHoldJoust","AttackJoust","FlyAttackJoust","ReclinedMount","FlyReclinedMount","ToAltered","FromAltered","FlyToAltered","FlyFromAltered","InStocks","FlyInStocks","VehicleGrab","VehicleThrow","FlyVehicleGrab","FlyVehicleThrow","ToAlteredPostSwap","FromAlteredPostSwap","FlyToAlteredPostSwap","FlyFromAlteredPostSwap","ReclinedMountPassenger","FlyReclinedMountPassenger","Carry2H","Carried2H","FlyCarry2H","FlyCarried2H","EmoteSniff","EmoteFlySniff","AttackFist1H","FlyAttackFist1H","AttackFist1HOff","FlyAttackFist1HOff","ParryFist1H","FlyParryFist1H","ReadyFist1H","FlyReadyFist1H","SpecialFist1H","FlySpecialFist1H","EmoteReadStart","FlyEmoteReadStart","EmoteReadLoop","FlyEmoteReadLoop","EmoteReadEnd","FlyEmoteReadEnd","SwimRun","FlySwimRun","SwimWalk","FlySwimWalk","SwimWalkBackwards","FlySwimWalkBackwards","SwimSprint","FlySwimSprint","MountSwimIdle","FlyMountSwimIdle","MountSwimBackwards","FlyMountSwimBackwards","MountSwimLeft","FlyMountSwimLeft","MountSwimRight","FlyMountSwimRight","MountSwimRun","FlyMountSwimRun","MountSwimSprint","FlyMountSwimSprint","MountSwimWalk","FlyMountSwimWalk","MountSwimWalkBackwards","FlyMountSwimWalkBackwards","MountFlightIdle","FlyMountFlightIdle","MountFlightBackwards","FlyMountFlightBackwards","MountFlightLeft","FlyMountFlightLeft","MountFlightRight","FlyMountFlightRight","MountFlightRun","FlyMountFlightRun","MountFlightSprint","FlyMountFlightSprint","MountFlightWalk","FlyMountFlightWalk","MountFlightWalkBackwards","FlyMountFlightWalkBackwards","MountFlightStart","FlyMountFlightStart","MountSwimStart","FlyMountSwimStart","MountSwimLand","FlyMountSwimLand","MountSwimLandRun","FlyMountSwimLandRun","MountFlightLand","FlyMountFlightLand","MountFlightLandRun","FlyMountFlightLandRun","ReadyBlowDart","FlyReadyBlowDart","LoadBlowDart","FlyLoadBlowDart","HoldBlowDart","FlyHoldBlowDart","AttackBlowDart","FlyAttackBlowDart","CarriageMount","FlyCarriageMount","CarriagePassengerMount","FlyCarriagePassengerMount","CarriageMountAttack","FlyCarriageMountAttack","BarTendStand","FlyBarTendStand","BarServerWalk","FlyBarServerWalk","BarServerRun","FlyBarServerRun","BarServerShuffleLeft","FlyBarServerShuffleLeft","BarServerShuffleRight","FlyBarServerShuffleRight","BarTendEmoteTalk","FlyBarTendEmoteTalk","BarTendEmotePoint","FlyBarTendEmotePoint","BarServerStand","FlyBarServerStand","BarSweepWalk","FlyBarSweepWalk","BarSweepRun","FlyBarSweepRun","BarSweepShuffleLeft","FlyBarSweepShuffleLeft","BarSweepShuffleRight","FlyBarSweepShuffleRight","BarSweepEmoteTalk","FlyBarSweepEmoteTalk","BarPatronSitEmotePoint","FlyBarPatronSitEmotePoint","MountSelfIdle","FlyMountSelfIdle","MountSelfWalk","FlyMountSelfWalk","MountSelfRun","FlyMountSelfRun","MountSelfSprint","FlyMountSelfSprint","MountSelfRunLeft","FlyMountSelfRunLeft","MountSelfRunRight","FlyMountSelfRunRight","MountSelfShuffleLeft","FlyMountSelfShuffleLeft","MountSelfShuffleRight","FlyMountSelfShuffleRight","MountSelfWalkBackwards","FlyMountSelfWalkBackwards","MountSelfSpecial","FlyMountSelfSpecial","MountSelfJump","FlyMountSelfJump","MountSelfJumpStart","FlyMountSelfJumpStart","MountSelfJumpEnd","FlyMountSelfJumpEnd","MountSelfJumpLandRun","FlyMountSelfJumpLandRun","MountSelfStart","FlyMountSelfStart","MountSelfFall","FlyMountSelfFall","Stormstrike","FlyStormstrike","ReadyJoustNoSheathe","FlyReadyJoustNoSheathe","Slam","FlySlam","DeathStrike","FlyDeathStrike","SwimAttackUnarmed","FlySwimAttackUnarmed","SpinningKick","FlySpinningKick","RoundHouseKick","FlyRoundHouseKick","RollStart","FlyRollStart","Roll","FlyRoll","RollEnd","FlyRollEnd","PalmStrike","FlyPalmStrike","MonkOffenseAttackUnarmed","FlyMonkOffenseAttackUnarmed","MonkOffenseAttackUnarmedOff","FlyMonkOffenseAttackUnarmedOff","MonkOffenseParryUnarmed","FlyMonkOffenseParryUnarmed","MonkOffenseReadyUnarmed","FlyMonkOffenseReadyUnarmed","MonkOffenseSpecialUnarmed","FlyMonkOffenseSpecialUnarmed","MonkDefenseAttackUnarmed","FlyMonkDefenseAttackUnarmed","MonkDefenseAttackUnarmedOff","FlyMonkDefenseAttackUnarmedOff","MonkDefenseParryUnarmed","FlyMonkDefenseParryUnarmed","MonkDefenseReadyUnarmed","FlyMonkDefenseReadyUnarmed","MonkDefenseSpecialUnarmed","FlyMonkDefenseSpecialUnarmed","MonkHealAttackUnarmed","FlyMonkHealAttackUnarmed","MonkHealAttackUnarmedOff","FlyMonkHealAttackUnarmedOff","MonkHealParryUnarmed","FlyMonkHealParryUnarmed","MonkHealReadyUnarmed","FlyMonkHealReadyUnarmed","MonkHealSpecialUnarmed","FlyMonkHealSpecialUnarmed","FlyingKick","FlyFlyingKick","FlyingKickStart","FlyFlyingKickStart","FlyingKickEnd","FlyFlyingKickEnd","CraneStart","FlyCraneStart","CraneLoop","FlyCraneLoop","CraneEnd","FlyCraneEnd","Despawned","FlyDespawned","ThousandFists","FlyThousandFists","MonkHealReadySpellDirected","FlyMonkHealReadySpellDirected","MonkHealReadySpellOmni","FlyMonkHealReadySpellOmni","MonkHealSpellCastDirected","FlyMonkHealSpellCastDirected","MonkHealSpellCastOmni","FlyMonkHealSpellCastOmni","MonkHealChannelCastDirected","FlyMonkHealChannelCastDirected","MonkHealChannelCastOmni","FlyMonkHealChannelCastOmni","Torpedo","FlyTorpedo","Meditate","FlyMeditate","BreathOfFire","FlyBreathOfFire","RisingSunKick","FlyRisingSunKick","GroundKick","FlyGroundKick","KickBack","FlyKickBack","PetBattleStand","FlyPetBattleStand","PetBattleDeath","FlyPetBattleDeath","PetBattleRun","FlyPetBattleRun","PetBattleWound","FlyPetBattleWound","PetBattleAttack","FlyPetBattleAttack","PetBattleReadySpell","FlyPetBattleReadySpell","PetBattleSpellCast","FlyPetBattleSpellCast","PetBattleCustom0","FlyPetBattleCustom0","PetBattleCustom1","FlyPetBattleCustom1","PetBattleCustom2","FlyPetBattleCustom2","PetBattleCustom3","FlyPetBattleCustom3","PetBattleVictory","FlyPetBattleVictory","PetBattleLoss","FlyPetBattleLoss","PetBattleStun","FlyPetBattleStun","PetBattleDead","FlyPetBattleDead","PetBattleFreeze","FlyPetBattleFreeze","MonkOffenseAttackWeapon","FlyMonkOffenseAttackWeapon","BarTendEmoteWave","FlyBarTendEmoteWave","BarServerEmoteTalk","FlyBarServerEmoteTalk","BarServerEmoteWave","FlyBarServerEmoteWave","BarServerPourDrinks","FlyBarServerPourDrinks","BarServerPickup","FlyBarServerPickup","BarServerPutDown","FlyBarServerPutDown","BarSweepStand","FlyBarSweepStand","BarPatronSit","FlyBarPatronSit","BarPatronSitEmoteTalk","FlyBarPatronSitEmoteTalk","BarPatronStand","FlyBarPatronStand","BarPatronStandEmoteTalk","FlyBarPatronStandEmoteTalk","BarPatronStandEmotePoint","FlyBarPatronStandEmotePoint","CarrionSwarm","FlyCarrionSwarm","WheelLoop","FlyWheelLoop","StandCharacterCreate","FlyStandCharacterCreate","MountChopper","FlyMountChopper","FacePose","FlyFacePose","CombatAbility2HBig01","FlyCombatAbility2HBig01","CombatAbility2H01","FlyCombatAbility2H01","CombatWhirlwind","FlyCombatWhirlwind","CombatChargeLoop","FlyCombatChargeLoop","CombatAbility1H01","FlyCombatAbility1H01","CombatChargeEnd","FlyCombatChargeEnd","CombatAbility1H02","FlyCombatAbility1H02","CombatAbility1HBig01","FlyCombatAbility1HBig01","CombatAbility2H02","FlyCombatAbility2H02","ShaSpellPrecastBoth","FlyShaSpellPrecastBoth","ShaSpellCastBothFront","FlyShaSpellCastBothFront","ShaSpellCastLeftFront","FlyShaSpellCastLeftFront","ShaSpellCastRightFront","FlyShaSpellCastRightFront","ReadyCrossbow","FlyReadyCrossbow","LoadCrossbow","FlyLoadCrossbow","AttackCrossbow","FlyAttackCrossbow","HoldCrossbow","FlyHoldCrossbow","CombatAbility2HL01","FlyCombatAbility2HL01","CombatAbility2HL02","FlyCombatAbility2HL02","CombatAbility2HLBig01","FlyCombatAbility2HLBig01","CombatUnarmed01","FlyCombatUnarmed01","CombatStompLeft","FlyCombatStompLeft","CombatStompRight","FlyCombatStompRight","CombatLeapLoop","FlyCombatLeapLoop","CombatLeapEnd","FlyCombatLeapEnd","ShaReadySpellCast","FlyShaReadySpellCast","ShaSpellPrecastBothChannel","FlyShaSpellPrecastBothChannel","ShaSpellCastBothUp","FlyShaSpellCastBothUp","ShaSpellCastBothUpChannel","FlyShaSpellCastBothUpChannel","ShaSpellCastBothFrontChannel","FlyShaSpellCastBothFrontChannel","ShaSpellCastLeftFrontChannel","FlyShaSpellCastLeftFrontChannel","ShaSpellCastRightFrontChannel","FlyShaSpellCastRightFrontChannel","PriReadySpellCast","FlyPriReadySpellCast","PriSpellPrecastBoth","FlyPriSpellPrecastBoth","PriSpellPrecastBothChannel","FlyPriSpellPrecastBothChannel","PriSpellCastBothUp","FlyPriSpellCastBothUp","PriSpellCastBothFront","FlyPriSpellCastBothFront","PriSpellCastLeftFront","FlyPriSpellCastLeftFront","PriSpellCastRightFront","FlyPriSpellCastRightFront","PriSpellCastBothUpChannel","FlyPriSpellCastBothUpChannel","PriSpellCastBothFrontChannel","FlyPriSpellCastBothFrontChannel","PriSpellCastLeftFrontChannel","FlyPriSpellCastLeftFrontChannel","PriSpellCastRightFrontChannel","FlyPriSpellCastRightFrontChannel","MagReadySpellCast","FlyMagReadySpellCast","MagSpellPrecastBoth","FlyMagSpellPrecastBoth","MagSpellPrecastBothChannel","FlyMagSpellPrecastBothChannel","MagSpellCastBothUp","FlyMagSpellCastBothUp","MagSpellCastBothFront","FlyMagSpellCastBothFront","MagSpellCastLeftFront","FlyMagSpellCastLeftFront","MagSpellCastRightFront","FlyMagSpellCastRightFront","MagSpellCastBothUpChannel","FlyMagSpellCastBothUpChannel","MagSpellCastBothFrontChannel","FlyMagSpellCastBothFrontChannel","MagSpellCastLeftFrontChannel","FlyMagSpellCastLeftFrontChannel","MagSpellCastRightFrontChannel","FlyMagSpellCastRightFrontChannel","LocReadySpellCast","FlyLocReadySpellCast","LocSpellPrecastBoth","FlyLocSpellPrecastBoth","LocSpellPrecastBothChannel","FlyLocSpellPrecastBothChannel","LocSpellCastBothUp","FlyLocSpellCastBothUp","LocSpellCastBothFront","FlyLocSpellCastBothFront","LocSpellCastLeftFront","FlyLocSpellCastLeftFront","LocSpellCastRightFront","FlyLocSpellCastRightFront","LocSpellCastBothUpChannel","FlyLocSpellCastBothUpChannel","LocSpellCastBothFrontChannel","FlyLocSpellCastBothFrontChannel","LocSpellCastLeftFrontChannel","FlyLocSpellCastLeftFrontChannel","LocSpellCastRightFrontChannel","FlyLocSpellCastRightFrontChannel","DruReadySpellCast","FlyDruReadySpellCast","DruSpellPrecastBoth","FlyDruSpellPrecastBoth","DruSpellPrecastBothChannel","FlyDruSpellPrecastBothChannel","DruSpellCastBothUp","FlyDruSpellCastBothUp","DruSpellCastBothFront","FlyDruSpellCastBothFront","DruSpellCastLeftFront","FlyDruSpellCastLeftFront","DruSpellCastRightFront","FlyDruSpellCastRightFront","DruSpellCastBothUpChannel","FlyDruSpellCastBothUpChannel","DruSpellCastBothFrontChannel","FlyDruSpellCastBothFrontChannel","DruSpellCastLeftFrontChannel","FlyDruSpellCastLeftFrontChannel","DruSpellCastRightFrontChannel","FlyDruSpellCastRightFrontChannel","ArtMainLoop","FlyArtMainLoop","ArtDualLoop","FlyArtDualLoop","ArtFistsLoop","FlyArtFistsLoop","ArtBowLoop","FlyArtBowLoop","CombatAbility1H01Off","FlyCombatAbility1H01Off","CombatAbility1H02Off","FlyCombatAbility1H02Off","CombatFuriousStrike01","FlyCombatFuriousStrike01","CombatFuriousStrike02","FlyCombatFuriousStrike02","CombatFuriousStrikes","FlyCombatFuriousStrikes","CombatReadySpellCast","FlyCombatReadySpellCast","CombatShieldThrow","FlyCombatShieldThrow","PalSpellCast1HUp","FlyPalSpellCast1HUp","CombatReadyPostSpellCast","FlyCombatReadyPostSpellCast","PriReadyPostSpellCast","FlyPriReadyPostSpellCast","DHCombatRun","FlyDHCombatRun","CombatShieldBash","FlyCombatShieldBash","CombatThrow","FlyCombatThrow","CombatAbility1HPierce","FlyCombatAbility1HPierce","CombatAbility1HOffPierce","FlyCombatAbility1HOffPierce","CombatMutilate","FlyCombatMutilate","CombatBladeStorm","FlyCombatBladeStorm","CombatFinishingMove","FlyCombatFinishingMove","CombatLeapStart","FlyCombatLeapStart","GlvThrowMain","FlyGlvThrowMain","GlvThrownOff","FlyGlvThrownOff","DHCombatSprint","FlyDHCombatSprint","CombatAbilityGlv01","FlyCombatAbilityGlv01","CombatAbilityGlv02","FlyCombatAbilityGlv02","CombatAbilityGlvOff01","FlyCombatAbilityGlvOff01","CombatAbilityGlvOff02","FlyCombatAbilityGlvOff02","CombatAbilityGlvBig01","FlyCombatAbilityGlvBig01","CombatAbilityGlvBig02","FlyCombatAbilityGlvBig02","ReadyGlv","FlyReadyGlv","CombatAbilityGlvBig03","FlyCombatAbilityGlvBig03","DoubleJumpStart","FlyDoubleJumpStart","DoubleJump","FlyDoubleJump","CombatEviscerate","FlyCombatEviscerate","DoubleJumpLandRun","FlyDoubleJumpLandRun","BackFlipStart","FlyBackFlipStart","BackFlipLoop","FlyBackFlipLoop","FelRushLoop","FlyFelRushLoop","FelRushEnd","FlyFelRushEnd","DHToAlteredStart","FlyDHToAlteredStart","DHToAlteredEnd","FlyDHToAlteredEnd","DHGlide","FlyDHGlide","FanOfKnives","FlyFanOfKnives","SingleJumpStart","FlySingleJumpStart","DHBladeDance1","FlyDHBladeDance1","DHBladeDance2","FlyDHBladeDance2","DHBladeDance3","FlyDHBladeDance3","DHMeteorStrike","FlyDHMeteorStrike","CombatExecute","FlyCombatExecute","ArtLoop","FlyArtLoop","ParryGlv","FlyParryGlv","CombatUnarmed02","FlyCombatUnarmed02","CombatPistolShot","FlyCombatPistolShot","CombatPistolShotOff","FlyCombatPistolShotOff","Monk2HLIdle","FlyMonk2HLIdle","ArtShieldLoop","FlyArtShieldLoop","CombatAbility2H03","FlyCombatAbility2H03","CombatStomp","FlyCombatStomp","CombatRoar","FlyCombatRoar","PalReadySpellCast","FlyPalReadySpellCast","PalSpellPrecastRight","FlyPalSpellPrecastRight","PalSpellPrecastRightChannel","FlyPalSpellPrecastRightChannel","PalSpellCastRightFront","FlyPalSpellCastRightFront","ShaSpellCastBothOut","FlyShaSpellCastBothOut","AttackWeapon","FlyAttackWeapon","ReadyWeapon","FlyReadyWeapon","AttackWeaponOff","FlyAttackWeaponOff","SpecialDual","FlySpecialDual","DkCast1HFront","FlyDkCast1HFront","CastStrongRight","FlyCastStrongRight","CastStrongLeft","FlyCastStrongLeft","CastCurseRight","FlyCastCurseRight","CastCurseLeft","FlyCastCurseLeft","CastSweepRight","FlyCastSweepRight","CastSweepLeft","FlyCastSweepLeft","CastStrongUpLeft","FlyCastStrongUpLeft","CastTwistUpBoth","FlyCastTwistUpBoth","CastOutStrong","FlyCastOutStrong","DrumLoop","FlyDrumLoop","ParryWeapon","FlyParryWeapon","ReadyFL","FlyReadyFL","AttackFL","FlyAttackFL","AttackFLOff","FlyAttackFLOff","ParryFL","FlyParryFL","SpecialFL","FlySpecialFL","PriHoverForward","FlyPriHoverForward","PriHoverBackward","FlyPriHoverBackward","PriHoverRight","FlyPriHoverRight","PriHoverLeft","FlyPriHoverLeft","RunBackwards","FlyRunBackwards","CastStrongUpRight","FlyCastStrongUpRight","WAWalk","FlyWAWalk","WARun","FlyWARun","WADrunkStand","FlyWADrunkStand","WADrunkShuffleLeft","FlyWADrunkShuffleLeft","WADrunkShuffleRight","FlyWADrunkShuffleRight","WADrunkWalk","FlyWADrunkWalk","WADrunkWalkBackwards","FlyWADrunkWalkBackwards","WADrunkWound","FlyWADrunkWound","WADrunkTalk","FlyWADrunkTalk","WATrance01","FlyWATrance01","WATrance02","FlyWATrance02","WAChant01","FlyWAChant01","WAChant02","FlyWAChant02","WAChant03","FlyWAChant03","WAHang01","FlyWAHang01","WAHang02","FlyWAHang02","WASummon01","FlyWASummon01","WASummon02","FlyWASummon02","WABeggarTalk","FlyWABeggarTalk","WABeggarStand","FlyWABeggarStand","WABeggarPoint","FlyWABeggarPoint","WABeggarBeg","FlyWABeggarBeg","WASit01","FlyWASit01","WASit02","FlyWASit02","WASit03","FlyWASit03","WACrierStand01","FlyWACrierStand01","WACrierStand02","FlyWACrierStand02","WACrierStand03","FlyWACrierStand03","WACrierTalk","FlyWACrierTalk","WACrateHold","FlyWACrateHold","WABarrelHold","FlyWABarrelHold","WASackHold","FlyWASackHold","WAWheelBarrowStand","FlyWAWheelBarrowStand","WAWheelBarrowWalk","FlyWAWheelBarrowWalk","WAWheelBarrowRun","FlyWAWheelBarrowRun","WAHammerLoop","FlyWAHammerLoop","WACrankLoop","FlyWACrankLoop","WAPourStart","FlyWAPourStart","WAPourLoop","FlyWAPourLoop","WAPourEnd","FlyWAPourEnd","WAEmotePour","FlyWAEmotePour","WARowingStandRight","FlyWARowingStandRight","WARowingStandLeft","FlyWARowingStandLeft","WARowingRight","FlyWARowingRight","WARowingLeft","FlyWARowingLeft","WAGuardStand01","FlyWAGuardStand01","WAGuardStand02","FlyWAGuardStand02","WAGuardStand03","FlyWAGuardStand03","WAGuardStand04","FlyWAGuardStand04","WAFreezing01","FlyWAFreezing01","WAFreezing02","FlyWAFreezing02","WAVendorStand01","FlyWAVendorStand01","WAVendorStand02","FlyWAVendorStand02","WAVendorStand03","FlyWAVendorStand03","WAVendorTalk","FlyWAVendorTalk","WALean01","FlyWALean01","WALean02","FlyWALean02","WALean03","FlyWALean03","WALeanTalk","FlyWALeanTalk","WABoatWheel","FlyWABoatWheel","WASmithLoop","FlyWASmithLoop","WAScrubbing","FlyWAScrubbing","WAWeaponSharpen","FlyWAWeaponSharpen","WAStirring","FlyWAStirring","WAPerch01","FlyWAPerch01","WAPerch02","FlyWAPerch02","HoldWeapon","FlyHoldWeapon","WABarrelWalk","FlyWABarrelWalk","WAPourHold","FlyWAPourHold","CastStrong","FlyCastStrong","CastCurse","FlyCastCurse","CastSweep","FlyCastSweep","CastStrongUp","FlyCastStrongUp","WABoatWheelStand","FlyWABoatWheelStand","WASmithStand","FlyWASmithStand","WACrankStand","FlyWACrankStand","WAPourWalk","FlyWAPourWalk","FalconeerStart","FlyFalconeerStart","FalconeerLoop","FlyFalconeerLoop","FalconeerEnd","FlyFalconeerEnd","WADrunkDrink","FlyWADrunkDrink","WAStandEat","FlyWAStandEat","WAStandDrink","FlyWAStandDrink","WABound01","FlyWABound01","WABound02","FlyWABound02","CombatAbility1H03Off","FlyCombatAbility1H03Off","CombatAbilityDualWield01","FlyCombatAbilityDualWield01","WACradle01","FlyWACradle01","LocSummon","FlyLocSummon","LoadWeapon","FlyLoadWeapon","ArtOffLoop","FlyArtOffLoop","WADead01","FlyWADead01","WADead02","FlyWADead02","WADead03","FlyWADead03","WADead04","FlyWADead04","WADead05","FlyWADead05","WADead06","FlyWADead06","WADead07","FlyWADead07","GiantRun","FlyGiantRun","BarTendEmoteCheer","FlyBarTendEmoteCheer","BarTendEmoteTalkQuestion","FlyBarTendEmoteTalkQuestion","BarTendEmoteTalkExclamation","FlyBarTendEmoteTalkExclamation","BarTendWalk","FlyBarTendWalk","BartendShuffleLeft","FlyBartendShuffleLeft","BarTendShuffleRight","FlyBarTendShuffleRight","BarTendCustomSpell01","FlyBarTendCustomSpell01","BarTendCustomSpell02","FlyBarTendCustomSpell02","BarTendCustomSpell03","FlyBarTendCustomSpell03","BarServerEmoteCheer","FlyBarServerEmoteCheer","BarServerEmoteTalkQuestion","FlyBarServerEmoteTalkQuestion","BarServerEmoteTalkExclamation","FlyBarServerEmoteTalkExclamation","BarServerCustomSpell01","FlyBarServerCustomSpell01","BarServerCustomSpell02","FlyBarServerCustomSpell02","BarServerCustomSpell03","FlyBarServerCustomSpell03","BarPatronEmoteDrink","FlyBarPatronEmoteDrink","BarPatronEmoteCheer","FlyBarPatronEmoteCheer","BarPatronCustomSpell01","FlyBarPatronCustomSpell01","BarPatronCustomSpell02","FlyBarPatronCustomSpell02","BarPatronCustomSpell03","FlyBarPatronCustomSpell03","HoldDart","FlyHoldDart","ReadyDart","FlyReadyDart","AttackDart","FlyAttackDart","LoadDart","FlyLoadDart","WADartTargetStand","FlyWADartTargetStand","WADartTargetEmoteTalk","FlyWADartTargetEmoteTalk","BarPatronSitEmoteCheer","FlyBarPatronSitEmoteCheer","BarPatronSitCustomSpell01","FlyBarPatronSitCustomSpell01","BarPatronSitCustomSpell02","FlyBarPatronSitCustomSpell02","BarPatronSitCustomSpell03","FlyBarPatronSitCustomSpell03","BarPianoStand","FlyBarPianoStand","BarPianoEmoteTalk","FlyBarPianoEmoteTalk","WAHearthSit","FlyWAHearthSit","WAHearthSitEmoteCry","FlyWAHearthSitEmoteCry","WAHearthSitEmoteCheer","FlyWAHearthSitEmoteCheer","WAHearthSitCustomSpell01","FlyWAHearthSitCustomSpell01","WAHearthSitCustomSpell02","FlyWAHearthSitCustomSpell02","WAHearthSitCustomSpell03","FlyWAHearthSitCustomSpell03","WAHearthStand","FlyWAHearthStand","WAHearthStandEmoteCheer","FlyWAHearthStandEmoteCheer","WAHearthStandEmoteTalk","FlyWAHearthStandEmoteTalk","WAHearthStandCustomSpell01","FlyWAHearthStandCustomSpell01","WAHearthStandCustomSpell02","FlyWAHearthStandCustomSpell02","WAHearthStandCustomSpell03","FlyWAHearthStandCustomSpell03","WAScribeStart","FlyWAScribeStart","WAScribeLoop","FlyWAScribeLoop","WAScribeEnd","FlyWAScribeEnd","WAEmoteScribe","FlyWAEmoteScribe","Haymaker","FlyHaymaker","HaymakerPrecast","FlyHaymakerPrecast","ChannelCastOmniUp","FlyChannelCastOmniUp","DHJumpLandRun","FlyDHJumpLandRun","Cinematic01","FlyCinematic01","Cinematic02","FlyCinematic02","Cinematic03","FlyCinematic03","Cinematic04","FlyCinematic04","Cinematic05","FlyCinematic05","Cinematic06","FlyCinematic06","Cinematic07","FlyCinematic07","Cinematic08","FlyCinematic08","Cinematic09","FlyCinematic09","Cinematic10","FlyCinematic10","TakeOffStart","FlyTakeOffStart","TakeOffFinish","FlyTakeOffFinish","LandStart","FlyLandStart","LandFinish","FlyLandFinish","WAWalkTalk","FlyWAWalkTalk","WAPerch03","FlyWAPerch03","CarriageMountMoving","FlyCarriageMountMoving","TakeOffFinishFly","FlyTakeOffFinishFly","CombatAbility2HBig02","FlyCombatAbility2HBig02","MountWide","FlyMountWide","EmoteTalkSubdued","FlyEmoteTalkSubdued","WASit04","FlyWASit04","MountSummon","FlyMountSummon","EmoteSelfie","FlyEmoteSelfie","CustomSpell11","FlyCustomSpell11","CustomSpell12","FlyCustomSpell12","CustomSpell13","FlyCustomSpell13","CustomSpell14","FlyCustomSpell14","CustomSpell15","FlyCustomSpell15","CustomSpell16","FlyCustomSpell16","CustomSpell17","FlyCustomSpell17","CustomSpell18","FlyCustomSpell18","CustomSpell19","FlyCustomSpell19","CustomSpell20","FlyCustomSpell20","AdvFlyLeft","FlyAdvFlyLeft","AdvFlyRight","FlyAdvFlyRight","AdvFlyForward","FlyAdvFlyForward","AdvFlyBackward","FlyAdvFlyBackward","AdvFlyUp","FlyAdvFlyUp","AdvFlyDown","FlyAdvFlyDown","AdvFlyForwardGlide","FlyAdvFlyForwardGlide","AdvFlyRoll","FlyAdvFlyRoll","ProfCookingLoop","FlyProfCookingLoop","ProfCookingStart","FlyProfCookingStart","ProfCookingEnd","FlyProfCookingEnd","WACurious","FlyWACurious","WAAlert","FlyWAAlert","WAInvestigate","FlyWAInvestigate","WAInteraction","FlyWAInteraction","WAThreaten","FlyWAThreaten","WAReact01","FlyWAReact01","WAReact02","FlyWAReact02","AdvFlyRollStart","FlyAdvFlyRollStart","AdvFlyRollEnd","FlyAdvFlyRollEnd","EmpBreathPrecast","FlyEmpBreathPrecast","EmpBreathPrecastChannel","FlyEmpBreathPrecastChannel","EmpBreathSpellCast","FlyEmpBreathSpellCast","EmpBreathSpellCastChannel","FlyEmpBreathSpellCastChannel","DracFlyBreathTakeoffStart","FlyDracFlyBreathTakeoffStart","DracFlyBreathTakeoffFinish","FlyDracFlyBreathTakeoffFinish","DracFlyBreath","FlyDracFlyBreath","DracFlyBreathLandStart","FlyDracFlyBreathLandStart","DracFlyBreathLandFinish","FlyDracFlyBreathLandFinish","DracAirDashLeft","FlyDracAirDashLeft","DracAirDashForward","FlyDracAirDashForward","DracAirDashBackward","FlyDracAirDashBackward","DracAirDashRight","FlyDracAirDashRight","LivingWorldProximityEnter","FlyLivingWorldProximityEnter","AdvFlyDownEnd","FlyAdvFlyDownEnd","LivingWorldProximityLoop","FlyLivingWorldProximityLoop","LivingWorldProximityLeave","FlyLivingWorldProximityLeave","EmpAirBarragePrecast","FlyEmpAirBarragePrecast","EmpAirBarragePrecastChannel","FlyEmpAirBarragePrecastChannel","EmpAirBarrageSpellCast","FlyEmpAirBarrageSpellCast","DracClawSwipeLeft","FlyDracClawSwipeLeft","DracClawSwipeRight","FlyDracClawSwipeRight","DracHoverIdle","FlyDracHoverIdle","DracHoverLeft","FlyDracHoverLeft","DracHoverRight","FlyDracHoverRight","DracHoverBackward","FlyDracHoverBackward","DracHoverForward","FlyDracHoverForward","DracAttackWings","FlyDracAttackWings","DracAttackTail","FlyDracAttackTail","AdvFlyStart","FlyAdvFlyStart","AdvFlyLand","FlyAdvFlyLand","AdvFlyLandRun","FlyAdvFlyLandRun","AdvFlyStrafeLeft","FlyAdvFlyStrafeLeft","AdvFlyStrafeRight","FlyAdvFlyStrafeRight","AdvFlyIdle","FlyAdvFlyIdle","AdvFlyRollRight","FlyAdvFlyRollRight","AdvFlyRollRightEnd","FlyAdvFlyRollRightEnd","AdvFlyRollLeft","FlyAdvFlyRollLeft","AdvFlyRollLeftEnd","FlyAdvFlyRollLeftEnd","AdvFlyFlap","FlyAdvFlyFlap","DracHoverDracClawSwipeLeft","FlyDracHoverDracClawSwipeLeft","DracHoverDracClawSwipeRight","FlyDracHoverDracClawSwipeRight","DracHoverDracAttackWings","FlyDracHoverDracAttackWings","DracHoverReadySpellOmni","FlyDracHoverReadySpellOmni","DracHoverSpellCastOmni","FlyDracHoverSpellCastOmni","DracHoverChannelSpellOmni","FlyDracHoverChannelSpellOmni","DracHoverReadySpellDirected","FlyDracHoverReadySpellDirected","DracHoverChannelSpellDirected","FlyDracHoverChannelSpellDirected","DracHoverSpellCastDirected","FlyDracHoverSpellCastDirected","DracHoverCastOutStrong","FlyDracHoverCastOutStrong","DracHoverBattleRoar","FlyDracHoverBattleRoar","DracHoverEmpBreathSpellCast","FlyDracHoverEmpBreathSpellCast","DracHoverEmpBreathSpellCastChannel","FlyDracHoverEmpBreathSpellCastChannel","LivingWorldTimeOfDayEnter","FlyLivingWorldTimeOfDayEnter","LivingWorldTimeOfDayLoop","FlyLivingWorldTimeOfDayLoop","LivingWorldTimeOfDayLeave","FlyLivingWorldTimeOfDayLeave","LivingWorldWeatherEnter","FlyLivingWorldWeatherEnter","LivingWorldWeatherLoop","FlyLivingWorldWeatherLoop","LivingWorldWeatherLeave","FlyLivingWorldWeatherLeave","AdvFlyDownStart","FlyAdvFlyDownStart","AdvFlyFlapBig","FlyAdvFlyFlapBig","DracHoverReadyUnarmed","FlyDracHoverReadyUnarmed","DracHoverAttackUnarmed","FlyDracHoverAttackUnarmed","DracHoverParryUnarmed","FlyDracHoverParryUnarmed","DracHoverCombatWound","FlyDracHoverCombatWound","DracHoverCombatCritical","FlyDracHoverCombatCritical","DracHoverAttackTail","FlyDracHoverAttackTail","Glide","FlyGlide","GlideEnd","FlyGlideEnd","DracClawSwipe","FlyDracClawSwipe","DracHoverDracClawSwipe","FlyDracHoverDracClawSwipe","AdvFlyFlapUp","FlyAdvFlyFlapUp","AdvFlySlowFall","FlyAdvFlySlowFall","AdvFlyFlapFoward","FlyAdvFlyFlapFoward","DracSpellCastWings","FlyDracSpellCastWings","DracHoverDracSpellCastWings","FlyDracHoverDracSpellCastWings","DracAirDashVertical","FlyDracAirDashVertical","DracAirDashRefresh","FlyDracAirDashRefresh","SkinningLoop","FlySkinningLoop","SkinningStart","FlySkinningStart","SkinningEnd","FlySkinningEnd","AdvFlyForwardGlideSlow","FlyAdvFlyForwardGlideSlow","AdvFlyForwardGlideFast","FlyAdvFlyForwardGlideFast","AdvFlySecondFlapUp","FlyAdvFlySecondFlapUp","FloatIdle","FlyFloatIdle","FloatWalk","FlyFloatWalk","CinematicTalk","FlyCinematicTalk","CinematicWAGuardEmoteSlam01","FlyCinematicWAGuardEmoteSlam01","WABlowHorn","FlyWABlowHorn","MountExtraWide","FlyMountExtraWide","WA2HIdle","FlyWA2HIdle","HerbalismLoop","FlyHerbalismLoop","CookingLoop","FlyCookingLoop","WAWeaponSharpenNoSheathe","FlyWAWeaponSharpenNoSheathe","CinematicDeath","FlyCinematicDeath","CinematicDeathPose","FlyCinematicDeathPose","EmpSlamPrecast","FlyEmpSlamPrecast","EmpSlamPrecastChannel","FlyEmpSlamPrecastChannel","EmpSlamSpellCast","FlyEmpSlamSpellCast","Climb","FlyClimb","ClimbStart","FlyClimbStart","ClimbEnd","FlyClimbEnd","MountLeanLeft","FlyMountLeanLeft","MountLeanRight","FlyMountLeanRight","MountDive","FlyMountDive","MountCrouch","FlyMountCrouch","WAShovelLoop","FlyWAShovelLoop","EmoteTalkFrustrated","FlyEmoteTalkFrustrated"];t.getAnimationName=e=>e in r?r[e]:"UnknownAnim_"+e},6500:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseCM2File=function(e){let t=new i.BinaryReader(e);if(1129132614!=t.readUInt32LE())throw new Error("Encountered wrong magic number. File data is probably not CM2 data?");const r=t.readUInt32LE();if(1e3!=r)throw new Error("Incompatible version encountered in CM2. Supported versions are: 1000. Encountered: "+r);const n=t.readUInt32LE(),s=t.readUInt32LE(),F=t.readUInt32LE(),C=t.readUInt32LE(),w=t.readUInt32LE(),M=t.readUInt32LE(),S=t.readUInt32LE(),D=t.readUInt32LE(),A=t.readUInt32LE(),T=t.readUInt32LE(),E=t.readUInt32LE(),B=t.readUInt32LE(),k=t.readUInt32LE(),L=t.readUInt32LE(),P=t.readUInt32LE(),I=t.readUInt32LE(),O=t.readUInt32LE(),R=t.readUInt32LE(),U=t.readUInt32LE(),W=t.readUInt32LE(),V=t.readUInt32LE(),z=t.readUInt32LE(),j=t.readUInt32LE(),G=t.readUInt32LE(),H=t.readUInt32LE(),N=t.readUInt32LE(),q=t.readUInt32LE();let K;const Z=t.readRemainingBytes();try{K=(0,a.inflate)(Z)}catch(e){throw new Error("Error while inflating zlib compressed data: "+e)}if(K.length<q)throw new Error("Compressed data appears to be smaller than expected? Received: "+K.length+" expected: "+q);t=new i.BinaryReader(K.buffer),t.seek(P);const X=(0,o.readArray)(t,(e=>e.readUInt16LE()));t.seek(L);const Y=(0,o.readArray)(t,u);t.seek(V);const $=(0,o.readArray)(t,(e=>e.readInt16LE()));t.seek(W);const Q=(0,o.readArray)(t,g);t.seek(M);const J=(0,o.readArray)(t,(e=>e.readInt16LE()));t.seek(S);const ee=(0,o.readArray)(t,(e=>e.readInt16LE()));t.seek(w);const te=(0,o.readArray)(t,d);t.seek(z);const re=(0,o.readArray)(t,y);t.seek(k);const ae=(0,o.readArray)(t,(e=>e.readUInt32LE()));t.seek(A);const ie=(0,o.readArray)(t,f);t.seek(G);const oe=(0,o.readArray)(t,(e=>e.readInt16LE()));t.seek(j);const ne=(0,o.readArray)(t,v);t.seek(H);const se=(0,o.readArray)(t,b);t.seek(N);const le=(0,o.readArray)(t,_);t.seek(F);const ue=(0,o.readArray)(t,(e=>e.readUInt16LE()));t.seek(C);const de=(0,o.readArray)(t,c);t.seek(E);const ce=(0,o.readArray)(t,(e=>e.readInt16LE()));t.seek(B);const he=(0,o.readArray)(t,(e=>e.readInt16LE()));t.seek(T);const fe=(0,o.readArray)(t,p);t.seek(U);const pe=(0,o.readArray)(t,(e=>e.readInt16LE()));t.seek(R);const me=(0,o.readArray)(t,m);t.seek(D);const ge=(0,o.readArray)(t,h);t.seek(O);const ye=(0,o.readArray)(t,(e=>e.readInt16LE()));t.seek(I);const xe=(0,o.readArray)(t,x);t.seek(s);return{flags:n,animationLookup:X,animations:Y,attachmentIdLookup:$,attachments:Q,boneCombos:J,boneIdLookup:ee,bones:te,colors:re,globalLoops:ae,materials:ie,particleEmitterGeosets:oe,particleEmitters:ne,particles:se,ribbonEmitters:le,skinTriangles:ue,submeshes:de,textureCombos:ce,textureIdLookup:he,textures:fe,textureTransformCombos:pe,textureTransforms:me,textureUnits:ge,textureWeightCombos:ye,textureWeights:xe,vertices:(0,o.readArray)(t,l)}},t.parseCM2BoneFile=function(e){let t;try{t=(0,a.inflate)(e)}catch(e){throw new Error("Error while inflating zlib compressed data: "+e)}var r=new i.BinaryReader(t.buffer);return{boneIds:(0,o.readArray)(r,(e=>e.readUInt16LE())),boneOffsetMatrices:(0,o.readArray)(r,o.readFloat44)}};const a=r(1668),i=r(9266),o=r(4337);function n(e,t){return{keys:(0,o.readArray)(e,(e=>e.readInt16LE())),values:(0,o.readArray)(e,t)}}function s(e,t){const r={interpolationType:e.readInt16LE(),globalSequence:e.readInt16LE(),animations:(0,o.readArray)(e,(e=>function(e,t){const r={timeStamps:(0,o.readArray)(e,(e=>e.readInt32LE())),values:(0,o.readArray)(e,t)};return r}(e,t)))};return r}function l(e){return{position:(0,o.readFloat3)(e),normal:(0,o.readFloat3)(e),texCoords1:(0,o.readFloat2)(e),texCoords2:(0,o.readFloat2)(e),boneWeights:[e.readUInt8(),e.readUInt8(),e.readUInt8(),e.readUInt8()],boneIndices:[e.readUInt8(),e.readUInt8(),e.readUInt8(),e.readUInt8()]}}function u(e){return{id:e.readUInt16LE(),variationIndex:e.readUInt16LE(),duration:e.readUInt32LE(),flags:e.readUInt32LE(),frequency:e.readUInt16LE(),blendTimeIn:e.readUInt16LE(),blendTimeOut:e.readUInt16LE(),extentBox:(0,o.readAABB)(e),variationNext:e.readInt16LE(),aliasNext:e.readUInt16LE()}}function d(e){return{keyBoneId:e.readInt32LE(),flags:e.readUInt32LE(),parentBoneId:e.readInt16LE(),subMeshId:e.readInt16LE(),boneNameCRC:e.readUInt32LE(),pivot:(0,o.readFloat3)(e),translation:s(e,o.readFloat3),rotation:s(e,o.readQuaternion),scale:s(e,o.readFloat3)}}function c(e){return{submeshId:e.readUInt16LE(),level:e.readUInt16LE(),vertexStart:e.readUInt16LE(),vertexCount:e.readUInt16LE(),triangleStart:e.readUInt16LE(),triangleCount:e.readUInt16LE(),centerBoneIndex:e.readUInt16LE(),centerPosition:(0,o.readFloat3)(e),sortCenterPosition:(0,o.readFloat3)(e),sortRadius:e.readFloatLE()}}function h(e){return{flags:e.readUInt8(),priority:e.readUInt8(),shaderId:e.readUInt16LE(),skinSectionIndex:e.readUInt16LE(),flags2:e.readUInt16LE(),colorIndex:e.readInt16LE(),materialIndex:e.readUInt16LE(),materialLayer:e.readUInt16LE(),textureCount:e.readUInt16LE(),textureComboIndex:e.readUInt16LE(),textureCoordComboIndex:e.readUInt16LE(),textureWeightComboIndex:e.readUInt16LE(),textureTransformComboIndex:e.readUInt16LE()}}function f(e){return{flags:e.readUInt16LE(),blendingMode:e.readUInt16LE()}}function p(e){return{type:e.readInt32LE(),flags:e.readUInt32LE(),textureId:e.readUInt32LE()}}function m(e){return{translation:s(e,o.readFloat3),rotation:s(e,o.readFloat4),scaling:s(e,o.readFloat3)}}function g(e){return{id:e.readInt32LE(),bone:e.readInt32LE(),position:(0,o.readFloat3)(e)}}function y(e){return{color:s(e,o.readFloat3),alpha:s(e,(e=>e.readUInt16LE()))}}function x(e){return{weights:s(e,(e=>e.readUInt16LE()))}}function v(e){return{particleId:e.readInt32LE(),flags:e.readUInt32LE(),position:(0,o.readFloat3)(e),bone:e.readInt16LE(),texture:e.readInt16LE(),blendingType:e.readUInt8(),emitterType:e.readUInt8(),particleColorIndex:e.readUInt16LE(),textureTileRotation:e.readUInt16LE(),textureDimensionsRows:e.readUInt16LE(),textureDimensionsColumns:e.readUInt16LE(),lifespanVary:e.readFloatLE(),emissionRateVary:e.readFloatLE(),colorTrack:n(e,o.readFloat3),alphaTrack:n(e,(e=>e.readUInt16LE())),scaleTrack:n(e,o.readFloat2),scaleVary:(0,o.readFloat2)(e),headCellTrack:n(e,(e=>e.readUInt16LE())),tailCellTrack:n(e,(e=>e.readUInt16LE())),tailLength:e.readFloatLE(),twinkleSpeed:e.readFloatLE(),twinklePercent:e.readFloatLE(),twinkleScale:(0,o.readFloat2)(e),burstMultiplier:e.readFloatLE(),drag:e.readFloatLE(),baseSpin:e.readFloatLE(),baseSpinVary:e.readFloatLE(),spin:e.readFloatLE(),spinVary:e.readFloatLE(),tumbleModelRotationSpeedMin:(0,o.readFloat3)(e),tumbleModelRotationSpeedMax:(0,o.readFloat3)(e),windVector:(0,o.readFloat3)(e),windTime:e.readFloatLE(),followSpeed1:e.readFloatLE(),followScale1:e.readFloatLE(),followSpeed2:e.readFloatLE(),followScale2:e.readFloatLE(),multiTextureParamX:(0,o.readFloat2)(e),multiTextureParam0:[(0,o.readFloat2)(e),(0,o.readFloat2)(e)],multiTextureParam1:[(0,o.readFloat2)(e),(0,o.readFloat2)(e)],emissionSpeed:s(e,(e=>e.readFloatLE())),speedVariation:s(e,(e=>e.readFloatLE())),verticalRange:s(e,(e=>e.readFloatLE())),horizontalRange:s(e,(e=>e.readFloatLE())),gravity:s(e,o.readFloat3),lifespan:s(e,(e=>e.readFloatLE())),emissionAreaLength:s(e,(e=>e.readFloatLE())),emissionAreaWidth:s(e,(e=>e.readFloatLE())),zSource:s(e,(e=>e.readFloatLE())),emissionRate:s(e,(e=>e.readFloatLE())),splinePoints:(0,o.readArray)(e,o.readFloat3),enabledIn:s(e,(e=>e.readUInt8()))}}function b(e){return{zSource:e.readFloatLE(),colorMult:e.readFloatLE(),alphaMult:e.readFloatLE(),alphaCutoff:n(e,(e=>e.readUInt16LE()))}}function _(e){return{ribbonId:e.readInt32LE(),boneIndex:e.readInt32LE(),position:(0,o.readFloat3)(e),edgesPerSecond:e.readFloatLE(),edgeLifetime:e.readFloatLE(),gravity:e.readFloatLE(),textureRows:e.readInt16LE(),textureCols:e.readInt16LE(),priorityPlane:e.readInt16LE(),texSlotTrack:s(e,(e=>e.readUInt16LE())),visibilityTrack:s(e,(e=>e.readUInt8())),textureIndices:(0,o.readArray)(e,(e=>e.readInt16LE())),materialIndices:(0,o.readArray)(e,(e=>e.readInt16LE())),colorTrack:s(e,o.readFloat3),alphaTrack:s(e,(e=>e.readUInt16LE())),heightAboveTrack:s(e,(e=>e.readFloatLE())),heightBelowTrack:s(e,(e=>e.readFloatLE()))}}},6677:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BinaryReader=void 0,t.BinaryReader=class{constructor(e){this.dataView=new DataView(e),this.offset=0}readBool(){const e=0!=this.dataView.getUint8(this.offset);return this.offset+=1,e}readUInt8(){const e=this.dataView.getUint8(this.offset);return this.offset+=1,e}readInt8(){const e=this.dataView.getInt8(this.offset);return this.offset+=1,e}readUInt16BE(){const e=this.dataView.getUint16(this.offset);return this.offset+=2,e}readUInt16LE(){const e=this.dataView.getUint16(this.offset,!0);return this.offset+=2,e}readInt16BE(){const e=this.dataView.getInt16(this.offset);return this.offset+=2,e}readInt16LE(){const e=this.dataView.getInt16(this.offset,!0);return this.offset+=2,e}readUInt32BE(){const e=this.dataView.getUint32(this.offset);return this.offset+=4,e}readUInt32LE(){const e=this.dataView.getUint32(this.offset,!0);return this.offset+=4,e}readInt32BE(){const e=this.dataView.getInt32(this.offset,!0);return this.offset+=4,e}readInt32LE(){const e=this.dataView.getInt32(this.offset,!0);return this.offset+=4,e}readFloatBE(){const e=this.dataView.getFloat32(this.offset);return this.offset+=4,e}readFloatLE(){const e=this.dataView.getFloat32(this.offset,!0);return this.offset+=4,e}readRemainingBytes(){return new Uint8Array(this.dataView.buffer,this.offset)}seek(e){this.offset=e}}},6679:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},6729:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(1173),t)},6837:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.TextureVariationDisplayType=void 0,function(e){e[e.Item=0]="Item",e[e.Creature=1]="Creature"}(r||(t.TextureVariationDisplayType=r={}))},6919:function(e,t,r){"use strict";var a=this&&this.__awaiter||function(e,t,r,a){return new(r||(r=Promise))((function(i,o){function n(e){try{l(a.next(e))}catch(e){o(e)}}function s(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}l((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.WoWModelServerDataProvider=void 0;const i=r(6466);t.WoWModelServerDataProvider=class{constructor(e,t){this.rootPath=e,this.progress=t}loadBoneFile(e){return a(this,void 0,void 0,(function*(){const t=`${this.rootPath}/modelviewer/bone/${e}.cbone`;try{const e=yield fetch(t);if(!e.ok)return new Error("Modelviewer Server returned responsecode: "+e.status);const r=yield e.arrayBuffer();return(0,i.parseCM2BoneFile)(r)}catch(e){return e}}))}loadModelFile(e){return a(this,void 0,void 0,(function*(){const t=`${this.rootPath}/modelviewer/models/${e}.cm2`;try{const e=yield fetch(t);if(!e.ok)return new Error("Modelviewer Server returned responsecode: "+e.status);const r=yield e.arrayBuffer();return(0,i.parseCM2File)(r)}catch(e){return e}}))}loadWorldModelFile(e){return a(this,void 0,void 0,(function*(){const t=`${this.rootPath}/modelviewer/models/${e}.cwmo`;try{const e=yield fetch(t);if(!e.ok)return new Error("Modelviewer Server returned responsecode: "+e.status);const r=yield e.arrayBuffer();return(0,i.parseCWMOFile)(r)}catch(e){return e}}))}loadCharacterCustomizationMetadata(e){return a(this,void 0,void 0,(function*(){const t=`${this.rootPath}/modelviewer/metadata/charactercustomization/${e}.json`;try{const e=yield fetch(t);return e.ok?yield e.json():new Error("Modelviewer Server returned responsecode: "+e.status)}catch(e){return e}}))}loadCharacterMetadata(e){return a(this,void 0,void 0,(function*(){const t=`${this.rootPath}/modelviewer/metadata/character/${e}.json`;try{const e=yield fetch(t);return e.ok?yield e.json():new Error("Modelviewer Server returned responsecode: "+e.status)}catch(e){return e}}))}loadItemMetadata(e){return a(this,void 0,void 0,(function*(){const t=`${this.rootPath}/modelviewer/metadata/item/${e}.json`;try{const e=yield fetch(t);return e.ok?yield e.json():new Error("Modelviewer Server returned responsecode: "+e.status)}catch(e){return e}}))}loadLiquidTypeMetadata(e){return a(this,void 0,void 0,(function*(){const t=`${this.rootPath}/modelviewer/metadata/liquidtype/${e}.json`;try{const e=yield fetch(t);return e.ok?yield e.json():new Error("Modelviewer Server returned responsecode: "+e.status)}catch(e){return e}}))}loadSpellVisualKitMetadata(e){return a(this,void 0,void 0,(function*(){const t=`${this.rootPath}/modelviewer/metadata/spellvisualkit/${e}.json`;try{const e=yield fetch(t);return e.ok?yield e.json():new Error("Modelviewer Server returned responsecode: "+e.status)}catch(e){return e}}))}loadTexture(e){return a(this,void 0,void 0,(function*(){const t=`${this.rootPath}/modelviewer/textures/${e}.webp`;try{const e=yield fetch(t);return e.ok?yield e.blob():new Error("Modelviewer Server returned responsecode: "+e.status)}catch(e){return e}}))}loadItemvisualMetadata(e){return a(this,void 0,void 0,(function*(){const t=`${this.rootPath}/modelviewer/metadata/itemvisual/${e}.json`;try{const e=yield fetch(t);return e.ok?yield e.json():new Error("Modelviewer Server returned responsecode: "+e.status)}catch(e){return e}}))}loadTextureVariationsMetadata(e){return a(this,void 0,void 0,(function*(){const t=`${this.rootPath}/modelviewer/metadata/texturevariations/${e}.json`;try{const e=yield fetch(t);return e.ok?yield e.json():new Error("Modelviewer Server returned responsecode: "+e.status)}catch(e){return e}}))}useProgressReporter(e){this.progress=e}}},6940:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(4510),t),i(r(8521),t),i(r(9551),t),i(r(8803),t),i(r(9889),t),i(r(5526),t),i(r(1851),t),i(r(2561),t),i(r(2526),t),i(r(6015),t),i(r(979),t)},6956:function(e,t,r){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LineSegment=void 0;const i=r(1639),o=r(1017),n=a(r(492)),s=a(r(7601)),l=r(8521),u="LINESEGMENT";class d extends l.WorldPositionedObject{constructor(e,t,r){super(),this.fileId=-1,this.lineWidth=e,this.startPos=i.Float3.copy(t),this.endPos=i.Float3.copy(r),this.updateBoundingBox()}attachToRenderer(e){this.renderer=e,this.isLoaded||(this.program=this.renderer.getShaderProgram(this,u,n.default,s.default),this.dataBuffers=this.renderer.getDataBuffers(this,u+"-RECT",(e=>{const t=e.createVertexIndexBuffer(!0);t.setData(new Uint16Array([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]));const r=e.createVertexDataBuffer([{index:this.program.getAttribLocation("a_position"),size:3,type:o.BufferDataType.Float,normalized:!1,stride:12,offset:0}],!0);r.setData(new Float32Array([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0]));const a=e.createVertexDataBuffer([{index:this.program.getAttribLocation("a_texCoord"),size:2,type:o.BufferDataType.Float,normalized:!1,stride:8,offset:0}],!0);a.setData(new Float32Array([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2]));const i=e.createDataBuffers(t,r);return i.addVertexDataBuffer(a),i})),this.texture=this.renderer.getSolidColorTexture([1,0,0,1]),this.createMaterial(),this.isLoaded=!0)}update(e){}draw(){if(!this.isLoaded||this.isDisposing)return;const e=new o.DrawingBatchRequest(u,-50,0,0);e.useMaterial(this.material).useDataBuffers(this.dataBuffers).drawIndexedTriangles(0,18),this.renderer.submitDrawRequest(e)}dispose(){this.isDisposing||(super.dispose(),this.material=null,this.program=null,this.dataBuffers=null,this.renderer=null,this.startPos=null,this.endPos=null,this.startColor=null,this.endColor=null)}setStartPos(e){i.Float3.copy(e,this.startPos),this.updateBoundingBox()}setEndPos(e){i.Float3.copy(e,this.endPos),this.updateBoundingBox()}setTexture(e){this.texture=e,this.isAttachedToRenderer&&this.createMaterial()}createMaterial(){this.material=this.renderer.getBaseMaterial(),this.material.useShaderProgram(this.program);const e={u_linewidth:this.lineWidth,u_segmentStart:this.startPos,u_segmentEnd:this.endPos,u_modelMatrix:this.worldModelMatrix,u_texture:this.texture};this.material.useBlendMode(o.GxBlend.GxBlend_Opaque),this.material.useBackFaceCulling(!1),this.material.useDepthTest(!1),this.material.useDepthWrite(!1),this.material.useColorMask(o.ColorMask.All),this.material.useUniforms(e)}updateBoundingBox(){this.setBoundingBox({min:this.startPos,max:this.endPos})}}t.LineSegment=d},7083:(e,t,r)=>{"use strict";const a=r(1447),i=r(9805),o=r(1996),n=r(4674),s=r(4442),l=r(7414),u=Object.prototype.toString,{Z_NO_FLUSH:d,Z_FINISH:c,Z_OK:h,Z_STREAM_END:f,Z_NEED_DICT:p,Z_STREAM_ERROR:m,Z_DATA_ERROR:g,Z_MEM_ERROR:y}=r(9681);function x(e){this.options=i.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;let r=a.inflateInit2(this.strm,t.windowBits);if(r!==h)throw new Error(n[r]);if(this.header=new l,a.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=o.string2buf(t.dictionary):"[object ArrayBuffer]"===u.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=a.inflateSetDictionary(this.strm,t.dictionary),r!==h)))throw new Error(n[r])}function v(e,t){const r=new x(t);if(r.push(e),r.err)throw r.msg||n[r.err];return r.result}x.prototype.push=function(e,t){const r=this.strm,i=this.options.chunkSize,n=this.options.dictionary;let s,l,x;if(this.ended)return!1;for(l=t===~~t?t:!0===t?c:d,"[object ArrayBuffer]"===u.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(0===r.avail_out&&(r.output=new Uint8Array(i),r.next_out=0,r.avail_out=i),s=a.inflate(r,l),s===p&&n&&(s=a.inflateSetDictionary(r,n),s===h?s=a.inflate(r,l):s===g&&(s=p));r.avail_in>0&&s===f&&r.state.wrap>0&&0!==e[r.next_in];)a.inflateReset(r),s=a.inflate(r,l);switch(s){case m:case g:case p:case y:return this.onEnd(s),this.ended=!0,!1}if(x=r.avail_out,r.next_out&&(0===r.avail_out||s===f))if("string"===this.options.to){let e=o.utf8border(r.output,r.next_out),t=r.next_out-e,a=o.buf2string(r.output,e);r.next_out=t,r.avail_out=i-t,t&&r.output.set(r.output.subarray(e,e+t),0),this.onData(a)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(s!==h||0!==x){if(s===f)return s=a.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(0===r.avail_in)break}}return!0},x.prototype.onData=function(e){this.chunks.push(e)},x.prototype.onEnd=function(e){e===h&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},e.exports.Inflate=x,e.exports.inflate=v,e.exports.inflateRaw=function(e,t){return(t=t||{}).raw=!0,v(e,t)},e.exports.ungzip=v,e.exports.constants=r(9681)},7229:function(e,t,r){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WMOModel=t.WMOOwnerTypes=void 0;const i=r(1639),o=r(9266),n=r(2462),s=r(1017),l=r(8521),u=a(r(8049)),d=a(r(5996)),c=r(5510),h=r(4540);var f;!function(e){e[e.WMOGroup=0]="WMOGroup",e[e.WMOLiquid=1]="WMOLiquid",e[e.WMOPortal=2]="WMOPortal"}(f||(t.WMOOwnerTypes=f={}));class p extends l.WorldPositionedObject{constructor(e,t){super(),this.isModelDataLoaded=!1,this.isTexturesLoaded=!1,this.doodadSetId=0,this.lodGroupMap=[],this.loadedTextures={},this.groupDoodads={},this.portalsByGroup={},this.groupLiquids={},this.groupMaterials={},this.activeGroups=[],this.activeDoodads=[],this.transposeInvModelMatrix=i.Float44.identity(),this.localCamera=i.Float3.zero(),this.localCameraFrustrum=i.Frustrum.zero(),this.objectFactory=t,this.dataManager=e}attachToRenderer(e){super.attachToRenderer(e),this.portalShader=this.renderer.getShaderProgram(this,"WMOPortal",d.default,u.default),this.fileId&&!this.isLoaded&&this.dataManager.getWMOModelFile(this.fileId).then(this.onModelLoaded.bind(this))}loadFileId(e){this.fileId!==e&&(this.fileId=e,this.renderer&&this.dataManager.getWMOModelFile(this.fileId).then(this.onModelLoaded.bind(this)))}update(e){if(super.update(e),this.isLoaded&&!this.isDisposing){i.Float44.transformDirection3(this.renderer.cameraPosition,this.invWorldModelMatrix,this.localCamera),i.Frustrum.copy(this.renderer.cameraFrustrum,this.localCameraFrustrum),i.Frustrum.transformSelf(this.localCameraFrustrum,this.invWorldModelMatrix),this.findVisibleGroupsAndDoodads(),this.setLODGroupsForVisibleGroups();for(let t=0;t<this.activeDoodads.length;t++)this.activeDoodads[t].update(e);for(const t of this.activeGroups)for(const r of this.groupLiquids[t])r.update(e)}}draw(){if(this.isLoaded&&!this.isDisposing){for(let e=0;e<this.activeGroups.length;e++){const t=this.activeGroups[e];this.drawGroup(t);for(const e of this.groupLiquids[t])e.draw()}for(let e=0;e<this.activeDoodads.length;e++)this.activeDoodads[e].draw();this.renderer.debugPortals&&this.drawPortals()}}getDoodadSets(){return this.modelData.doodadSets.map((e=>e.name))}useDoodadSet(e){this.doodadSetId=e,this.loadDoodads()}dispose(){if(!this.isDisposing){super.dispose(),this.modelData=null,this.loadedTextures=null;for(const e in this.groupDoodads)for(const t of this.groupDoodads[e])t.dispose();this.groupDoodads=null;for(const e in this.groupLiquids)for(const t of this.groupLiquids[e])t.dispose();this.groupLiquids=null,this.groupMaterials=null,this.activeGroups=null,this.activeDoodads=null,this.lodGroupMap=null,this.groupDatabuffers=null,this.portalsByGroup=null,this.groupViews=null,this.portalShader=null,this.portalDataBuffers&&this.portalDataBuffers.dispose(),this.portalDataBuffers=null,this.portalData=null,this.portalMaterial=null,this.localCamera=null,this.localCameraFrustrum=null,this.transposeInvModelMatrix=null}}get isLoaded(){return this.isModelDataLoaded&&this.isTexturesLoaded&&this.children.every((e=>e.isLoaded))}onModelLoaded(e){this.modelData=e,null!=this.modelData?this.isDisposing||(this.setBoundingBox(this.modelData.boundingBox),this.setupPortals(),this.makeLodMap(),this.loadTextures(),this.loadDoodads(),this.loadLiquids(),this.setupDataBuffers(),this.setupPortalGraphics(),this.isModelDataLoaded=!0,this.processCallbacks("modelDataLoaded")):this.dispose()}loadDoodads(){for(let e=0;e<this.modelData.groups.length;e++)if(this.groupDoodads[e])for(const t of this.groupDoodads[e])t.dispose();const e=this.getDoodadSetRefs(),t=[];for(let r=0;r<this.modelData.groups.length;r++){const a=this.modelData.groups[r];this.groupDoodads[r]=[];const o=a.doodadReferences;for(let a of o)if(-1!==e.indexOf(a)){const e=this.modelData.doodadDefs[a],o=this.modelData.doodadIds[e.nameOffset];if(0===o)continue;const n=this.objectFactory.createM2Model(o);this.addChild(n);const s=i.Float3.create(e.scale,e.scale,e.scale);n.setModelMatrix(e.position,e.rotation,s),n.once("disposed",(()=>{this.groupDoodads[r]=this.groupDoodads[r].filter((e=>!e.isDisposing))})),t.push(n.onceAsync("loaded")),this.groupDoodads[r].push(n)}}Promise.all(t).then((()=>{this.processCallbacks("doodadsLoaded"),this.isLoaded&&this.processCallbacks("loaded")}))}loadTextures(){const e=[];this.loadedTextures[0]=this.renderer.getUnknownTexture();for(let t=0;t<this.modelData.groups.length;t++){const r=this.modelData.groups[t];for(let t=0;t<r.batches.length;t++){const a=r.batches[t],i=this.modelData.materials[a.materialId];for(const t of[i.texture1,i.texture2,i.texture3])if(0!==t){const r=(i.flags&n.WoWWorldModelMaterialMaterialFlags.ClampS)>0,a=(i.flags&n.WoWWorldModelMaterialMaterialFlags.ClampT)>0,o=this.renderer.getTexture(this,t,{clampS:r,clampT:a}).then((e=>{this.isDisposing||(this.loadedTextures[t]=e)}));e.push(o)}}}Promise.all(e).then((()=>{this.setupMaterials(),this.isTexturesLoaded=!0,this.processCallbacks("texturesLoaded"),this.isLoaded&&this.processCallbacks("loaded")}))}loadLiquids(){for(let e=0;e<this.modelData.groups.length;e++){this.groupLiquids[e]=[];const t=this.modelData.groups[e];for(const r of t.liquidData){const a=new c.WMOLiquid(r,t,this.modelData.flags,this.dataManager);this.addChild(a),a.updateModelMatrixFromParent(),this.groupLiquids[e].push(a)}}}getDoodadSetRefs(){let e=this.modelData.doodadSets[0];this.doodadSetId>this.modelData.doodadSets.length&&(this.doodadSetId=0);let t=Array.from({length:e.count},((t,r)=>r+e.startIndex));if(0!=this.doodadSetId){const e=this.modelData.doodadSets[this.doodadSetId];t=t.concat(Array.from({length:e.count},((t,r)=>r+e.startIndex)))}return t}makeLodMap(){this.activeGroups=Array(this.modelData.groupInfo.length),this.lodGroupMap=Array(3*this.modelData.groupInfo.length);const e=this.modelData.groupInfo.length,t=[];for(let r=0;r<this.lodGroupMap.length;r++){if(r<e){this.modelData.groupInfo[r%e].flags&n.WowWorldModelGroupFlags.Lod||(t.push(r+e),t.push(r+e+e)),this.lodGroupMap[r]=r%e;continue}if(t.indexOf(r)>-1){this.lodGroupMap[r]=r%e;continue}const a=t.filter((e=>e<r)).length;this.lodGroupMap[r]=r-a}}setupPortals(){for(let e=0;e<this.modelData.groupInfo.length;e++)this.portalsByGroup[e]=[];this.portalData=Array(this.modelData.portals.length);for(let e=0;e<this.modelData.portals.length;e++){const t=this.modelData.portals[e];let r=this.modelData.portalVertices.slice(t.startVertex,t.startVertex+t.vertexCount);const a=i.Plane.majorAxis(t.plane),o=i.Float3.zero();for(let e=0;e<r.length;e++)i.Float3.add(r[e],o,o);i.Float3.scale(o,1/r.length,o);const n=i.Float3.projectToVec2(o,a);r=r.sort(((e,t)=>{const r=i.Float2.subtract(n,i.Float3.projectToVec2(e,a)),o=i.Float2.subtract(n,i.Float3.projectToVec2(t,a));return Math.atan2(r[1],r[0])-Math.atan2(o[1],o[0])}));const s=i.AABB.fromVertices(r,0);this.portalData[e]={index:e,negGroup:e,posGroup:e,boundingBox:s,plane:t.plane,vertices:r}}for(const e of this.modelData.portalRefs)e.side>0?this.portalData[e.portalIndex].posGroup=e.groupIndex:this.portalData[e.portalIndex].negGroup=e.groupIndex;for(let e=0;e<this.modelData.groups.length;e++){const t=this.modelData.groups[e],r=t.portalsOffset,a=t.portalCount;this.portalsByGroup[e]=[];for(let t=r;t<r+a;t++)this.portalsByGroup[e].push(this.modelData.portalRefs[t])}}findVisibleGroupsAndDoodads(){this.activeGroups=[],this.activeDoodads=[],this.groupViews={};const e=this.findGroupIndexForPoint(this.localCamera),t=[];for(let e=0;e<this.modelData.groupInfo.length;e++){const r=this.modelData.groupInfo[e];r.flags&n.WowWorldModelGroupFlags.AlwaysDraw?this.activeGroups.push(e):r.flags&n.WowWorldModelGroupFlags.Exterior&&i.AABB.visibleInFrustrum(r.boundingBox,this.localCameraFrustrum)&&t.push(e)}let r=[],a=!1;e<0?r=t:(a=(this.modelData.groupInfo[e].flags&n.WowWorldModelGroupFlags.Interior)>0,r=[e],a||(r=r.concat(t)));const o=new Set,s=new Set;let l=[];for(const e of r)this.traversePortals(e,this.localCameraFrustrum,o,s,l,0);if(a&&l.length>0)for(const e of t)-1===this.activeGroups.indexOf(e)&&this.activeGroups.push(e),this.groupViews[e]=l;this.activeGroups=this.activeGroups.concat([...o]);for(const e of this.activeGroups){const t=this.modelData.groupInfo[e];for(let r=0;r<this.groupDoodads[e].length;r++){const a=this.groupDoodads[e][r];if(!(i.AABB.distanceToPointIgnoreAxis(a.worldBoundingBox,this.localCamera,i.Axis.Z)>this.renderer.doodadRenderDistance))if(t.flags&n.WowWorldModelGroupFlags.AlwaysDraw)this.activeDoodads.push(a);else for(const t of this.groupViews[e])if(i.AABB.visibleInFrustrum(a.worldBoundingBox,t)){this.activeDoodads.push(a);break}}}}setLODGroupsForVisibleGroups(){for(let e=0;e<this.activeGroups.length;e++){const t=this.activeGroups[e],r=this.modelData.groupInfo[t];if(!(r.flags&n.WowWorldModelGroupFlags.Lod)){this.activeGroups[e]=t;continue}const a=i.AABB.distanceToPoint(r.boundingBox,this.localCamera);let o=0;a>800?o=2:a>500&&(o=1),this.activeGroups[e]=this.lodGroupMap[o*this.modelData.groupInfo.length+t]}}findGroupIndexForPoint(e){let t=-1,r=null,a=Number.MAX_VALUE;for(let o=0;o<this.modelData.groupInfo.length;o++){const s=this.modelData.groupInfo[o];if(s.flags&n.WowWorldModelGroupFlags.Unreachable||s.flags&n.WowWorldModelGroupFlags.AntiPortal||s.flags&n.WowWorldModelGroupFlags.Unknown_0x400000)continue;if(s.flags&n.WowWorldModelGroupFlags.Exterior){if(!i.AABB.containsPointIgnoreMaxZ(s.boundingBox,e))continue}else if(!i.AABB.containsPoint(s.boundingBox,e))continue;(-1===t||a===Number.MAX_VALUE&&i.AABB.containsBoundingBox(r,s.boundingBox))&&(t=o,r=s.boundingBox);const l=this.modelData.groups[o],u=[],d={faceIndices:l.bspIndices,nodes:l.bspNodes,vertexIndices:l.indices,vertices:l.vertices};i.BspTree.findNodesForPoint(d,e,u,0);const c=i.BspTree.pickClosestTriangle_NegZ(d,e,u);c&&c.distance<a&&(a=c.distance,t=o)}return t}traversePortals(e,t,r,a,o,s){if(s>8)return;if(a.has(e))return;this.groupViews[e]=this.groupViews[e]?this.groupViews[e]:[],this.groupViews[e].push(t),r.add(e),a.add(e);const l=this.portalsByGroup[e];for(const a of l){const l=this.portalData[a.portalIndex];let u=i.AABB.containsPoint(l.boundingBox,this.localCamera);if(i.Plane.sideFacingPoint(l.plane,this.localCamera)!==a.side&&!u)continue;if(!i.AABB.visibleInFrustrum(l.boundingBox,t)&&!u)continue;const d=i.Frustrum.copy(t);for(let e=0;e<l.vertices.length;e++){const t=l.vertices[e],r=l.vertices[(e+1)%l.vertices.length],a=l.vertices[(e-1+l.vertices.length)%l.vertices.length],o=i.Plane.fromEyeAndVertices(this.localCamera,t,r);i.Plane.distanceToPoint(o,a)<0&&i.Float4.scale(o,-1,o),d.push(o)}const c=this.modelData.groupInfo[e],h=this.modelData.groupInfo[a.groupIndex];c.flags&n.WowWorldModelGroupFlags.Interior&&h.flags&n.WowWorldModelGroupFlags.Exterior&&o.push(d),this.traversePortals(a.groupIndex,d,r,new Set,o,s+1)}}drawGroup(e){const t=this.modelData.groups[e];for(let r=0;r<t.batches.length;r++){const a=t.batches[r],i=new s.DrawingBatchRequest("WMO",this.fileId,a.materialId);i.useMaterial(this.groupMaterials[a.materialId]).useDataBuffers(this.groupDatabuffers[e]).drawIndexedTriangles(2*a.startIndex,a.indexCount),this.renderer.submitDrawRequest(i)}}drawPortals(){for(let e=0;e<this.modelData.portals.length;e++){const t=this.modelData.portals[e];if(!i.AABB.visibleInFrustrum(this.portalData[e].boundingBox,this.renderer.cameraFrustrum))continue;const r=new s.DrawingBatchRequest("WMO-PORTAL",this.fileId,e);r.useMaterial(this.portalMaterial).useDataBuffers(this.portalDataBuffers).drawIndexedTriangles(1.5*t.startVertex*2,1.5*t.vertexCount),this.renderer.submitDrawRequest(r)}}setupDataBuffers(){this.groupDatabuffers=new Array(this.modelData.groups.length);for(let e=0;e<this.modelData.groups.length;e++)this.groupDatabuffers[e]=this.renderer.getDataBuffers(this,"WMO-"+this.fileId+"-"+e,(t=>{const r=this.modelData.groups[e],a=r.vertexColors.length/r.vertices.length;if(a!=Math.floor(a))throw new Error("Unexpected situation. Number of Vertex Colors is not cleanly divisible by number of vertices.");const i=r.uvList.length/r.vertices.length;if(i!=Math.floor(i))throw new Error("Unexpected situation. Number of UV coordinates is not cleanly divisible by number of vertices.");const n=56,l=t.createVertexDataBuffer([{index:h.WmoShaderBuilder.getAttribLocation("a_position"),size:3,type:s.BufferDataType.Float,normalized:!1,stride:n,offset:0},{index:h.WmoShaderBuilder.getAttribLocation("a_normal"),size:3,type:s.BufferDataType.Float,normalized:!1,stride:n,offset:12},{index:h.WmoShaderBuilder.getAttribLocation("a_color1"),size:4,type:s.BufferDataType.UInt8,normalized:!1,stride:n,offset:24},{index:h.WmoShaderBuilder.getAttribLocation("a_color2"),size:4,type:s.BufferDataType.UInt8,normalized:!1,stride:n,offset:28},{index:h.WmoShaderBuilder.getAttribLocation("a_texCoord1"),size:2,type:s.BufferDataType.Float,normalized:!1,stride:n,offset:32},{index:h.WmoShaderBuilder.getAttribLocation("a_texCoord2"),size:2,type:s.BufferDataType.Float,normalized:!1,stride:n,offset:40},{index:h.WmoShaderBuilder.getAttribLocation("a_texCoord3"),size:2,type:s.BufferDataType.Float,normalized:!1,stride:n,offset:48}],!0),u=r.vertices.length,d=new Uint8Array(n*u),c=new o.BinaryWriter(d.buffer);for(let e=0;e<r.vertices.length;e++)c.writeFloatLE(r.vertices[e][0]),c.writeFloatLE(r.vertices[e][1]),c.writeFloatLE(r.vertices[e][2]),c.writeFloatLE(r.normals[e][0]),c.writeFloatLE(r.normals[e][1]),c.writeFloatLE(r.normals[e][2]),c.writeUInt8(a>0?r.vertexColors[e][0]:0),c.writeUInt8(a>0?r.vertexColors[e][1]:0),c.writeUInt8(a>0?r.vertexColors[e][2]:0),c.writeUInt8(a>0?r.vertexColors[e][3]:255),c.writeUInt8(a>1?r.vertexColors[e+r.vertices.length][0]:0),c.writeUInt8(a>1?r.vertexColors[e+r.vertices.length][1]:0),c.writeUInt8(a>1?r.vertexColors[e+r.vertices.length][2]:0),c.writeUInt8(a>1?r.vertexColors[e+r.vertices.length][3]:255),c.writeFloatLE(i>0?r.uvList[e][0]:0),c.writeFloatLE(i>0?r.uvList[e][1]:0),c.writeFloatLE(i>1?r.uvList[e+r.vertices.length][0]:0),c.writeFloatLE(i>1?r.uvList[e+r.vertices.length][1]:0),c.writeFloatLE(i>2?r.uvList[e+2*r.vertices.length][0]:0),c.writeFloatLE(i>2?r.uvList[e+2*r.vertices.length][1]:0);l.setData(d);const f=t.createVertexIndexBuffer(!0);return f.setData(new Uint16Array(r.indices)),t.createDataBuffers(f,l)}))}setupPortalGraphics(){const e=this.renderer.graphics.createVertexDataBuffer([{index:this.portalShader.getAttribLocation("a_position"),size:3,type:s.BufferDataType.Float,normalized:!1,stride:12,offset:0}],!0),t=new Uint8Array(12*this.modelData.portalVertices.length),r=new o.BinaryWriter(t.buffer);for(let e=0;e<this.modelData.portalVertices.length;e++)r.writeFloatLE(this.modelData.portalVertices[e][0]),r.writeFloatLE(this.modelData.portalVertices[e][1]),r.writeFloatLE(this.modelData.portalVertices[e][2]);e.setData(t);const a=this.renderer.graphics.createVertexIndexBuffer(!0),i=[];for(let e=0;e<this.modelData.portals.length;e++){const t=this.modelData.portals[e];if(!(t.vertexCount-2<=0))for(let e=0;e<t.vertexCount-2;e++)i.push(t.startVertex+0),i.push(t.startVertex+e+1),i.push(t.startVertex+e+2)}a.setData(new Uint16Array(i)),this.portalDataBuffers=this.renderer.graphics.createDataBuffers(e,a)}setupMaterials(){if(this.isDisposing)return;for(let e=0;e<this.modelData.materials.length;e++){const t=this.modelData.materials[e],r=(0,s.M2BlendModeToEGxBlend)(t.blendMode),a=h.WmoShaderBuilder.getShaderProgram(this.renderer,this,t.shader),i=!!(t.flags&n.WoWWorldModelMaterialMaterialFlags.Unlit),o=!!(t.flags&n.WoWWorldModelMaterialMaterialFlags.Unculled),l=this.renderer.getBaseMaterial();l.useCounterClockWiseFrontFaces(!0),l.useBackFaceCulling(!o),l.useBlendMode(r),l.useDepthTest(!0),l.useDepthWrite(!0),l.useColorMask(s.ColorMask.Alpha|s.ColorMask.Red|s.ColorMask.Blue|s.ColorMask.Green),l.useShaderProgram(a),l.useUniforms({u_modelMatrix:this.worldModelMatrix,u_cameraPos:this.renderer.cameraPosition,u_blendMode:t.blendMode,u_unlit:i,u_texture1:this.loadedTextures[t.texture1],u_texture2:this.loadedTextures[t.texture2],u_texture3:this.loadedTextures[t.texture3]}),this.groupMaterials[e]=l}const e=this.renderer.getBaseMaterial();e.useCounterClockWiseFrontFaces(!1),e.useBackFaceCulling(!1),e.useBlendMode(s.GxBlend.GxBlend_Alpha),e.useDepthTest(!1),e.useDepthWrite(!1),e.useColorMask(s.ColorMask.Alpha|s.ColorMask.Red|s.ColorMask.Blue|s.ColorMask.Green),e.useShaderProgram(this.portalShader),e.useUniforms({u_modelMatrix:this.worldModelMatrix,u_color:i.Float4.create(.8,.1,.1,.25)}),this.portalMaterial=e}setModelMatrix(e,t,r){super.setModelMatrix(e,t,r),i.Float44.tranpose(this.invWorldModelMatrix,this.transposeInvModelMatrix)}canExecuteCallbackNow(e){switch(e){case"modelDataLoaded":return null!=this.modelData;case"texturesLoaded":return this.isTexturesLoaded;default:return super.canExecuteCallbackNow(e)}}}t.WMOModel=p},7243:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.M2Model=void 0;const a=r(2462),i=r(1639),o=r(9266),n=r(1017),s=r(8521),l=r(909),u=r(2981),d=r(4741),c=r(9886),h=r(9795);class f extends s.WorldPositionedObject{constructor(e,t){super(),this.isModelDataLoaded=!1,this.isTexturesLoaded=!1,this.isDisposing=!1,this.isMirrored=!1,this.modelViewMatrix=i.Float44.identity(),this.invModelViewMatrix=i.Float44.identity(),this.bonePositionBuffer=new Float32Array(4096),this.modelAttachments={},this.children=[],this.particleColorOverrides=[null,null,null],this.rng=t,this.dataManager=e}get isLoaded(){return this.isModelDataLoaded&&this.isTexturesLoaded}dispose(){if(!this.isDisposing){if(super.dispose(),this.modelData=null,this.boneFileData=null,this.particleEmitters)for(const e of this.particleEmitters)e.dispose();if(this.particleEmitters=null,this.particleColorOverrides=null,this.ribbonEmitters)for(const e of this.ribbonEmitters)e.dispose();if(this.ribbonEmitters=null,this.bonePositionBuffer=null,this.animationState&&this.animationState.dispose(),this.animationState=null,this.textureObjects=null,this.textureUnitData=null,this.boneData)for(const e of this.boneData)e.boneOffsetMatrix=null,e.positionMatrix=null,e.animationState=null;this.boneData=null,this.attachedToModel=null,this.modelViewMatrix=null,this.invModelViewMatrix=null;for(const e in this.modelAttachments)this.modelAttachments[e].dispose();this.modelAttachments=null}}attachToRenderer(e){super.attachToRenderer(e),this.bonePositionTexture||(this.bonePositionTexture=this.renderer.graphics.createDataTexture(4)),this.fileId&&!this.isLoaded&&this.dataManager.getM2ModelFile(this.fileId).then(this.onModelLoaded.bind(this))}loadFileId(e){this.fileId!==e&&(this.fileId=e,this.renderer&&this.dataManager.getM2ModelFile(this.fileId).then(this.onModelLoaded.bind(this)))}update(e){if(super.update(e),this.isLoaded&&!this.isDisposing){this.animationState.update(e),i.Float44.multiply(this.worldModelMatrix,this.renderer.viewMatrix,this.modelViewMatrix),i.Float44.invert(this.modelViewMatrix,this.invModelViewMatrix);for(const e of this.boneData)e.hasUpdatedThisTick=!1;if(this.attachedToModel){const e=this.attachedToModel.boneData;if(e){const t={};for(let r=0;r<e.length;r++)t[e[r].crc]=r;for(let r=0;r<this.boneData.length;r++){const a=this.boneData[r],o=t[a.crc];o&&(a.isOverriden=!0,i.Float44.copy(e[o].positionMatrix,a.positionMatrix))}}}for(let e=0;e<this.modelData.bones.length;e++)this.updateBone(this.modelData.bones[e],e);for(let e=0;e<this.textureUnitData.length;e++)this.textureUnitData[e].show&&this.updateTextureUnit(this.modelData.textureUnits[e],e);for(let t=0;t<this.modelData.particleEmitters.length;t++)this.particleEmitters[t].update(e);for(let t=0;t<this.modelData.ribbonEmitters.length;t++)this.ribbonEmitters[t].update(e);for(const t in this.modelAttachments)this.modelAttachments[t].update(e)}}attachTo(e){this.attachedToModel=e}draw(){if(this.isLoaded&&!this.isDisposing){this.updateBonePositions();for(let e=0;e<this.textureUnitData.length;e++)this.textureUnitData[e].show&&this.drawTextureUnit(this.modelData.textureUnits[e],e);for(let e=0;e<this.modelData.particleEmitters.length;e++)this.particleEmitters[e].draw();for(let e=0;e<this.modelData.ribbonEmitters.length;e++)this.ribbonEmitters[e].draw();for(const e in this.modelAttachments)this.modelAttachments[e].draw()}}swapTexture(e,t){t&&this.once("texturesLoaded",(()=>{this.textureObjects[e]=t;for(let e=0;e<this.modelData.textureUnits.length;e++)this.createMaterialForTexUnit(e)}))}swapTextureType(e,t){t&&this.once("modelDataLoaded",(()=>{const r=this.modelData.textures.findIndex((t=>t.type===e));r<0||this.swapTexture(r,t)}))}getAnimations(){return this.modelData?(0,o.distinct)(this.modelData.animations.map((e=>e.id))).sort(((e,t)=>e-t)):[]}useAnimation(e){this.once("modelDataLoaded",(()=>{this.animationState.useAnimation(e)}))}pauseAnimation(){this.once("modelDataLoaded",(()=>{this.animationState.isPaused=!0}))}resumeAnimation(){this.animationState.isPaused=!1}setAnimationSpeed(e){this.animationState.speed=e}toggleGeoset(e,t){return this.toggleGeosets(e,e,t)}toggleGeosets(e,t,r){this.once("texturesLoaded",(()=>{for(let a=0;a<this.textureUnitData.length;a++){const i=this.textureUnitData[a];i.geoSetId>=e&&i.geoSetId<=t&&(i.show=r)}if(this.modelData.particleEmitterGeosets&&this.modelData.particleEmitterGeosets.length>0)for(let a=0;a<this.modelData.particleEmitterGeosets.length;++a){let i=this.modelData.particleEmitterGeosets[a];i>=e&&i<=t&&(this.particleEmitters[a].show=r)}}))}loadBoneFile(e){this.boneFileId!==e&&(this.boneFileId=e,e?this.dataManager.getBoneFileData(e).then(this.onBoneFileLoaded.bind(this)):(this.boneData=null,this.resetBoneFileData()))}setParticleColorOverride(e){this.particleColorOverrides=e}getAttachment(e){return this.modelData.attachments[this.modelData.attachmentIdLookup[e]]}getAttachments(){return this.modelData.attachments}getBone(e){return this.boneData[e]}getBoneById(e){return this.boneData[this.modelData.boneIdLookup[e]]}getBones(){return this.boneData}addAttachedModel(e,t){const r=t.id;let a=this.modelAttachments[r];a||(a=new h.ModelAttachment(this,t),this.modelAttachments[r]=a),a.addChild(e)}updateBonePositions(){const e=Math.min(256,this.modelData.bones.length);for(let t=0;t<e;t++)this.bonePositionBuffer.set(this.boneData[t].positionMatrix,16*t);this.bonePositionTexture.setData(this.bonePositionBuffer,16,e)}updateBone(e,t){const r=this.boneData[t];if(r.hasUpdatedThisTick||r.isOverriden)return;if(i.Float44.identity(r.positionMatrix),i.Float44.multiply(r.positionMatrix,this.modelViewMatrix,r.positionMatrix),e.parentBoneId>-1){this.updateBone(this.modelData.bones[e.parentBoneId],e.parentBoneId);let t=i.Float44.copy(this.boneData[e.parentBoneId].positionMatrix),a=i.Float44.copy(t);if(7&e.flags){if(i.Float44.multiply(this.modelViewMatrix,t,t),6&~e.flags)if(4&e.flags)for(let e=0;e<3;e++){const r=i.Float44.getColumn4(this.modelViewMatrix,e),a=i.Float4.length(r),o=i.Float44.getColumn4(t,e),n=i.Float4.length(o);i.Float4.scale(r,n/a,r),i.Float44.setColumn(t,e,r)}else for(let e=0;e<3;e++){const r=i.Float44.getColumn4(this.modelViewMatrix,e),a=i.Float4.length(r),o=i.Float44.getColumn4(t,e),n=i.Float4.length(o);i.Float4.scale(o,1/n*a,r),i.Float44.setColumn(t,e,r)}else for(let e=0;e<3;e++)i.Float44.setColumn(t,e,i.Float44.getColumn4(this.modelViewMatrix,e));let r;if(1&e.flags)r=i.Float44.getColumn4(this.modelViewMatrix,3),i.Float44.setColumn(t,3,r);else{const r=i.Float4.create(e.pivot[0],e.pivot[1],e.pivot[2],1),o=i.Float4.create(e.pivot[0],e.pivot[1],e.pivot[2],0),n=i.Float4.identity();i.Float4.subtract(i.Float44.transformDirection4(r,a),i.Float44.transformDirection4(o,t),n),n[3]=1,i.Float44.setColumn(t,3,n)}i.Float44.multiply(this.invWorldModelMatrix,t,t)}i.Float44.multiply(r.positionMatrix,t,r.positionMatrix)}let o=i.Float44.identity(),n=!1;if(640&e.flags){i.Float44.translate(o,e.pivot,o);const t=r.animationState?r.animationState:this.animationState;if(t.hasAnimatedValuesForTrack(e.translation)){const r=t.getFloat3TrackValue(e.translation,i.Float3.zero());i.Float44.translate(o,r,o),n=!0}if(t.hasAnimatedValuesForTrack(e.rotation)){const r=t.getFloat4TrackValue(e.rotation,i.Float4.identity());r[0]=-r[0],r[1]=-r[1],r[2]=-r[2],i.Float44.multiply(o,i.Float44.fromQuat(r),o),n=!0}if(t.hasAnimatedValuesForTrack(e.scale)){const r=t.getFloat3TrackValue(e.scale,i.Float3.one());i.Float44.scale(o,r,o),n=!0}i.Float44.translate(o,i.Float3.negate(e.pivot),o)}null!=r.boneOffsetMatrix&&(i.Float44.translate(o,e.pivot,o),i.Float44.multiply(o,r.boneOffsetMatrix,o),i.Float44.translate(o,i.Float3.negate(e.pivot),o)),i.Float44.multiply(r.positionMatrix,o,r.positionMatrix);const s=120&e.flags;if(s){const t=r.positionMatrix,l=i.Float44.copy(r.positionMatrix),u=i.Float3.create(i.Float4.length(i.Float44.getColumn4(r.positionMatrix,0)),i.Float4.length(i.Float44.getColumn4(r.positionMatrix,1)),i.Float4.length(i.Float44.getColumn4(r.positionMatrix,2)));switch(s){case a.WoWBoneFlags.SphericalBillboard:if(n){const e=i.Float44.getColumn4(o,0);i.Float44.setColumn(t,0,i.Float4.normalize(i.Float4.create(e[1],e[2],-e[0],0)));const r=i.Float44.getColumn4(o,1);i.Float44.setColumn(t,1,i.Float4.normalize(this.isMirrored?i.Float4.create(-r[1],-r[2],r[0],0):i.Float4.create(r[1],r[2],-r[0],0)));const a=i.Float44.getColumn4(o,2);i.Float44.setColumn(t,2,i.Float4.normalize(i.Float4.create(a[1],a[2],-a[0],0)))}else i.Float44.setColumn(t,0,i.Float4.create(0,0,-1,0)),i.Float44.setColumn(t,1,this.isMirrored?i.Float4.create(-1,0,0,0):i.Float4.create(1,0,0,0)),i.Float44.setColumn(t,2,i.Float4.create(0,1,0,0));case a.WoWBoneFlags.CylindricalBillboardLockX:{const e=i.Float4.normalize(i.Float44.getColumn4(t,0));i.Float44.setColumn(t,0,e);const r=i.Float4.normalize(i.Float4.create(t[4],-t[0],0,0));i.Float44.setColumn(t,1,r);const a=i.Float4.cross(r,e);a[3]=0,i.Float44.setColumn(t,2,a)}case a.WoWBoneFlags.CylindricalBillboardLockY:{const e=i.Float4.normalize(i.Float44.getColumn4(t,1));i.Float44.setColumn(t,1,e);const r=i.Float4.normalize(i.Float4.create(-t[5],t[1],0,0));i.Float44.setColumn(t,0,r);const a=i.Float4.cross(e,r);a[3]=0,i.Float44.setColumn(t,2,a)}case a.WoWBoneFlags.CylindricalBillboardLockZ:{const e=i.Float4.normalize(i.Float44.getColumn4(t,2));i.Float44.setColumn(t,2,e);const r=i.Float4.normalize(i.Float4.create(t[9],t[8],0,0));i.Float44.setColumn(t,1,r);const a=i.Float4.cross(e,r);a[3]=0,i.Float44.setColumn(t,0,a)}}const d=i.Float4.create(e.pivot[0],e.pivot[1],e.pivot[2],1),c=i.Float4.create(e.pivot[0],e.pivot[1],e.pivot[2],0);i.Float44.setColumn(t,0,i.Float4.scale(i.Float44.getColumn4(t,0),u[0])),i.Float44.setColumn(t,1,i.Float4.scale(i.Float44.getColumn4(t,1),u[1])),i.Float44.setColumn(t,2,i.Float4.scale(i.Float44.getColumn4(t,2),u[2]));const h=i.Float4.identity();i.Float4.subtract(i.Float44.transformDirection4(d,l),i.Float44.transformDirection4(c,t),h),h[3]=1,i.Float44.setColumn(t,3,h)}i.Float44.multiply(this.invModelViewMatrix,r.positionMatrix,r.positionMatrix),r.hasUpdatedThisTick=!0}updateTextureUnit(e,t){const r=this.textureUnitData[t];i.Float4.set(r.color,1,1,1,1);const a=this.modelData.colors[e.colorIndex];if(a){let e=i.Float3.one(),t=1;this.animationState.hasAnimatedValuesForTrack(a.color)&&this.animationState.getFloat3TrackValue(a.color,i.Float3.one(),e),this.animationState.hasAnimatedValuesForTrack(a.alpha)&&(t=this.animationState.getNumberTrackValue(a.alpha)/32767),r.color[0]=e[0],r.color[1]=e[1],r.color[2]=e[2],r.color[3]=t}for(let t=0;t<e.textureCount;t++)r.textureWeights[t]=1;if(e.textureWeightComboIndex>-1&&e.textureWeightComboIndex<this.modelData.textureWeightCombos.length)for(let t=0;t<e.textureCount;t++){const a=this.modelData.textureWeightCombos[e.textureWeightComboIndex+t];if(a>-1&&a<this.modelData.textureWeights.length){const e=this.modelData.textureWeights[a];if(this.animationState.hasAnimatedValuesForTrack(e.weights)){const a=this.animationState.getNumberTrackValue(e.weights,32767)/32767;r.textureWeights[t]=a}}}if(r.color[3]*=r.textureWeights[0],e.textureTransformComboIndex>-1&&e.textureTransformComboIndex<this.modelData.textureTransformCombos.length)for(let t=0;t<e.textureCount;t++){const a=r.textureMatrices[t];i.Float44.identity(a);let o=this.modelData.textureTransformCombos[e.textureTransformComboIndex+t];if(o>-1&&o<this.modelData.textureTransforms.length){const e=this.modelData.textureTransforms[o];if(i.Float44.translate(a,i.Float3.create(.5,.5,0),a),this.animationState.hasAnimatedValuesForTrack(e.scaling)){const t=this.animationState.getFloat3TrackValue(e.scaling);i.Float44.scale(a,t,a)}if(this.animationState.hasAnimatedValuesForTrack(e.rotation)){const t=this.animationState.getFloat4TrackValue(e.rotation);i.Float44.multiply(a,i.Float44.fromQuat(t),a)}if(this.animationState.hasAnimatedValuesForTrack(e.translation)){const t=this.animationState.getFloat3TrackValue(e.translation);i.Float44.translate(a,t,a)}i.Float44.translate(a,i.Float3.create(-.5,-.5,0),a)}}}drawTextureUnit(e,t){const r=this.textureUnitData[t],a=this.modelData.submeshes[e.skinSectionIndex],i=new n.DrawingBatchRequest("M2",this.fileId,t);i.useMaterial(r.material).useDataBuffers(this.dataBuffers).drawIndexedTriangles(2*(a.triangleStart+65536*a.level),a.triangleCount),this.renderer.submitDrawRequest(i)}onModelLoaded(e){if(null!==e){if(!this.isDisposing){this.modelData=e,this.setBoundingBox(i.AABB.fromVertices(this.modelData.vertices.map((e=>e.position)),0)),this.animationState=new d.AnimationState(this.modelData.animations,this.modelData.globalLoops),this.animationState.useAnimation(0),this.setupDataBuffers(),this.boneData=new Array(this.modelData.bones.length);for(let e=0;e<this.modelData.bones.length;e++)this.boneData[e]={boneOffsetMatrix:i.Float44.identity(),hasUpdatedThisTick:!1,isOverriden:!1,crc:this.modelData.bones[e].boneNameCRC,positionMatrix:i.Float44.identity()};this.processBoneFileData(),this.isModelDataLoaded=!0,this.processCallbacks("modelDataLoaded"),this.loadTextures()}}else this.dispose()}setupDataBuffers(){this.dataBuffers=this.renderer.getDataBuffers(this,"M2-"+this.fileId,(e=>{const t=e.createVertexIndexBuffer(!0),r=e.createVertexDataBuffer([{index:c.M2ShaderBuilder.getAttribLocation("a_position"),size:3,type:n.BufferDataType.Float,normalized:!1,stride:48,offset:0},{index:c.M2ShaderBuilder.getAttribLocation("a_normal"),size:3,type:n.BufferDataType.Float,normalized:!1,stride:48,offset:12},{index:c.M2ShaderBuilder.getAttribLocation("a_bones"),size:4,type:n.BufferDataType.UInt8,normalized:!1,stride:48,offset:24},{index:c.M2ShaderBuilder.getAttribLocation("a_boneWeights"),size:4,type:n.BufferDataType.UInt8,normalized:!1,stride:48,offset:28},{index:c.M2ShaderBuilder.getAttribLocation("a_texcoord1"),size:2,type:n.BufferDataType.Float,normalized:!1,stride:48,offset:32},{index:c.M2ShaderBuilder.getAttribLocation("a_texcoord2"),size:2,type:n.BufferDataType.Float,normalized:!1,stride:48,offset:40}],!0),a=this.modelData.vertices,i=48*a.length,s=new Uint8Array(i),l=new o.BinaryWriter(s.buffer);for(let e=0;e<a.length;++e)l.writeFloatLE(a[e].position[0]),l.writeFloatLE(a[e].position[1]),l.writeFloatLE(a[e].position[2]),l.writeFloatLE(a[e].normal[0]),l.writeFloatLE(a[e].normal[1]),l.writeFloatLE(a[e].normal[2]),l.writeUInt8(a[e].boneIndices[0]),l.writeUInt8(a[e].boneIndices[1]),l.writeUInt8(a[e].boneIndices[2]),l.writeUInt8(a[e].boneIndices[3]),l.writeUInt8(a[e].boneWeights[0]),l.writeUInt8(a[e].boneWeights[1]),l.writeUInt8(a[e].boneWeights[2]),l.writeUInt8(a[e].boneWeights[3]),l.writeFloatLE(a[e].texCoords1[0]),l.writeFloatLE(a[e].texCoords1[1]),l.writeFloatLE(a[e].texCoords2[0]),l.writeFloatLE(a[e].texCoords2[1]);return r.setData(s),t.setData(new Uint16Array(this.modelData.skinTriangles)),e.createDataBuffers(r,t)}))}loadTextures(){this.isTexturesLoaded=!1,this.textureObjects={};const e=[];for(let t=0;t<this.modelData.textures.length;t++){const r=this.modelData.textures[t].textureId;if(r){const a=this.renderer.getTexture(this,r).then((e=>{this.isDisposing||(this.textureObjects[t]=e)}));e.push(a)}else this.textureObjects[t]=this.renderer.getSolidColorTexture([0,1,0,1]),this.textureObjects[t].fileId=t}Promise.all(e).then((()=>{this.isTexturesLoaded=!0,this.onTexturesLoaded()}))}onTexturesLoaded(){if(!this.isDisposing){this.particleEmitters=new Array(this.modelData.particleEmitters.length),this.ribbonEmitters=new Array(this.modelData.ribbonEmitters.length);for(let e=0;e<this.modelData.particleEmitters.length;e++){const t=this.modelData.particles[e],r=this.modelData.particleEmitters[e],a=new l.M2ParticleEmitter(e,this,r,t);this.particleEmitters[e]=a}for(let e=0;e<this.modelData.ribbonEmitters.length;e++){const t=this.modelData.ribbonEmitters[e],r=new u.M2RibbonEmitter(e,this,t);this.ribbonEmitters[e]=r}this.textureUnitData=new Array(this.modelData.textureUnits.length);for(let e=0;e<this.modelData.textureUnits.length;e++)this.createTextureUnitData(e);this.processCallbacks("texturesLoaded"),this.isLoaded&&this.processCallbacks("loaded")}}onBoneFileLoaded(e){this.boneFileData=e,e?this.processBoneFileData():this.resetBoneFileData}processBoneFileData(){var e;const t=this.boneFileData;if(t&&(null===(e=this.boneData)||void 0===e?void 0:e.length))for(let e=0;e<t.boneIds.length;e++)i.Float44.copy(t.boneOffsetMatrices[e],this.boneData[t.boneIds[e]].boneOffsetMatrix)}resetBoneFileData(){if(this.boneData)for(let e=0;e<this.boneData.length;e++)i.Float44.identity(this.boneData[e].boneOffsetMatrix)}createTextureUnitData(e){const t=this.modelData.textureUnits[e];let r=this.renderer.getBaseMaterial();this.textureUnitData[e]={color:i.Float4.one(),textureMatrices:[i.Float44.identity(),i.Float44.identity()],textureWeights:i.Float4.one(),material:r,geoSetId:this.modelData.submeshes[t.skinSectionIndex].submeshId,show:!0},this.createMaterialForTexUnit(e)}createMaterialForTexUnit(e){const t=this.modelData.textureUnits[e],r=this.textureUnitData[e],i=r.material,o=this.renderer.getUnknownTexture(),s=[o,o,o,o];if(!(t.textureComboIndex<0||t.textureComboIndex>this.modelData.textureCombos.length))for(let e=0;e<t.textureCount;e++){const r=this.modelData.textureCombos[t.textureComboIndex+e];r>-1&&r<this.modelData.textures.length&&(s[e]=this.textureObjects[r])}const l=c.M2ShaderBuilder.getShaderProgram(this.renderer,this,t.shaderId,t.textureCount),u=this.modelData.materials[t.materialIndex],d=(0,n.M2BlendModeToEGxBlend)(u.blendingMode);i.useShaderProgram(l),i.useBackFaceCulling(!(4&u.flags)),i.useCounterClockWiseFrontFaces(!this.isMirrored),i.useBlendMode(d),i.useDepthTest(!(a.WoWMaterialFlags.DepthTest&u.flags)),i.useDepthWrite(!(a.WoWMaterialFlags.DepthWrite&u.flags)),i.useColorMask(n.ColorMask.Alpha|n.ColorMask.Blue|n.ColorMask.Green|n.ColorMask.Red),i.useUniforms({u_numBones:Math.min(256,this.modelData.bones.length),u_boneMatrices:this.bonePositionTexture,u_modelMatrix:this.worldModelMatrix,u_textureTransformMatrix1:r.textureMatrices[0],u_textureTransformMatrix2:r.textureMatrices[1],u_color:r.color,u_blendMode:d,u_unlit:!!(a.WoWMaterialFlags.Unlit&u.flags),u_texture1:s[0],u_texture2:s[1],u_texture3:s[2],u_texture4:s[3],u_textureWeights:r.textureWeights})}canExecuteCallbackNow(e){switch(e){case"modelDataLoaded":return null!=this.modelData;case"texturesLoaded":return this.isTexturesLoaded;default:return super.canExecuteCallbackNow(e)}}}t.M2Model=f},7293:e=>{"use strict";const t=16209;e.exports=function(e,r){let a,i,o,n,s,l,u,d,c,h,f,p,m,g,y,x,v,b,_,F,C,w,M,S;const D=e.state;a=e.next_in,M=e.input,i=a+(e.avail_in-5),o=e.next_out,S=e.output,n=o-(r-e.avail_out),s=o+(e.avail_out-257),l=D.dmax,u=D.wsize,d=D.whave,c=D.wnext,h=D.window,f=D.hold,p=D.bits,m=D.lencode,g=D.distcode,y=(1<<D.lenbits)-1,x=(1<<D.distbits)-1;e:do{p<15&&(f+=M[a++]<<p,p+=8,f+=M[a++]<<p,p+=8),v=m[f&y];t:for(;;){if(b=v>>>24,f>>>=b,p-=b,b=v>>>16&255,0===b)S[o++]=65535&v;else{if(!(16&b)){if(64&b){if(32&b){D.mode=16191;break e}e.msg="invalid literal/length code",D.mode=t;break e}v=m[(65535&v)+(f&(1<<b)-1)];continue t}for(_=65535&v,b&=15,b&&(p<b&&(f+=M[a++]<<p,p+=8),_+=f&(1<<b)-1,f>>>=b,p-=b),p<15&&(f+=M[a++]<<p,p+=8,f+=M[a++]<<p,p+=8),v=g[f&x];;){if(b=v>>>24,f>>>=b,p-=b,b=v>>>16&255,16&b){if(F=65535&v,b&=15,p<b&&(f+=M[a++]<<p,p+=8,p<b&&(f+=M[a++]<<p,p+=8)),F+=f&(1<<b)-1,F>l){e.msg="invalid distance too far back",D.mode=t;break e}if(f>>>=b,p-=b,b=o-n,F>b){if(b=F-b,b>d&&D.sane){e.msg="invalid distance too far back",D.mode=t;break e}if(C=0,w=h,0===c){if(C+=u-b,b<_){_-=b;do{S[o++]=h[C++]}while(--b);C=o-F,w=S}}else if(c<b){if(C+=u+c-b,b-=c,b<_){_-=b;do{S[o++]=h[C++]}while(--b);if(C=0,c<_){b=c,_-=b;do{S[o++]=h[C++]}while(--b);C=o-F,w=S}}}else if(C+=c-b,b<_){_-=b;do{S[o++]=h[C++]}while(--b);C=o-F,w=S}for(;_>2;)S[o++]=w[C++],S[o++]=w[C++],S[o++]=w[C++],_-=3;_&&(S[o++]=w[C++],_>1&&(S[o++]=w[C++]))}else{C=o-F;do{S[o++]=S[C++],S[o++]=S[C++],S[o++]=S[C++],_-=3}while(_>2);_&&(S[o++]=S[C++],_>1&&(S[o++]=S[C++]))}break}if(64&b){e.msg="invalid distance code",D.mode=t;break e}v=g[(65535&v)+(f&(1<<b)-1)]}}break}}while(a<i&&o<s);_=p>>3,a-=_,p-=_<<3,f&=(1<<p)-1,e.next_in=a,e.next_out=o,e.avail_in=a<i?i-a+5:5-(a-i),e.avail_out=o<s?s-o+257:257-(o-s),D.hold=f,D.bits=p}},7319:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextureVariantModel=void 0;const a=r(9551);class i extends a.M2Model{constructor(e,t){super(e,t)}useTextureVariation(e){if(this.isDisposing)return;const t=this.textureVariations.textureVariations[e];if(t)for(let e=0;e<t.textureIds.length;e++){if(!t.textureIds[e])continue;if(e>=this.modelData.textureCombos.length)break;const r=this.modelData.textureCombos[e];this.renderer.getTexture(this,t.textureIds[e]).then((e=>{this.swapTexture(r,e)}))}}attachToRenderer(e){super.attachToRenderer(e),this.isLoaded||this.once("modelDataLoaded",(()=>{this.dataManager.getTextureVariationsMetadata(this.fileId).then(this.onTextureVariationsLoaded.bind(this))}))}get isLoaded(){return super.isLoaded&&null!=this.textureVariations}canExecuteCallbackNow(e){return"textureVariationsLoaded"===e?null!=this.textureVariations:super.canExecuteCallbackNow(e)}dispose(){this.isDisposing||(super.dispose(),this.textureVariations=null)}onTextureVariationsLoaded(e){this.isDisposing||(this.textureVariations=e,this.processCallbacks("textureVariationsLoaded"),this.useTextureVariation(0),this.isLoaded&&this.processCallbacks("loaded"))}}t.TextureVariantModel=i},7347:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},7414:e=>{"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},7515:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ItemModel=void 0;const a=r(1639),i=r(708),o=r(8521);function n(e,t){return a.Float3.set(t,e>>16&255,e>>8&255,255&e)}class s extends o.WorldPositionedObject{constructor(e,t,r,a){super(),this.sectionTextures={},this.texturePickingStrategy=r,this.modelPickingStrategy=a,this.objectFactory=t,this.dataManager=e}attachToRenderer(e){super.attachToRenderer(e),this.displayInfoId&&!this.isLoaded&&this.dataManager.getItemMetadata(this.displayInfoId).then(this.onItemMetadataLoaded.bind(this))}get isLoaded(){return null!=this.itemMetadata&&this.texturesLoaded&&this.componentsLoaded&&(!this.itemVisual||this.itemVisual.isLoaded)}get classId(){var e;return null===(e=this.itemMetadata)||void 0===e?void 0:e.classId}get subClassId(){var e;return null===(e=this.itemMetadata)||void 0===e?void 0:e.subclassId}get inventoryType(){var e;return null===(e=this.itemMetadata)||void 0===e?void 0:e.inventoryType}loadDisplayInfoId(e){this.displayInfoId!==e&&(0===e&&this.dispose(),this.displayInfoId=e,this.renderer&&this.dataManager.getItemMetadata(this.displayInfoId).then(this.onItemMetadataLoaded.bind(this)))}update(e){super.update(e),this.isLoaded&&!this.isDisposing&&(this.component1&&this.component1.update(e),this.component2&&this.component2.update(e),this.itemVisual&&this.itemVisual.update(e),this.stateSpellVisualKit&&this.stateSpellVisualKit.update(e),this.sheathedSpellVisualKit,this.unsheathedSpellVisualKit&&this.unsheathedSpellVisualKit.update(e))}draw(){this.isLoaded&&!this.isDisposing&&(this.component1&&this.component1.draw(),this.component2&&this.component2.draw(),this.itemVisual&&this.itemVisual.draw(),this.stateSpellVisualKit&&this.stateSpellVisualKit.draw(),this.sheathedSpellVisualKit,this.unsheathedSpellVisualKit&&this.unsheathedSpellVisualKit.draw())}equipTo(e){this.isDisposing||(this.character=e,this.character.addChild(this),this.updateModelMatrixFromParent())}setItemVisual(e){if(this.itemVisual){if(this.itemVisual.itemVisualId===e)return;this.itemVisual.dispose()}const t=this.objectFactory.createItemVisual(e);return t.once("loaded",(()=>{this.isLoaded&&this.processCallbacks("loaded")})),this.itemVisual=t,t.attachTo(this),t}dispose(){this.isDisposing||(super.dispose(),this.itemMetadata=null,this.character=null,this.component1&&this.component1.dispose(),this.component1=null,this.component2&&this.component2.dispose(),this.component2=null,this.stateSpellVisualKit&&this.stateSpellVisualKit.dispose(),this.stateSpellVisualKit=null,this.sheathedSpellVisualKit&&this.sheathedSpellVisualKit.dispose(),this.sheathedSpellVisualKit=null,this.unsheathedSpellVisualKit&&this.unsheathedSpellVisualKit.dispose(),this.unsheathedSpellVisualKit=null,this.sectionTextures=null,this.component1Texture=null,this.component2Texture=null)}canExecuteCallbackNow(e){switch(e){case"metadataLoaded":return null!=this.itemMetadata;case"componentsLoaded":return this.componentsLoaded;case"sectionTexturesLoaded":return this.texturesLoaded;default:return super.canExecuteCallbackNow(e)}}onItemMetadataLoaded(e){if(!e)return void this.dispose();if(this.isDisposing)return;this.itemMetadata=e;const t=this.character?this.character.race:1,r=this.character?this.character.gender:0,o=this.character?this.character.class:1;let s=[null,null,null];if(e.particleColor)for(let t=0;t<e.particleColor.start.length;t++){let r=[a.Float3.zero(),a.Float3.zero(),a.Float3.zero()];n(e.particleColor.start[t],r[0]),n(e.particleColor.mid[t],r[1]),n(e.particleColor.end[t],r[2]),s[t]=r}const l=[];if(e.component1){const a=this.itemMetadata.inventoryType===i.InventoryType.Shoulders?0:-1,n=this.modelPickingStrategy(e.component1.modelFiles,a,t,r,o),u=this.texturePickingStrategy(e.component1.textureFiles,t,r,o)[0];if(u){this.component1Texture=this.renderer.getUnknownTexture();const e=this.renderer.getTexture(this,u).then((e=>{this.component1Texture=e,this.component1&&this.component1.swapTextureType(2,e)}));l.push(e)}n&&(this.component1=this.objectFactory.createM2Model(n),this.addChild(this.component1),this.component1.once("texturesLoaded",this.onComponentLoaded.bind(this)),s&&this.component1.setParticleColorOverride(s))}if(e.component2){const a=this.itemMetadata.inventoryType===i.InventoryType.Shoulders?1:-1,n=this.modelPickingStrategy(e.component2.modelFiles,a,t,r,o),u=this.texturePickingStrategy(e.component2.textureFiles,t,r,o)[0];if(u){this.component2Texture=this.renderer.getUnknownTexture();const e=this.renderer.getTexture(this,u).then((e=>{this.component2Texture=e,this.component2&&this.component2.swapTextureType(2,e)}));l.push(e)}n&&(this.component2=this.objectFactory.createM2Model(n),this.addChild(this.component2),this.component2.once("texturesLoaded",this.onComponentLoaded.bind(this)),s&&this.component2.setParticleColorOverride(s))}if(e.componentSections)for(const a of e.componentSections){this.sectionTextures[a.section]=[null,null,null];const e=this.texturePickingStrategy(a.textures,t,r,o);for(let t=0;t<2;t++)if(e[t]){const r=this.renderer.getTexture(this,e[t]).then((e=>{this.sectionTextures[a.section][t]=e}));l.push(r)}}if(e.itemVisual&&this.setItemVisual(e.itemVisual),e.stateSpellVisualKitId){this.stateSpellVisualKit=this.objectFactory.createSpellVisualKit(e.stateSpellVisualKitId);const t=this.component1?this.component1:this.character;t?this.stateSpellVisualKit.attachTo(t):this.stateSpellVisualKit.attachToRenderer(this.renderer)}this.processCallbacks("metadataLoaded"),Promise.all(l).then(this.onTexturesLoaded.bind(this)),this.onComponentLoaded()}onComponentLoaded(){if(!this.isDisposing&&(!this.component1||this.component1.isLoaded)&&(!this.component2||this.component2.isLoaded)){if(this.componentsLoaded=!0,this.component1||this.component2){let e;e=this.component1&&this.component2?a.AABB.merge(this.component1.worldBoundingBox,this.component2.worldBoundingBox):this.component1?this.component1.worldBoundingBox:this.component2.worldBoundingBox,this.setBoundingBox(e)}this.processCallbacks("componentsLoaded"),this.isLoaded&&this.processCallbacks("loaded")}}onTexturesLoaded(){this.isDisposing||(this.texturesLoaded=!0,this.processCallbacks("sectionTexturesLoaded"),this.isLoaded&&this.processCallbacks("loaded"))}}t.ItemModel=s},7601:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});const a="precision mediump float;\r\n\r\nuniform sampler2D u_texture;\r\nvarying vec2 v_texCoord;\r\n\r\nvoid main() {\r\n    if ( v_texCoord.y < - 1.0 || v_texCoord.y > 1.0 ) \r\n        discard; // discard endcaps\r\n\r\n    vec4 diffuseColor = texture2D(u_texture, v_texCoord.st);\r\n    gl_FragColor = diffuseColor;\r\n}"},7690:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CachedGraphics=void 0,t.CachedGraphics=class{constructor(){}startFrame(e,t){this.lastUsedShaderProgram=void 0,this.lastUsedVertexDataBuffer=void 0,this.lastUsedVertexIndexBuffer=void 0,this.lastUsedDatabuffers=void 0,this.lastUsedBlendMode=void 0,this.lastUsedDepthWrite=void 0,this.lastUsedDepthTest=void 0,this.lastUsedColorMask=void 0,this.lastUsedBackFaceCulling=void 0,this.lastUsedCounterClockWiseFrontFaces=void 0,this.lastUsedFrameBuffer=void 0}useBlendMode(e){this.lastUsedBlendMode!=e&&(this.activateBlendMode(e),this.lastUsedBlendMode=e)}useDepthWrite(e){this.lastUsedDepthWrite!=e&&(this.activateDepthWrite(e),this.lastUsedDepthWrite=e)}useDepthTest(e){this.lastUsedDepthTest!=e&&(this.activateDepthTest(e),this.lastUsedDepthWrite=e)}useBackFaceCulling(e){this.lastUsedBackFaceCulling!=e&&(this.activateBackFaceCulling(e),this.lastUsedBackFaceCulling=e)}useCounterClockWiseFrontFaces(e){this.lastUsedCounterClockWiseFrontFaces!=e&&(this.activateCounterClockWiseFrontFaces(e),this.lastUsedCounterClockWiseFrontFaces=e)}useColorMask(e){this.lastUsedColorMask!=e&&(this.activateColorMask(e),this.lastUsedColorMask=e)}useVertexIndexBuffer(e){e!=this.lastUsedVertexIndexBuffer&&(e?e.bind():this.lastUsedVertexIndexBuffer.unbind(),this.lastUsedVertexIndexBuffer=e)}useVertexDataBuffer(e){e!=this.lastUsedVertexDataBuffer&&(e?e.bind():this.lastUsedVertexDataBuffer.unbind(),this.lastUsedVertexDataBuffer=e)}useShaderProgram(e){e!=this.lastUsedShaderProgram&&(e?e.bind():this.lastUsedShaderProgram.unbind(),this.lastUsedShaderProgram=e)}useDataBuffers(e){e!=this.lastUsedDatabuffers&&(e?e.bind():this.lastUsedDatabuffers.unbind(),this.lastUsedDatabuffers=e)}useFrameBuffer(e){e!=this.lastUsedFrameBuffer&&(e?e.bind():this.lastUsedFrameBuffer.unbind(),this.lastUsedFrameBuffer=e)}}},7693:(e,t)=>{"use strict";var r,a,i;Object.defineProperty(t,"__esModule",{value:!0}),t.TextureSection=t.GeoSet=t.EquipmentSlot=void 0,function(e){e[e.Start=0]="Start",e[e.Head=0]="Head",e[e.Neck=1]="Neck",e[e.Shoulders=2]="Shoulders",e[e.Shirt=3]="Shirt",e[e.Body=4]="Body",e[e.Waist=5]="Waist",e[e.Legs=6]="Legs",e[e.Feet=7]="Feet",e[e.Wrists=8]="Wrists",e[e.Hands=9]="Hands",e[e.Finger1=10]="Finger1",e[e.Finger2=11]="Finger2",e[e.Trinket1=12]="Trinket1",e[e.Trinket2=13]="Trinket2",e[e.Back=14]="Back",e[e.MainHand=15]="MainHand",e[e.OffHand=16]="OffHand",e[e.Ranged=17]="Ranged",e[e.Tabard=18]="Tabard",e[e.End=19]="End"}(r||(t.EquipmentSlot=r={})),function(e){e[e.Hair=0]="Hair",e[e.Facial=1]="Facial",e[e.Facial2=2]="Facial2",e[e.Facial3=3]="Facial3",e[e.Wrists=4]="Wrists",e[e.Boots=5]="Boots",e[e.Shirt=6]="Shirt",e[e.Ears=7]="Ears",e[e.Sleeves=8]="Sleeves",e[e.Legcuffs=9]="Legcuffs",e[e.ShirtDoublet=10]="ShirtDoublet",e[e.PantDoublet=11]="PantDoublet",e[e.Tabard=12]="Tabard",e[e.LowerBody=13]="LowerBody",e[e.Loincloth=14]="Loincloth",e[e.Cloak=15]="Cloak",e[e.FacialJewelry=16]="FacialJewelry",e[e.EyeEffects=17]="EyeEffects",e[e.Belt=18]="Belt",e[e.SkinTail=19]="SkinTail",e[e.Feet=20]="Feet",e[e.Head=21]="Head",e[e.Torso=22]="Torso",e[e.HandAttachments=23]="HandAttachments",e[e.HeadAttachments=24]="HeadAttachments",e[e.Facewear=25]="Facewear",e[e.Shoulders=26]="Shoulders",e[e.Helmet=27]="Helmet",e[e.ArmUpper=28]="ArmUpper",e[e.ArmReplace=29]="ArmReplace",e[e.LegsReplace=30]="LegsReplace",e[e.FeetReplace=31]="FeetReplace",e[e.HeadSwapGeoset=32]="HeadSwapGeoset",e[e.Eyes=33]="Eyes",e[e.Eyebrows=34]="Eyebrows",e[e.Piercings=35]="Piercings",e[e.Necklaces=36]="Necklaces",e[e.Headdress=37]="Headdress",e[e.Tail=38]="Tail",e[e.MiscAccesory=39]="MiscAccesory",e[e.MiscFeature=40]="MiscFeature",e[e.Noses=41]="Noses",e[e.HairDecoration=42]="HairDecoration",e[e.HornDecoration=43]="HornDecoration"}(a||(t.GeoSet=a={})),function(e){e[e.UpperArm=0]="UpperArm",e[e.LowerArm=1]="LowerArm",e[e.Hand=2]="Hand",e[e.UpperTorso=3]="UpperTorso",e[e.LowerTorso=4]="LowerTorso",e[e.UpperLeg=5]="UpperLeg",e[e.LowerLeg=6]="LowerLeg",e[e.Foot=7]="Foot",e[e.Accessory=8]="Accessory"}(i||(t.TextureSection=i={}))},7707:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},7716:(e,t)=>{"use strict";var r,a,i,o,n,s;Object.defineProperty(t,"__esModule",{value:!0}),t.WoWParticleFlags=t.WoWTextureFlags=t.WoWTextureType=t.WoWMaterialFlags=t.WoWBoneFlags=t.WoWAnimationFlags=void 0,function(e){e[e.Init=1]="Init",e[e.Unk_0x2=2]="Unk_0x2",e[e.Unk_0x4=4]="Unk_0x4",e[e.Unk_0x8=8]="Unk_0x8",e[e.LowPrioritySequence=16]="LowPrioritySequence",e[e.PrimaryBoneSequence=32]="PrimaryBoneSequence",e[e.IsAlias=64]="IsAlias",e[e.BlendedAnimation=128]="BlendedAnimation",e[e.SequenceInModel=256]="SequenceInModel",e[e.BlendTimeInAndOut=512]="BlendTimeInAndOut",e[e.Unk_0x400=1024]="Unk_0x400",e[e.Unk_0x800=2048]="Unk_0x800",e[e.Unk_0x1000=4096]="Unk_0x1000",e[e.Unk_0x2000=8192]="Unk_0x2000"}(r||(t.WoWAnimationFlags=r={})),function(e){e[e.IgnoreParentTranslate=1]="IgnoreParentTranslate",e[e.IgnoreParentScale=2]="IgnoreParentScale",e[e.IgnoreParentRotation=4]="IgnoreParentRotation",e[e.SphericalBillboard=8]="SphericalBillboard",e[e.CylindricalBillboardLockX=16]="CylindricalBillboardLockX",e[e.CylindricalBillboardLockY=32]="CylindricalBillboardLockY",e[e.CylindricalBillboardLockZ=64]="CylindricalBillboardLockZ",e[e.Unk_0x80=128]="Unk_0x80",e[e.UNK_0x100=256]="UNK_0x100",e[e.Transformed=512]="Transformed",e[e.KinematicBone=1024]="KinematicBone",e[e.HelmetAnimScaled=4096]="HelmetAnimScaled",e[e.SomethingSequenceId=8192]="SomethingSequenceId"}(a||(t.WoWBoneFlags=a={})),function(e){e[e.None=0]="None",e[e.Unlit=1]="Unlit",e[e.Unfogged=2]="Unfogged",e[e.TwoSided=4]="TwoSided",e[e.DepthTest=8]="DepthTest",e[e.DepthWrite=16]="DepthWrite",e[e.Unknown_0x40=64]="Unknown_0x40",e[e.Unknown_0x80=128]="Unknown_0x80",e[e.Unknown_0x100=256]="Unknown_0x100",e[e.Unknown_0x200=512]="Unknown_0x200",e[e.Unknown_0x400=1024]="Unknown_0x400",e[e.PreventAlphaForCustomElements=2048]="PreventAlphaForCustomElements"}(i||(t.WoWMaterialFlags=i={})),function(e){e[e.None=0]="None",e[e.Skin=1]="Skin",e[e.ObjectSkin=2]="ObjectSkin",e[e.WeaponBlade=3]="WeaponBlade",e[e.WeaponHandle=4]="WeaponHandle",e[e.Environment=5]="Environment",e[e.CharHair=6]="CharHair",e[e.CharFacialHair=7]="CharFacialHair",e[e.SkinExtra=8]="SkinExtra",e[e.UISkin=9]="UISkin",e[e.TaurenMane=10]="TaurenMane",e[e.Monster1=11]="Monster1",e[e.Monster2=12]="Monster2",e[e.Monster3=13]="Monster3",e[e.ItemIcon=14]="ItemIcon",e[e.GuildBackgroundColor=15]="GuildBackgroundColor",e[e.GuildEmblemColor=16]="GuildEmblemColor",e[e.GuildBorderColor=17]="GuildBorderColor",e[e.GuildEmblem=18]="GuildEmblem",e[e.CharEyes=19]="CharEyes",e[e.CharJewelry=20]="CharJewelry",e[e.CharSecondarySkin=21]="CharSecondarySkin",e[e.CharSecondaryHair=22]="CharSecondaryHair",e[e.CharSecondaryArmor=23]="CharSecondaryArmor",e[e.Unknown24=24]="Unknown24",e[e.Unknown25=25]="Unknown25",e[e.Unknown26=26]="Unknown26"}(o||(t.WoWTextureType=o={})),function(e){e[e.None=0]="None",e[e.TextureWrapX=1]="TextureWrapX",e[e.TextureWrapY=2]="TextureWrapY"}(n||(t.WoWTextureFlags=n={})),function(e){e[e.AffectedByLighting=1]="AffectedByLighting",e[e.Unknown_0x02=2]="Unknown_0x02",e[e.OrientationIsAffectedByPlayerOrientation=4]="OrientationIsAffectedByPlayerOrientation",e[e.TravelUpInWorldspace=8]="TravelUpInWorldspace",e[e.DoNotTrail=16]="DoNotTrail",e[e.Unlightning=32]="Unlightning",e[e.UseBurstMulitpler=64]="UseBurstMulitpler",e[e.ParticlesInModelSpace=128]="ParticlesInModelSpace",e[e.Unknown_0x100=256]="Unknown_0x100",e[e.Unknown_0x200=512]="Unknown_0x200",e[e.PinnedParticles=1024]="PinnedParticles",e[e.Unknown_0x800=2048]="Unknown_0x800",e[e.XYQuadParticles=4096]="XYQuadParticles",e[e.ClampToGround=8192]="ClampToGround",e[e.Unknown_0x4000=16384]="Unknown_0x4000",e[e.Unknown_0x8000=32768]="Unknown_0x8000",e[e.ChooseRandomTexture=65536]="ChooseRandomTexture",e[e.OutwardParticles=131072]="OutwardParticles",e[e.Unknown_0x40000=262144]="Unknown_0x40000",e[e.ScaleVaryAffectsXAndYIndependently=524288]="ScaleVaryAffectsXAndYIndependently",e[e.Unknown_0x100000=1048576]="Unknown_0x100000",e[e.RandomFlipBookStart=2097152]="RandomFlipBookStart",e[e.IgnoreDistance=4194304]="IgnoreDistance",e[e.GravityValuesAreCompressedVectors=8388608]="GravityValuesAreCompressedVectors",e[e.BoneGeneratorIsBoneAndNotJoint=16777216]="BoneGeneratorIsBoneAndNotJoint",e[e.Unknown_0x2000000=33554432]="Unknown_0x2000000",e[e.DoNotThrottleEmissionRateBasedOnDistance=67108864]="DoNotThrottleEmissionRateBasedOnDistance",e[e.Unknown_0x8000000=134217728]="Unknown_0x8000000",e[e.UsesMultiTexturing=268435456]="UsesMultiTexturing"}(s||(t.WoWParticleFlags=s={}))},7729:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalAnimatedValueNumber=t.LocalAnimatedValueFloat2=t.LocalAnimatedFloat3=t.LocalAnimatedFloat4=t.LocalAnimatedValue=void 0;const a=r(1639);class i{constructor(e){this.timestamps=e.keys,this.values=e.values}dispose(){return this.timestamps=null,this.values=null,null}getValueAtTimestamp(e,t,r,a){r||(r=this.getDefaultT());let i=a||this.values;if(this.values.length>1&&this.timestamps.length>1){var o=this.timestamps[this.timestamps.length-1];o>0&&e>o&&(e%=o);var n=0;for(let t=0;t<this.timestamps.length-1;++t)if(e>this.timestamps[t]&&e<=this.timestamps[t+1]){n=t;break}var s=this.timestamps[n],l=this.timestamps[n+1],u=0;return s!=l&&(u=(e-s)/(l-s)),this.lerpT(i[n],i[n+1],u,r)}return i.length>0?r=this.copyT(i[0],r):t}}t.LocalAnimatedValue=i,t.LocalAnimatedFloat4=class extends i{getDefaultT(){return a.Float4.zero()}copyT(e,t){return a.Float4.copy(e,t)}lerpT(e,t,r,i){return a.Float4.lerp(e,t,r,i)}},t.LocalAnimatedFloat3=class extends i{getDefaultT(){return a.Float3.zero()}copyT(e,t){return a.Float3.copy(e,t)}lerpT(e,t,r,i){return a.Float3.lerp(e,t,r,i)}},t.LocalAnimatedValueFloat2=class extends i{getDefaultT(){return a.Float2.zero()}copyT(e,t){return a.Float2.copy(e,t)}lerpT(e,t,r,i){return a.Float2.lerp(e,t,r,i)}},t.LocalAnimatedValueNumber=class extends i{getDefaultT(){return 0}copyT(e,t){return t}lerpT(e,t,r,a){return e+r*(t-e)}}},7906:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AleaPrngGenerator=void 0,t.AleaPrngGenerator=class{constructor(e){this.setSeed(e)}setSeed(e){this.n=4022871197,this.c=1,this.s0=this.mash(" "),this.s1=this.mash(" "),this.s2=this.mash(" "),this.s0-=this.mash(e),this.s0<0&&(this.s0+=1),this.s1-=this.mash(e),this.s1<0&&(this.s1+=1),this.s2-=this.mash(e),this.s2<0&&(this.s2+=1)}mash(e){e=String(e);for(var t=0;t<e.length;t++){this.n+=e.charCodeAt(t);var r=.02519603282416938*this.n;this.n=r>>>0,r-=this.n,r*=this.n,this.n=r>>>0,r-=this.n,this.n+=4294967296*r}return 2.3283064365386963e-10*(this.n>>>0)}getInt(){return 4294967296*this.next()|0}getFloat(){return this.next()}getSignedFloat(){const e=this.next();return 1&this.c?e:-e}next(){const e=2091639*this.s0+2.3283064365386963e-10*this.c;return this.s0=this.s1,this.s1=this.s2,this.s2=e-(this.c=0|e)}}},7983:function(e){var t;"undefined"!=typeof self&&self,t=()=>(()=>{"use strict";var e={"./src/attributes.js":(e,t,r)=>{function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}t.__esModule=!0,t.createAttribsFromArrays=k,t.createBufferFromArray=P,t.createBufferFromTypedArray=_,t.createBufferInfoFromArrays=function(e,t,r){var a=k(e,t),o=Object.assign({},r||{});o.attribs=Object.assign({},r?r.attribs:{},a);var n=t.indices;if(n){var s=D(n,"indices");o.indices=_(e,s,d),o.numElements=s.length,o.elementType=i.getGLTypeForTypedArray(s)}else o.numElements||(o.numElements=function(e,t){var r,a;for(a=0;a<L.length&&!((r=L[a])in t)&&!((r=v.attribPrefix+r)in t);++a);a===L.length&&(r=Object.keys(t)[0]);var i=t[r];if(!i.buffer)return 1;e.bindBuffer(u,i.buffer);var o=e.getBufferParameter(u,c);e.bindBuffer(u,null);var n,s=o/((n=i.type)===h||n===f?1:n===p||n===m?2:n===g||n===y||n===x?4:0),l=i.numComponents||i.size,d=s/l;if(d%1!=0)throw new Error("numComponents ".concat(l," not correct for length ").concat(length));return d}(e,o.attribs));return o},t.createBuffersFromArrays=function(e,t){var r={};return Object.keys(t).forEach((function(a){r[a]=P(e,t[a],a)})),t.indices?(r.numElements=t.indices.length,r.elementType=i.getGLTypeForTypedArray(D(t.indices),"indices")):r.numElements=function(e){var t,r;for(r=0;r<L.length&&!((t=L[r])in e);++r);r===L.length&&(t=Object.keys(e)[0]);var a=e[t],i=C(a).length;if(void 0===i)return 1;var o=S(a,t),n=i/o;if(i%o>0)throw new Error("numComponents ".concat(o," not correct for length ").concat(i));return n}(t),r},t.getArray_=C,t.getNumComponents_=S,t.setAttribInfoBufferFromArray=function(e,t,r,a){r=D(r),void 0!==a?(e.bindBuffer(u,t.buffer),e.bufferSubData(u,a,r)):b(e,u,t.buffer,r,t.drawType)},t.setAttributeDefaults_=function(e){o.copyExistingProperties(e,v)},t.setAttributePrefix=function(e){v.attribPrefix=e};var i=s(r("./src/typedarrays.js")),o=s(r("./src/helper.js"));function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}function s(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var r=n(t);if(r&&r.has(e))return r.get(e);var i={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var l=o?Object.getOwnPropertyDescriptor(e,s):null;l&&(l.get||l.set)?Object.defineProperty(i,s,l):i[s]=e[s]}return i.default=e,r&&r.set(e,i),i}var l=35044,u=34962,d=34963,c=34660,h=5120,f=5121,p=5122,m=5123,g=5124,y=5125,x=5126,v={attribPrefix:""};function b(e,t,r,a,i){e.bindBuffer(t,r),e.bufferData(t,a,i||l)}function _(e,t,r,a){if(o.isBuffer(e,t))return t;r=r||u;var i=e.createBuffer();return b(e,r,i,t,a),i}function F(e){return"indices"===e}function C(e){return e.length?e:e.data}var w=/coord|texture/i,M=/color|colour/i;function S(e,t,r){return e.numComponents||e.size||function(e,t){var r;if(t%(r=w.test(e)?2:M.test(e)?4:3)>0)throw new Error("Can not guess numComponents for attribute '".concat(e,"'. Tried ").concat(r," but ").concat(t," values is not evenly divisible by ").concat(r,". You should specify it."));return r}(t,r||C(e).length)}function D(e,t){if(i.isArrayBuffer(e))return e;if(i.isArrayBuffer(e.data))return e.data;Array.isArray(e)&&(e={data:e});var r=e.type?A(e.type):void 0;return r||(r=F(t)?Uint16Array:Float32Array),new r(e.data)}function A(e){return"number"==typeof e?i.getTypedArrayTypeForGLType(e):e||Float32Array}function T(e,t){return{buffer:t.buffer,numValues:24,type:(r=t.type,"number"==typeof r?r:r?i.getGLTypeForTypedArrayType(r):x),arrayType:A(t.type)};var r}function E(e,t){var r=t.data||t,a=A(t.type),o=r*a.BYTES_PER_ELEMENT,n=e.createBuffer();return e.bindBuffer(u,n),e.bufferData(u,o,t.drawType||l),{buffer:n,numValues:r,type:i.getGLTypeForTypedArrayType(a),arrayType:a}}function B(e,t,r){var a=D(t,r);return{arrayType:a.constructor,buffer:_(e,a,void 0,t.drawType),type:i.getGLTypeForTypedArray(a),numValues:0}}function k(e,t){var r={};return Object.keys(t).forEach((function(a){if(!F(a)){var o=t[a],n=o.attrib||o.name||o.attribName||v.attribPrefix+a;if(o.value){if(!Array.isArray(o.value)&&!i.isArrayBuffer(o.value))throw new Error("array.value is not array or typedarray");r[n]={value:o.value}}else{var s=(o.buffer&&o.buffer instanceof WebGLBuffer?T:"number"==typeof o||"number"==typeof o.data?E:B)(e,o,a),l=s.buffer,u=s.type,d=s.numValues,c=s.arrayType,h=void 0!==o.normalize?o.normalize:(p=c)===Int8Array||p===Uint8Array,f=S(o,a,d);r[n]={buffer:l,numComponents:f,type:u,normalize:h,stride:o.stride||0,offset:o.offset||0,divisor:void 0===o.divisor?void 0:o.divisor,drawType:o.drawType}}}var p})),e.bindBuffer(u,null),r}var L=["position","positions","a_position"];function P(e,t,r){var a="indices"===r?d:u;return _(e,D(t,r),a)}},"./src/draw.js":(e,t,r)=>{function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}t.__esModule=!0,t.drawBufferInfo=l,t.drawObjectList=function(e,t){var r=null,a=null;t.forEach((function(t){if(!1!==t.active){var o=t.programInfo,s=t.vertexArrayInfo||t.bufferInfo,u=!1,d=void 0===t.type?n:t.type;o!==r&&(r=o,e.useProgram(o.program),u=!0),(u||s!==a)&&(a&&a.vertexArrayObject&&!s.vertexArrayObject&&e.bindVertexArray(null),a=s,i.setBuffersAndAttributes(e,o,s)),i.setUniforms(o,t.uniforms),l(e,s,d,t.count,t.offset,t.instanceCount)}})),a&&a.vertexArrayObject&&e.bindVertexArray(null)};var i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var i={__proto__:null},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var l=n?Object.getOwnPropertyDescriptor(e,s):null;l&&(l.get||l.set)?Object.defineProperty(i,s,l):i[s]=e[s]}return i.default=e,r&&r.set(e,i),i}(r("./src/programs.js"));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}var n=4,s=5123;function l(e,t,r,a,i,o){r=void 0===r?n:r;var l=t.indices,u=t.elementType,d=void 0===a?t.numElements:a;i=void 0===i?0:i,u||l?void 0!==o?e.drawElementsInstanced(r,d,void 0===u?s:t.elementType,i,o):e.drawElements(r,d,void 0===u?s:t.elementType,i):void 0!==o?e.drawArraysInstanced(r,i,d,o):e.drawArrays(r,i,d)}},"./src/framebuffers.js":(e,t,r)=>{function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}t.__esModule=!0,t.bindFramebufferInfo=function(e,t,r){r=r||l,t?(e.bindFramebuffer(r,t.framebuffer),e.viewport(0,0,t.width,t.height)):(e.bindFramebuffer(r,null),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight))},t.createFramebufferInfo=function(e,t,r,a){var n=l,s=e.createFramebuffer();e.bindFramebuffer(n,s),r=r||e.drawingBufferWidth,a=a||e.drawingBufferHeight;var h=[],f={framebuffer:s,attachments:[],width:r,height:a};return(t=t||g).forEach((function(t,s){var l=t.attachment,g=t.samples,b=t.format,_=t.attachmentPoint||function(e,t){return y[e]||y[t]}(b,t.internalFormat);if(_||(_=c+s),function(e){return e>=c&&e<c+v}(_)&&h.push(_),!l)if(void 0!==g||function(e){return x[e]}(b))l=e.createRenderbuffer(),e.bindRenderbuffer(u,l),g>1?e.renderbufferStorageMultisample(u,g,b,r,a):e.renderbufferStorage(u,b,r,a);else{var F=Object.assign({},t);F.width=r,F.height=a,void 0===F.auto&&(F.auto=!1,F.min=F.min||F.minMag||m,F.mag=F.mag||F.minMag||m,F.wrapS=F.wrapS||F.wrap||p,F.wrapT=F.wrapT||F.wrap||p),l=i.createTexture(e,F)}if(o.isRenderbuffer(e,l))e.framebufferRenderbuffer(n,_,u,l);else{if(!o.isTexture(e,l))throw new Error("unknown attachment type");void 0!==t.layer?e.framebufferTextureLayer(n,_,l,t.level||0,t.layer):e.framebufferTexture2D(n,_,t.target||d,l,t.level||0)}f.attachments.push(l)})),e.drawBuffers&&e.drawBuffers(h),f},t.resizeFramebufferInfo=function(e,t,r,a,n){a=a||e.drawingBufferWidth,n=n||e.drawingBufferHeight,t.width=a,t.height=n,(r=r||g).forEach((function(r,s){var l=t.attachments[s],d=r.format,c=r.samples;if(void 0!==c||o.isRenderbuffer(e,l))e.bindRenderbuffer(u,l),c>1?e.renderbufferStorageMultisample(u,c,d,a,n):e.renderbufferStorage(u,d,a,n);else{if(!o.isTexture(e,l))throw new Error("unknown attachment type");i.resizeTexture(e,l,r,a,n)}}))};var i=s(r("./src/textures.js")),o=s(r("./src/helper.js"));function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}function s(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var r=n(t);if(r&&r.has(e))return r.get(e);var i={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var l=o?Object.getOwnPropertyDescriptor(e,s):null;l&&(l.get||l.set)?Object.defineProperty(i,s,l):i[s]=e[s]}return i.default=e,r&&r.set(e,i),i}var l=36160,u=36161,d=3553,c=36064,h=36096,f=33306,p=33071,m=9729,g=[{format:6408,type:5121,min:m,wrap:p},{format:34041}],y={};y[34041]=f,y[6401]=36128,y[36168]=36128,y[6402]=h,y[33189]=h,y[33190]=h,y[36012]=h,y[35056]=f,y[36013]=f;var x={32854:!0,32855:!0,36194:!0,34041:!0,33189:!0,6401:!0,36168:!0},v=32},"./src/helper.js":(e,t)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}t.__esModule=!0,t.copyExistingProperties=function(e,t){Object.keys(t).forEach((function(r){t.hasOwnProperty(r)&&e.hasOwnProperty(r)&&(t[r]=e[r])}))},t.copyNamedProperties=function(e,t,r){e.forEach((function(e){var a=t[e];void 0!==a&&(r[e]=a)}))},t.error=function(){var e;(e=console).error.apply(e,arguments)},t.isBuffer=function(e,t){return"undefined"!=typeof WebGLBuffer&&i(t,"WebGLBuffer")},t.isRenderbuffer=function(e,t){return"undefined"!=typeof WebGLRenderbuffer&&i(t,"WebGLRenderbuffer")},t.isSampler=function(e,t){return"undefined"!=typeof WebGLSampler&&i(t,"WebGLSampler")},t.isShader=function(e,t){return"undefined"!=typeof WebGLShader&&i(t,"WebGLShader")},t.isTexture=function(e,t){return"undefined"!=typeof WebGLTexture&&i(t,"WebGLTexture")},t.warn=function(){var e;(e=console).warn.apply(e,arguments)};var a=new Map;function i(e,t){if(!e||"object"!==r(e))return!1;var i=a.get(t);i||(i=new WeakMap,a.set(t,i));var o=i.get(e);if(void 0===o){var n=Object.prototype.toString.call(e);o=n.substring(8,n.length-1)===t,i.set(e,o)}return o}},"./src/m4.js":(e,t,r)=>{function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}t.__esModule=!0,t.axisRotate=function(e,t,r,a){a=a||new u(16);var i=t[0],o=t[1],n=t[2],s=Math.sqrt(i*i+o*o+n*n),l=(i/=s)*i,d=(o/=s)*o,c=(n/=s)*n,h=Math.cos(r),f=Math.sin(r),p=1-h,m=l+(1-l)*h,g=i*o*p+n*f,y=i*n*p-o*f,x=i*o*p-n*f,v=d+(1-d)*h,b=o*n*p+i*f,_=i*n*p+o*f,F=o*n*p-i*f,C=c+(1-c)*h,w=e[0],M=e[1],S=e[2],D=e[3],A=e[4],T=e[5],E=e[6],B=e[7],k=e[8],L=e[9],P=e[10],I=e[11];return a[0]=m*w+g*A+y*k,a[1]=m*M+g*T+y*L,a[2]=m*S+g*E+y*P,a[3]=m*D+g*B+y*I,a[4]=x*w+v*A+b*k,a[5]=x*M+v*T+b*L,a[6]=x*S+v*E+b*P,a[7]=x*D+v*B+b*I,a[8]=_*w+F*A+C*k,a[9]=_*M+F*T+C*L,a[10]=_*S+F*E+C*P,a[11]=_*D+F*B+C*I,e!==a&&(a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a},t.axisRotation=function(e,t,r){r=r||new u(16);var a=e[0],i=e[1],o=e[2],n=Math.sqrt(a*a+i*i+o*o),s=(a/=n)*a,l=(i/=n)*i,d=(o/=n)*o,c=Math.cos(t),h=Math.sin(t),f=1-c;return r[0]=s+(1-s)*c,r[1]=a*i*f+o*h,r[2]=a*o*f-i*h,r[3]=0,r[4]=a*i*f-o*h,r[5]=l+(1-l)*c,r[6]=i*o*f+a*h,r[7]=0,r[8]=a*o*f+i*h,r[9]=i*o*f-a*h,r[10]=d+(1-d)*c,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},t.copy=d,t.create=function(){return new u(16).fill(0)},t.frustum=function(e,t,r,a,i,o,n){var s=t-e,l=a-r,d=i-o;return(n=n||new u(16))[0]=2*i/s,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=2*i/l,n[6]=0,n[7]=0,n[8]=(e+t)/s,n[9]=(a+r)/l,n[10]=o/d,n[11]=-1,n[12]=0,n[13]=0,n[14]=i*o/d,n[15]=0,n},t.getAxis=function(e,t,r){var a=4*t;return(r=r||i.create())[0]=e[a+0],r[1]=e[a+1],r[2]=e[a+2],r},t.getTranslation=function(e,t){return(t=t||i.create())[0]=e[12],t[1]=e[13],t[2]=e[14],t},t.identity=c,t.inverse=h,t.lookAt=function(e,t,r,a){return a=a||new u(16),n=n||i.create(),s=s||i.create(),l=l||i.create(),i.normalize(i.subtract(e,t,l),l),i.normalize(i.cross(r,l,n),n),i.normalize(i.cross(l,n,s),s),a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=0,a[4]=s[0],a[5]=s[1],a[6]=s[2],a[7]=0,a[8]=l[0],a[9]=l[1],a[10]=l[2],a[11]=0,a[12]=e[0],a[13]=e[1],a[14]=e[2],a[15]=1,a},t.multiply=function(e,t,r){r=r||new u(16);var a=e[0],i=e[1],o=e[2],n=e[3],s=e[4],l=e[5],d=e[6],c=e[7],h=e[8],f=e[9],p=e[10],m=e[11],g=e[12],y=e[13],x=e[14],v=e[15],b=t[0],_=t[1],F=t[2],C=t[3],w=t[4],M=t[5],S=t[6],D=t[7],A=t[8],T=t[9],E=t[10],B=t[11],k=t[12],L=t[13],P=t[14],I=t[15];return r[0]=a*b+s*_+h*F+g*C,r[1]=i*b+l*_+f*F+y*C,r[2]=o*b+d*_+p*F+x*C,r[3]=n*b+c*_+m*F+v*C,r[4]=a*w+s*M+h*S+g*D,r[5]=i*w+l*M+f*S+y*D,r[6]=o*w+d*M+p*S+x*D,r[7]=n*w+c*M+m*S+v*D,r[8]=a*A+s*T+h*E+g*B,r[9]=i*A+l*T+f*E+y*B,r[10]=o*A+d*T+p*E+x*B,r[11]=n*A+c*T+m*E+v*B,r[12]=a*k+s*L+h*P+g*I,r[13]=i*k+l*L+f*P+y*I,r[14]=o*k+d*L+p*P+x*I,r[15]=n*k+c*L+m*P+v*I,r},t.negate=function(e,t){return(t=t||new u(16))[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t[9]=-e[9],t[10]=-e[10],t[11]=-e[11],t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=-e[15],t},t.ortho=function(e,t,r,a,i,o,n){return(n=n||new u(16))[0]=2/(t-e),n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=2/(a-r),n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2/(i-o),n[11]=0,n[12]=(t+e)/(e-t),n[13]=(a+r)/(r-a),n[14]=(o+i)/(i-o),n[15]=1,n},t.perspective=function(e,t,r,a,i){i=i||new u(16);var o=Math.tan(.5*Math.PI-.5*e),n=1/(r-a);return i[0]=o/t,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=(r+a)*n,i[11]=-1,i[12]=0,i[13]=0,i[14]=r*a*n*2,i[15]=0,i},t.rotateX=function(e,t,r){r=r||new u(16);var a=e[4],i=e[5],o=e[6],n=e[7],s=e[8],l=e[9],d=e[10],c=e[11],h=Math.cos(t),f=Math.sin(t);return r[4]=h*a+f*s,r[5]=h*i+f*l,r[6]=h*o+f*d,r[7]=h*n+f*c,r[8]=h*s-f*a,r[9]=h*l-f*i,r[10]=h*d-f*o,r[11]=h*c-f*n,e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r},t.rotateY=function(e,t,r){r=r||new u(16);var a=e[0],i=e[1],o=e[2],n=e[3],s=e[8],l=e[9],d=e[10],c=e[11],h=Math.cos(t),f=Math.sin(t);return r[0]=h*a-f*s,r[1]=h*i-f*l,r[2]=h*o-f*d,r[3]=h*n-f*c,r[8]=h*s+f*a,r[9]=h*l+f*i,r[10]=h*d+f*o,r[11]=h*c+f*n,e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r},t.rotateZ=function(e,t,r){r=r||new u(16);var a=e[0],i=e[1],o=e[2],n=e[3],s=e[4],l=e[5],d=e[6],c=e[7],h=Math.cos(t),f=Math.sin(t);return r[0]=h*a+f*s,r[1]=h*i+f*l,r[2]=h*o+f*d,r[3]=h*n+f*c,r[4]=h*s-f*a,r[5]=h*l-f*i,r[6]=h*d-f*o,r[7]=h*c-f*n,e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r},t.rotationX=function(e,t){t=t||new u(16);var r=Math.cos(e),a=Math.sin(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=a,t[7]=0,t[8]=0,t[9]=-a,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.rotationY=function(e,t){t=t||new u(16);var r=Math.cos(e),a=Math.sin(e);return t[0]=r,t[1]=0,t[2]=-a,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=a,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.rotationZ=function(e,t){t=t||new u(16);var r=Math.cos(e),a=Math.sin(e);return t[0]=r,t[1]=a,t[2]=0,t[3]=0,t[4]=-a,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.scale=function(e,t,r){r=r||new u(16);var a=t[0],i=t[1],o=t[2];return r[0]=a*e[0],r[1]=a*e[1],r[2]=a*e[2],r[3]=a*e[3],r[4]=i*e[4],r[5]=i*e[5],r[6]=i*e[6],r[7]=i*e[7],r[8]=o*e[8],r[9]=o*e[9],r[10]=o*e[10],r[11]=o*e[11],e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r},t.scaling=function(e,t){return(t=t||new u(16))[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.setAxis=function(e,t,r,a){a!==e&&(a=d(e,a));var i=4*r;return a[i+0]=t[0],a[i+1]=t[1],a[i+2]=t[2],a},t.setDefaultType=function(e){var t=u;return u=e,t},t.setTranslation=function(e,t,r){return e!==(r=r||c())&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11]),r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r},t.transformDirection=function(e,t,r){r=r||i.create();var a=t[0],o=t[1],n=t[2];return r[0]=a*e[0]+o*e[4]+n*e[8],r[1]=a*e[1]+o*e[5]+n*e[9],r[2]=a*e[2]+o*e[6]+n*e[10],r},t.transformNormal=function(e,t,r){r=r||i.create();var a=h(e),o=t[0],n=t[1],s=t[2];return r[0]=o*a[0]+n*a[1]+s*a[2],r[1]=o*a[4]+n*a[5]+s*a[6],r[2]=o*a[8]+n*a[9]+s*a[10],r},t.transformPoint=function(e,t,r){r=r||i.create();var a=t[0],o=t[1],n=t[2],s=a*e[3]+o*e[7]+n*e[11]+e[15];return r[0]=(a*e[0]+o*e[4]+n*e[8]+e[12])/s,r[1]=(a*e[1]+o*e[5]+n*e[9]+e[13])/s,r[2]=(a*e[2]+o*e[6]+n*e[10]+e[14])/s,r},t.translate=function(e,t,r){r=r||new u(16);var a=t[0],i=t[1],o=t[2],n=e[0],s=e[1],l=e[2],d=e[3],c=e[4],h=e[5],f=e[6],p=e[7],m=e[8],g=e[9],y=e[10],x=e[11],v=e[12],b=e[13],_=e[14],F=e[15];return e!==r&&(r[0]=n,r[1]=s,r[2]=l,r[3]=d,r[4]=c,r[5]=h,r[6]=f,r[7]=p,r[8]=m,r[9]=g,r[10]=y,r[11]=x),r[12]=n*a+c*i+m*o+v,r[13]=s*a+h*i+g*o+b,r[14]=l*a+f*i+y*o+_,r[15]=d*a+p*i+x*o+F,r},t.translation=function(e,t){return(t=t||new u(16))[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},t.transpose=function(e,t){var r;if((t=t||new u(16))===e)return r=e[1],e[1]=e[4],e[4]=r,r=e[2],e[2]=e[8],e[8]=r,r=e[3],e[3]=e[12],e[12]=r,r=e[6],e[6]=e[9],e[9]=r,r=e[7],e[7]=e[13],e[13]=r,r=e[11],e[11]=e[14],e[14]=r,t;var a=e[0],i=e[1],o=e[2],n=e[3],s=e[4],l=e[5],d=e[6],c=e[7],h=e[8],f=e[9],p=e[10],m=e[11],g=e[12],y=e[13],x=e[14],v=e[15];return t[0]=a,t[1]=s,t[2]=h,t[3]=g,t[4]=i,t[5]=l,t[6]=f,t[7]=y,t[8]=o,t[9]=d,t[10]=p,t[11]=x,t[12]=n,t[13]=c,t[14]=m,t[15]=v,t};var i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var i={__proto__:null},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var l=n?Object.getOwnPropertyDescriptor(e,s):null;l&&(l.get||l.set)?Object.defineProperty(i,s,l):i[s]=e[s]}return i.default=e,r&&r.set(e,i),i}(r("./src/v3.js"));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}var n,s,l,u=Float32Array;function d(e,t){return(t=t||new u(16))[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function c(e){return(e=e||new u(16))[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function h(e,t){t=t||new u(16);var r=e[0],a=e[1],i=e[2],o=e[3],n=e[4],s=e[5],l=e[6],d=e[7],c=e[8],h=e[9],f=e[10],p=e[11],m=e[12],g=e[13],y=e[14],x=e[15],v=f*x,b=y*p,_=l*x,F=y*d,C=l*p,w=f*d,M=i*x,S=y*o,D=i*p,A=f*o,T=i*d,E=l*o,B=c*g,k=m*h,L=n*g,P=m*s,I=n*h,O=c*s,R=r*g,U=m*a,W=r*h,V=c*a,z=r*s,j=n*a,G=v*s+F*h+C*g-(b*s+_*h+w*g),H=b*a+M*h+A*g-(v*a+S*h+D*g),N=_*a+S*s+T*g-(F*a+M*s+E*g),q=w*a+D*s+E*h-(C*a+A*s+T*h),K=1/(r*G+n*H+c*N+m*q);return t[0]=K*G,t[1]=K*H,t[2]=K*N,t[3]=K*q,t[4]=K*(b*n+_*c+w*m-(v*n+F*c+C*m)),t[5]=K*(v*r+S*c+D*m-(b*r+M*c+A*m)),t[6]=K*(F*r+M*n+E*m-(_*r+S*n+T*m)),t[7]=K*(C*r+A*n+T*c-(w*r+D*n+E*c)),t[8]=K*(B*d+P*p+I*x-(k*d+L*p+O*x)),t[9]=K*(k*o+R*p+V*x-(B*o+U*p+W*x)),t[10]=K*(L*o+U*d+z*x-(P*o+R*d+j*x)),t[11]=K*(O*o+W*d+j*p-(I*o+V*d+z*p)),t[12]=K*(L*f+O*y+k*l-(I*y+B*l+P*f)),t[13]=K*(W*y+B*i+U*f-(R*f+V*y+k*i)),t[14]=K*(R*l+j*y+P*i-(z*y+L*i+U*l)),t[15]=K*(z*f+I*i+V*l-(W*l+j*f+O*i)),t}},"./src/primitives.js":(e,t,r)=>{function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}t.__esModule=!0,t.concatVertices=function(e){for(var t,r={},a=function(){var a=e[i];Object.keys(a).forEach((function(e){r[e]||(r[e]=[]),t||"indices"===e||(t=e);var i=a[e],o=h(i,e),n=c(i).length/o;r[e].push(n)}))},i=0;i<e.length;++i)a();var o=r[t],n={};return Object.keys(r).forEach((function(t){var r=function(t){for(var r,a=0,i=0;i<e.length;++i){var o=e[i][t];a+=c(o).length,r&&!o.data||(r=o)}return{length:a,spec:r}}(t),a=U(r.spec,r.length);!function(t,r,a){for(var i=0,o=0,n=0;n<e.length;++n){var s=e[n][t],l=c(s);"indices"===t?(R(l,a,o,i),i+=r[n]):R(l,a,o),o+=l.length}}(t,o,c(a)),n[t]=a})),n},t.create3DFBuffers=t.create3DFBufferInfo=void 0,t.create3DFVertices=T,t.createAugmentedTypedArray=p,t.createCrescentBuffers=t.createCrescentBufferInfo=void 0,t.createCrescentVertices=E,t.createCubeBuffers=t.createCubeBufferInfo=t.createCresentVertices=t.createCresentBuffers=t.createCresentBufferInfo=void 0,t.createCubeVertices=S,t.createCylinderBuffers=t.createCylinderBufferInfo=void 0,t.createCylinderVertices=B,t.createDiscBuffers=t.createDiscBufferInfo=void 0,t.createDiscVertices=L,t.createPlaneBuffers=t.createPlaneBufferInfo=void 0,t.createPlaneVertices=C,t.createSphereBuffers=t.createSphereBufferInfo=void 0,t.createSphereVertices=w,t.createTorusBuffers=t.createTorusBufferInfo=void 0,t.createTorusVertices=k,t.createTruncatedConeBuffers=t.createTruncatedConeBufferInfo=void 0,t.createTruncatedConeVertices=D,t.createXYQuadBuffers=t.createXYQuadBufferInfo=void 0,t.createXYQuadVertices=F,t.deindexVertices=function(e){var t=e.indices,r={},a=t.length;return Object.keys(e).filter(m).forEach((function(i){for(var o=e[i],n=o.numComponents,s=p(n,a,o.constructor),l=0;l<a;++l)for(var u=t[l]*n,d=0;d<n;++d)s.push(o[u+d]);r[i]=s})),r},t.duplicateVertices=function(e){var t={};return Object.keys(e).forEach((function(r){var a=e[r],i=c(a),o=U(a,i.length);R(i,c(o),0),t[r]=o})),t},t.flattenNormals=function(e){if(e.indices)throw new Error("can not flatten normals of indexed vertices. deindex them first");for(var t=e.normal,r=t.length,a=0;a<r;a+=9){var i=t[a+0],o=t[a+1],n=t[a+2],s=t[a+3],l=t[a+4],u=t[a+5],d=i+s+t[a+6],c=o+l+t[a+7],h=n+u+t[a+8],f=Math.sqrt(d*d+c*c+h*h);d/=f,c/=f,h/=f,t[a+0]=d,t[a+1]=c,t[a+2]=h,t[a+3]=d,t[a+4]=c,t[a+5]=h,t[a+6]=d,t[a+7]=c,t[a+8]=h}return e},t.makeRandomVertexColors=function(e,t){t=t||{};var r=e.position.numElements,a=p(4,r,Uint8Array),i=t.rand||function(e,t){return t<3?256*Math.random()|0:255};if(e.color=a,e.indices)for(var o=0;o<r;++o)a.push(i(o,0),i(o,1),i(o,2),i(o,3));else for(var n=t.vertsPerColor||3,s=r/n,l=0;l<s;++l)for(var u=[i(l,0),i(l,1),i(l,2),i(l,3)],d=0;d<n;++d)a.push(u);return e},t.reorientDirections=x,t.reorientNormals=v,t.reorientPositions=b,t.reorientVertices=_;var i=d(r("./src/attributes.js")),o=d(r("./src/helper.js")),n=d(r("./src/typedarrays.js")),s=d(r("./src/m4.js")),l=d(r("./src/v3.js"));function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}function d(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var r=u(t);if(r&&r.has(e))return r.get(e);var i={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var s=o?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(i,n,s):i[n]=e[n]}return i.default=e,r&&r.set(e,i),i}var c=i.getArray_,h=i.getNumComponents_;function f(e,t){var r=0;return e.push=function(){for(var t=0;t<arguments.length;++t){var a=arguments[t];if(a instanceof Array||n.isArrayBuffer(a))for(var i=0;i<a.length;++i)e[r++]=a[i];else e[r++]=a}},e.reset=function(e){r=e||0},e.numComponents=t,Object.defineProperty(e,"numElements",{get:function(){return this.length/this.numComponents|0}}),e}function p(e,t,r){return f(new(r||Float32Array)(e*t),e)}function m(e){return"indices"!==e}function g(e,t,r){for(var a=e.length,i=new Float32Array(3),o=0;o<a;o+=3)r(t,[e[o],e[o+1],e[o+2]],i),e[o]=i[0],e[o+1]=i[1],e[o+2]=i[2]}function y(e,t,r){r=r||l.create();var a=t[0],i=t[1],o=t[2];return r[0]=a*e[0]+i*e[1]+o*e[2],r[1]=a*e[4]+i*e[5]+o*e[6],r[2]=a*e[8]+i*e[9]+o*e[10],r}function x(e,t){return g(e,t,s.transformDirection),e}function v(e,t){return g(e,s.inverse(t),y),e}function b(e,t){return g(e,t,s.transformPoint),e}function _(e,t){return Object.keys(e).forEach((function(r){var a=e[r];r.indexOf("pos")>=0?b(a,t):r.indexOf("tan")>=0||r.indexOf("binorm")>=0?x(a,t):r.indexOf("norm")>=0&&v(a,t)})),e}function F(e,t,r){return e=e||2,{position:{numComponents:2,data:[(t=t||0)+-1*(e*=.5),(r=r||0)+-1*e,t+1*e,r+-1*e,t+-1*e,r+1*e,t+1*e,r+1*e]},normal:[0,0,1,0,0,1,0,0,1,0,0,1],texcoord:[0,0,1,0,0,1,1,1],indices:[0,1,2,2,1,3]}}function C(e,t,r,a,i){e=e||1,t=t||1,r=r||1,a=a||1,i=i||s.identity();for(var o=(r+1)*(a+1),n=p(3,o),l=p(3,o),u=p(2,o),d=0;d<=a;d++)for(var c=0;c<=r;c++){var h=c/r,f=d/a;n.push(e*h-.5*e,0,t*f-.5*t),l.push(0,1,0),u.push(h,f)}for(var m=r+1,g=p(3,r*a*2,Uint16Array),y=0;y<a;y++)for(var x=0;x<r;x++)g.push((y+0)*m+x,(y+1)*m+x,(y+0)*m+x+1),g.push((y+1)*m+x,(y+1)*m+x+1,(y+0)*m+x+1);return _({position:n,normal:l,texcoord:u,indices:g},i)}function w(e,t,r,a,i,o,n){if(t<=0||r<=0)throw new Error("subdivisionAxis and subdivisionHeight must be > 0");a=a||0,o=o||0;for(var s=(i=i||Math.PI)-a,l=(n=n||2*Math.PI)-o,u=(t+1)*(r+1),d=p(3,u),c=p(3,u),h=p(2,u),f=0;f<=r;f++)for(var m=0;m<=t;m++){var g=m/t,y=f/r,x=l*g+o,v=s*y+a,b=Math.sin(x),_=Math.cos(x),F=Math.sin(v),C=_*F,w=Math.cos(v),M=b*F;d.push(e*C,e*w,e*M),c.push(C,w,M),h.push(1-g,y)}for(var S=t+1,D=p(3,t*r*2,Uint16Array),A=0;A<t;A++)for(var T=0;T<r;T++)D.push((T+0)*S+A,(T+0)*S+A+1,(T+1)*S+A),D.push((T+1)*S+A,(T+0)*S+A+1,(T+1)*S+A+1);return{position:d,normal:c,texcoord:h,indices:D}}var M=[[3,7,5,1],[6,2,0,4],[6,7,3,2],[0,1,5,4],[7,6,4,5],[2,3,1,0]];function S(e){for(var t=(e=e||1)/2,r=[[-t,-t,-t],[+t,-t,-t],[-t,+t,-t],[+t,+t,-t],[-t,-t,+t],[+t,-t,+t],[-t,+t,+t],[+t,+t,+t]],a=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],i=[[1,0],[0,0],[0,1],[1,1]],o=p(3,24),n=p(3,24),s=p(2,24),l=p(3,12,Uint16Array),u=0;u<6;++u){for(var d=M[u],c=0;c<4;++c){var h=r[d[c]],f=a[u],m=i[c];o.push(h),n.push(f),s.push(m)}var g=4*u;l.push(g+0,g+1,g+2),l.push(g+0,g+2,g+3)}return{position:o,normal:n,texcoord:s,indices:l}}function D(e,t,r,a,i,o,n){if(a<3)throw new Error("radialSubdivisions must be 3 or greater");if(i<1)throw new Error("verticalSubdivisions must be 1 or greater");for(var s=void 0===o||o,l=void 0===n||n,u=(s?2:0)+(l?2:0),d=(a+1)*(i+1+u),c=p(3,d),h=p(3,d),f=p(2,d),m=p(3,a*(i+u/2)*2,Uint16Array),g=a+1,y=Math.atan2(e-t,r),x=Math.cos(y),v=Math.sin(y),b=i+(l?2:0),_=s?-2:0;_<=b;++_){var F=_/i,C=r*F,w=void 0;_<0?(C=0,F=1,w=e):_>i?(C=r,F=1,w=t):w=e+_/i*(t-e),-2!==_&&_!==i+2||(w=0,F=0),C-=r/2;for(var M=0;M<g;++M){var S=Math.sin(M*Math.PI*2/a),D=Math.cos(M*Math.PI*2/a);c.push(S*w,C,D*w),_<0?h.push(0,-1,0):_>i?h.push(0,1,0):0===w?h.push(0,0,0):h.push(S*x,v,D*x),f.push(M/a,1-F)}}for(var A=0;A<i+u;++A)if(!(1===A&&s||A===i+u-2&&l))for(var T=0;T<a;++T)m.push(g*(A+0)+0+T,g*(A+0)+1+T,g*(A+1)+1+T),m.push(g*(A+0)+0+T,g*(A+1)+1+T,g*(A+1)+0+T);return{position:c,normal:h,texcoord:f,indices:m}}function A(e,t){t=t||[];for(var r=[],a=0;a<e.length;a+=4){var i=e[a],o=e.slice(a+1,a+4);o.push.apply(o,t);for(var n=0;n<i;++n)r.push.apply(r,o)}return r}function T(){var e=[0,0,0,0,150,0,30,0,0,0,150,0,30,150,0,30,0,0,30,0,0,30,30,0,100,0,0,30,30,0,100,30,0,100,0,0,30,60,0,30,90,0,67,60,0,30,90,0,67,90,0,67,60,0,0,0,30,30,0,30,0,150,30,0,150,30,30,0,30,30,150,30,30,0,30,100,0,30,30,30,30,30,30,30,100,0,30,100,30,30,30,60,30,67,60,30,30,90,30,30,90,30,67,60,30,67,90,30,0,0,0,100,0,0,100,0,30,0,0,0,100,0,30,0,0,30,100,0,0,100,30,0,100,30,30,100,0,0,100,30,30,100,0,30,30,30,0,30,30,30,100,30,30,30,30,0,100,30,30,100,30,0,30,30,0,30,60,30,30,30,30,30,30,0,30,60,0,30,60,30,30,60,0,67,60,30,30,60,30,30,60,0,67,60,0,67,60,30,67,60,0,67,90,30,67,60,30,67,60,0,67,90,0,67,90,30,30,90,0,30,90,30,67,90,30,30,90,0,67,90,30,67,90,0,30,90,0,30,150,30,30,90,30,30,90,0,30,150,0,30,150,30,0,150,0,0,150,30,30,150,30,0,150,0,30,150,30,30,150,0,0,0,0,0,0,30,0,150,30,0,0,0,0,150,30,0,150,0],t=A([18,0,0,1,18,0,0,-1,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,-1,0,6,-1,0,0]),r=A([18,200,70,120,18,80,70,200,6,70,200,210,6,200,200,70,6,210,100,70,6,210,160,70,6,70,180,210,6,100,70,210,6,76,210,100,6,140,210,80,6,90,130,110,6,160,160,220],[255]),a=e.length/3,i={position:p(3,a),texcoord:p(2,a),normal:p(3,a),color:p(4,a,Uint8Array),indices:p(3,a/3,Uint16Array)};i.position.push(e),i.texcoord.push([.22,.19,.22,.79,.34,.19,.22,.79,.34,.79,.34,.19,.34,.19,.34,.31,.62,.19,.34,.31,.62,.31,.62,.19,.34,.43,.34,.55,.49,.43,.34,.55,.49,.55,.49,.43,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,1,1,1,0,0,1,1,1,0]),i.normal.push(t),i.color.push(r);for(var o=0;o<a;++o)i.indices.push(o);return i}function E(e,t,r,a,i,o,n){if(i<=0)throw new Error("subdivisionDown must be > 0");var s=(n=n||1)-(o=o||0),u=2*(i+1)*4,d=p(3,u),c=p(3,u),h=p(2,u);function f(e,t,r){return e+(t-e)*r}function m(t,r,n,u,p,m){for(var g=0;g<=i;g++){var y=r/1,x=g/i,v=2*(y-.5),b=(o+x*s)*Math.PI,_=Math.sin(b),F=Math.cos(b),C=f(e,t,_),w=v*a,M=F*e,S=_*C;d.push(w,M,S);var D=l.add(l.multiply([0,_,F],n),u);c.push(D),h.push(y*p+m,x)}}for(var g=0;g<2;g++){var y=2*(g/1-.5);m(t,g,[1,1,1],[0,0,0],1,0),m(t,g,[0,0,0],[y,0,0],0,0),m(r,g,[1,1,1],[0,0,0],1,0),m(r,g,[0,0,0],[y,0,0],0,1)}var x=p(3,2*i*4,Uint16Array);function v(e,t){for(var r=0;r<i;++r)x.push(e+r+0,e+r+1,t+r+0),x.push(e+r+1,t+r+1,t+r+0)}var b=i+1;return v(0*b,4*b),v(5*b,7*b),v(6*b,2*b),v(3*b,1*b),{position:d,normal:c,texcoord:h,indices:x}}function B(e,t,r,a,i,o){return D(e,e,t,r,a,i,o)}function k(e,t,r,a,i,o){if(r<3)throw new Error("radialSubdivisions must be 3 or greater");if(a<3)throw new Error("verticalSubdivisions must be 3 or greater");i=i||0;for(var n=(o=o||2*Math.PI)-i,s=r+1,l=a+1,u=s*l,d=p(3,u),c=p(3,u),h=p(2,u),f=p(3,r*a*2,Uint16Array),m=0;m<l;++m)for(var g=m/a,y=g*Math.PI*2,x=Math.sin(y),v=e+x*t,b=Math.cos(y),_=b*t,F=0;F<s;++F){var C=F/r,w=i+C*n,M=Math.sin(w),S=Math.cos(w),D=M*v,A=S*v,T=M*x,E=S*x;d.push(D,_,A),c.push(T,b,E),h.push(C,1-g)}for(var B=0;B<a;++B)for(var k=0;k<r;++k){var L=1+k,P=1+B;f.push(s*B+k,s*P+k,s*B+L),f.push(s*P+k,s*P+L,s*B+L)}return{position:d,normal:c,texcoord:h,indices:f}}function L(e,t,r,a,i){if(t<3)throw new Error("divisions must be at least 3");i=i||1,a=a||0;for(var o=(t+1)*((r=r||1)+1),n=p(3,o),s=p(3,o),l=p(2,o),u=p(3,r*t*2,Uint16Array),d=0,c=e-a,h=t+1,f=0;f<=r;++f){for(var m=a+c*Math.pow(f/r,i),g=0;g<=t;++g){var y=2*Math.PI*g/t,x=m*Math.cos(y),v=m*Math.sin(y);if(n.push(x,0,v),s.push(0,1,0),l.push(1-g/t,f/r),f>0&&g!==t){var b=d+(g+1),_=d+g,F=d+g-h,C=d+(g+1)-h;u.push(b,_,F),u.push(b,F,C)}}d+=t+1}return{position:n,normal:s,texcoord:l,indices:u}}function P(e){return function(t){var r=e.apply(this,Array.prototype.slice.call(arguments,1));return i.createBuffersFromArrays(t,r)}}function I(e){return function(t){var r=e.apply(null,Array.prototype.slice.call(arguments,1));return i.createBufferInfoFromArrays(t,r)}}var O=["numComponents","size","type","normalize","stride","offset","attrib","name","attribName"];function R(e,t,r,a){a=a||0;for(var i=e.length,o=0;o<i;++o)t[r+o]=e[o]+a}function U(e,t){var r=c(e),a=new r.constructor(t),i=a;return r.numComponents&&r.numElements&&f(a,r.numComponents),e.data&&(i={data:a},o.copyNamedProperties(O,e,i)),i}t.create3DFBufferInfo=I(T),t.create3DFBuffers=P(T),t.createCubeBufferInfo=I(S),t.createCubeBuffers=P(S),t.createPlaneBufferInfo=I(C),t.createPlaneBuffers=P(C),t.createSphereBufferInfo=I(w),t.createSphereBuffers=P(w),t.createTruncatedConeBufferInfo=I(D),t.createTruncatedConeBuffers=P(D),t.createXYQuadBufferInfo=I(F),t.createXYQuadBuffers=P(F);var W=t.createCrescentBufferInfo=I(E),V=t.createCrescentBuffers=P(E);t.createCylinderBufferInfo=I(B),t.createCylinderBuffers=P(B),t.createTorusBufferInfo=I(k),t.createTorusBuffers=P(k),t.createDiscBufferInfo=I(L),t.createDiscBuffers=P(L),t.createCresentBufferInfo=W,t.createCresentBuffers=V,t.createCresentVertices=E},"./src/programs.js":(e,t,r)=>{function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}t.__esModule=!0,t.bindTransformFeedbackInfo=De,t.bindUniformBlock=ke,t.createAttributeSetters=Ie,t.createProgram=pe,t.createProgramAsync=void 0,t.createProgramFromScripts=function(e,t,r,a,i){var o,n=de(r,a,i),s=[],l=p(t);try{for(l.s();!(o=l.n()).done;){var u=o.value,d=v(u);if(!d)return le(n,"unknown script element: ".concat(u));s.push(d.text)}}catch(e){l.e(e)}finally{l.f()}return pe(e,s,n)},t.createProgramFromSources=be,t.createProgramInfo=We,t.createProgramInfoAsync=void 0,t.createProgramInfoFromProgram=Re,t.createProgramInfos=je,t.createProgramInfosAsync=void 0,t.createPrograms=ze,t.createProgramsAsync=void 0,t.createTransformFeedback=function(e,t,r){var a=e.createTransformFeedback();return e.bindTransformFeedback(S,a),e.useProgram(t.program),De(e,t,r),e.bindTransformFeedback(S,null),a},t.createTransformFeedbackInfo=Se,t.createUniformBlockInfo=function(e,t,r){return Be(e,t.program,t.uniformBlockSpec,r)},t.createUniformBlockInfoFromProgram=Be,t.createUniformBlockSpecFromProgram=Ae,t.createUniformSetters=Me,t.setAttributes=Oe,t.setBlockUniforms=function(e,t){var r=e.setters;for(var a in t){var i=r[a];i&&i(t[a])}},t.setBuffersAndAttributes=function(e,t,r){r.vertexArrayObject?e.bindVertexArray(r.vertexArrayObject):(Oe(t.attribSetters||t,r.attribs),r.indices&&e.bindBuffer(C,r.indices))},t.setUniformBlock=function(e,t,r){ke(e,t,r)&&e.bufferData(w,r.array,_)},t.setUniforms=Pe,t.setUniformsAndBindTextures=void 0;var i=s(r("./src/utils.js")),o=s(r("./src/helper.js"));function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}function s(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var r=n(t);if(r&&r.has(e))return r.get(e);var i={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var l=o?Object.getOwnPropertyDescriptor(e,s):null;l&&(l.get||l.set)?Object.defineProperty(i,s,l):i[s]=e[s]}return i.default=e,r&&r.set(e,i),i}function l(){l=function(){return t};var e,t={},r=Object.prototype,i=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},n="function"==typeof Symbol?Symbol:{},s=n.iterator||"@@iterator",u=n.asyncIterator||"@@asyncIterator",d=n.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function h(e,t,r,a){var i=t&&t.prototype instanceof v?t:v,n=Object.create(i.prototype),s=new k(a||[]);return o(n,"_invoke",{value:A(e,r,s)}),n}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var p="suspendedStart",m="suspendedYield",g="executing",y="completed",x={};function v(){}function b(){}function _(){}var F={};c(F,s,(function(){return this}));var C=Object.getPrototypeOf,w=C&&C(C(L([])));w&&w!==r&&i.call(w,s)&&(F=w);var M=_.prototype=v.prototype=Object.create(F);function S(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function D(e,t){function r(o,n,s,l){var u=f(e[o],e,n);if("throw"!==u.type){var d=u.arg,c=d.value;return c&&"object"==a(c)&&i.call(c,"__await")?t.resolve(c.__await).then((function(e){r("next",e,s,l)}),(function(e){r("throw",e,s,l)})):t.resolve(c).then((function(e){d.value=e,s(d)}),(function(e){return r("throw",e,s,l)}))}l(u.arg)}var n;o(this,"_invoke",{value:function(e,a){function i(){return new t((function(t,i){r(e,a,t,i)}))}return n=n?n.then(i,i):i()}})}function A(t,r,a){var i=p;return function(o,n){if(i===g)throw new Error("Generator is already running");if(i===y){if("throw"===o)throw n;return{value:e,done:!0}}for(a.method=o,a.arg=n;;){var s=a.delegate;if(s){var l=T(s,a);if(l){if(l===x)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(i===p)throw i=y,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);i=g;var u=f(t,r,a);if("normal"===u.type){if(i=a.done?y:m,u.arg===x)continue;return{value:u.arg,done:a.done}}"throw"===u.type&&(i=y,a.method="throw",a.arg=u.arg)}}}function T(t,r){var a=r.method,i=t.iterator[a];if(i===e)return r.delegate=null,"throw"===a&&t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method)||"return"!==a&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+a+"' method")),x;var o=f(i,t.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,x;var n=o.arg;return n?n.done?(r[t.resultName]=n.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,x):n:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,x)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function B(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function L(t){if(t||""===t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,n=function r(){for(;++o<t.length;)if(i.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return n.next=n}}throw new TypeError(a(t)+" is not iterable")}return b.prototype=_,o(M,"constructor",{value:_,configurable:!0}),o(_,"constructor",{value:b,configurable:!0}),b.displayName=c(_,d,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,c(e,d,"GeneratorFunction")),e.prototype=Object.create(M),e},t.awrap=function(e){return{__await:e}},S(D.prototype),c(D.prototype,u,(function(){return this})),t.AsyncIterator=D,t.async=function(e,r,a,i,o){void 0===o&&(o=Promise);var n=new D(h(e,r,a,i),o);return t.isGeneratorFunction(r)?n:n.next().then((function(e){return e.done?e.value:n.next()}))},S(M),c(M,d,"Generator"),c(M,s,(function(){return this})),c(M,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var a in t)r.push(a);return r.reverse(),function e(){for(;r.length;){var a=r.pop();if(a in t)return e.value=a,e.done=!1,e}return e.done=!0,e}},t.values=L,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(B),!t)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function a(a,i){return s.type="throw",s.arg=t,r.next=a,i&&(r.method="next",r.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var n=this.tryEntries[o],s=n.completion;if("root"===n.tryLoc)return a("end");if(n.tryLoc<=this.prev){var l=i.call(n,"catchLoc"),u=i.call(n,"finallyLoc");if(l&&u){if(this.prev<n.catchLoc)return a(n.catchLoc,!0);if(this.prev<n.finallyLoc)return a(n.finallyLoc)}else if(l){if(this.prev<n.catchLoc)return a(n.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return a(n.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&i.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var n=o?o.completion:{};return n.type=e,n.arg=t,o?(this.method="next",this.next=o.finallyLoc,x):this.complete(n)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),x},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),B(r),x}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var a=r.completion;if("throw"===a.type){var i=a.arg;B(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,a){return this.delegate={iterator:L(t),resultName:r,nextLoc:a},"next"===this.method&&(this.arg=e),x}},t}function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){var i,o,n,s;i=e,o=t,n=r[t],s=function(e){if("object"!=a(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o),(o="symbol"==a(s)?s:String(s))in i?Object.defineProperty(i,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):i[o]=n})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function c(e,t,r,a,i,o,n){try{var s=e[o](n),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(a,i)}function h(e){return function(){var t=this,r=arguments;return new Promise((function(a,i){var o=e.apply(t,r);function n(e){c(o,a,i,n,s,"next",e)}function s(e){c(o,a,i,n,s,"throw",e)}n(void 0)}))}}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,i,o,n,s=[],l=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=o.call(r)).done)&&(s.push(a.value),s.length!==t);l=!0);}catch(e){u=!0,i=e}finally{try{if(!l&&null!=r.return&&(n=r.return(),Object(n)!==n))return}finally{if(u)throw i}}return s}}(e,t)||m(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=m(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,i=function(){};return{s:i,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,n=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return n=e.done,e},e:function(e){s=!0,o=e},f:function(){try{n||null==r.return||r.return()}finally{if(s)throw o}}}}function m(e,t){if(e){if("string"==typeof e)return g(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g(e,t):void 0}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}var y=o.error,x=o.warn;function v(e){return"undefined"!=typeof document&&document.getElementById?document.getElementById(e):null}var b=33984,_=35048,F=34962,C=34963,w=35345,M=35982,S=36386,D=35713,A=35714,T=35632,E=35633,B=35981,k=35718,L=35721,P=35971,I=35382,O=35396,R=35398,U=35392,W=35395,V=5124,z=3553,j=34067,G=32879,H=35866,N={};function q(e,t){return N[t].bindPoint}function K(e,t){return function(r){e.uniform1i(t,r)}}function Z(e,t){return function(r){e.uniform1iv(t,r)}}function X(e,t){return function(r){e.uniform2iv(t,r)}}function Y(e,t){return function(r){e.uniform3iv(t,r)}}function $(e,t){return function(r){e.uniform4iv(t,r)}}function Q(e,t,r,a){var n=q(0,t);return i.isWebGL2(e)?function(t){var i,s;!t||o.isTexture(e,t)?(i=t,s=null):(i=t.texture,s=t.sampler),e.uniform1i(a,r),e.activeTexture(b+r),e.bindTexture(n,i),e.bindSampler(r,s)}:function(t){e.uniform1i(a,r),e.activeTexture(b+r),e.bindTexture(n,t)}}function J(e,t,r,a,n){for(var s=q(0,t),l=new Int32Array(n),u=0;u<n;++u)l[u]=r+u;return i.isWebGL2(e)?function(t){e.uniform1iv(a,l),t.forEach((function(t,a){var i,n;e.activeTexture(b+l[a]),!t||o.isTexture(e,t)?(i=t,n=null):(i=t.texture,n=t.sampler),e.bindSampler(r,n),e.bindTexture(s,i)}))}:function(t){e.uniform1iv(a,l),t.forEach((function(t,r){e.activeTexture(b+l[r]),e.bindTexture(s,t)}))}}function ee(e,t){return function(r){if(r.value)switch(e.disableVertexAttribArray(t),r.value.length){case 4:e.vertexAttrib4fv(t,r.value);break;case 3:e.vertexAttrib3fv(t,r.value);break;case 2:e.vertexAttrib2fv(t,r.value);break;case 1:e.vertexAttrib1fv(t,r.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else e.bindBuffer(F,r.buffer),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,r.numComponents||r.size,r.type||5126,r.normalize||!1,r.stride||0,r.offset||0),e.vertexAttribDivisor&&e.vertexAttribDivisor(t,r.divisor||0)}}function te(e,t){return function(r){if(r.value){if(e.disableVertexAttribArray(t),4!==r.value.length)throw new Error("The length of an integer constant value must be 4!");e.vertexAttrib4iv(t,r.value)}else e.bindBuffer(F,r.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,r.numComponents||r.size,r.type||V,r.stride||0,r.offset||0),e.vertexAttribDivisor&&e.vertexAttribDivisor(t,r.divisor||0)}}function re(e,t){return function(r){if(r.value){if(e.disableVertexAttribArray(t),4!==r.value.length)throw new Error("The length of an unsigned integer constant value must be 4!");e.vertexAttrib4uiv(t,r.value)}else e.bindBuffer(F,r.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,r.numComponents||r.size,r.type||5125,r.stride||0,r.offset||0),e.vertexAttribDivisor&&e.vertexAttribDivisor(t,r.divisor||0)}}function ae(e,t,r){var a=r.size,i=r.count;return function(r){e.bindBuffer(F,r.buffer);for(var o=r.size||r.numComponents||a,n=o/i,s=r.type||5126,l=N[s].size*o,u=r.normalize||!1,d=r.offset||0,c=l/i,h=0;h<i;++h)e.enableVertexAttribArray(t+h),e.vertexAttribPointer(t+h,n,s,u,l,d+c*h),e.vertexAttribDivisor&&e.vertexAttribDivisor(t+h,r.divisor||0)}}N[5126]={Type:Float32Array,size:4,setter:function(e,t){return function(r){e.uniform1f(t,r)}},arraySetter:function(e,t){return function(r){e.uniform1fv(t,r)}}},N[35664]={Type:Float32Array,size:8,setter:function(e,t){return function(r){e.uniform2fv(t,r)}},cols:2},N[35665]={Type:Float32Array,size:12,setter:function(e,t){return function(r){e.uniform3fv(t,r)}},cols:3},N[35666]={Type:Float32Array,size:16,setter:function(e,t){return function(r){e.uniform4fv(t,r)}},cols:4},N[V]={Type:Int32Array,size:4,setter:K,arraySetter:Z},N[35667]={Type:Int32Array,size:8,setter:X,cols:2},N[35668]={Type:Int32Array,size:12,setter:Y,cols:3},N[35669]={Type:Int32Array,size:16,setter:$,cols:4},N[5125]={Type:Uint32Array,size:4,setter:function(e,t){return function(r){e.uniform1ui(t,r)}},arraySetter:function(e,t){return function(r){e.uniform1uiv(t,r)}}},N[36294]={Type:Uint32Array,size:8,setter:function(e,t){return function(r){e.uniform2uiv(t,r)}},cols:2},N[36295]={Type:Uint32Array,size:12,setter:function(e,t){return function(r){e.uniform3uiv(t,r)}},cols:3},N[36296]={Type:Uint32Array,size:16,setter:function(e,t){return function(r){e.uniform4uiv(t,r)}},cols:4},N[35670]={Type:Uint32Array,size:4,setter:K,arraySetter:Z},N[35671]={Type:Uint32Array,size:8,setter:X,cols:2},N[35672]={Type:Uint32Array,size:12,setter:Y,cols:3},N[35673]={Type:Uint32Array,size:16,setter:$,cols:4},N[35674]={Type:Float32Array,size:32,setter:function(e,t){return function(r){e.uniformMatrix2fv(t,!1,r)}},rows:2,cols:2},N[35675]={Type:Float32Array,size:48,setter:function(e,t){return function(r){e.uniformMatrix3fv(t,!1,r)}},rows:3,cols:3},N[35676]={Type:Float32Array,size:64,setter:function(e,t){return function(r){e.uniformMatrix4fv(t,!1,r)}},rows:4,cols:4},N[35685]={Type:Float32Array,size:32,setter:function(e,t){return function(r){e.uniformMatrix2x3fv(t,!1,r)}},rows:2,cols:3},N[35686]={Type:Float32Array,size:32,setter:function(e,t){return function(r){e.uniformMatrix2x4fv(t,!1,r)}},rows:2,cols:4},N[35687]={Type:Float32Array,size:48,setter:function(e,t){return function(r){e.uniformMatrix3x2fv(t,!1,r)}},rows:3,cols:2},N[35688]={Type:Float32Array,size:48,setter:function(e,t){return function(r){e.uniformMatrix3x4fv(t,!1,r)}},rows:3,cols:4},N[35689]={Type:Float32Array,size:64,setter:function(e,t){return function(r){e.uniformMatrix4x2fv(t,!1,r)}},rows:4,cols:2},N[35690]={Type:Float32Array,size:64,setter:function(e,t){return function(r){e.uniformMatrix4x3fv(t,!1,r)}},rows:4,cols:3},N[35678]={Type:null,size:0,setter:Q,arraySetter:J,bindPoint:z},N[35680]={Type:null,size:0,setter:Q,arraySetter:J,bindPoint:j},N[35679]={Type:null,size:0,setter:Q,arraySetter:J,bindPoint:G},N[35682]={Type:null,size:0,setter:Q,arraySetter:J,bindPoint:z},N[36289]={Type:null,size:0,setter:Q,arraySetter:J,bindPoint:H},N[36292]={Type:null,size:0,setter:Q,arraySetter:J,bindPoint:H},N[36293]={Type:null,size:0,setter:Q,arraySetter:J,bindPoint:j},N[36298]={Type:null,size:0,setter:Q,arraySetter:J,bindPoint:z},N[36299]={Type:null,size:0,setter:Q,arraySetter:J,bindPoint:G},N[36300]={Type:null,size:0,setter:Q,arraySetter:J,bindPoint:j},N[36303]={Type:null,size:0,setter:Q,arraySetter:J,bindPoint:H},N[36306]={Type:null,size:0,setter:Q,arraySetter:J,bindPoint:z},N[36307]={Type:null,size:0,setter:Q,arraySetter:J,bindPoint:G},N[36308]={Type:null,size:0,setter:Q,arraySetter:J,bindPoint:j},N[36311]={Type:null,size:0,setter:Q,arraySetter:J,bindPoint:H};var ie={};ie[5126]={size:4,setter:ee},ie[35664]={size:8,setter:ee},ie[35665]={size:12,setter:ee},ie[35666]={size:16,setter:ee},ie[V]={size:4,setter:te},ie[35667]={size:8,setter:te},ie[35668]={size:12,setter:te},ie[35669]={size:16,setter:te},ie[5125]={size:4,setter:re},ie[36294]={size:8,setter:re},ie[36295]={size:12,setter:re},ie[36296]={size:16,setter:re},ie[35670]={size:4,setter:te},ie[35671]={size:8,setter:te},ie[35672]={size:12,setter:te},ie[35673]={size:16,setter:te},ie[35674]={size:4,setter:ae,count:2},ie[35675]={size:9,setter:ae,count:3},ie[35676]={size:16,setter:ae,count:4};var oe=/ERROR:\s*\d+:(\d+)/gi,ne=/^[ \t]*\n/;function se(e){var t=0;return ne.test(e)&&(t=1,e=e.replace(ne,"")),{lineOffset:t,shaderSource:e}}function le(e,t){return e.errorCallback(t),e.callback&&setTimeout((function(){e.callback("".concat(t,"\n").concat(e.errors.join("\n")))})),null}function ue(e,t,r,a){if(a=a||y,!e.getShaderParameter(r,D)){var o=e.getShaderInfoLog(r),n=se(e.getShaderSource(r)),s=n.lineOffset,l=n.shaderSource,u="".concat(function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=function(e){if(Array.isArray(e))return g(e)}(t=r.matchAll(oe))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||m(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),o=new Map(i.map((function(e,t){var a=parseInt(e[1]),o=i[t+1],n=o?o.index:r.length;return[a-1,r.substring(e.index,n)]})));return e.split("\n").map((function(e,t){var r=o.get(t);return"".concat(t+1+a,": ").concat(e).concat(r?"\n\n^^^ ".concat(r):"")})).join("\n")}(l,o,s),"\nError compiling ").concat(i.glEnumToString(e,t),": ").concat(o);return a(u),u}return""}function de(e,t,r){var a,i,o;if("function"==typeof t&&(r=t,t=void 0),"function"==typeof e)r=e,e=void 0;else if(e&&!Array.isArray(e)){var n=e;r=n.errorCallback,e=n.attribLocations,a=n.transformFeedbackVaryings,i=n.transformFeedbackMode,o=n.callback}var s=r||y,l=[],u={errorCallback:function(e){l.push(e);for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];s.apply(void 0,[e].concat(r))},transformFeedbackVaryings:a,transformFeedbackMode:i,callback:o,errors:l},d={};return Array.isArray(e)?e.forEach((function(e,r){d[e]=t?t[r]:r})):d=e||{},u.attribLocations=d,u}var ce=["VERTEX_SHADER","FRAGMENT_SHADER"],he=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(t){return setTimeout(t,e)}))};function fe(e,t,r){for(var a,i=e.createProgram(),o=de(r),n=o.attribLocations,s=o.transformFeedbackVaryings,l=o.transformFeedbackMode,u=0;u<t.length;++u){var d=t[u];if("string"==typeof d){var c=v(d),h=c?c.text:d,p=e[ce[u]];c&&c.type&&(p=((a=c.type).indexOf("frag")>=0?T:a.indexOf("vert")>=0?E:void 0)||p),d=e.createShader(p),e.shaderSource(d,se(h).shaderSource),e.compileShader(d),e.attachShader(i,d)}}Object.entries(n).forEach((function(t){var r=f(t,2),a=r[0],o=r[1];return e.bindAttribLocation(i,o,a)}));var m=s;return m&&(m.attribs&&(m=m.attribs),Array.isArray(m)||(m=Object.keys(m)),e.transformFeedbackVaryings(i,m,l||B)),e.linkProgram(i),i}function pe(e,t,r,a,i){var o=de(r,a,i),n=new Set(t),s=fe(e,t,o);function l(e,t){var r=ve(e,t,o.errorCallback);return r&&function(e,t,r){var a,i=p(e.getAttachedShaders(t));try{for(i.s();!(a=i.n()).done;){var o=a.value;r.has(o)&&e.deleteShader(o)}}catch(e){i.e(e)}finally{i.f()}e.deleteProgram(t)}(e,t,n),r}if(!o.callback)return l(e,s)?void 0:s;ge(e,s).then((function(){var t=l(e,s);o.callback(t,t?void 0:s)}))}function me(e){return function(t,r){for(var a=arguments.length,i=new Array(a>2?a-2:0),o=2;o<a;o++)i[o-2]=arguments[o];return new Promise((function(a,o){var n=de.apply(void 0,i);n.callback=function(e,t){e?o(e):a(t)},e(t,r,n)}))}}function ge(e,t){return ye.apply(this,arguments)}function ye(){return(ye=h(l().mark((function e(t,r){var a,i,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=t.getExtension("KHR_parallel_shader_compile"),i=a?function(e,t){return e.getProgramParameter(t,a.COMPLETION_STATUS_KHR)}:function(){return!0},o=0;case 3:return e.next=5,he(o);case 5:o=1e3/60;case 6:if(!i(t,r)){e.next=3;break}case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xe(){return(xe=h(l().mark((function e(t,r){var a,i,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=0,i=Object.values(r);case 1:if(!(a<i.length)){e.next=8;break}return o=i[a],e.next=5,ge(t,o);case 5:a++,e.next=1;break;case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ve(e,t,r){if(r=r||y,!e.getProgramParameter(t,A)){var a=e.getProgramInfoLog(t);r("Error in program linking: ".concat(a));var i=e.getAttachedShaders(t).map((function(t){return ue(e,e.getShaderParameter(t,e.SHADER_TYPE),t,r)}));return"".concat(a,"\n").concat(i.filter((function(e){return e})).join("\n"))}}function be(e,t,r,a,i){return pe(e,t,r,a,i)}function _e(e){var t=e.name;return t.startsWith("gl_")||t.startsWith("webgl_")}t.createProgramAsync=me(pe),t.createProgramInfoAsync=me(We);var Fe=/(\.|\[|]|\w+)/g,Ce=function(e){return e>="0"&&e<="9"};function we(e,t,r,a){for(var i=e.split(Fe).filter((function(e){return""!==e})),o=0,n="";;){var s=i[o++];n+=s;var l=Ce(s[0]),u=l?parseInt(s):s;if(l&&(n+=i[o++]),o===i.length){r[u]=t;break}var d=i[o++],c="["===d,h=r[u]||(c?[]:{});r[u]=h,r=h,a[n]=a[n]||function(e){return function(t){Le(e,t)}}(h),n+=d}}function Me(e,t){var r=0;function a(t,a,i){var o,n=a.name.endsWith("[0]"),s=a.type,l=N[s];if(!l)throw new Error("unknown type: 0x".concat(s.toString(16)));if(l.bindPoint){var u=r;r+=a.size,o=n?l.arraySetter(e,s,u,i,a.size):l.setter(e,s,u,i,a.size)}else o=l.arraySetter&&n?l.arraySetter(e,i):l.setter(e,i);return o.location=i,o}for(var i={},o={},n=e.getProgramParameter(t,k),s=0;s<n;++s){var l=e.getActiveUniform(t,s);if(!_e(l)){var u=l.name;u.endsWith("[0]")&&(u=u.substr(0,u.length-3));var d=e.getUniformLocation(t,l.name);if(d){var c=a(0,l,d);i[u]=c,we(u,c,o,i)}}}return i}function Se(e,t){for(var r={},a=e.getProgramParameter(t,P),i=0;i<a;++i){var o=e.getTransformFeedbackVarying(t,i);r[o.name]={index:i,type:o.type,size:o.size}}return r}function De(e,t,r){for(var a in t.transformFeedbackInfo&&(t=t.transformFeedbackInfo),r.attribs&&(r=r.attribs),r){var i=t[a];if(i){var o=r[a];o.offset?e.bindBufferRange(M,i.index,o.buffer,o.offset,o.size):e.bindBufferBase(M,i.index,o.buffer)}}}function Ae(e,t){for(var r=e.getProgramParameter(t,k),a=[],i=[],o=0;o<r;++o){i.push(o),a.push({});var n=e.getActiveUniform(t,o);a[o].name=n.name}[["UNIFORM_TYPE","type"],["UNIFORM_SIZE","size"],["UNIFORM_BLOCK_INDEX","blockNdx"],["UNIFORM_OFFSET","offset"]].forEach((function(r){var o=r[0],n=r[1];e.getActiveUniforms(t,i,e[o]).forEach((function(e,t){a[t][n]=e}))}));for(var s={},l=e.getProgramParameter(t,I),u=0;u<l;++u){var d=e.getActiveUniformBlockName(t,u),c={index:e.getUniformBlockIndex(t,d),usedByVertexShader:e.getActiveUniformBlockParameter(t,u,O),usedByFragmentShader:e.getActiveUniformBlockParameter(t,u,R),size:e.getActiveUniformBlockParameter(t,u,U),uniformIndices:e.getActiveUniformBlockParameter(t,u,W)};c.used=c.usedByVertexShader||c.usedByFragmentShader,s[d]=c}return{blockSpecs:s,uniformData:a}}var Te=/\[\d+\]\.$/,Ee=function(e,t){return((e+(t-1))/t|0)*t};function Be(e,t,r,a){var i=r.blockSpecs,o=r.uniformData,n=i[a];if(!n)return x("no uniform block object named:",a),{name:a,uniforms:{}};var s=new ArrayBuffer(n.size),l=e.createBuffer(),u=n.index;e.bindBuffer(w,l),e.uniformBlockBinding(t,n.index,u);var d=a+".";Te.test(d)&&(d=d.replace(Te,"."));var c={},h={},f={};return n.uniformIndices.forEach((function(e){var t=o[e],r=t.name;r.startsWith(d)&&(r=r.substr(d.length));var a=r.endsWith("[0]");a&&(r=r.substr(0,r.length-3));var i=N[t.type],n=i.Type,l=a?Ee(i.size,16)*t.size:i.size*t.size,u=new n(s,t.offset,l/n.BYTES_PER_ELEMENT);c[r]=u;var p=function(e,t,r,a){if(t||r){a=a||1;var i=e.length/4;return function(t){for(var r=0,o=0,n=0;n<i;++n){for(var s=0;s<a;++s)e[r++]=t[o++];r+=4-a}}}return function(t){t.length?e.set(t):e[0]=t}}(u,a,i.rows,i.cols);h[r]=p,we(r,p,f,h)})),{name:a,array:s,asFloat:new Float32Array(s),buffer:l,uniforms:c,setters:h}}function ke(e,t,r){var a=(t.uniformBlockSpec||t).blockSpecs[r.name];if(a){var i=a.index;return e.bindBufferRange(w,i,r.buffer,r.offset||0,r.array.byteLength),!0}return!1}function Le(e,t){for(var r in t){var a=e[r];"function"==typeof a?a(t[r]):Le(e[r],t[r])}}function Pe(e){for(var t=e.uniformSetters||e,r=arguments.length<=1?0:arguments.length-1,a=0;a<r;++a){var i=a+1<1||arguments.length<=a+1?void 0:arguments[a+1];if(Array.isArray(i))for(var o=i.length,n=0;n<o;++n)Pe(t,i[n]);else for(var s in i){var l=t[s];l&&l(i[s])}}}function Ie(e,t){for(var r={},a=e.getProgramParameter(t,L),i=0;i<a;++i){var o=e.getActiveAttrib(t,i);if(!_e(o)){var n=e.getAttribLocation(t,o.name),s=ie[o.type],l=s.setter(e,n,s);l.location=n,r[o.name]=l}}return r}function Oe(e,t){for(var r in t){var a=e[r];a&&a(t[r])}}function Re(e,t){var r={program:t,uniformSetters:Me(e,t),attribSetters:Ie(e,t)};return i.isWebGL2(e)&&(r.uniformBlockSpec=Ae(e,t),r.transformFeedbackInfo=Se(e,t)),r}t.setUniformsAndBindTextures=Pe;var Ue=/\s|{|}|;/;function We(e,t,r,a,i){var o=de(r,a,i),n=[];if(t=t.map((function(e){if(!Ue.test(e)){var t=v(e);if(t)e=t.text;else{var r="no element with id: ".concat(e);o.errorCallback(r),n.push(r)}}return e})),n.length)return le(o,"");var s=o.callback;s&&(o.callback=function(t,r){s(t,t?void 0:Re(e,r))});var l=be(e,t,o);return l?Re(e,l):null}function Ve(e,t,r,a,i){for(var o=0,n=Object.entries(t);o<n.length;o++){var s=f(n[o],2),l=s[0],u=s[1],c=d({},i),h=r[l];Array.isArray(h)||Object.assign(c,h);var m=ve(e,u,c.errorCallback);if(m){for(var g=0,y=Object.values(t);g<y.length;g++){var x=y[g],v=e.getAttachedShaders(x);e.deleteProgram(x);var b,_=p(v);try{for(_.s();!(b=_.n()).done;){var F=b.value;a.has(F)||e.deleteShader(F)}}catch(e){_.e(e)}finally{_.f()}}return m}}}function ze(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=new Set,i=Object.fromEntries(Object.entries(t).map((function(t){var i=f(t,2),o=i[0],n=i[1],s=d({},r),l=Array.isArray(n)?n:n.shaders;return Array.isArray(n)||Object.assign(s,n),l.forEach(a.add,a),[o,fe(e,l,s)]})));if(!r.callback)return Ve(e,i,t,a,r)?void 0:i;(function(e,t){return xe.apply(this,arguments)})(e,i).then((function(){var o=Ve(e,i,t,a,r);r.callback(o,o?void 0:i)}))}function je(e,t,r){function a(e,t){return Object.fromEntries(Object.entries(t).map((function(t){var r=f(t,2),a=r[0],i=r[1];return[a,Re(e,i)]})))}var i=(r=de(r)).callback;i&&(r.callback=function(t,r){i(t,t?void 0:a(e,r))});var o=ze(e,t,r);if(!i&&o)return a(e,o)}t.createProgramsAsync=me(ze),t.createProgramInfosAsync=me(je)},"./src/textures.js":(e,t,r)=>{function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}t.__esModule=!0,t.canFilter=Et,t.canGenerateMipmap=Tt,t.createSampler=Wt,t.createSamplers=function(e,t){var r={};return Object.keys(t).forEach((function(a){r[a]=Wt(e,t[a])})),r},t.createTexture=Qt,t.createTextures=function(e,t,r){r=r||Nt;var a=0,i=[],o={},n={};function s(){0===a&&setTimeout((function(){r(i.length?i:void 0,o,n)}),0)}return Object.keys(t).forEach((function(r){var l,u,d=t[r];("string"==typeof(u=d.src)||Array.isArray(u)&&"string"==typeof u[0])&&(l=function(e,t,o){n[r]=o,--a,e&&i.push(e),s()},++a),o[r]=Qt(e,d,l)})),s(),o},t.getBytesPerElementForInternalFormat=St,t.getFormatAndTypeForInternalFormat=Dt,t.getNumComponentsForFormat=function(e){var t=Ct[e];if(!t)throw"unknown format: "+e;return t.numColorComponents},t.loadTextureFromUrl=Xt,t.resizeTexture=function(e,t,r,a,i,o){a=a||r.width,i=i||r.height,o=o||r.depth;var n=r.target||w;e.bindTexture(n,t);var s,l=r.level||0,u=r.internalFormat||r.format||g,d=Dt(u),c=r.format||d.format,f=r.src;if(s=f&&(h(f)||Array.isArray(f)&&"number"==typeof f[0])?r.type||Bt(0,f,d.type):r.type||d.type,n===M)for(var p=0;p<6;++p)e.texImage2D(A+p,l,u,a,i,0,c,s,null);else n===S||n===D?e.texImage3D(n,l,u,a,i,o,0,c,s,null):e.texImage2D(n,l,u,a,i,0,c,s,null)},t.setDefaultTextureColor=Lt,t.setEmptyTexture=$t,t.setSamplerParameters=Ut,t.setTextureDefaults_=function(e){n.copyExistingProperties(e,c),e.textureColor&&Lt(e.textureColor)},t.setTextureFilteringForSize=Vt,t.setTextureFromArray=Yt,t.setTextureFromElement=Ht,t.setTextureParameters=Rt;var i=l(r("./src/utils.js")),o=l(r("./src/typedarrays.js")),n=l(r("./src/helper.js"));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(s=function(e){return e?r:t})(e)}function l(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var r=s(t);if(r&&r.has(e))return r.get(e);var i={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var l=o?Object.getOwnPropertyDescriptor(e,n):null;l&&(l.get||l.set)?Object.defineProperty(i,n,l):i[n]=e[n]}return i.default=e,r&&r.set(e,i),i}var u,d,c={textureColor:new Uint8Array([128,192,255,255]),textureOptions:{},crossOrigin:void 0},h=o.isArrayBuffer,f=function(){return u=u||("undefined"!=typeof document&&document.createElement?document.createElement("canvas").getContext("2d"):null)},p=6406,m=6407,g=6408,y=6409,x=6410,v=6402,b=34041,_=33071,F=9728,C=9729,w=3553,M=34067,S=32879,D=35866,A=34069,T=34070,E=34071,B=34072,k=34073,L=34074,P=10241,I=10240,O=10242,R=10243,U=32882,W=33082,V=33083,z=33084,j=33085,G=34892,H=34893,N=3317,q=3314,K=32878,Z=3316,X=3315,Y=32877,$=37443,Q=37441,J=37440,ee=33321,te=36756,re=33325,ae=33326,ie=33330,oe=33329,ne=33338,se=33337,le=33340,ue=33339,de=33323,ce=36757,he=33327,fe=33328,pe=33336,me=33335,ge=33332,ye=33331,xe=33334,ve=33333,be=32849,_e=35905,Fe=36194,Ce=36758,we=35898,Me=35901,Se=34843,De=34837,Ae=36221,Te=36239,Ee=36215,Be=36233,ke=36209,Le=36227,Pe=32856,Ie=35907,Oe=36759,Re=32855,Ue=32854,We=32857,Ve=34842,ze=34836,je=36220,Ge=36238,He=36975,Ne=36214,qe=36232,Ke=36226,Ze=36208,Xe=33189,Ye=33190,$e=36012,Qe=36013,Je=35056,et=5120,tt=5121,rt=5122,at=5123,it=5124,ot=5125,nt=5126,st=32819,lt=32820,ut=33635,dt=5131,ct=36193,ht=33640,ft=35899,pt=35902,mt=36269,gt=34042,yt=33319,xt=33320,vt=6403,bt=36244,_t=36248,Ft=36249,Ct={},wt=Ct;function Mt(e){if(!d){var t={};t[p]={textureFormat:p,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[tt,dt,ct,nt]},t[y]={textureFormat:y,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[tt,dt,ct,nt]},t[x]={textureFormat:x,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2,4,4,8],type:[tt,dt,ct,nt]},t[m]={textureFormat:m,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,6,6,12,2],type:[tt,dt,ct,nt,ut]},t[g]={textureFormat:g,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,8,8,16,2,2],type:[tt,dt,ct,nt,st,lt]},t[v]={textureFormat:v,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[ot,at]},t[ee]={textureFormat:vt,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1],type:[tt]},t[te]={textureFormat:vt,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[1],type:[et]},t[re]={textureFormat:vt,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4,2],type:[nt,dt]},t[ae]={textureFormat:vt,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[4],type:[nt]},t[ie]={textureFormat:bt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[tt]},t[oe]={textureFormat:bt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[et]},t[ge]={textureFormat:bt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[at]},t[ye]={textureFormat:bt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[rt]},t[xe]={textureFormat:bt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[ot]},t[ve]={textureFormat:bt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[it]},t[de]={textureFormat:yt,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2],type:[tt]},t[ce]={textureFormat:yt,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[2],type:[et]},t[he]={textureFormat:yt,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[8,4],type:[nt,dt]},t[fe]={textureFormat:yt,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[8],type:[nt]},t[pe]={textureFormat:xt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[tt]},t[me]={textureFormat:xt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[et]},t[ne]={textureFormat:xt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[at]},t[se]={textureFormat:xt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[rt]},t[le]={textureFormat:xt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[ot]},t[ue]={textureFormat:xt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[it]},t[be]={textureFormat:m,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3],type:[tt]},t[_e]={textureFormat:m,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[tt]},t[Fe]={textureFormat:m,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,2],type:[tt,ut]},t[Ce]={textureFormat:m,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[et]},t[we]={textureFormat:m,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[nt,dt,ft]},t[Me]={textureFormat:m,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[nt,dt,pt]},t[Se]={textureFormat:m,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6],type:[nt,dt]},t[De]={textureFormat:m,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[nt]},t[Ae]={textureFormat:_t,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[tt]},t[Te]={textureFormat:_t,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[et]},t[Ee]={textureFormat:_t,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[at]},t[Be]={textureFormat:_t,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[rt]},t[ke]={textureFormat:_t,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[ot]},t[Le]={textureFormat:_t,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[it]},t[Pe]={textureFormat:g,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[tt]},t[Ie]={textureFormat:g,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[tt]},t[Oe]={textureFormat:g,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4],type:[et]},t[Re]={textureFormat:g,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2,4],type:[tt,lt,ht]},t[Ue]={textureFormat:g,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2],type:[tt,st]},t[We]={textureFormat:g,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[ht]},t[Ve]={textureFormat:g,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[16,8],type:[nt,dt]},t[ze]={textureFormat:g,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[16],type:[nt]},t[je]={textureFormat:Ft,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[tt]},t[Ge]={textureFormat:Ft,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[et]},t[He]={textureFormat:Ft,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[ht]},t[Ne]={textureFormat:Ft,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[at]},t[qe]={textureFormat:Ft,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[rt]},t[Ke]={textureFormat:Ft,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[it]},t[Ze]={textureFormat:Ft,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[ot]},t[Xe]={textureFormat:v,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[at,ot]},t[Ye]={textureFormat:v,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[ot]},t[$e]={textureFormat:v,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[nt]},t[Je]={textureFormat:b,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[gt]},t[Qe]={textureFormat:b,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[mt]},Object.keys(t).forEach((function(e){var r=t[e];r.bytesPerElementMap={},r.bytesPerElement.forEach((function(e,t){var a=r.type[t];r.bytesPerElementMap[a]=e}))})),d=t}return d[e]}function St(e,t){var r=Mt(e);if(!r)throw"unknown internal format";var a=r.bytesPerElementMap[t];if(void 0===a)throw"unknown internal format";return a}function Dt(e){var t=Mt(e);if(!t)throw"unknown internal format";return{format:t.textureFormat,type:t.type[0]}}function At(e){return!(e&e-1)}function Tt(e,t,r,a){if(!i.isWebGL2(e))return At(t)&&At(r);var o=Mt(a);if(!o)throw"unknown internal format";return o.colorRenderable&&o.textureFilterable}function Et(e){var t=Mt(e);if(!t)throw"unknown internal format";return t.textureFilterable}function Bt(e,t,r){return h(t)?o.getGLTypeForTypedArray(t):r||tt}function kt(e,t,r,a,i){if(i%1!=0)throw"can't guess dimensions";if(r||a){if(a){if(!r&&(r=i/a)%1)throw"can't guess dimensions"}else if((a=i/r)%1)throw"can't guess dimensions"}else{var o=Math.sqrt(i/(t===M?6:1));o%1==0?(r=o,a=o):(r=i,a=1)}return{width:r,height:a}}function Lt(e){c.textureColor=new Uint8Array([255*e[0],255*e[1],255*e[2],255*e[3]])}function Pt(e,t){void 0!==t.colorspaceConversion&&e.pixelStorei($,t.colorspaceConversion),void 0!==t.premultiplyAlpha&&e.pixelStorei(Q,t.premultiplyAlpha),void 0!==t.flipY&&e.pixelStorei(J,t.flipY)}function It(e){e.pixelStorei(N,4),i.isWebGL2(e)&&(e.pixelStorei(q,0),e.pixelStorei(K,0),e.pixelStorei(Z,0),e.pixelStorei(X,0),e.pixelStorei(Y,0))}function Ot(e,t,r,a){a.minMag&&(r.call(e,t,P,a.minMag),r.call(e,t,I,a.minMag)),a.min&&r.call(e,t,P,a.min),a.mag&&r.call(e,t,I,a.mag),a.wrap&&(r.call(e,t,O,a.wrap),r.call(e,t,R,a.wrap),(t===S||n.isSampler(e,t))&&r.call(e,t,U,a.wrap)),a.wrapR&&r.call(e,t,U,a.wrapR),a.wrapS&&r.call(e,t,O,a.wrapS),a.wrapT&&r.call(e,t,R,a.wrapT),void 0!==a.minLod&&r.call(e,t,W,a.minLod),void 0!==a.maxLod&&r.call(e,t,V,a.maxLod),void 0!==a.baseLevel&&r.call(e,t,z,a.baseLevel),void 0!==a.maxLevel&&r.call(e,t,j,a.maxLevel),void 0!==a.compareFunc&&r.call(e,t,H,a.compareFunc),void 0!==a.compareMode&&r.call(e,t,G,a.compareMode)}function Rt(e,t,r){var a=r.target||w;e.bindTexture(a,t),Ot(e,a,e.texParameteri,r)}function Ut(e,t,r){Ot(e,t,e.samplerParameteri,r)}function Wt(e,t){var r=e.createSampler();return Ut(e,r,t),r}function Vt(e,t,r,a,i,o){r=r||c.textureOptions,o=o||g;var n=r.target||w;if(a=a||r.width,i=i||r.height,e.bindTexture(n,t),Tt(e,a,i,o))e.generateMipmap(n);else{var s=Et(o)?C:F;e.texParameteri(n,P,s),e.texParameteri(n,I,s),e.texParameteri(n,O,_),e.texParameteri(n,R,_)}}function zt(e){return!0===e.auto||void 0===e.auto&&void 0===e.level}function jt(e,t){return(t=t||{}).cubeFaceOrder||[A,T,E,B,k,L]}function Gt(e,t){var r=jt(0,t).map((function(e,t){return{face:e,ndx:t}}));return r.sort((function(e,t){return e.face-t.face})),r}function Ht(e,t,r,a){var i=(a=a||c.textureOptions).target||w,o=a.level||0,n=r.width,s=r.height,l=a.internalFormat||a.format||g,u=Dt(l),d=a.format||u.format,h=a.type||u.type;if(Pt(e,a),e.bindTexture(i,t),i===M){var p,m,y=r.width,x=r.height;if(y/6===x)p=x,m=[0,0,1,0,2,0,3,0,4,0,5,0];else if(x/6===y)p=y,m=[0,0,0,1,0,2,0,3,0,4,0,5];else if(y/3==x/2)p=y/3,m=[0,0,1,0,2,0,0,1,1,1,2,1];else{if(y/2!=x/3)throw"can't figure out cube map from element: "+(r.src?r.src:r.nodeName);p=y/2,m=[0,0,1,0,0,1,1,1,0,2,1,2]}var v=f();v?(v.canvas.width=p,v.canvas.height=p,n=p,s=p,Gt(0,a).forEach((function(t){var a=m[2*t.ndx+0]*p,i=m[2*t.ndx+1]*p;v.drawImage(r,a,i,p,p,0,0,p,p),e.texImage2D(t.face,o,l,d,h,v.canvas)})),v.canvas.width=1,v.canvas.height=1):"undefined"!=typeof createImageBitmap&&(n=p,s=p,Gt(0,a).forEach((function(u){var c=m[2*u.ndx+0]*p,f=m[2*u.ndx+1]*p;e.texImage2D(u.face,o,l,p,p,0,d,h,null),createImageBitmap(r,c,f,p,p,{premultiplyAlpha:"none",colorSpaceConversion:"none"}).then((function(r){Pt(e,a),e.bindTexture(i,t),e.texImage2D(u.face,o,l,d,h,r),zt(a)&&Vt(e,t,a,n,s,l)}))})))}else if(i===S||i===D){var b=Math.min(r.width,r.height),_=Math.max(r.width,r.height),F=_/b;if(F%1!=0)throw"can not compute 3D dimensions of element";var C=r.width===_?1:0,A=r.height===_?1:0;e.pixelStorei(N,1),e.pixelStorei(q,r.width),e.pixelStorei(K,0),e.pixelStorei(Y,0),e.texImage3D(i,o,l,b,b,b,0,d,h,null);for(var T=0;T<F;++T){var E=T*b*C,B=T*b*A;e.pixelStorei(Z,E),e.pixelStorei(X,B),e.texSubImage3D(i,o,0,0,T,b,b,1,d,h,r)}It(e)}else e.texImage2D(i,o,l,d,h,r);zt(a)&&Vt(e,t,a,n,s,l),Rt(e,t,a)}function Nt(){}function qt(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof ImageData&&e instanceof ImageData||"undefined"!=typeof HTMLElement&&e instanceof HTMLElement}function Kt(e,t,r){return qt(e)?(setTimeout((function(){r(null,e)})),e):function(e,t,r){var a;if(r=r||Nt,t=void 0!==t?t:c.crossOrigin,t=function(e,t){return void 0!==t||function(e){if("undefined"!=typeof document){var t=document.createElement("a");return t.href=e,t.hostname===location.hostname&&t.port===location.port&&t.protocol===location.protocol}var r=new URL(location.href).origin;return new URL(e,location.href).origin===r}(e)?t:"anonymous"}(e,t),"undefined"!=typeof Image){a=new Image,void 0!==t&&(a.crossOrigin=t);var i=function(){a.removeEventListener("error",o),a.removeEventListener("load",s),a=null},o=function(){var t="couldn't load image: "+e;n.error(t),r(t,a),i()},s=function(){r(null,a),i()};return a.addEventListener("error",o),a.addEventListener("load",s),a.src=e,a}if("undefined"!=typeof ImageBitmap){var l,u,d=function(){r(l,u)},h={};t&&(h.mode="cors"),fetch(e,h).then((function(e){if(!e.ok)throw e;return e.blob()})).then((function(e){return createImageBitmap(e,{premultiplyAlpha:"none",colorSpaceConversion:"none"})})).then((function(e){u=e,setTimeout(d)})).catch((function(e){l=e,setTimeout(d)})),a=null}return a}(e,t,r)}function Zt(e,t,r){var a=(r=r||c.textureOptions).target||w;if(e.bindTexture(a,t),!1!==r.color){var i=function(e){return e=e||c.textureColor,h(e)?e:new Uint8Array([255*e[0],255*e[1],255*e[2],255*e[3]])}(r.color);if(a===M)for(var o=0;o<6;++o)e.texImage2D(A+o,0,g,1,1,0,g,tt,i);else a===S||a===D?e.texImage3D(a,0,g,1,1,1,0,g,tt,i):e.texImage2D(a,0,g,1,1,0,g,tt,i)}}function Xt(e,t,r,a){return a=a||Nt,r=r||c.textureOptions,Zt(e,t,r),Kt((r=Object.assign({},r)).src,r.crossOrigin,(function(i,o){i?a(i,t,o):(Ht(e,t,o,r),a(null,t,o))}))}function Yt(e,t,r,a){var n=(a=a||c.textureOptions).target||w;e.bindTexture(n,t);var s=a.width,l=a.height,u=a.depth,d=a.level||0,f=a.internalFormat||a.format||g,p=Dt(f),m=a.format||p.format,y=a.type||Bt(0,r,p.type);if(h(r))r instanceof Uint8ClampedArray&&(r=new Uint8Array(r.buffer));else{var x=o.getTypedArrayTypeForGLType(y);r=new x(r)}var v,b=St(f,y),_=r.byteLength/b;if(_%1)throw"length wrong size for format: "+i.glEnumToString(e,m);if(n===S||n===D)if(s||l||u)!s||l&&u?!l||s&&u?(v=kt(0,n,s,l,_/u),s=v.width,l=v.height):(v=kt(0,n,s,u,_/l),s=v.width,u=v.height):(v=kt(0,n,l,u,_/s),l=v.width,u=v.height);else{var F=Math.cbrt(_);if(F%1!=0)throw"can't guess cube size of array of numElements: "+_;s=F,l=F,u=F}else v=kt(0,n,s,l,_),s=v.width,l=v.height;if(It(e),e.pixelStorei(N,a.unpackAlignment||1),Pt(e,a),n===M){var C=_/6*(b/r.BYTES_PER_ELEMENT);Gt(0,a).forEach((function(t){var a=C*t.ndx,i=r.subarray(a,a+C);e.texImage2D(t.face,d,f,s,l,0,m,y,i)}))}else n===S||n===D?e.texImage3D(n,d,f,s,l,u,0,m,y,r):e.texImage2D(n,d,f,s,l,0,m,y,r);return{width:s,height:l,depth:u,type:y}}function $t(e,t,r){var a=r.target||w;e.bindTexture(a,t);var i=r.level||0,o=r.internalFormat||r.format||g,n=Dt(o),s=r.format||n.format,l=r.type||n.type;if(Pt(e,r),a===M)for(var u=0;u<6;++u)e.texImage2D(A+u,i,o,r.width,r.height,0,s,l,null);else a===S||a===D?e.texImage3D(a,i,o,r.width,r.height,r.depth,0,s,l,null):e.texImage2D(a,i,o,r.width,r.height,0,s,l,null)}function Qt(e,t,r){r=r||Nt,t=t||c.textureOptions;var a=e.createTexture(),i=t.target||w,o=t.width||1,n=t.height||1,s=t.internalFormat||g;e.bindTexture(i,a),i===M&&(e.texParameteri(i,O,_),e.texParameteri(i,R,_));var l=t.src;if(l)if("function"==typeof l&&(l=l(e,t)),"string"==typeof l)Xt(e,a,t,r);else if(h(l)||Array.isArray(l)&&("number"==typeof l[0]||Array.isArray(l[0])||h(l[0]))){var u=Yt(e,a,l,t);o=u.width,n=u.height}else Array.isArray(l)&&("string"==typeof l[0]||qt(l[0]))?i===M?function(e,t,r,a){a=a||Nt;var i=r.src;if(6!==i.length)throw"there must be 6 urls for a cubemap";var o=r.level||0,n=r.internalFormat||r.format||g,s=Dt(n),l=r.format||s.format,u=r.type||tt,d=r.target||w;if(d!==M)throw"target must be TEXTURE_CUBE_MAP";Zt(e,t,r),r=Object.assign({},r);var c,h=6,f=[],p=jt(0,r);c=i.map((function(i,s){return Kt(i,r.crossOrigin,(m=p[s],function(i,s){--h,i?f.push(i):s.width!==s.height?f.push("cubemap face img is not a square: "+s.src):(Pt(e,r),e.bindTexture(d,t),5===h?jt().forEach((function(t){e.texImage2D(t,o,n,l,u,s)})):e.texImage2D(m,o,n,l,u,s),zt(r)&&e.generateMipmap(d)),0===h&&a(f.length?f:void 0,t,c)}));var m}))}(e,a,t,r):function(e,t,r,a){a=a||Nt;var i=r.src,o=r.internalFormat||r.format||g,n=Dt(o),s=r.format||n.format,l=r.type||tt,u=r.target||D;if(u!==S&&u!==D)throw"target must be TEXTURE_3D or TEXTURE_2D_ARRAY";Zt(e,t,r),r=Object.assign({},r);var d,c=i.length,h=[],p=r.level||0,m=r.width,y=r.height,x=i.length,v=!0;d=i.map((function(i,n){return Kt(i,r.crossOrigin,(g=n,function(i,n){if(--c,i)h.push(i);else{if(Pt(e,r),e.bindTexture(u,t),v){v=!1,m=r.width||n.width,y=r.height||n.height,e.texImage3D(u,p,o,m,y,x,0,s,l,null);for(var b=0;b<x;++b)e.texSubImage3D(u,p,0,0,b,m,y,1,s,l,n)}else{var _,F=n;n.width===m&&n.height===y||(F=(_=f()).canvas,_.canvas.width=m,_.canvas.height=y,_.drawImage(n,0,0,m,y)),e.texSubImage3D(u,p,0,0,g,m,y,1,s,l,F),_&&F===_.canvas&&(_.canvas.width=0,_.canvas.height=0)}zt(r)&&e.generateMipmap(u)}0===c&&a(h.length?h:void 0,t,d)}));var g}))}(e,a,t,r):(Ht(e,a,l,t),o=l.width,n=l.height);else $t(e,a,t);return zt(t)&&Vt(e,a,t,o,n,s),Rt(e,a,t),a}wt[p]={numColorComponents:1},wt[y]={numColorComponents:1},wt[x]={numColorComponents:2},wt[m]={numColorComponents:3},wt[g]={numColorComponents:4},wt[vt]={numColorComponents:1},wt[bt]={numColorComponents:1},wt[yt]={numColorComponents:2},wt[xt]={numColorComponents:2},wt[m]={numColorComponents:3},wt[_t]={numColorComponents:3},wt[g]={numColorComponents:4},wt[Ft]={numColorComponents:4},wt[v]={numColorComponents:1},wt[b]={numColorComponents:2}},"./src/twgl-full.js":(e,t,r)=>{function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}t.__esModule=!0;var i={m4:!0,v3:!0,primitives:!0};t.v3=t.primitives=t.m4=void 0;var o=d(r("./src/m4.js"));t.m4=o;var n=d(r("./src/v3.js"));t.v3=n;var s=d(r("./src/primitives.js"));t.primitives=s;var l=r("./src/twgl.js");function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}function d(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var r=u(t);if(r&&r.has(e))return r.get(e);var i={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var s=o?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(i,n,s):i[n]=e[n]}return i.default=e,r&&r.set(e,i),i}Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===l[e]||(t[e]=l[e]))}))},"./src/twgl.js":(e,t,r)=>{function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}t.__esModule=!0;var i={addExtensionsToContext:!0,getContext:!0,getWebGLContext:!0,resizeCanvasToDisplaySize:!0,setDefaults:!0,attributes:!0,textures:!0,utils:!0,draw:!0,framebuffers:!0,programs:!0,typedarrays:!0,vertexArrays:!0};t.addExtensionsToContext=b,t.framebuffers=t.draw=t.attributes=void 0,t.getContext=function(e,t){var r=function(e,t){for(var r=["webgl2","webgl","experimental-webgl"],a=null,i=0;i<r.length;++i)if(a=e.getContext(r[i],t)){g.addExtensionsToContext&&b(a);break}return a}(e,t);return r},t.getWebGLContext=function(e,t){var r=function(e,t){for(var r=["webgl","experimental-webgl"],a=null,i=0;i<r.length;++i)if(a=e.getContext(r[i],t)){g.addExtensionsToContext&&b(a);break}return a}(e,t);return r},t.programs=void 0,t.resizeCanvasToDisplaySize=function(e,t){t=t||1,t=Math.max(0,t);var r=e.clientWidth*t|0,a=e.clientHeight*t|0;return(e.width!==r||e.height!==a)&&(e.width=r,e.height=a,!0)},t.setDefaults=function(e){s.copyExistingProperties(e,g),o.setAttributeDefaults_(e),n.setTextureDefaults_(e)},t.vertexArrays=t.utils=t.typedarrays=t.textures=void 0;var o=m(r("./src/attributes.js"));t.attributes=o,Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===o[e]||(t[e]=o[e]))}));var n=m(r("./src/textures.js"));t.textures=n,Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===n[e]||(t[e]=n[e]))}));var s=m(r("./src/helper.js")),l=m(r("./src/utils.js"));t.utils=l,Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===l[e]||(t[e]=l[e]))}));var u=m(r("./src/draw.js"));t.draw=u,Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===u[e]||(t[e]=u[e]))}));var d=m(r("./src/framebuffers.js"));t.framebuffers=d,Object.keys(d).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===d[e]||(t[e]=d[e]))}));var c=m(r("./src/programs.js"));t.programs=c,Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===c[e]||(t[e]=c[e]))}));var h=m(r("./src/typedarrays.js"));t.typedarrays=h,Object.keys(h).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===h[e]||(t[e]=h[e]))}));var f=m(r("./src/vertex-arrays.js"));function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(p=function(e){return e?r:t})(e)}function m(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var r=p(t);if(r&&r.has(e))return r.get(e);var i={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var s=o?Object.getOwnPropertyDescriptor(e,n):null;s&&(s.get||s.set)?Object.defineProperty(i,n,s):i[n]=e[n]}return i.default=e,r&&r.set(e,i),i}t.vertexArrays=f,Object.keys(f).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===f[e]||(t[e]=f[e]))}));var g={addExtensionsToContext:!0},y=/^(.*?)_/;function x(e,t){l.glEnumToString(e,0);var r=e.getExtension(t);if(r){var a={},i=y.exec(t)[1],o="_"+i;for(var n in r){var u=r[n],d="function"==typeof u,c=d?i:o,h=n;n.endsWith(c)&&(h=n.substring(0,n.length-c.length)),void 0!==e[h]?d||e[h]===u||s.warn(h,e[h],u,n):d?e[h]=function(e){return function(){return e.apply(r,arguments)}}(u):(e[h]=u,a[h]=u)}a.constructor={name:r.constructor.name},l.glEnumToString(a,0)}return r}var v=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_color_buffer_float","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2","EXT_frag_depth","EXT_sRGB","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_depth_texture","WEBGL_draw_buffers"];function b(e){for(var t=0;t<v.length;++t)x(e,v[t])}},"./src/typedarrays.js":(e,t)=>{t.__esModule=!0,t.getGLTypeForTypedArray=function(e){if(e instanceof Int8Array)return r;if(e instanceof Uint8Array)return a;if(e instanceof Uint8ClampedArray)return a;if(e instanceof Int16Array)return i;if(e instanceof Uint16Array)return o;if(e instanceof Int32Array)return n;if(e instanceof Uint32Array)return s;if(e instanceof Float32Array)return l;throw new Error("unsupported typed array type")},t.getGLTypeForTypedArrayType=function(e){if(e===Int8Array)return r;if(e===Uint8Array)return a;if(e===Uint8ClampedArray)return a;if(e===Int16Array)return i;if(e===Uint16Array)return o;if(e===Int32Array)return n;if(e===Uint32Array)return s;if(e===Float32Array)return l;throw new Error("unsupported typed array type")},t.getTypedArrayTypeForGLType=function(e){var t=u[e];if(!t)throw new Error("unknown gl type");return t},t.isArrayBuffer=void 0;var r=5120,a=5121,i=5122,o=5123,n=5124,s=5125,l=5126,u={},d=u;d[r]=Int8Array,d[a]=Uint8Array,d[i]=Int16Array,d[o]=Uint16Array,d[n]=Int32Array,d[s]=Uint32Array,d[l]=Float32Array,d[32819]=Uint16Array,d[32820]=Uint16Array,d[33635]=Uint16Array,d[5131]=Uint16Array,d[33640]=Uint32Array,d[35899]=Uint32Array,d[35902]=Uint32Array,d[36269]=Uint32Array,d[34042]=Uint32Array,t.isArrayBuffer="undefined"!=typeof SharedArrayBuffer?function(e){return e&&e.buffer&&(e.buffer instanceof ArrayBuffer||e.buffer instanceof SharedArrayBuffer)}:function(e){return e&&e.buffer&&e.buffer instanceof ArrayBuffer}},"./src/utils.js":(e,t)=>{var r,a;t.__esModule=!0,t.glEnumToString=void 0,t.isWebGL1=function(e){return!e.texStorage2D},t.isWebGL2=function(e){return!!e.texStorage2D},t.glEnumToString=(r={},a={},function(e,t){return function(e){var t=e.constructor.name;if(!r[t]){for(var i in e)if("number"==typeof e[i]){var o=a[e[i]];a[e[i]]=o?"".concat(o," | ").concat(i):i}r[t]=!0}}(e),a[t]||("number"==typeof t?"0x".concat(t.toString(16)):t)})},"./src/v3.js":(e,t)=>{t.__esModule=!0,t.add=function(e,t,a){return(a=a||new r(3))[0]=e[0]+t[0],a[1]=e[1]+t[1],a[2]=e[2]+t[2],a},t.copy=function(e,t){return(t=t||new r(3))[0]=e[0],t[1]=e[1],t[2]=e[2],t},t.create=function(e,t,a){var i=new r(3);return e&&(i[0]=e),t&&(i[1]=t),a&&(i[2]=a),i},t.cross=function(e,t,a){a=a||new r(3);var i=e[2]*t[0]-e[0]*t[2],o=e[0]*t[1]-e[1]*t[0];return a[0]=e[1]*t[2]-e[2]*t[1],a[1]=i,a[2]=o,a},t.distance=function(e,t){var r=e[0]-t[0],a=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(r*r+a*a+i*i)},t.distanceSq=function(e,t){var r=e[0]-t[0],a=e[1]-t[1],i=e[2]-t[2];return r*r+a*a+i*i},t.divScalar=function(e,t,a){return(a=a||new r(3))[0]=e[0]/t,a[1]=e[1]/t,a[2]=e[2]/t,a},t.divide=function(e,t,a){return(a=a||new r(3))[0]=e[0]/t[0],a[1]=e[1]/t[1],a[2]=e[2]/t[2],a},t.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},t.length=function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},t.lengthSq=function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},t.lerp=function(e,t,a,i){return(i=i||new r(3))[0]=e[0]+a*(t[0]-e[0]),i[1]=e[1]+a*(t[1]-e[1]),i[2]=e[2]+a*(t[2]-e[2]),i},t.lerpV=function(e,t,a,i){return(i=i||new r(3))[0]=e[0]+a[0]*(t[0]-e[0]),i[1]=e[1]+a[1]*(t[1]-e[1]),i[2]=e[2]+a[2]*(t[2]-e[2]),i},t.max=function(e,t,a){return(a=a||new r(3))[0]=Math.max(e[0],t[0]),a[1]=Math.max(e[1],t[1]),a[2]=Math.max(e[2],t[2]),a},t.min=function(e,t,a){return(a=a||new r(3))[0]=Math.min(e[0],t[0]),a[1]=Math.min(e[1],t[1]),a[2]=Math.min(e[2],t[2]),a},t.mulScalar=function(e,t,a){return(a=a||new r(3))[0]=e[0]*t,a[1]=e[1]*t,a[2]=e[2]*t,a},t.multiply=function(e,t,a){return(a=a||new r(3))[0]=e[0]*t[0],a[1]=e[1]*t[1],a[2]=e[2]*t[2],a},t.negate=function(e,t){return(t=t||new r(3))[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},t.normalize=function(e,t){t=t||new r(3);var a=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=Math.sqrt(a);return i>1e-5?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=0,t[1]=0,t[2]=0),t},t.setDefaultType=function(e){var t=r;return r=e,t},t.subtract=function(e,t,a){return(a=a||new r(3))[0]=e[0]-t[0],a[1]=e[1]-t[1],a[2]=e[2]-t[2],a};var r=Float32Array},"./src/vertex-arrays.js":(e,t,r)=>{function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}t.__esModule=!0,t.createVAOAndSetAttributes=s,t.createVAOFromBufferInfo=function(e,t,r){return s(e,t.attribSetters||t,r.attribs,r.indices)},t.createVertexArrayInfo=function(e,t,r){var a=e.createVertexArray();return e.bindVertexArray(a),t.length||(t=[t]),t.forEach((function(t){i.setBuffersAndAttributes(e,t,r)})),e.bindVertexArray(null),{numElements:r.numElements,elementType:r.elementType,vertexArrayObject:a}};var i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=a(e)&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var i={__proto__:null},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var l=n?Object.getOwnPropertyDescriptor(e,s):null;l&&(l.get||l.set)?Object.defineProperty(i,s,l):i[s]=e[s]}return i.default=e,r&&r.set(e,i),i}(r("./src/programs.js"));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}var n=34963;function s(e,t,r,a){var o=e.createVertexArray();return e.bindVertexArray(o),i.setAttributes(t,r),a&&e.bindBuffer(n,a),e.bindVertexArray(null),o}}},t={},r=function r(a){var i=t[a];if(void 0!==i)return i.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,r),o.exports}("./src/twgl-full.js");return r})(),e.exports=t()},8049:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});const a="precision mediump float;\r\n\r\nuniform vec4 u_color;\r\n\r\nvoid main() {\r\n    gl_FragColor = u_color;\r\n}"},8085:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpellVisualKitModel=void 0;const a=r(708),i=r(8521),o=r(3598);class n extends i.WorldPositionedObject{constructor(e,t){super(),this.objectFactory=t,this.dataManager=e,this.effectObjects=[]}get isLoaded(){return null!=this.metadata&&this.effectsLoaded}attachToRenderer(e){super.attachToRenderer(e),this.spellVisualKitId&&!this.isLoaded&&this.dataManager.getSpellVisualKitMetadata(this.spellVisualKitId).then(this.onSpellVisualKitMetadataLoaded.bind(this))}attachTo(e){if(!this.isDisposing){if(this.attachedToModel)throw"Spell visual kit is already attached to a different model.";this.attachedToModel=e,this.attachedToModel.addChild(this)}}loadSpellVisualKitId(e){this.isDisposing||this.spellVisualKitId!==e&&(this.spellVisualKitId=e,this.renderer&&this.dataManager.getSpellVisualKitMetadata(this.spellVisualKitId).then(this.onSpellVisualKitMetadataLoaded.bind(this)))}update(e){if(!this.isDisposing)for(const t of this.effectObjects)t.update(e)}draw(){if(!this.isDisposing)for(const e of this.effectObjects)e.draw()}dispose(){this.isDisposing||(super.dispose(),this.metadata=null,this.dataManager=null,this.objectFactory=null)}pauseAnimation(){this.once("effectsLoaded",(()=>{for(const e of this.children)e.pauseAnimation()}))}resumeAnimation(){this.once("effectsLoaded",(()=>{for(const e of this.children)e.resumeAnimation()}))}canExecuteCallbackNow(e){return"metadataLoaded"===e?null!=this.metadata:super.canExecuteCallbackNow(e)}onSpellVisualKitMetadataLoaded(e){if(e){if(!this.isDisposing){this.metadata=e;for(const e of this.metadata.effects)switch(e.type){case a.SpellVisualKitEffectType.ModelAttach:this.processModelAttachEffect(e);break;case a.SpellVisualKitEffectType.Beam:this.processBeamEffect(e)}this.processCallbacks("metadataLoaded")}}else this.dispose()}processModelAttachEffect(e){var t=new o.ModelAttachEffect(this.objectFactory);t.once("loaded",this.onEffectLoaded.bind(this)),this.effectObjects.push(t);const r=t.loadModelAttachEffect(e);r>=0?this.attachedToModel&&this.attachedToModel.once("modelDataLoaded",(()=>{this.attachedToModel.addAttachedModel(t,this.attachedToModel.getAttachment(r))})):this.addChild(t)}processBeamEffect(e){}onEffectLoaded(){this.effectsLoaded=this.effectObjects.every((e=>e.isLoaded)),this.isLoaded&&this.processCallbacks("loaded")}}t.SpellVisualKitModel=n},8120:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserRenderer=void 0;const a=r(5981);class i extends a.BaseRenderer{constructor(e){super(e),this.containerElement=e.container,this.framesDrawn=0,this.maxFpsCounterSize=100,this.fpsCounter=[]}dispose(){super.dispose()}start(){super.start();const e=this;e.lastTime=this.now();const t=()=>{if(e.isDisposing)return;const r=e.now();e.once("afterDraw",(()=>{if(this.fpsCounter.push(1/(this.lastDeltaTime/1e3)),this.fpsCounter.length>this.maxFpsCounterSize&&this.fpsCounter.splice(0,1),this.fpsElement){const e=this.fpsCounter.reduce(((e,t)=>e+t),0)/this.fpsCounter.length;this.fpsElement.textContent="FPS: "+Math.floor(e)}this.framesDrawn++,this.batchesElement&&(this.batchesElement.textContent="Batches: "+this.drawRequests.length)})),e.draw(r-e.lastTime),e.lastTime=r,window.requestAnimationFrame(t)};t()}enableDebug(){this.setupDebugElements()}enableDebugPortals(){this.debugPortals=!0}disableDebug(){this.destroyDebugElements()}disableDebugPortals(){this.debugPortals=!1}now(){return window.performance&&window.performance.now?window.performance.now():Date.now()}processTexture(e,t,r){return new Promise(((a,i)=>{const o=new Image;o.onload=()=>{const t=this.graphics.createTextureFromImg(o,r);t.fileId=e,a(t)},o.onerror=(t,r,i,o,n)=>{var s;null===(s=this.errorHandler)||void 0===s||s.call(this,"imgProcessing","TEXTURE-"+e,n||new Error("Unable to process image data for file: "+e)),a(this.getUnknownTexture())},o.src=window.URL.createObjectURL(t)}))}setupDebugElements(){this.debugContainer=document.createElement("div"),this.debugContainer.style.position="absolute",this.debugContainer.style.left="0",this.debugContainer.style.top="0",this.debugContainer.style.padding="1em",this.fpsElement=document.createElement("p"),this.fpsElement.style.color="white",this.fpsElement.style.margin="0",this.debugContainer.append(this.fpsElement),this.batchesElement=document.createElement("p"),this.batchesElement.style.color="white",this.batchesElement.style.margin="0",this.batchesElement.style.marginTop="1.2em",this.debugContainer.append(this.batchesElement),this.containerElement.append(this.debugContainer)}destroyDebugElements(){this.fpsElement&&(this.fpsElement.remove(),this.fpsElement=null),this.batchesElement&&(this.batchesElement.remove(),this.batchesElement=null),this.debugContainer&&(this.debugContainer.remove(),this.debugContainer=null)}}t.BrowserRenderer=i},8156:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(2222),t),i(r(8219),t),i(r(2462),t),i(r(708),t),i(r(6919),t),i(r(1722),t),i(r(4849),t),i(r(6303),t),i(r(1639),t),i(r(8204),t),i(r(1670),t),i(r(105),t),i(r(3335),t)},8169:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CharacterModel=void 0;const a=r(9551),i=r(45),o=r(7693),n=r(1132),s=[13,14,15,16,17,88,89],l=[8,9,10,11,12,86,87],u=[1,1,1,1,1,1,1,2,1,1,1,1,1,1,0,1,0,0,1,1,1,1,1,1,0,0,1,0,1,0,0,0,2,1,1,0,0,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1];class d extends a.M2Model{constructor(e,t,r,a){super(e,t),this.class=0,this.inventory=new n.CharacterInventory(this,r),this.texturePickingStrategy=a,this.objectFactory=r}attachToRenderer(e){super.attachToRenderer(e),this.modelId&&!this.isLoaded&&this.dataManager.getCharacterMetadata(this.modelId).then(this.onCharacterMetadataLoaded.bind(this))}loadModelId(e){this.modelId=e,this.gender=(e-1)%2,this.race=Math.ceil(e/2),this.textureLayerBaseFileIds={},this.textureLayerBaseTextures={},this.textureLayerCombiners={},this.skinnedModels={},this.renderer&&this.dataManager.getCharacterMetadata(this.modelId).then(this.onCharacterMetadataLoaded.bind(this))}dispose(){if(!this.isDisposing){super.dispose(),this.characterMetadata=null,this.customizationChoices=null,this.itemGeoModifyData=null,this.customizationGeosets=null,this.textureLayerBaseFileIds=null,this.textureLayerBaseTextures=null;for(const e in this.textureLayerCombiners)this.textureLayerCombiners[e].dispose();this.textureLayerCombiners=null;for(const e in this.skinnedModels)this.skinnedModels[e].dispose();this.skinnedModels=null,this.inventory.dispose(),this.inventory=null}}get isLoaded(){return super.isLoaded&&this.skinLayerTexturesLoaded}get customizationData(){return this.characterMetadata.characterCustomizationData}get skinLayerTexturesLoaded(){var e;if(!this.characterMetadata)return!1;for(const t in this.textureLayerBaseFileIds){const r=this.textureLayerBaseFileIds[t];for(let a=0;a<r.length;a++)if((null===(e=this.textureLayerBaseTextures[t][a])||void 0===e?void 0:e.fileId)!=r[a])return!1}return!0}update(e){if(!this.isDisposing){super.update(e),this.inventory.update(e);for(const t in this.skinnedModels)this.skinnedModels[t].update(e)}}draw(){if(!this.isDisposing&&this.isLoaded){super.draw(),this.inventory.draw();for(const e in this.skinnedModels)this.skinnedModels[e].draw()}}canExecuteCallbackNow(e){if(this.isDisposing)return!1;switch(e){case"characterMetadataLoaded":return null!=this.characterMetadata;case"skinTexturesLoaded":return this.skinLayerTexturesLoaded;default:return super.canExecuteCallbackNow(e)}}setCustomizationChoice(e,t){this.isDisposing||this.once("characterMetadataLoaded",(()=>{const r=this.characterMetadata.characterCustomizationData.options.findIndex((t=>t.id===e));if(r<0)return;const a=this.characterMetadata.characterCustomizationData.options[r].choices.find((e=>e.id===t));a&&(this.customizationChoices[r]=a,this.applyCustomizations())}))}equipItem(e,t,r){if(!this.isDisposing)return this.inventory.equipItem(e,t,r)}unequipItem(e){this.isDisposing||this.inventory.unequipItem(e)}reloadSkinTextures(){this.skinLayerTexturesLoaded&&this.updateSkinTextures()}updateGeosets(){this.isDisposing||this.once("texturesLoaded",(()=>{this.onGeosetUpdate()}))}setHandAnimation(e,t){this.once("modelDataLoaded",(()=>{const r=e?l:s;for(const e of r){const r=this.getBoneById(e);r&&(r.animationState||(r.animationState=new a.AnimationState(this.modelData.animations,this.modelData.globalLoops)),r.animationState.useAnimation(t?15:0))}}))}onCharacterMetadataLoaded(e){e?this.isDisposing||(this.characterMetadata=e,this.loadFileId(e.fileDataId),this.loadSkinnedModels(),this.setDefaultCustomizations(),this.applyCustomizations(),this.processCallbacks("characterMetadataLoaded")):this.dispose()}setDefaultCustomizations(){if(!this.isDisposing){this.customizationChoices=[];for(const e of this.customizationData.options)this.customizationChoices.push(e.choices[0])}}applyCustomizations(){if(this.isDisposing)return;this.itemGeoModifyData=[];let e=0,t=this.characterMetadata.fileDataId;const r=e=>0==e.relationChoiceID||this.customizationChoices.some((t=>t.id==e.relationChoiceID));this.customizationGeosets={};const a={};for(const i of this.customizationChoices){const o=i.elements.filter(r),n=o.filter((e=>e.boneSet));n.length>0&&(e=n[0].boneSet.boneFileDataId);const s=o.filter((e=>e.material));s.sort(((e,t)=>t.relationChoiceID-e.relationChoiceID));for(const e of s){const t=this.texturePickingStrategy(e.material.textureFiles,this.race,this.gender,this.class);if(!t[0])continue;const r=this.customizationData.textureLayers.find((t=>t.chrModelTextureTargetId===e.material.chrModelTextureTargetId));r&&(a[r.layer]=t)}const l=o.filter((e=>e.geoset));l.sort(((e,t)=>e.geoset.geosetType-t.geoset.geosetType||e.geoset.geosetId-t.geoset.geosetId));for(const e of l)this.customizationGeosets[e.geoset.geosetType]=e.geoset.geosetId;const u=o.filter((e=>e.skinnedModel));for(const e of u){const t=this.skinnedModels[e.skinnedModel.collectionsFileDataId];t.toggleGeosets(0,5300,!1),t.toggleGeoset(100*e.skinnedModel.geosetType+e.skinnedModel.geosetId,!0)}const d=o.filter((e=>e.custItemGeoModify));for(const e of d)this.itemGeoModifyData.push(e.custItemGeoModify);const c=o.find((e=>0!=e.conditionalModelFileDataId));c&&(t=c.conditionalModelFileDataId)}this.loadBoneFile(e),this.loadFileId(t),this.loadSkinTextures(a),this.updateGeosets()}loadSkinTextures(e){if(this.isDisposing)return;this.textureLayerBaseFileIds={},this.textureLayerBaseTextures={};const t=[];for(const r in e){const a=this.customizationData.textureLayers[parseInt(r,10)],o=this.customizationData.modelMaterials.find((e=>e.textureType===a.textureType));this.textureLayerCombiners[a.textureType]||(this.textureLayerCombiners[a.textureType]=new i.SkinLayerTextureCombiner(this,a.textureType,o.width,o.height)),this.textureLayerBaseFileIds[r]=e[r],this.textureLayerBaseTextures[r]=[null,null,null],t.push(r)}const r=[];for(const a of t)for(let t=0;t<3;t++){const i=e[a][t];i&&r.push(this.renderer.getTexture(this,i).then((e=>{const r=this.textureLayerBaseFileIds[a];r&&r[t]===e.fileId&&(this.textureLayerBaseTextures[a][t]=e)})))}Promise.all(r).then(this.onSkinTexturesLoaded.bind(this))}onSkinTexturesLoaded(){this.isDisposing||(this.updateSkinTextures(),this.processCallbacks("skinTexturesLoaded"),this.isLoaded&&this.processCallbacks("loaded"))}updateSkinTextures(){if(this.isDisposing)return;if(!this.skinLayerTexturesLoaded)return;for(const e in this.textureLayerCombiners)this.textureLayerCombiners[e].clear();const[e,t]=this.inventory.shouldDrawUnderwear(),r=this.customizationData.textureLayers.sort(((e,t)=>e.layer-t.layer));for(const a of r){if(!this.textureLayerBaseFileIds[a.layer])continue;const r=this.textureLayerCombiners[a.textureType];if(!r)continue;if(3===a.textureSection&&!e)continue;if(5===a.textureSection&&!t)continue;let i,o,n,s;if(-1===a.textureSection)i=o=0,n=r.width,s=r.height;else{const e=this.customizationData.textureSections.find((e=>e.sectionType===a.textureSection));if(!e)continue;i=e.x,o=e.y,n=e.width,s=e.height}r.drawTextureSection(this.textureLayerBaseTextures[a.layer],i,o,n,s,a.blendMode)}const a=this.inventory.getItemTextures();for(const e in a){const t=parseInt(e,10);if(7==t&&(8===this.race||31===this.race))continue;const r=this.textureLayerCombiners[1];if(!r)continue;const i=this.customizationData.textureSections.find((t=>t.sectionType===parseInt(e,10)));if(i)for(const e of a[t])r.drawTextureSection(e,i.x,i.y,i.width,i.height,0)}const i=this.inventory.inventoryData[o.EquipmentSlot.Back];i&&this.swapTextureType(2,i.model1.component1Texture),this.once("texturesLoaded",(()=>{for(const e in this.textureLayerCombiners)this.swapTextureType(parseInt(e,10),this.textureLayerCombiners[e].outputTexture)}))}onGeosetUpdate(){if(this.isDisposing)return;this.toggleGeosets(0,5300,!1);const e=[...u];for(const t in this.customizationGeosets)e[parseInt(t,10)]=this.customizationGeosets[t];for(let t=0;t<e.length;t++)this.toggleGeoset(100*t+e[t],!0);const t=this.inventory.getGeosetToggles();for(const e in t){const r=parseInt(e,10);let a=t[r];for(const e of this.itemGeoModifyData)if(e.geosetType===r&&e.original===a){a=e.override;break}this.toggleGeosets(100*r,100*(r+1)-1,!1),a>-1&&this.toggleGeoset(100*r+a,!0)}this.toggleGeoset(0,!0)}loadSkinnedModels(){if(this.isDisposing)return;const e=this.customizationData.options.reduce(((e,t)=>e.concat(t.choices.reduce(((e,t)=>e.concat(t.elements.filter((e=>e.skinnedModel)).map((e=>e.skinnedModel.collectionsFileDataId)))),[]))),[]),t=new Set(e);if(0!=t.size)for(const e of t){const t=this.objectFactory.createM2Model(e);this.addChild(t),t.attachTo(this),t.toggleGeosets(0,5300,!1),this.skinnedModels[e]=t}}}t.CharacterModel=d},8204:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Disposable=void 0,t.Disposable=class{constructor(){this.isDisposing=!1,this.callbacks={}}on(e,t){this.addCallback(e,t,!0)}onceAsync(e){return new Promise((t=>this.once(e,t)))}off(e,t){this.removeCallback(e,t)}once(e,t){this.addCallback(e,t,!1)}canExecuteCallbackNow(e){return"disposed"===e&&this.isDisposing}processCallbacks(e){if(this.callbacks[e])for(let t=0;t<this.callbacks[e].length;t++){const r=this.callbacks[e][t];r.callback(this),r.persistent||(this.callbacks[e].splice(t,1),t--)}}addCallback(e,t,r){this.canExecuteCallbackNow(e)&&(t(this),!r)||(this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push({callback:t,persistent:r}))}removeCallback(e,t){const r=this.callbacks[e];r&&(this.callbacks[e]=r.filter((e=>e.callback!==t)))}dispose(){this.isDisposing=!0,this.processCallbacks("disposed")}}},8219:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(5981),t),i(r(8120),t),i(r(1312),t),i(r(2715),t),i(r(6940),t),i(r(1017),t)},8283:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultIoCContainer=void 0;const a=r(1639),i=r(6166),o=r(2876),n=r(9716),s=r(9663);t.DefaultIoCContainer=class{constructor(){}setRandomNumberGeneratorCtor(e){this.rngFactory=e}getRandomNumberGenerator(e){return this.rngFactory(e||184594917*Math.random())}setTexturePickingStrategy(e){this.texturePickingStrategy=e}getTexturePickingStrategy(){return this.texturePickingStrategy}setModelPickingStrategy(e){this.modelPickingStrategy=e}getModelPickingStrategy(){return this.modelPickingStrategy}setObjectFactory(e){this.objectFactory=e}getObjectFactory(){return this.objectFactory}setDataLoader(e){this.dataLoader=e}getDataLoader(){return this.dataLoader}setProgressReporter(e){this.progressReporter=e}getProgressReporter(){return this.progressReporter}setErrorHandler(e){this.errorHandler=e}getErrorHandler(){return this.errorHandler}setDataManager(e){this.dataManager=e}getDataManager(){return this.dataManager}setObjectIdentifier(e){this.objectIdentifier=e}getObjectIdentifier(){return this.objectIdentifier}createDefaults(){this.texturePickingStrategy=i.defaultTexturePickingStrategy,this.modelPickingStrategy=i.defaultModelPickingStrategy,this.objectFactory=new o.DefaultObjectFactory(this),this.dataManager=new n.DefaultDataManager(this),this.objectIdentifier=new s.ObjectIdentifier,this.rngFactory=e=>new a.AleaPrngGenerator(e)}}},8381:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});const a="precision mediump float;\r\nprecision mediump int;\r\n\r\nattribute vec3 a_position;\r\nattribute vec4 a_color;\r\nattribute vec2 a_texCoord1;\r\n\r\nuniform mat4 u_projectionMatrix;\r\nuniform mat4 u_viewMatrix;\r\n\r\nvarying vec4 v_color;\r\nvarying vec2 v_texCoord1;\r\n\r\nvoid main() {\r\n    vec4 aPositionVec4 = vec4(a_position, 1);\r\n\r\n    v_color = a_color;\r\n    v_texCoord1 = a_texCoord1;\r\n    vec4 vertexViewSpace = u_viewMatrix * aPositionVec4;\r\n\r\n    gl_Position = u_projectionMatrix * vertexViewSpace;\r\n}\r\n"},8411:(e,t,r)=>{"use strict";const{_tr_init:a,_tr_stored_block:i,_tr_flush_block:o,_tr_tally:n,_tr_align:s}=r(3665),l=r(3269),u=r(4823),d=r(4674),{Z_NO_FLUSH:c,Z_PARTIAL_FLUSH:h,Z_FULL_FLUSH:f,Z_FINISH:p,Z_BLOCK:m,Z_OK:g,Z_STREAM_END:y,Z_STREAM_ERROR:x,Z_DATA_ERROR:v,Z_BUF_ERROR:b,Z_DEFAULT_COMPRESSION:_,Z_FILTERED:F,Z_HUFFMAN_ONLY:C,Z_RLE:w,Z_FIXED:M,Z_DEFAULT_STRATEGY:S,Z_UNKNOWN:D,Z_DEFLATED:A}=r(9681),T=258,E=262,B=42,k=113,L=666,P=(e,t)=>(e.msg=d[t],t),I=e=>2*e-(e>4?9:0),O=e=>{let t=e.length;for(;--t>=0;)e[t]=0},R=e=>{let t,r,a,i=e.w_size;t=e.hash_size,a=t;do{r=e.head[--a],e.head[a]=r>=i?r-i:0}while(--t);t=i,a=t;do{r=e.prev[--a],e.prev[a]=r>=i?r-i:0}while(--t)};let U=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask;const W=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))},V=(e,t)=>{o(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,W(e.strm)},z=(e,t)=>{e.pending_buf[e.pending++]=t},j=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},G=(e,t,r,a)=>{let i=e.avail_in;return i>a&&(i=a),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),r),1===e.state.wrap?e.adler=l(e.adler,t,i,r):2===e.state.wrap&&(e.adler=u(e.adler,t,i,r)),e.next_in+=i,e.total_in+=i,i)},H=(e,t)=>{let r,a,i=e.max_chain_length,o=e.strstart,n=e.prev_length,s=e.nice_match;const l=e.strstart>e.w_size-E?e.strstart-(e.w_size-E):0,u=e.window,d=e.w_mask,c=e.prev,h=e.strstart+T;let f=u[o+n-1],p=u[o+n];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(r=t,u[r+n]===p&&u[r+n-1]===f&&u[r]===u[o]&&u[++r]===u[o+1]){o+=2,r++;do{}while(u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&o<h);if(a=T-(h-o),o=h-T,a>n){if(e.match_start=t,n=a,a>=s)break;f=u[o+n-1],p=u[o+n]}}}while((t=c[t&d])>l&&0!=--i);return n<=e.lookahead?n:e.lookahead},N=e=>{const t=e.w_size;let r,a,i;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-E)&&(e.window.set(e.window.subarray(t,t+t-a),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),R(e),a+=t),0===e.strm.avail_in)break;if(r=G(e.strm,e.window,e.strstart+e.lookahead,a),e.lookahead+=r,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=U(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=U(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<E&&0!==e.strm.avail_in)},q=(e,t)=>{let r,a,o,n=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,s=0,l=e.strm.avail_in;do{if(r=65535,o=e.bi_valid+42>>3,e.strm.avail_out<o)break;if(o=e.strm.avail_out-o,a=e.strstart-e.block_start,r>a+e.strm.avail_in&&(r=a+e.strm.avail_in),r>o&&(r=o),r<n&&(0===r&&t!==p||t===c||r!==a+e.strm.avail_in))break;s=t===p&&r===a+e.strm.avail_in?1:0,i(e,0,0,s),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,W(e.strm),a&&(a>r&&(a=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+a),e.strm.next_out),e.strm.next_out+=a,e.strm.avail_out-=a,e.strm.total_out+=a,e.block_start+=a,r-=a),r&&(G(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(0===s);return l-=e.strm.avail_in,l&&(l>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=l&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-l,e.strm.next_in),e.strstart),e.strstart+=l,e.insert+=l>e.w_size-e.insert?e.w_size-e.insert:l),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),s?4:t!==c&&t!==p&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(o=e.window_size-e.strstart,e.strm.avail_in>o&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,o+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),o>e.strm.avail_in&&(o=e.strm.avail_in),o&&(G(e.strm,e.window,e.strstart,o),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.high_water<e.strstart&&(e.high_water=e.strstart),o=e.bi_valid+42>>3,o=e.pending_buf_size-o>65535?65535:e.pending_buf_size-o,n=o>e.w_size?e.w_size:o,a=e.strstart-e.block_start,(a>=n||(a||t===p)&&t!==c&&0===e.strm.avail_in&&a<=o)&&(r=a>o?o:a,s=t===p&&0===e.strm.avail_in&&r===a?1:0,i(e,e.block_start,r,s),e.block_start+=r,W(e.strm)),s?3:1)},K=(e,t)=>{let r,a;for(;;){if(e.lookahead<E){if(N(e),e.lookahead<E&&t===c)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=U(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-E&&(e.match_length=H(e,r)),e.match_length>=3)if(a=n(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=U(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=U(e,e.ins_h,e.window[e.strstart+1]);else a=n(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(a&&(V(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===p?(V(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(V(e,!1),0===e.strm.avail_out)?1:2},Z=(e,t)=>{let r,a,i;for(;;){if(e.lookahead<E){if(N(e),e.lookahead<E&&t===c)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=U(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-E&&(e.match_length=H(e,r),e.match_length<=5&&(e.strategy===F||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,a=n(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=U(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,a&&(V(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(a=n(e,0,e.window[e.strstart-1]),a&&V(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(a=n(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===p?(V(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(V(e,!1),0===e.strm.avail_out)?1:2};function X(e,t,r,a,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=a,this.func=i}const Y=[new X(0,0,0,0,q),new X(4,4,8,4,K),new X(4,5,16,8,K),new X(4,6,32,32,K),new X(4,4,16,16,Z),new X(8,16,32,32,Z),new X(8,16,128,128,Z),new X(8,32,128,256,Z),new X(32,128,258,1024,Z),new X(32,258,258,4096,Z)];function $(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=A,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),O(this.dyn_ltree),O(this.dyn_dtree),O(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),O(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),O(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Q=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==B&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==k&&t.status!==L?1:0},J=e=>{if(Q(e))return P(e,x);e.total_in=e.total_out=0,e.data_type=D;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?B:k,e.adler=2===t.wrap?0:1,t.last_flush=-2,a(t),g},ee=e=>{const t=J(e);var r;return t===g&&((r=e.state).window_size=2*r.w_size,O(r.head),r.max_lazy_match=Y[r.level].max_lazy,r.good_match=Y[r.level].good_length,r.nice_match=Y[r.level].nice_length,r.max_chain_length=Y[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0),t},te=(e,t,r,a,i,o)=>{if(!e)return x;let n=1;if(t===_&&(t=6),a<0?(n=0,a=-a):a>15&&(n=2,a-=16),i<1||i>9||r!==A||a<8||a>15||t<0||t>9||o<0||o>M||8===a&&1!==n)return P(e,x);8===a&&(a=9);const s=new $;return e.state=s,s.strm=e,s.status=B,s.wrap=n,s.gzhead=null,s.w_bits=a,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=i+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<i+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.sym_buf=s.lit_bufsize,s.sym_end=3*(s.lit_bufsize-1),s.level=t,s.strategy=o,s.method=r,ee(e)};e.exports.deflateInit=(e,t)=>te(e,t,A,15,8,S),e.exports.deflateInit2=te,e.exports.deflateReset=ee,e.exports.deflateResetKeep=J,e.exports.deflateSetHeader=(e,t)=>Q(e)||2!==e.state.wrap?x:(e.state.gzhead=t,g),e.exports.deflate=(e,t)=>{if(Q(e)||t>m||t<0)return e?P(e,x):x;const r=e.state;if(!e.output||0!==e.avail_in&&!e.input||r.status===L&&t!==p)return P(e,0===e.avail_out?b:x);const a=r.last_flush;if(r.last_flush=t,0!==r.pending){if(W(e),0===e.avail_out)return r.last_flush=-1,g}else if(0===e.avail_in&&I(t)<=I(a)&&t!==p)return P(e,b);if(r.status===L&&0!==e.avail_in)return P(e,b);if(r.status===B&&0===r.wrap&&(r.status=k),r.status===B){let t=A+(r.w_bits-8<<4)<<8,a=-1;if(a=r.strategy>=C||r.level<2?0:r.level<6?1:6===r.level?2:3,t|=a<<6,0!==r.strstart&&(t|=32),t+=31-t%31,j(r,t),0!==r.strstart&&(j(r,e.adler>>>16),j(r,65535&e.adler)),e.adler=1,r.status=k,W(e),0!==r.pending)return r.last_flush=-1,g}if(57===r.status)if(e.adler=0,z(r,31),z(r,139),z(r,8),r.gzhead)z(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),z(r,255&r.gzhead.time),z(r,r.gzhead.time>>8&255),z(r,r.gzhead.time>>16&255),z(r,r.gzhead.time>>24&255),z(r,9===r.level?2:r.strategy>=C||r.level<2?4:0),z(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(z(r,255&r.gzhead.extra.length),z(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=u(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(z(r,0),z(r,0),z(r,0),z(r,0),z(r,0),z(r,9===r.level?2:r.strategy>=C||r.level<2?4:0),z(r,3),r.status=k,W(e),0!==r.pending)return r.last_flush=-1,g;if(69===r.status){if(r.gzhead.extra){let t=r.pending,a=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+a>r.pending_buf_size;){let i=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+i),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>t&&(e.adler=u(e.adler,r.pending_buf,r.pending-t,t)),r.gzindex+=i,W(e),0!==r.pending)return r.last_flush=-1,g;t=0,a-=i}let i=new Uint8Array(r.gzhead.extra);r.pending_buf.set(i.subarray(r.gzindex,r.gzindex+a),r.pending),r.pending+=a,r.gzhead.hcrc&&r.pending>t&&(e.adler=u(e.adler,r.pending_buf,r.pending-t,t)),r.gzindex=0}r.status=73}if(73===r.status){if(r.gzhead.name){let t,a=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>a&&(e.adler=u(e.adler,r.pending_buf,r.pending-a,a)),W(e),0!==r.pending)return r.last_flush=-1,g;a=0}t=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,z(r,t)}while(0!==t);r.gzhead.hcrc&&r.pending>a&&(e.adler=u(e.adler,r.pending_buf,r.pending-a,a)),r.gzindex=0}r.status=91}if(91===r.status){if(r.gzhead.comment){let t,a=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>a&&(e.adler=u(e.adler,r.pending_buf,r.pending-a,a)),W(e),0!==r.pending)return r.last_flush=-1,g;a=0}t=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,z(r,t)}while(0!==t);r.gzhead.hcrc&&r.pending>a&&(e.adler=u(e.adler,r.pending_buf,r.pending-a,a))}r.status=103}if(103===r.status){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(W(e),0!==r.pending))return r.last_flush=-1,g;z(r,255&e.adler),z(r,e.adler>>8&255),e.adler=0}if(r.status=k,W(e),0!==r.pending)return r.last_flush=-1,g}if(0!==e.avail_in||0!==r.lookahead||t!==c&&r.status!==L){let a=0===r.level?q(r,t):r.strategy===C?((e,t)=>{let r;for(;;){if(0===e.lookahead&&(N(e),0===e.lookahead)){if(t===c)return 1;break}if(e.match_length=0,r=n(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(V(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===p?(V(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(V(e,!1),0===e.strm.avail_out)?1:2})(r,t):r.strategy===w?((e,t)=>{let r,a,i,o;const s=e.window;for(;;){if(e.lookahead<=T){if(N(e),e.lookahead<=T&&t===c)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=e.strstart-1,a=s[i],a===s[++i]&&a===s[++i]&&a===s[++i])){o=e.strstart+T;do{}while(a===s[++i]&&a===s[++i]&&a===s[++i]&&a===s[++i]&&a===s[++i]&&a===s[++i]&&a===s[++i]&&a===s[++i]&&i<o);e.match_length=T-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=n(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=n(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(V(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===p?(V(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(V(e,!1),0===e.strm.avail_out)?1:2})(r,t):Y[r.level].func(r,t);if(3!==a&&4!==a||(r.status=L),1===a||3===a)return 0===e.avail_out&&(r.last_flush=-1),g;if(2===a&&(t===h?s(r):t!==m&&(i(r,0,0,!1),t===f&&(O(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),W(e),0===e.avail_out))return r.last_flush=-1,g}return t!==p?g:r.wrap<=0?y:(2===r.wrap?(z(r,255&e.adler),z(r,e.adler>>8&255),z(r,e.adler>>16&255),z(r,e.adler>>24&255),z(r,255&e.total_in),z(r,e.total_in>>8&255),z(r,e.total_in>>16&255),z(r,e.total_in>>24&255)):(j(r,e.adler>>>16),j(r,65535&e.adler)),W(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?g:y)},e.exports.deflateEnd=e=>{if(Q(e))return x;const t=e.state.status;return e.state=null,t===k?P(e,v):g},e.exports.deflateSetDictionary=(e,t)=>{let r=t.length;if(Q(e))return x;const a=e.state,i=a.wrap;if(2===i||1===i&&a.status!==B||a.lookahead)return x;if(1===i&&(e.adler=l(e.adler,t,r,0)),a.wrap=0,r>=a.w_size){0===i&&(O(a.head),a.strstart=0,a.block_start=0,a.insert=0);let e=new Uint8Array(a.w_size);e.set(t.subarray(r-a.w_size,r),0),t=e,r=a.w_size}const o=e.avail_in,n=e.next_in,s=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,N(a);a.lookahead>=3;){let e=a.strstart,t=a.lookahead-2;do{a.ins_h=U(a,a.ins_h,a.window[e+3-1]),a.prev[e&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=e,e++}while(--t);a.strstart=e,a.lookahead=2,N(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,e.next_in=n,e.input=s,e.avail_in=o,a.wrap=i,g},e.exports.deflateInfo="pako deflate (from Nodeca project)"},8521:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorldPositionedObject=void 0;const a=r(1639),i=r(1353);class o extends i.RenderObject{constructor(){super(),this.children=[],this.worldModelMatrix=a.Float44.identity(),this.localModelMatrix=a.Float44.identity(),this.localBoundingBox=a.AABB.create(a.Float3.zero(),a.Float3.zero()),this.worldBoundingBox=a.AABB.create(a.Float3.zero(),a.Float3.zero()),this.scale=a.Float3.one(),this.invWorldModelMatrix=a.Float44.invert(this.worldModelMatrix)}attachToRenderer(e){super.attachToRenderer(e);for(const t of this.children)t.isAttachedToRenderer||t.attachToRenderer(e)}update(e){}dispose(){if(super.dispose(),this.children)for(const e of this.children)e.dispose();this.children=null,this.renderer=null,this.worldModelMatrix=null,this.invWorldModelMatrix=null,this.localBoundingBox=null,this.worldBoundingBox=null}updateModelMatrixFromParent(){a.Float44.copy(this.localModelMatrix,this.worldModelMatrix),this.parent&&a.Float44.multiply(this.parent.worldModelMatrix,this.worldModelMatrix,this.worldModelMatrix),a.Float44.invert(this.worldModelMatrix,this.invWorldModelMatrix);for(const e of this.children)e.updateModelMatrixFromParent()}setModelMatrix(e,t,r){a.Float44.identity(this.localModelMatrix),null!==e&&a.Float44.translate(this.localModelMatrix,e,this.localModelMatrix),null!=t&&a.Float44.multiply(this.localModelMatrix,a.Float44.fromQuat(t),this.localModelMatrix),null!=r&&(this.scale=r,a.Float44.scale(this.localModelMatrix,r,this.localModelMatrix)),this.updateModelMatrixFromParent()}setModelMatrixFromMatrix(e){a.Float44.scale(e,this.scale,this.localModelMatrix),this.updateModelMatrixFromParent()}addChild(e){e.parent&&(e.parent.children=e.parent.children.filter((t=>t!==e))),e.parent=this,this.children.push(e),this.isAttachedToRenderer&&e.attachToRenderer(this.renderer),e.once("disposed",(()=>{this.children=this.children.filter((e=>!e.isDisposing))})),e.updateModelMatrixFromParent()}setBoundingBox(e){this.localBoundingBox=a.AABB.transform(e,this.localModelMatrix),this.worldBoundingBox=a.AABB.transform(e,this.worldModelMatrix)}}t.WorldPositionedObject=o},8680:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});const a="precision mediump float;\r\n\r\nvarying vec4 v_color;\r\nvarying vec2 v_texCoord1;\r\nvarying vec2 v_texCoord2;\r\nvarying vec2 v_texCoord3;\r\nvarying float v_alphaCutoff;\r\n\r\nuniform int u_pixelShader;\r\nuniform sampler2D u_texture1;\r\nuniform sampler2D u_texture2;\r\nuniform sampler2D u_texture3;\r\nuniform float u_alphaTreshold;\r\nuniform float u_alphaMult;\r\nuniform float u_colorMult;\r\n\r\nvoid main(void) {\r\n    vec4 tex = vec4(1, 1, 1, 1);\r\n    vec4 tex2 = vec4(1, 1, 1, 1);\r\n    vec4 tex3 = vec4(1, 1, 1, 1);\r\n\r\n    // gl_FragColor = color;\r\n    tex = texture2D(u_texture1, v_texCoord1).rgba;\r\n    tex2 = texture2D(u_texture2, v_texCoord2).rgba;\r\n    tex3 = texture2D(u_texture3, v_texCoord3).rgba;\r\n\r\n    vec3 matDiffuse = (tex * v_color).rgb; \r\n    float opacity = tex.a * v_color.a;\r\n\r\n    if (u_pixelShader == 0) {\r\n        matDiffuse = v_color.xyz * tex.rgb;\r\n        opacity = tex.a*v_color.a;    \r\n    } else if (u_pixelShader == 1) {\r\n        vec4 textureMod = tex*tex2;\r\n        float texAlpha = (textureMod.w * tex3.w);\r\n        opacity = texAlpha*v_color.a;\r\n        matDiffuse = v_color.xyz * textureMod.rgb;\r\n    } else if (u_pixelShader == 2) {\r\n        vec4 textureMod = tex*tex2*tex3;\r\n        float texAlpha = textureMod.w;\r\n        matDiffuse = v_color.xyz * textureMod.rgb;\r\n        opacity = texAlpha*v_color.a;\r\n    } else if (u_pixelShader == 3) {\r\n        vec4 textureMod = tex*tex2*tex3;\r\n        float texAlpha = textureMod.w;\r\n        matDiffuse = v_color.xyz;\r\n        opacity = texAlpha*v_color.a;\r\n    } else if (u_pixelShader == 4) {\r\n        discard; \r\n    }\r\n    \r\n    matDiffuse = matDiffuse.rgb * u_colorMult;\r\n    opacity = opacity * u_alphaMult;\r\n\r\n    if (opacity < u_alphaTreshold) {\r\n        discard;\r\n    }\r\n    if (opacity < v_alphaCutoff) {\r\n        discard;\r\n    }\r\n    \r\n    gl_FragColor = vec4(matDiffuse.rgb, opacity);\r\n}"},8803:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(7229),t),i(r(2690),t),i(r(7347),t)},8875:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Float44=t.Float33=void 0;const a=r(3055),i="undefined"!=typeof Float32Array?Float32Array:Array;var o,n;!function(e){function t(e){if(e)return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e;const t=new i(9);return i!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}e.create=function(...e){const t=new i(9);for(let r=0;r<e.length&&r<9;r++)t[r]=e[r];return t},e.identity=t,e.getRotationMatrix=function(e,r){return(r=r||t())[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r},e.getColumn=function(e,t,r){return(r=r||a.Float3.zero())[0]=e[3*t],r[1]=e[3*t+1],r[2]=e[3*t+2],r},e.fromQuat=function(e,r){return(r=r||t())[0]=1-2*(e[1]*e[1]-e[2]*e[2]),r[1]=2*(e[1]*e[0]+e[3]*e[2]),r[2]=2*(e[2]*e[0]-e[3]*e[1]),r[3]=2*(e[1]*e[0]-e[3]*e[2]),r[4]=1-2*(e[0]*e[0]-e[2]*e[2]),r[5]=2*(e[2]*e[1]+e[3]*e[0]),r[6]=2*(e[2]*e[0]+e[3]*e[1]),r[7]=2*(e[2]*e[1]-e[3]*e[0]),r[8]=1-2*(e[0]*e[0]-e[1]*e[1]),r},e.copy=function(e,r){return(r=r||t())[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r},e.multiply=function(e,r,a){a=a||t();const i=e[0],o=e[1],n=e[2],s=e[3],l=e[4],u=e[5],d=e[6],c=e[7],h=e[8],f=r[0],p=r[1],m=r[2],g=r[3],y=r[4],x=r[5],v=r[6],b=r[7],_=r[8];return a[0]=f*i+p*s+m*d,a[1]=f*o+p*l+m*c,a[2]=f*n+p*u+m*h,a[3]=g*i+y*s+x*d,a[4]=g*o+y*l+x*c,a[5]=g*n+y*u+x*h,a[6]=v*i+b*s+_*d,a[7]=v*o+b*l+_*c,a[8]=v*n+b*u+_*h,a},e.scale=function(e,r,a){return(a=a||t())[0]=e[0]*r,a[1]=e[1]*r,a[2]=e[2]*r,a[3]=e[3]*r,a[4]=e[4]*r,a[5]=e[5]*r,a[6]=e[6]*r,a[7]=e[7]*r,a[8]=e[8]*r,a},e.transformDir=function(e,t,r){let a=e[0],i=e[1],o=e[2];return r[0]=a*t[0]+i*t[3]+o*t[6],r[1]=a*t[1]+i*t[4]+o*t[7],r[2]=a*t[2]+i*t[5]+o*t[8],r}}(o||(t.Float33=o={})),function(e){function t(e){if(e)return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e;const t=new i(16);return i!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}e.identity=t,e.create=function(...e){const t=new i(16);for(let r=0;r<e.length&&r<16;r++)t[r]=e[r];return t},e.copy=function(e,r){return(r=r||t())[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},e.tranpose=function(e,r){if(e===(r=r||t())){let t=r[1];return e[1]=r[4],e[4]=t,t=r[2],e[2]=r[8],e[8]=t,t=e[3],e[3]=r[12],e[12]=t,t=e[6],e[6]=r[9],e[9]=t,t=e[7],e[7]=r[13],e[13]=t,t=e[11],e[11]=r[14],e[14]=t,r}return r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15],e},e.invert=function(e,r){r=r||t();const a=e[0],i=e[1],o=e[2],n=e[3],s=e[4],l=e[5],u=e[6],d=e[7],c=e[8],h=e[9],f=e[10],p=e[11],m=e[12],g=e[13],y=e[14],x=e[15];var v=a*l-i*s,b=a*u-o*s,_=a*d-n*s,F=i*u-o*l,C=i*d-n*l,w=o*d-n*u,M=c*g-h*m,S=c*y-f*m,D=c*x-p*m,A=h*y-f*g,T=h*x-p*g,E=f*x-p*y,B=v*E-b*T+_*A+F*D-C*S+w*M;return B?(B=1/B,r[0]=(l*E-u*T+d*A)*B,r[1]=(o*T-i*E-n*A)*B,r[2]=(g*w-y*C+x*F)*B,r[3]=(f*C-h*w-p*F)*B,r[4]=(u*D-s*E-d*S)*B,r[5]=(a*E-o*D+n*S)*B,r[6]=(y*_-m*w-x*b)*B,r[7]=(c*w-f*_+p*b)*B,r[8]=(s*T-l*D+d*M)*B,r[9]=(i*D-a*T-n*M)*B,r[10]=(m*C-g*_+x*v)*B,r[11]=(h*_-c*C-p*v)*B,r[12]=(l*S-s*A-u*M)*B,r[13]=(a*A-i*S+o*M)*B,r[14]=(g*b-m*F-y*v)*B,r[15]=(c*F-h*b+f*v)*B,r):(t(r),r)},e.multiply=function(e,r,a){a=a||t();const i=e[0],o=e[1],n=e[2],s=e[3],l=e[4],u=e[5],d=e[6],c=e[7],h=e[8],f=e[9],p=e[10],m=e[11],g=e[12],y=e[13],x=e[14],v=e[15],b=r[0],_=r[1],F=r[2],C=r[3],w=r[4],M=r[5],S=r[6],D=r[7],A=r[8],T=r[9],E=r[10],B=r[11],k=r[12],L=r[13],P=r[14],I=r[15];return a[0]=b*i+_*l+F*h+C*g,a[1]=b*o+_*u+F*f+C*y,a[2]=b*n+_*d+F*p+C*x,a[3]=b*s+_*c+F*m+C*v,a[4]=w*i+M*l+S*h+D*g,a[5]=w*o+M*u+S*f+D*y,a[6]=w*n+M*d+S*p+D*x,a[7]=w*s+M*c+S*m+D*v,a[8]=A*i+T*l+E*h+B*g,a[9]=A*o+T*u+E*f+B*y,a[10]=A*n+T*d+E*p+B*x,a[11]=A*s+T*c+E*m+B*v,a[12]=k*i+L*l+P*h+I*g,a[13]=k*o+L*u+P*f+I*y,a[14]=k*n+L*d+P*p+I*x,a[15]=k*s+L*c+P*m+I*v,a},e.translate=function(e,r,a){return e===(a=a||t())?(a[12]=e[0]*r[0]+e[4]*r[1]+e[8]*r[2]+e[12],a[13]=e[1]*r[0]+e[5]*r[1]+e[9]*r[2]+e[13],a[14]=e[2]*r[0]+e[6]*r[1]+e[10]*r[2]+e[14],a[15]=e[3]*r[0]+e[7]*r[1]+e[11]*r[2]+e[15]):(a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a[4]=e[4],a[5]=e[5],a[6]=e[6],a[7]=e[7],a[8]=e[8],a[9]=e[9],a[10]=e[10],a[11]=e[11],a[12]=e[0]*r[0]+e[4]*r[1]+e[8]*r[2]+e[12],a[13]=e[1]*r[0]+e[5]*r[1]+e[9]*r[2]+e[13],a[14]=e[2]*r[0]+e[6]*r[1]+e[10]*r[2]+e[14],a[15]=e[3]*r[0]+e[7]*r[1]+e[11]*r[2]+e[15]),a},e.scale=function(e,r,a){(a=a||t())[0]=e[0]*r[0],a[1]=e[1]*r[0],a[2]=e[2]*r[0],a[3]=e[3]*r[0],a[4]=e[4]*r[1],a[5]=e[5]*r[1],a[6]=e[6]*r[1],a[7]=e[7]*r[1],a[8]=e[8]*r[2],a[9]=e[9]*r[2],a[10]=e[10]*r[2],a[11]=e[11]*r[2],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]},e.rotateX=function(e,r,a){e!==(a=a||t())&&(a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]);const i=Math.sin(r),o=Math.cos(r),n=e[4],s=e[5],l=e[6],u=e[7],d=e[8],c=e[9],h=e[10],f=e[11];return a[4]=n*o+d*i,a[5]=s*o+c*i,a[6]=l*o+h*i,a[7]=u*o+f*i,a[8]=d*o-n*i,a[9]=c*o-s*i,a[10]=h*o-l*i,a[11]=f*o-u*i,a},e.rotateY=function(e,r,a){e!==(a=a||t())&&(a[4]=e[4],a[5]=e[5],a[6]=e[6],a[7]=e[7],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]);const i=Math.sin(r),o=Math.cos(r),n=e[0],s=e[1],l=e[2],u=e[3],d=e[8],c=e[9],h=e[10],f=e[11];return a[0]=n*o-d*i,a[1]=s*o-c*i,a[2]=l*o-h*i,a[3]=u*o-f*i,a[8]=n*i+d*o,a[9]=s*i+c*o,a[10]=l*i+h*o,a[11]=u*i+f*o,a},e.rotateZ=function(e,r,a){e!==(a=a||t())&&(a[8]=e[8],a[9]=e[9],a[10]=e[10],a[11]=e[11],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]);const i=Math.sin(r),o=Math.cos(r),n=e[0],s=e[1],l=e[2],u=e[3],d=e[4],c=e[5],h=e[6],f=e[7];return a[0]=n*o+d*i,a[1]=s*o+c*i,a[2]=l*o+h*i,a[3]=u*o+f*i,a[4]=d*o-n*i,a[5]=c*o-s*i,a[6]=h*o-l*i,a[7]=f*o-u*i,a},e.createWithTranslation=function(e,r){return(r=r||t())[12]=e[0],r[13]=e[1],r[14]=e[2],r},e.fromQuat=function(e,r){r=r||t();const a=e[0],i=e[1],o=e[2],n=e[3],s=a+a,l=i+i,u=o+o,d=a*s,c=a*l,h=a*u,f=i*l,p=i*u,m=o*u,g=n*s,y=n*l,x=n*u;return r[0]=1-(f+m),r[1]=c+x,r[2]=h-y,r[3]=0,r[4]=c-x,r[5]=1-(d+m),r[6]=p+g,r[7]=0,r[8]=h+y,r[9]=p-g,r[10]=1-(d+f),r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},e.getTranslation=function(e,t){return(t=t||a.Float3.zero())[0]=e[12],t[1]=e[13],t[2]=e[14],t},e.transformPoint=function(e,t,r){r=r||a.Float3.zero();let i=e[0],o=e[1],n=e[2],s=t[3]*i+t[7]*o+t[11]*n+t[15];return s=s||1,r[0]=(t[0]*i+t[4]*o+t[8]*n+t[12])/s,r[1]=(t[1]*i+t[5]*o+t[9]*n+t[13])/s,r[2]=(t[2]*i+t[6]*o+t[10]*n+t[14])/s,r},e.transformDirection4=function(e,t,r){r=r||a.Float4.zero();const i=e[0],o=e[1],n=e[2],s=e[3];return r[0]=t[0]*i+t[4]*o+t[8]*n+t[12]*s,r[1]=t[1]*i+t[5]*o+t[9]*n+t[13]*s,r[2]=t[2]*i+t[6]*o+t[10]*n+t[14]*s,r[3]=t[3]*i+t[7]*o+t[11]*n+t[15]*s,r},e.transformDirection3=function(e,t,r){let a=e[0],i=e[1],o=e[2],n=t[3]*a+t[7]*i+t[11]*o+t[15];return n=n||1,r[0]=(t[0]*a+t[4]*i+t[8]*o+t[12])/n,r[1]=(t[1]*a+t[5]*i+t[9]*o+t[13])/n,r[2]=(t[2]*a+t[6]*i+t[10]*o+t[14])/n,r},e.transformDirection3_1=function(e,t,r){r=r||a.Float3.zero();const i=e[0],o=e[1],n=e[2];return r[0]=t[0]*i+t[4]*o+t[8]*n+t[12],r[1]=t[1]*i+t[5]*o+t[9]*n+t[13],r[2]=t[2]*i+t[6]*o+t[10]*n+t[14],r},e.transformDirection3_0=function(e,t,r){r=r||a.Float3.zero();const i=e[0],o=e[1],n=e[2];return r[0]=t[0]*i+t[4]*o+t[8]*n,r[1]=t[1]*i+t[5]*o+t[9]*n,r[2]=t[2]*i+t[6]*o+t[10]*n,r},e.perspective=function(t,r,a,i,o){o=o||e.identity();const n=1/Math.tan(t/2);if(o[0]=n/r,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=n,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,null!==i&&i!==1/0){const e=1/(a-i);o[10]=(i+a)*e,o[14]=2*i*a*e}else o[10]=-1,o[14]=-2*a;return o},e.getColumn4=function(e,t){return a.Float4.create(e[4*t+0],e[4*t+1],e[4*t+2],0)},e.getColumn3=function(e,t){return a.Float3.create(e[4*t+0],e[4*t+1],e[4*t+2])},e.setColumn=function(e,t,r){for(let a=0;a<4;a++)e[4*t+a]=r[a]},e.lookAt=function(e,t,r,i){const o=a.Float3.normalize(a.Float3.subtract(e,t)),n=a.Float3.normalize(a.Float3.cross(r,o)),s=a.Float3.normalize(a.Float3.cross(o,n));return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=0,i[4]=s[0],i[5]=s[1],i[6]=s[2],i[7]=0,i[8]=o[0],i[9]=o[1],i[10]=o[2],i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i},e.transformMatrix=function(t,r,i,o,n,s){return s=s||e.identity(),e.fromQuat(a.Float4.quatFromEulers(o,i,r),s),e.translate(s,t,s),e.scale(s,a.Float3.fromScalar(n),s),s}}(n||(t.Float44=n={}))},8997:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});const a="attribute vec3 a_position;\r\nattribute vec4 a_color;\r\nattribute vec2 a_texCoord1;\r\nattribute vec2 a_texCoord2;\r\nattribute vec2 a_texCoord3;\r\nattribute float a_alphaCutoff;\r\n\r\nvarying vec4 v_color;\r\nvarying vec2 v_texCoord1;\r\nvarying vec2 v_texCoord2;\r\nvarying vec2 v_texCoord3;\r\nvarying float v_alphaCutoff;\r\n\r\nuniform mat4 u_projectionMatrix;\r\nuniform mat4 u_viewMatrix;\r\n\r\nvoid main(void) {\r\n    vec4 pos = vec4(a_position, 1);\r\n    gl_Position = u_projectionMatrix * u_viewMatrix * pos;\r\n    \r\n    v_color = a_color;\r\n    v_texCoord1 = a_texCoord1;\r\n    v_texCoord2 = a_texCoord2;\r\n    v_texCoord3 = a_texCoord3;\r\n    v_alphaCutoff = a_alphaCutoff;\r\n}"},9257:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});const a="precision mediump float;\r\n            \r\nuniform float u_drawX;\r\nuniform float u_drawY;\r\nuniform float u_drawWidth;\r\nuniform float u_drawHeight;\r\nuniform bool u_isUpscaled;\r\nuniform vec2 u_textureResolution;\r\n\r\nattribute vec2 a_texCoord;\r\nvarying vec2 v_texCoord;\r\n\r\nconst float FUDGE_FACTOR = 0.3;\r\n\r\nvoid main() {\r\n    vec2 final_texCoord = a_texCoord.xy;\r\n    // Fudge texture coords slightly to remove upscaling artifacts\r\n    if (u_isUpscaled) {\r\n        final_texCoord.x = max(\r\n            min(final_texCoord.x, (u_textureResolution.x - FUDGE_FACTOR) / u_textureResolution.x),\r\n            FUDGE_FACTOR / u_textureResolution.x);\r\n        final_texCoord.y = max(\r\n            min(final_texCoord.y, (u_textureResolution.y - FUDGE_FACTOR) / u_textureResolution.y),\r\n            FUDGE_FACTOR / u_textureResolution.y\r\n        );\r\n    }\r\n\r\n    v_texCoord = final_texCoord;\r\n    \r\n    vec2 pos = vec2(\r\n        (u_drawX + a_texCoord.x * u_drawWidth)* 2.0 - 1.0,\r\n        (u_drawY + a_texCoord.y * u_drawHeight)* 2.0 - 1.0\r\n    );\r\n    \r\n    gl_Position = vec4(pos.x, pos.y, 0, 1);\r\n}"},9266:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};function o(e,t,r){return r.indexOf(e)===t}Object.defineProperty(t,"__esModule",{value:!0}),t.hasFlagsActive=function(e,t){return(e&t)===t},t.distinct=function(e){return e.filter(o)},i(r(3975),t)},9277:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(7906),t),i(r(9297),t)},9297:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},9551:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(4741),t),i(r(7243),t),i(r(4176),t),i(r(2567),t)},9663:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectIdentifier=void 0,t.ObjectIdentifier=class{constructor(){this.counter=0}createIdentifier(e){return this.counter++}}},9681:e=>{"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},9716:function(e,t){"use strict";var r=this&&this.__awaiter||function(e,t,r,a){return new(r||(r=Promise))((function(i,o){function n(e){try{l(a.next(e))}catch(e){o(e)}}function s(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,s)}l((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultDataManager=void 0,t.DefaultDataManager=class{constructor(e){this.runningRequests={},this.dataLoader=e.getDataLoader(),this.progress=e.getProgressReporter(),this.errorHandler=e.getErrorHandler(),this.cache=e.getObjectFactory().createCache()}update(e){this.cache.update(e)}getM2ModelFile(e){const t="M2-"+e;return this.getDataFromLoaderOrCache(t,(t=>t.loadModelFile(e)))}getWMOModelFile(e){const t="WMO-"+e;return this.getDataFromLoaderOrCache(t,(t=>t.loadWorldModelFile(e)))}getLiquidTypeMetadata(e){const t="LIQUID-"+e;return this.getDataFromLoaderOrCache(t,(t=>t.loadLiquidTypeMetadata(e)))}getCharacterMetadata(e){const t="CHARACTER-"+e;return this.getDataFromLoaderOrCache(t,(t=>t.loadCharacterMetadata(e)))}getItemMetadata(e){const t="ITEM-"+e;return this.getDataFromLoaderOrCache(t,(t=>t.loadItemMetadata(e)))}getTextureVariationsMetadata(e){const t="TEXTUREVAR-"+e;return this.getDataFromLoaderOrCache(t,(t=>t.loadTextureVariationsMetadata(e)))}getBoneFileData(e){const t="BONES-"+e;return this.getDataFromLoaderOrCache(t,(t=>t.loadBoneFile(e)))}getTextureImageData(e){const t="IMG-"+e;return this.getDataFromLoaderOrCache(t,(t=>t.loadTexture(e)))}getItemVisualMetadata(e){const t="ITEMVISUAL-"+e;return this.getDataFromLoaderOrCache(t,(t=>t.loadItemvisualMetadata(e)))}getSpellVisualKitMetadata(e){const t="SPELLVISUALKIT-"+e;return this.getDataFromLoaderOrCache(t,(t=>t.loadSpellVisualKitMetadata(e)))}getDataFromLoaderOrCache(e,t){return r(this,void 0,void 0,(function*(){var r,a,i,o;if(this.runningRequests[e]){const t=yield this.runningRequests[e];return t instanceof Error?null:t}if(this.cache.contains(e))return this.cache.get(e);null===(r=this.progress)||void 0===r||r.setOperation("Loading model data..."),null===(a=this.progress)||void 0===a||a.addFileToOperation(e);const n=t(this.dataLoader);this.runningRequests[e]=n;const s=yield n;return delete this.runningRequests[e],null===(i=this.progress)||void 0===i||i.removeFileFromOperation(e),s instanceof Error?(null===(o=this.errorHandler)||void 0===o||o.call(this,"dataFetching",e,s),null):(this.cache.store(e,s),s)}))}}},9724:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},9795:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ModelAttachment=void 0;const a=r(1639),i=r(8521);class o extends i.WorldPositionedObject{constructor(e,t){super(),this.parentModel=e,this.parentModel.addChild(this),this.attachment=t}get isLoaded(){return this.children.every((e=>e.isLoaded))}update(e){if(this.isDisposing)return;const t=this.parentModel.getBone(this.attachment.bone);a.Float44.translate(t.positionMatrix,this.attachment.position,this.localModelMatrix),this.updateModelMatrixFromParent()}draw(){this.isDisposing}pauseAnimation(){for(const e of this.children)e.pauseAnimation()}resumeAnimation(){for(const e of this.children)e.resumeAnimation()}}t.ModelAttachment=o},9805:e=>{"use strict";const t=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);e.exports.assign=function(e){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const a=r.shift();if(a){if("object"!=typeof a)throw new TypeError(a+"must be non-object");for(const r in a)t(a,r)&&(e[r]=a[r])}}return e},e.exports.flattenChunks=e=>{let t=0;for(let r=0,a=e.length;r<a;r++)t+=e[r].length;const r=new Uint8Array(t);for(let t=0,a=0,i=e.length;t<i;t++){let i=e[t];r.set(i,a),a+=i.length}return r}},9886:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.M2ShaderBuilder=void 0;const a=r(4176),i={a_position:0,a_normal:1,a_bones:2,a_boneWeights:3,a_texcoord1:4,a_texcoord2:5};t.M2ShaderBuilder=class{static getAttribLocations(){return i}static getShaderProgram(e,t,r,a){const i=this.getShaderName(r,a),[o,n]=this.getShaderProgramTexts(e,r,a);return e.getShaderProgram(t,i,o,n,this.getAttribLocations())}static getShaderName(e,t){const r=(0,a.getM2VertexShaderId)(e,t),i=(0,a.getM2PixelShaderId)(e,t);return"M2-"+a.M2VertexShader[r]+"-"+a.M2PixelShader[i]}static getShaderProgramTexts(e,t,r){const i=(0,a.getM2VertexShaderId)(t,r),o=(0,a.getM2PixelShaderId)(t,r),n=this.getVertexShaderParams(i);return[this.getVertProgramText(i,n.numTexCoords,n.hasEdgeScan,n.hasPtt),this.getFragProgramText(e,o,n.numTexCoords)]}static getAttribLocation(e){return i[e]}static getVertexShaderParams(e){const t=a.M2VertexShader[e].split("_");let r=0,i=!1,o=!1;return"BW"===t[0]?r=1:"Color"===t[0]?r=3:(i=t.some((e=>"EdgeFade"===e)),o=t.some((e=>"Env"===e)),r=t.length,i&&(r-=1)),{numTexCoords:r,hasEdgeScan:i,hasPtt:o}}static getVertProgramText(e,t,r,a){return`attribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec4 a_bones;\nattribute vec4 a_boneWeights;\nattribute vec2 a_texcoord1;\nattribute vec2 a_texcoord2;\n\nuniform mat4 u_textureTransformMatrix1;\nuniform mat4 u_textureTransformMatrix2;\nuniform mat4 u_modelMatrix;\nuniform mat4 u_viewMatrix;\nuniform mat4 u_projectionMatrix;\nuniform vec4 u_color;\nuniform int u_vertexShader;\n\nuniform int u_numBones;\nuniform sampler2D u_boneMatrices;\n\nvarying vec3 v_normal;\nvarying vec4 v_color;\n${t>=1?"varying vec2 v_texCoord1;":""}\n${t>=2?"varying vec2 v_texCoord2;":""}\n${t>=3?"varying vec2 v_texCoord3;":""}\n\nmat4 invert(mat4 inputMatrix) {\n    float\n        m00 = inputMatrix[0][0], m01 = inputMatrix[0][1], m02 = inputMatrix[0][2], m03 = inputMatrix[0][3],\n        m10 = inputMatrix[1][0], m11 = inputMatrix[1][1], m12 = inputMatrix[1][2], m13 = inputMatrix[1][3],\n        m20 = inputMatrix[2][0], m21 = inputMatrix[2][1], m22 = inputMatrix[2][2], m23 = inputMatrix[2][3],\n        m30 = inputMatrix[3][0], m31 = inputMatrix[3][1], m32 = inputMatrix[3][2], m33 = inputMatrix[3][3];\n\n    float \n        t0 = m00 * m11 - m01 * m10,\n        t1 = m00 * m12 - m02 * m10,\n        t2 = m00 * m13 - m03 * m10,\n        t3 = m01 * m12 - m02 * m11,\n        t4 = m01 * m13 - m03 * m11,\n        t5 = m02 * m13 - m03 * m12,\n        t6 = m20 * m31 - m21 * m30,\n        t7 = m20 * m32 - m22 * m30,\n        t8 = m20 * m33 - m23 * m30,\n        t9 = m21 * m32 - m22 * m31,\n        t10 = m21 * m33 - m23 * m31,\n        t11 = m22 * m33 - m23 * m32,\n        determinant = t0 * t11 - t1 * t10 + t2 * t9 + t3 * t8 - t4 * t7 + t5 * t6;\n\n    return mat4(\n        m11 * t11 - m12 * t10 + m13 * t9,\n        m02 * t10 - m01 * t11 - m03 * t9,\n        m31 * t5 - m32 * t4 + m33 * t3,\n        m22 * t4 - m21 * t5 - m23 * t3,\n        m12 * t8 - m10 * t11 - m13 * t7,\n        m00 * t11 - m02 * t8 + m03 * t7,\n        m32 * t2 - m30 * t5 - m33 * t1,\n        m20 * t5 - m22 * t2 + m23 * t1,\n        m10 * t10 - m11 * t8 + m13 * t6,\n        m01 * t8 - m00 * t10 - m03 * t6,\n        m30 * t4 - m31 * t2 + m33 * t0,\n        m21 * t2 - m20 * t4 - m23 * t0,\n        m11 * t7 - m10 * t9 - m12 * t6,\n        m00 * t9 - m01 * t7 + m02 * t6,\n        m31 * t1 - m30 * t3 - m32 * t0,\n        m20 * t3 - m21 * t1 + m22 * t0\n    ) / determinant;\n}\n\nhighp mat4 transpose(in highp mat4 inputMatrix) {\n    return mat4(\n        vec4(inputMatrix[0][0], inputMatrix[1][0], inputMatrix[2][0], inputMatrix[3][0]),\n        vec4(inputMatrix[0][1], inputMatrix[1][1], inputMatrix[2][1], inputMatrix[3][1]),\n        vec4(inputMatrix[0][2], inputMatrix[1][2], inputMatrix[2][2], inputMatrix[3][2]),\n        vec4(inputMatrix[0][3], inputMatrix[1][3], inputMatrix[2][3], inputMatrix[3][3])\n    );\n}\n\nmat4 getBoneMatrix(float index) {\n    float row = (index + 0.5) / float(u_numBones);\n    return mat4(\n        texture2D(u_boneMatrices, vec2(0.5/4., row)),\n        texture2D(u_boneMatrices, vec2(1.5/4., row)),\n        texture2D(u_boneMatrices, vec2(2.5/4., row)),\n        texture2D(u_boneMatrices, vec2(3.5/4., row))\n    );\n}\n\n${a?this.getVsPosToTexCoordFn():""}\n${r?this.getVsEdgeScanFn():""}\nvoid main(void) {\n    mat4 boneTransformMatrix =  mat4(1.0);\n    if (length(a_boneWeights) > 0.0) {\n        boneTransformMatrix =  mat4(0.0);\n        for (int i = 0; i < 4; i++) {\n            boneTransformMatrix += getBoneMatrix(a_bones[i]) * a_boneWeights[i];\n        }\n    }\n\n    mat4 posMatrix = u_viewMatrix * u_modelMatrix * boneTransformMatrix;\n    vec4 pos = posMatrix * vec4(a_position, 1);\n    gl_Position = u_projectionMatrix * pos;\n\n    mat4 normalMatrix = transpose(invert(posMatrix));\n    v_normal = normalize((normalMatrix * vec4(a_normal, 0.0)).xyz);\n    \n    vec4 clampedColor = clamp(u_color, 0., 1.);\n    vec4 halfColor = clampedColor * 0.5;\n\n    ${t>=1?"v_texCoord1 = vec2(0.0, 0.0);":""}\n    ${t>=2?"v_texCoord2 = vec2(0.0, 0.0);":""}\n    ${t>=3?"v_texCoord3 = vec2(0.0, 0.0);":""}\n    ${this.getVertexShaderText(e)}\n}\n`}static getFragProgramText(e,t,r){return`precision mediump float;\n\nvarying vec3 v_normal;\nvarying vec4 v_color;\n${r>=1?"varying vec2 v_texCoord1;":""}\n${r>=2?"varying vec2 v_texCoord2;":""}\n${r>=3?"varying vec2 v_texCoord3;":""}\n\nuniform int u_blendMode;\nuniform bool u_unlit;\n${e.getLightingUniforms()}\n\nuniform sampler2D u_texture1;\nuniform sampler2D u_texture2;\nuniform sampler2D u_texture3;\nuniform sampler2D u_texture4;\nuniform vec4 u_textureWeights;\n\n${e.getLightingFunction()}\n        \nvoid main(void) {\n    vec4 outputColor = vec4(1.0);\n    vec3 specular = vec3(0.0);\n\n    ${r>=1?"vec4 tex1 = texture2D(u_texture1, v_texCoord1.st);":""}\n    ${r>=2?"vec4 tex2 = texture2D(u_texture2, v_texCoord2.st);":""}\n    ${r>=3?"vec4 tex3 = texture2D(u_texture3, v_texCoord3.st);":""}\n\n    vec3 materialColor;\n    float discardAlpha = 1.0;\n${this.getPixelShaderText(t)}\n\n    if (u_blendMode == 13) {\n        outputColor.a = discardAlpha * v_color.a;\n    } else if (u_blendMode == 1) {\n        if (discardAlpha < (128.0 / 255.0))\n            discard;\n        outputColor.a = v_color.a;\n    } else if (u_blendMode == 0) {\n        outputColor.a = v_color.a;\n    } else {\n        outputColor.a = discardAlpha * v_color.a;\n    }\n\n    outputColor.rgb = light(!u_unlit, materialColor, v_normal, vec3(0.), specular, vec3(0.));\n    \n    gl_FragColor = outputColor;\n}\n`}static getPixelShaderText(e){switch(e){case a.M2PixelShader.Combiners_Opaque:return"\nmaterialColor = v_color.rgb * 2.0 * tex1.rgb;\n";case a.M2PixelShader.Combiners_Mod:return"\nmaterialColor = v_color.rgb * 2.0 * tex1.rgb;\ndiscardAlpha = tex1.a;\n";case a.M2PixelShader.Combiners_Opaque_Mod:return"\nmaterialColor = v_color.rgb * 2.0 * tex1.rgb * tex2.rgb;\ndiscardAlpha = tex2.a;\n";case a.M2PixelShader.Combiners_Opaque_Mod2x:return"\nmaterialColor = v_color.rgb * 2.0 * tex1.rgb * tex2.rgb * 2.0;\ndiscardAlpha = tex2.a * 2.0;\n";case a.M2PixelShader.Combiners_Opaque_Mod2xNA:return"\nmaterialColor = v_color.rgb * 2.0 * tex1.rgb * tex2.rgb * 2.0;\n";case a.M2PixelShader.Combiners_Opaque_Opaque:return"\nmaterialColor = v_color.rgb * 2.0 * tex1.rgb * tex2.rgb;\n";case a.M2PixelShader.Combiners_Mod_Mod:return"\nmaterialColor = v_color.rgb * 2.0 * tex1.rgb * tex2.rgb;\ndiscardAlpha = tex1.a * tex2.a;\n";case a.M2PixelShader.Combiners_Mod_Mod2x:return"\nmaterialColor = v_color.rgb * 2.0 * tex1.rgb * tex2.rgb * 2.0;\ndiscardAlpha = tex1.a * tex2.a * 2.0;\n";case a.M2PixelShader.Combiners_Mod_Add:return"\nmaterialColor = v_color.rgb * 2.0 * tex1.rgb;\ndiscardAlpha = tex1.a + tex2.a;\nspecular = tex2.rgb;\n";case a.M2PixelShader.Combiners_Mod_Mod2xNA:return"\nmaterialColor = v_color.rgb * 2.0 * tex1.rgb * tex2.rgb * 2.0;\ndiscardAlpha = tex1.a;\n";case a.M2PixelShader.Combiners_Mod_AddNA:return"\nmaterialColor = v_color.rgb * 2.0 * tex1.rgb;\ndiscardAlpha = tex1.a;\nspecular = tex2.rgb;\n";case a.M2PixelShader.Combiners_Mod_Opaque:return"\nmaterialColor = v_color.rgb * 2.0 * tex1.rgb * tex2.rgb;\ndiscardAlpha = tex1.a;\n";case a.M2PixelShader.Combiners_Opaque_Mod2xNA_Alpha:return"\nmaterialColor = v_color.rgb * 2.0 * mix(tex1.rgb * tex2.rgb * 2.0, tex1.rgb, vec3(tex1.a));\n";case a.M2PixelShader.Combiners_Opaque_AddAlpha:return"\nmaterialColor = v_color.rgb * 2.0 * tex1.rgb;\nspecular = tex2.rgb * tex2.a;\n";case a.M2PixelShader.Combiners_Opaque_AddAlpha_Alpha:return"\nmaterialColor = v_color.rgb * 2.0 * tex1.rgb;\nspecular = tex2.rgb * tex2.a * (1.0 - tex1.a);\n";case a.M2PixelShader.Combiners_Opaque_Mod2xNA_Alpha_Add:return"\nmaterialColor = v_color.rgb * 2.0 * mix(tex1.rgb * tex2.rgb * 2.0, tex1.rgb, vec3(tex1.a));\nspecular = tex3.rgb * tex3.a * u_textureWeights.b;\n";case a.M2PixelShader.Combiners_Mod_AddAlpha:return"\nmaterialColor = v_color.rgb * 2.0 * tex1.rgb;\ndiscardAlpha = tex1.a;\nspecular = tex2.rgb * tex2.a;\n";case a.M2PixelShader.Combiners_Mod_AddAlpha_Alpha:return"\nmaterialColor = v_color.rgb * 2.0 * tex1.rgb;\ndiscardAlpha = tex1.a + tex2.a * (0.3 * tex2.r + 0.59 * tex2.g + 0.11 * tex2.b);\nspecular = tex2.rgb * tex2.a * (1.0 - tex1.a);\n";case a.M2PixelShader.Combiners_Opaque_Alpha_Alpha:return"\nmaterialColor = v_color.rgb * 2.0 * mix(mix(tex1.rgb, tex2.rgb, vec3(tex2.a)), tex1.rgb, vec3(tex1.a));\n";case a.M2PixelShader.Combiners_Opaque_Mod2xNA_Alpha_3s:return"\nmaterialColor = v_color.rgb * 2.0 * mix(tex1.rgb * tex2.rgb * 2.0, tex3.rgb, vec3(tex3.a));\n";case a.M2PixelShader.Combiners_Opaque_AddAlpha_Wgt:return"\nmaterialColor = v_color.rgb * 2.0 * tex1.rgb;\nspecular = tex2.rgb * tex2.a * u_textureWeights.g;\n";case a.M2PixelShader.Combiners_Mod_Add_Alpha:return"\nmaterialColor = v_color.rgb * 2.0 * tex1.rgb;\ndiscardAlpha = tex1.a + tex2.a;\nspecular = tex2.rgb * (1.0 - tex1.a);\n";case a.M2PixelShader.Combiners_Opaque_ModNA_Alpha:return"\nmaterialColor = v_color.rgb * 2.0 * mix(tex1.rgb * tex2.rgb, tex1.rgb, vec3(tex1.a));\n";case a.M2PixelShader.Combiners_Mod_AddAlpha_Wgt:return"\nmaterialColor = v_color.rgb * 2.0 * tex1.rgb;\ndiscardAlpha = tex1.a;\nspecular = tex2.rgb * tex2.a * u_textureWeights.g;\n";case a.M2PixelShader.Combiners_Opaque_Mod_Add_Wgt:return"\nmaterialColor = v_color.rgb * 2.0 * mix(tex1.rgb, tex2.rgb, vec3(tex2.a));\nspecular = tex1.rgb * tex1.a * u_textureWeights.r;\n";case a.M2PixelShader.Combiners_Opaque_Mod2xNA_Alpha_UnshAlpha:return"\nfloat glowOpacity = clamp(tex3.a * u_textureWeights.b, 0.0, 1.0);\nmaterialColor = v_color.rgb * 2.0 * mix(tex1.rgb * tex2.rgb * 2.0, tex1.rgb, vec3(tex1.a)) * (1.0 - glowOpacity);\nspecular = tex3.rgb * glowOpacity;\n";case a.M2PixelShader.Combiners_Mod_Dual_Crossfade:return"\nvec4 crossFaded = mix(mix(tex1, texture2D(u_texture2, v_texCoord1), vec4(clamp(u_textureWeights.g, 0.0, 1.0))), texture2D(u_texture3, v_texCoord1), vec4(clamp(u_textureWeights.b, 0.0, 1.0)));\nmaterialColor = v_color.rgb * 2.0 * crossFaded.rgb;\ndiscardAlpha = crossFaded.a;\n";case a.M2PixelShader.Combiners_Opaque_Mod2xNA_Alpha_Alpha:return"\nmaterialColor = v_color.rgb * 2.0 * mix(mix(tex1.rgb * tex2.rgb * 2.0, tex3.rgb, vec3(tex3.a)), tex1.rgb, vec3(tex1.a));\n";case a.M2PixelShader.Combiners_Mod_Masked_Dual_Crossfade:return"\nvec4 crossFaded = mix(mix(tex1, texture2D(u_texture2, v_texCoord1), vec4(clamp(u_textureWeights.g, 0.0, 1.0))), texture2D(u_texture3, v_texCoord1), vec4(clamp(u_textureWeights.b, 0.0, 1.0)));\nmaterialColor = v_color.rgb * 2.0 * crossFaded.rgb;\ndiscardAlpha = crossFaded.a * texture2D(u_texture4, v_texCoord2).a;\n";case a.M2PixelShader.Combiners_Opaque_Alpha:return"\nmaterialColor = v_color.rgb * 2.0 * mix(tex1.rgb, tex2.rgb, vec3(tex2.a));\n";case a.M2PixelShader.Guild:return"\nmaterialColor = v_color.rgb * 2.0 * mix(tex1.rgb * mix(vec3(1), tex2.rgb, vec3(tex2.a)), tex3.rgb, vec3(tex3.a));\ndiscardAlpha = tex1.a;\n";case a.M2PixelShader.Guild_NoBorder:return"\nmaterialColor = v_color.rgb * 2.0 * tex1.rgb * mix(vec3(1), tex2.rgb, vec3(tex2.a));\ndiscardAlpha = tex1.a;\n";case a.M2PixelShader.Guild_Opaque:return"\nmaterialColor = v_color.rgb * 2.0 * mix(tex1.rgb * mix(vec3(1), tex2.rgb, vec3(tex2.a)), tex3.rgb, vec3(tex3.a));\n";case a.M2PixelShader.Combiners_Mod_Depth:return"\nmaterialColor = v_color.rgb * 2.0 * tex1.rgb;\ndiscardAlpha = tex1.a;\n";case a.M2PixelShader.Illum:return"\ndiscardAlpha = tex1.a;\n";case a.M2PixelShader.Combiners_Mod_Mod_Mod_Const:return"\nmaterialColor = v_color.rgb * 2.0 * (tex1 * tex2 * tex3).rgb;\ndiscardAlpha = (tex1 * tex2 * tex3).a;\n";default:throw new Error("Unknown M2 Pixel shader: "+e)}}static getVsPosToTexCoordFn(){return"\nvec2 posToTexCoord(vec3 pos, vec3 normal) {\n    vec3 reflection = reflect(normalize(pos), normal);\n    return normalize(reflection).xy * 0.5 + vec2(0.5);\n}\n"}static getVsEdgeScanFn(){return"\nfloat edgeScan(vec3 position, vec3 normal){\n    float dotProductClamped = clamp(dot(-normalize(position),normal), 0., 1.);\n    return clamp(2.7 * dotProductClamped * dotProductClamped - 0.4, 0., 1.);\n}\n"}static getVertexShaderText(e){switch(e){case a.M2VertexShader.Diffuse_T1:return"\nv_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a);\nv_texCoord1 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\n";case a.M2VertexShader.Diffuse_Env:return"\nv_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a);\nv_texCoord1 = posToTexCoord(pos.xyz,normalize(v_normal.xyz));\n";case a.M2VertexShader.Diffuse_T1_T2:return"\nv_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a);\nv_texCoord1 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\nv_texCoord2 = (u_textureTransformMatrix2 * vec4(a_texcoord2, 0., 1.)).xy;\n";case a.M2VertexShader.Diffuse_T1_Env:return"\nv_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a);\nv_texCoord1 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\nv_texCoord2 = posToTexCoord(pos.xyz,normalize(v_normal.xyz));\n";case a.M2VertexShader.Diffuse_Env_T1:return"\nv_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a);\nv_texCoord1 = posToTexCoord(pos.xyz,normalize(v_normal.xyz));\nv_texCoord2 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\n";case a.M2VertexShader.Diffuse_Env_Env:return"\nv_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a);\nv_texCoord1 = posToTexCoord(pos.xyz,normalize(v_normal.xyz));\nv_texCoord2 = posToTexCoord(pos.xyz,normalize(v_normal.xyz));\n";case a.M2VertexShader.Diffuse_T1_Env_T1:return"\nv_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a);\nv_texCoord1 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\nv_texCoord2 = posToTexCoord(pos.xyz,normalize(v_normal.xyz));\nv_texCoord3 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\n";case a.M2VertexShader.Diffuse_T1_T1:return"\nv_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a);\nv_texCoord1 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\nv_texCoord2 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\n";case a.M2VertexShader.Diffuse_T1_T1_T1:return"\nv_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a);\nv_texCoord1 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\nv_texCoord2 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\nv_texCoord3 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\n";case a.M2VertexShader.Diffuse_EdgeFade_T1:return"\nv_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a * edgeScan(pos.xyz, v_normal.rgb));\nv_texCoord1 = ((u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy).xy;\n";case a.M2VertexShader.Diffuse_T2:return"\nv_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a);\nv_texCoord1 = (u_textureTransformMatrix2 * vec4(a_texcoord2, 0., 1.)).xy;\n";case a.M2VertexShader.Diffuse_T1_Env_T2:return"\nv_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a);\nv_texCoord1 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\nv_texCoord2 = posToTexCoord(pos.xyz,normalize(v_normal.xyz));\nv_texCoord3 = (u_textureTransformMatrix2 * vec4(a_texcoord2, 0., 1.)).xy;\n";case a.M2VertexShader.Diffuse_EdgeFade_T1_T2:return"\nv_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a * edgeScan(pos.xyz, v_normal.rgb));\nv_texCoord1 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\nv_texCoord2 = (u_textureTransformMatrix2 * vec4(a_texcoord2, 0., 1.)).xy;\n";case a.M2VertexShader.Diffuse_EdgeFade_Env:return"\nv_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a * edgeScan(pos.xyz, v_normal.rgb));\nv_texCoord1 = posToTexCoord(pos.xyz,normalize(v_normal.xyz));\n";case a.M2VertexShader.Diffuse_T1_T2_T1:return"\nv_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a);\nv_texCoord1 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\nv_texCoord2 = (u_textureTransformMatrix2 * vec4(a_texcoord2, 0., 1.)).xy;\nv_texCoord3 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\n";case a.M2VertexShader.Diffuse_T1_T2_T3:return"\nv_color = vec4(halfColor.r, halfColor.g, halfColor.b, clampedColor.a);\nv_texCoord1 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\nv_texCoord2 = (u_textureTransformMatrix2 * vec4(a_texcoord2, 0., 1.)).xy;\nv_texCoord3 = v_texCoord3;\n";case a.M2VertexShader.Color_T1_T2_T3:return"\nvec4 in_col0 = vec4(1.0, 1.0, 1.0, 1.0);\nv_color = vec4((in_col0.rgb * 0.5).r, (in_col0.rgb * 0.5).g, (in_col0.rgb * 0.5).b, in_col0.a);\nv_texCoord1 = (u_textureTransformMatrix2 * vec4(a_texcoord2, 0., 1.)).xy;\nv_texCoord2 = vec2(0., 0.);\nv_texCoord3 = v_texCoord3;\n";case a.M2VertexShader.BW_Diffuse_T1:case a.M2VertexShader.BW_Diffuse_T1_T2:return"\nv_color = vec4(clampedColor.rgb * 0.5, clampedColor.a);\nv_texCoord1 = (u_textureTransformMatrix1 * vec4(a_texcoord1, 0., 1.)).xy;\n";default:throw Error("Unknown M2 vertex shader: "+e)}}}},9889:function(e,t,r){"use strict";var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,i)}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(8169),t),i(r(7693),t)}},t={};function r(a){var i=t[a];if(void 0!==i)return i.exports;var o=t[a]={exports:{}};return e[a].call(o.exports,o,o.exports,r),o.exports}return r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r(8156)})()));